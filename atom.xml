<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>èŠ‹é“æºç  â€”â€” çº¯æºç è§£æBLOG</title>
  
  <subtitle>æ„¿åŠç”Ÿç¼–ç ï¼Œå¦‚ä¸€ç”Ÿè€å‹ï¼</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.iocoder.cn/"/>
  <updated>2017-12-27T12:55:08.000Z</updated>
  <id>http://www.iocoder.cn/</id>
  
  <author>
    <name>èŠ‹é“æºç </name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” Agent DictionaryManager å­—å…¸ç®¡ç†</title>
    <link href="http://www.iocoder.cn/SkyWalking/agent-dictionary/"/>
    <id>http://www.iocoder.cn/SkyWalking/agent-dictionary/</id>
    <published>2020-09-27T16:00:00.000Z</published>
    <updated>2017-12-27T12:55:08.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/agent-dictionary/">http://www.iocoder.cn/SkyWalking/agent-dictionary/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/agent-dictionary/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-dictionary/">2. Collector åŒæ­¥ç›¸å…³ API</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/agent-dictionary/">2.1 åº”ç”¨çš„åŒæ­¥ API</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-dictionary/">2.2 æ“ä½œçš„åŒæ­¥ API</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-dictionary/">3. Agent è°ƒç”¨åŒæ­¥ API</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/agent-dictionary/">3.1 DictionaryManager</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-dictionary/">3.2 PossibleFound</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-dictionary/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>Agent DictionaryManager å­—å…¸ç®¡ç†</strong>ã€‚å…ˆæ¥ç®€å•äº†è§£ä¸‹å­—å…¸çš„å®šä¹‰å’Œç”¨é€”ï¼š</p><ul><li>å­—å…¸å®é™…ä¸Šæ˜¯ä¸€ä¸ª Map æ˜ å°„ã€‚ç›®å‰ Agent ä¸Šæœ‰ä¸¤ç§å­—å…¸ï¼šåº”ç”¨ç¼–ç ä¸åº”ç”¨ç¼–å·çš„æ˜ å°„ï¼Œæ“ä½œåä¸æ“ä½œç¼–å·çš„æ˜ å°„ã€‚<ul><li>åº”ç”¨çš„å®šä¹‰ï¼šä¾‹å¦‚ï¼ŒTomcat å¯åŠ¨çš„åº”ç”¨ï¼Œæˆ–è€…ç¨‹åºé‡Œè®¿é—®çš„ MongoDB ã€MySQL éƒ½å¯ä»¥è®¤ä¸ºæ˜¯åº”ç”¨ã€‚</li><li>æ“ä½œçš„å®šä¹‰ï¼šä¾‹å¦‚ï¼Œè®¿é—®çš„ URL åœ°å€ï¼ŒMongo çš„æ‰§è¡Œæ“ä½œã€‚</li></ul></li><li>Agent åœ¨æ¯æ¬¡ä¸Šä¼ è°ƒç”¨é“¾è·¯ Segment ç»™ Collector æ—¶ï¼ŒSegment é‡Œé¢éœ€è¦åŒ…å«åº”ç”¨å’Œæ“ä½œç›¸å…³ä¿¡æ¯ã€‚è€ƒè™‘åˆ°å‡å°‘ç½‘ç»œæµé‡ï¼Œåº”ç”¨ç¼–å·å°‘äºåº”ç”¨ç¼–å·ï¼Œæ“ä½œç¼–å·å°‘äºæ“ä½œåã€‚</li></ul><p>Agent å­—å…¸ï¼Œä¼š<strong>å®šæ—¶</strong>ä» Collector ã€<strong>åŒæ­¥</strong>ã€‘<strong>éœ€è¦</strong>( <em>éœ€è¦çš„å®šä¹‰ï¼Œä¸‹æ–‡ä»£ç ä¼šçœ‹åˆ°</em> )çš„å­—å…¸ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬åˆ†æˆä¸¤ä¸ªå°èŠ‚ï¼Œåˆ†åˆ«ä» API çš„<strong>å®ç°</strong>ä¸<strong>è°ƒç”¨</strong>ï¼Œåˆ†äº«ä»£ç çš„å…·ä½“å®ç°ã€‚</p><h1 id="2-Collector-åŒæ­¥ç›¸å…³-API"><a href="#2-Collector-åŒæ­¥ç›¸å…³-API" class="headerlink" title="2. Collector åŒæ­¥ç›¸å…³ API"></a>2. Collector åŒæ­¥ç›¸å…³ API</h1><p>Collector åŒæ­¥ç›¸å…³ API ç›¸å…³æœ‰å››ä¸ªæ¥å£ï¼š</p><ul><li>2.1 åº”ç”¨çš„åŒæ­¥ API</li><li>2.2 æ“ä½œçš„åŒæ­¥ API</li></ul><p>API å¤„ç†çš„æµç¨‹å¤§ä½“å¦‚ä¸‹ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_25/01.png" alt=""></p><h2 id="2-1-åº”ç”¨çš„åŒæ­¥-API"><a href="#2-1-åº”ç”¨çš„åŒæ­¥-API" class="headerlink" title="2.1 åº”ç”¨çš„åŒæ­¥ API"></a>2.1 åº”ç”¨çš„åŒæ­¥ API</h2><p>åº”ç”¨çš„åŒæ­¥ API ï¼Œå®é™…ä½¿ç”¨çš„æ˜¯<strong>åº”ç”¨çš„æ³¨å†Œ API</strong>ï¼Œåœ¨ <a href="http://www.iocoder.cn/SkyWalking/register/?self">ã€Œ2.1 åº”ç”¨çš„æ³¨å†Œ APIã€</a> æœ‰è¯¦ç»†è§£æã€‚</p><h2 id="2-2-æ“ä½œçš„åŒæ­¥-API"><a href="#2-2-æ“ä½œçš„åŒæ­¥-API" class="headerlink" title="2.2 æ“ä½œçš„åŒæ­¥ API"></a>2.2 æ“ä½œçš„åŒæ­¥ API</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ API çš„å®šä¹‰ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-network/src/main/proto/DiscoveryService.proto#L11" rel="external nofollow noopener noreferrer" target="_blank"><code>DiscoveryService</code></a> ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_28/01.png" alt=""></p><p>æ•´ä½“ä»£ç å’Œ <a href="#">ã€Œ2.1 åº”ç”¨çš„åŒæ­¥ APIã€</a> éå¸¸ç›¸ä¼¼ï¼Œæ‰€ä»¥æœ¬å°èŠ‚ï¼Œæ›´å¤šçš„æ˜¯æä¾›ä»£ç çš„é“¾æ¥åœ°å€ã€‚</p><h3 id="2-2-1-ServiceNameDiscoveryServiceHandler-discovery-â€¦"><a href="#2-2-1-ServiceNameDiscoveryServiceHandler-discovery-â€¦" class="headerlink" title="2.2.1 ServiceNameDiscoveryServiceHandler#discovery(â€¦)"></a>2.2.1 ServiceNameDiscoveryServiceHandler#discovery(â€¦)</h3><p><a href="https://github.com/YunaiV/skywalking/blob/0830d985227c42f0e0f3787ebc99a2b197486b69/apm-collector/apm-collector-agent-grpc/collector-agent-grpc-provider/src/main/java/org/skywalking/apm/collector/agent/grpc/handler/ServiceNameDiscoveryServiceHandler.java#L49" rel="external nofollow noopener noreferrer" target="_blank"><code>ServiceNameDiscoveryServiceHandler#discovery(ServiceNameCollection, StreamObserver&lt;ServiceNameMappingCollection&gt;)</code></a>ï¼Œæ ¹æ®æ“ä½œåæ•°ç»„ï¼ŒæŸ¥æ‰¾æ“ä½œç¼–å·æ•°ç»„ã€‚</p><h3 id="2-2-2-IServiceNameService-getOrCreate-â€¦"><a href="#2-2-2-IServiceNameService-getOrCreate-â€¦" class="headerlink" title="2.2.2 IServiceNameService#getOrCreate(â€¦)"></a>2.2.2 IServiceNameService#getOrCreate(â€¦)</h3><p><code>org.skywalking.apm.collector.agent.stream.service.register.IServiceNameService</code> ï¼Œç»§æ‰¿ <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Service.java" rel="external nofollow noopener noreferrer" target="_blank">Service</a> æ¥å£ï¼Œæ“ä½œåæœåŠ¡æ¥å£ã€‚</p><ul><li>å®šä¹‰äº† <a href="https://github.com/YunaiV/skywalking/blob/a4db2c4dd5e2adc861e7fb9e9b7b7ffdc57dfb88/apm-collector/apm-collector-agent-stream/collector-agent-stream-define/src/main/java/org/skywalking/apm/collector/agent/stream/service/register/IInstanceIDService.java#L39" rel="external nofollow noopener noreferrer" target="_blank"><code>#getOrCreate(applicationId, serviceName)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œæ ¹æ®åº”ç”¨ç¼–å· + æ“ä½œåå­—ï¼Œè·å–æˆ–åˆ›å»ºæ“ä½œå( ServiceName )ï¼Œå¹¶è·å¾—æ“ä½œç¼–å·ã€‚</li></ul><p><code>org.skywalking.apm.collector.agent.stream.worker.register.ServiceNameService</code> ï¼Œå®ç° IServiceNameService æ¥å£ï¼Œæ“ä½œåæœåŠ¡å®ç°ç±»ã€‚</p><ul><li>å®ç°äº† <a href="https://github.com/YunaiV/skywalking/blob/0830d985227c42f0e0f3787ebc99a2b197486b69/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ServiceNameService.java#L64" rel="external nofollow noopener noreferrer" target="_blank"><code>#getOrCreate(applicationId, serviceName)</code></a> æ–¹æ³•ã€‚</li></ul><h3 id="2-2-3-Graph-start-ServiceName"><a href="#2-2-3-Graph-start-ServiceName" class="headerlink" title="2.2.3 Graph#start(ServiceName)"></a>2.2.3 Graph#start(ServiceName)</h3><p>åœ¨ <a href="https://github.com/YunaiV/skywalking/blob/a9873b9bf07882746bd30f29b3c64f4b44887bf2/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/graph/RegisterStreamGraph.java#L79" rel="external nofollow noopener noreferrer" target="_blank"><code>#createServiceNameRegisterGraph()</code></a> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° ServiceName å¯¹åº”çš„ <code>Graph&lt;ServiceName&gt;</code> å¯¹è±¡çš„åˆ›å»ºã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/a9873b9bf07882746bd30f29b3c64f4b44887bf2/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ServiceNameRegisterRemoteWorker.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.agent.stream.worker.register.ServiceNameRegisterRemoteWorker</code></a> ï¼Œç»§æ‰¿ AbstractRemoteWorker æŠ½è±¡ç±»ï¼Œæ“ä½œåæ³¨å†Œè¿œç¨‹ Worker ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/0830d985227c42f0e0f3787ebc99a2b197486b69/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ServiceNameRegisterSerialWorker.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.agent.stream.worker.register.ServiceNameRegisterSerialWorker</code></a> ï¼Œç»§æ‰¿ AbstractLocalAsyncWorker æŠ½è±¡ç±»ï¼Œå¼‚æ­¥ä¿å­˜åº”ç”¨ Worker ã€‚<ul><li>ç›¸åŒäº Application ï¼ŒServiceName çš„æ“ä½œç¼–å·ï¼Œä» <code>&quot;1&quot;</code> <strong>åŒå‘</strong>é€’å¢ã€‚ </li><li><a href="https://github.com/YunaiV/skywalking/blob/a4db2c4dd5e2adc861e7fb9e9b7b7ffdc57dfb88/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/ServiceNameEsRegisterDAO.java#L52" rel="external nofollow noopener noreferrer" target="_blank">ServiceNameEsRegisterDAO#save(ServiceName)</a></li></ul></li></ul><h3 id="2-2-4-ServiceName"><a href="#2-2-4-ServiceName" class="headerlink" title="2.2.4 ServiceName"></a>2.2.4 ServiceName</h3><p><a href="https://github.com/YunaiV/skywalking/blob/a9873b9bf07882746bd30f29b3c64f4b44887bf2/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/register/ServiceName.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.table.register.ServiceName</code></a> ï¼Œæ“ä½œåã€‚ä¾‹å¦‚è®°å½•åœ¨ ES å¦‚ä¸‹å›¾ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_28/02.png" alt=""></p><h1 id="3-Agent-è°ƒç”¨åŒæ­¥-API"><a href="#3-Agent-è°ƒç”¨åŒæ­¥-API" class="headerlink" title="3. Agent è°ƒç”¨åŒæ­¥ API"></a>3. Agent è°ƒç”¨åŒæ­¥ API</h1><p>åœ¨ <a href="#">ã€ŠSkyWalking æºç åˆ†æ â€”â€” åº”ç”¨äºåº”ç”¨å®ä¾‹çš„æ³¨å†Œã€‹ã€Œ3. Agent è°ƒç”¨æ³¨å†Œ APIã€</a> ä¸€æ–‡ä¸­ï¼Œåœ¨ <a href="https://github.com/YunaiV/skywalking/blob/bb8cb1b7dcb428c161f225f0b5d57441105f84c0/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/AppAndServiceRegisterClient.java#L170" rel="external nofollow noopener noreferrer" target="_blank">ã€ç¬¬ 170 è‡³ 173 è¡Œã€‘çš„ä»£ç </a>ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒAppAndServiceRegisterClient ä¼šå®šæ—¶ä» Collector åŒæ­¥æ‰€æœ‰å­—å…¸ä¿¡æ¯ã€‚</p><h2 id="3-1-DictionaryManager"><a href="#3-1-DictionaryManager" class="headerlink" title="3.1 DictionaryManager"></a>3.1 DictionaryManager</h2><p><a href="https://github.com/YunaiV/skywalking/blob/0830d985227c42f0e0f3787ebc99a2b197486b69/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/dictionary/DictionaryManager.java#L27" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.dictionary.DictionaryManager</code></a> ï¼Œå­—å…¸ç®¡ç†å™¨ã€‚ç›®å‰ç®¡ç†æœ‰ä¸¤ç§å­—å…¸ï¼š</p><ul><li>ApplicationDictionary</li><li>OperationNameDictionary</li></ul><h3 id="3-1-ApplicationDictionary"><a href="#3-1-ApplicationDictionary" class="headerlink" title="3.1 ApplicationDictionary"></a>3.1 ApplicationDictionary</h3><p><code>org.skywalking.apm.agent.core.dictionary.ApplicationDictionary</code> ï¼Œåº”ç”¨å­—å…¸ã€‚</p><ul><li><code>INSTANCE</code> æšä¸¾å±æ€§ï¼Œå•ä¾‹ã€‚</li><li><code>applicationDictionary</code> å±æ€§ï¼Œåº”ç”¨ç¼–ç ä¸åº”ç”¨ç¼–å·çš„æ˜ å°„ã€‚</li><li><code>unRegisterApplications</code> å±æ€§ï¼ŒæœªçŸ¥åº”ç”¨ç¼–ç é›†åˆã€‚Agent ä¼šå®šæ—¶ä» Collector åŒæ­¥ã€‚è¿™ä¹Ÿæ˜¯æ–‡ç« å¼€å¤´è¯´çš„ï¼Œâ€œ<strong>éœ€è¦</strong>â€çš„å®šä¹‰ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/0830d985227c42f0e0f3787ebc99a2b197486b69/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/dictionary/ApplicationDictionary.java#L56" rel="external nofollow noopener noreferrer" target="_blank"><code>#find(applicationCode)</code></a> æ–¹æ³•ï¼Œæ ¹æ®åº”ç”¨ç¼–ç ï¼ŒæŸ¥è¯¢åº”ç”¨ç¼–å·ã€‚</p><ul><li>ç¬¬ 57 è¡Œï¼šæ ¹æ®åº”ç”¨ç¼–ç ï¼Œä» <code>applicationDictionary</code> ä¸­ï¼ŒæŸ¥è¯¢åº”ç”¨ç¼–å·ã€‚</li><li>ç¬¬ 58 è‡³ 59 è¡Œï¼šå½“åº”ç”¨ç¼–å·æŸ¥æ‰¾åˆ°æ—¶ï¼Œè¿”å› Found ã€‚Found ä¼šåœ¨ä¸‹æ–‡è¯¦ç»†è§£æã€‚</li><li>ç¬¬ 61 è‡³ 64 è¡Œï¼šå½“åº”ç”¨ç¼–å·æŸ¥æ‰¾ä¸åˆ°æ—¶ï¼Œæ·»åŠ åˆ° <code>unRegisterApplications</code> ä¸­ï¼Œè¿”å› NotFound ã€‚NotFound ä¼šåœ¨ä¸‹æ–‡è¯¦ç»†è§£æã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/0830d985227c42f0e0f3787ebc99a2b197486b69/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/dictionary/ApplicationDictionary.java#L74" rel="external nofollow noopener noreferrer" target="_blank"><code>#syncRemoteDictionary(ApplicationRegisterServiceGrpc.ApplicationRegisterServiceBlockingStub)</code></a> æ–¹æ³•ï¼Œè°ƒç”¨ <a href="#">ã€Œ2.1 åº”ç”¨çš„åŒæ­¥ APIã€</a> ï¼Œä» Collector åŒæ­¥ <code>unRegisterApplications</code> å¯¹åº”çš„åº”ç”¨ç¼–å·é›†åˆã€‚</p><h3 id="3-2-OperationNameDictionary"><a href="#3-2-OperationNameDictionary" class="headerlink" title="3.2 OperationNameDictionary"></a>3.2 OperationNameDictionary</h3><p><code>org.skywalking.apm.agent.core.dictionary.OperationNameDictionary</code> ï¼Œæ“ä½œåå­—å…¸ã€‚</p><p>å’Œ ApplicationDictionary åŸºæœ¬ç±»ä¼¼ï¼Œèƒ–å‹ç‚¹å‡» <a href="https://github.com/YunaiV/skywalking/blob/0830d985227c42f0e0f3787ebc99a2b197486b69/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/dictionary/OperationNameDictionary.java" rel="external nofollow noopener noreferrer" target="_blank">ä»£ç </a> ï¼Œè‡ªå·±é˜…è¯»ç†è§£ã€‚</p><h1 id="3-2-PossibleFound"><a href="#3-2-PossibleFound" class="headerlink" title="3.2 PossibleFound"></a>3.2 PossibleFound</h1><p>åœ¨åˆ†äº« PossibleFound ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µä»£ç ï¼Œäº†è§£è¯¥ç±»çš„æ„å›¾ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_28/03.png" alt=""></p><ul><li>æˆ‘ä»¬åœ¨ä½¿ç”¨ <code>XXXXDictionary#find(xxx)</code> æ–¹æ³•æ—¶ï¼Œè¿”å›çš„ä¼šæ˜¯ Found æˆ–è€… NotFound ã€‚è¿™ä¸¤ä¸ªç±»æœ¬èº«æ˜¯<strong>äº’æ–¥</strong>çš„ï¼Œå¹¶ä¸”ç»§æ‰¿ PossibleFound ã€‚åœ¨ PossibleFound æä¾› <code>#doInCondition(method01, method02)</code> æ–¹æ³•ï¼Œ<strong>ä¼˜é›…</strong>çš„å¤„ç†ä¸¤ç§æƒ…å†µã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/0830d985227c42f0e0f3787ebc99a2b197486b69/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/dictionary/PossibleFound.java#L26" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.dictionary.PossibleFound</code></a> ï¼Œ<strong>æŠ½è±¡ç±»</strong>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li><code>found</code> å±æ€§ï¼Œæ˜¯å¦æ‰¾åˆ°ã€‚</li><li><code>value</code> å±æ€§ï¼Œæ‰¾åˆ°çš„ç»“æœã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/0830d985227c42f0e0f3787ebc99a2b197486b69/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/dictionary/Found.java#L26" rel="external nofollow noopener noreferrer" target="_blank">org.skywalking.apm.agent.core.dictionary.Found</a> å®ç° PossibleFound ç±»ï¼Œ<code>found = true</code> å¹¶ä¸” <code>value</code> ä¸ºæ‰¾åˆ°çš„å€¼ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/0830d985227c42f0e0f3787ebc99a2b197486b69/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/dictionary/NotFound.java#L26" rel="external nofollow noopener noreferrer" target="_blank">org.skywalking.apm.agent.core.dictionary.NotFound</a> å®ç° PossibleFound ç±»ï¼Œ<code>found = false</code> å¹¶ä¸” <code>value</code> ä¸èµ‹å€¼ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/0830d985227c42f0e0f3787ebc99a2b197486b69/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/dictionary/PossibleFound.java#L46" rel="external nofollow noopener noreferrer" target="_blank"><code>#doInCondition(Found, NotFound)</code></a> æ–¹æ³•ï¼Œæ ¹æ®æŸ¥æ‰¾ç»“æœï¼Œæ‰§è¡Œä¸åŒçš„é€»è¾‘ï¼Œã€æ— è¿”å›ã€‘ã€‚<ul><li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/0830d985227c42f0e0f3787ebc99a2b197486b69/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/dictionary/PossibleFound.java#L72" rel="external nofollow noopener noreferrer" target="_blank"><code>PossibleFound.Found</code></a> æ¥å£ï¼ŒFound æ—¶çš„å¤„ç†é€»è¾‘æ¥å£ã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•°ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/0830d985227c42f0e0f3787ebc99a2b197486b69/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/dictionary/PossibleFound.java#L79" rel="external nofollow noopener noreferrer" target="_blank"><code>PossibleFound.NotFound</code></a> æ¥å£ï¼ŒNotFound æ—¶çš„å¤„ç†é€»è¾‘æ¥å£ã€‚</li></ul></li><li><a href="https://github.com/YunaiV/skywalking/blob/0830d985227c42f0e0f3787ebc99a2b197486b69/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/dictionary/PossibleFound.java#L61" rel="external nofollow noopener noreferrer" target="_blank"><code>#doInCondition(FoundAndObtain, NotFoundAndObtain)</code></a> æ–¹æ³•ï¼Œæ ¹æ®æŸ¥æ‰¾ç»“æœï¼Œæ‰§è¡Œä¸åŒçš„é€»è¾‘ï¼Œã€æœ‰è¿”å›ã€‘ã€‚<ul><li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/0830d985227c42f0e0f3787ebc99a2b197486b69/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/dictionary/PossibleFound.java#L86" rel="external nofollow noopener noreferrer" target="_blank"><code>PossibleFound.FoundAndObtain</code></a> æ¥å£ï¼ŒFound æ—¶çš„å¤„ç†é€»è¾‘æ¥å£ã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•°ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/0830d985227c42f0e0f3787ebc99a2b197486b69/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/dictionary/PossibleFound.java#L93" rel="external nofollow noopener noreferrer" target="_blank"><code>PossibleFound.NotFoundAndObtain</code></a> æ¥å£ï¼ŒNotFound æ—¶çš„å¤„ç†é€»è¾‘æ¥å£ã€‚</li></ul></li></ul><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>å†™æ°´æ–‡ï¼Œå¥½æ¯ç‡¥ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_28/04.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸ªæœ‹å‹åœˆå¯å¥½ï¼Ÿ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨&lt;strong&gt;å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘&lt;/strong&gt;
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” åº”ç”¨äºåº”ç”¨å®ä¾‹çš„æ³¨å†Œ</title>
    <link href="http://www.iocoder.cn/SkyWalking/register/"/>
    <id>http://www.iocoder.cn/SkyWalking/register/</id>
    <published>2020-09-24T16:00:00.000Z</published>
    <updated>2017-12-28T00:56:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/register/">http://www.iocoder.cn/SkyWalking/register/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/register/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/register/">2. Collector æ³¨å†Œç›¸å…³ API</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/register/">2.1 åº”ç”¨çš„æ³¨å†Œ API</a></li><li><a href="http://www.iocoder.cn/SkyWalking/register/">2.2 åº”ç”¨å®ä¾‹çš„æ­£å¸¸æ³¨å†Œ API</a></li><li><a href="http://www.iocoder.cn/SkyWalking/register/">2.3 åº”ç”¨å®ä¾‹çš„æ¢å¤æ³¨å†Œ API</a></li><li><a href="http://www.iocoder.cn/SkyWalking/register/">2.4 åº”ç”¨å®ä¾‹çš„å¿ƒè·³ API</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/register/">3. Agent è°ƒç”¨æ³¨å†Œ API</a></li><li><a href="http://www.iocoder.cn/SkyWalking/register/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>åº”ç”¨ä¸åº”ç”¨å®ä¾‹çš„æ³¨å†Œ</strong>ã€‚å…ˆæ¥ç®€å•äº†è§£ä¸‹æ³¨å†Œçš„æ•´ä½“æµç¨‹ï¼š</p><ul><li>åº”ç”¨å¯åŠ¨ï¼ŒAgent å‘ Collector æ³¨å†Œ<strong>åº”ç”¨</strong>ã€‚</li><li>æ³¨å†Œåº”ç”¨æˆåŠŸåï¼ŒAgent å‘ Collector æ³¨å†Œåº”ç”¨<strong>å®ä¾‹</strong>ã€‚</li></ul><p>ä¸‹é¢ï¼Œæˆ‘ä»¬åˆ†æˆä¸¤ä¸ªå°èŠ‚ï¼Œåˆ†åˆ«ä» API çš„<strong>å®ç°</strong>ä¸<strong>è°ƒç”¨</strong>ï¼Œåˆ†äº«ä»£ç çš„å…·ä½“å®ç°ã€‚</p><blockquote><p>å‹æƒ…æç¤ºï¼šæ¨èé˜…è¯» <a href="https://github.com/apache/incubator-skywalking/blob/master/docs/cn/How-to-communicate-with-the-collector-CN.md" rel="external nofollow noopener noreferrer" target="_blank">ã€Šæ¢é’ˆä¸Collectoré—´é€šè®¯åè®®ã€‹</a> ã€‚</p></blockquote><h1 id="2-Collector-æ³¨å†Œç›¸å…³-API"><a href="#2-Collector-æ³¨å†Œç›¸å…³-API" class="headerlink" title="2. Collector æ³¨å†Œç›¸å…³ API"></a>2. Collector æ³¨å†Œç›¸å…³ API</h1><p>Collector æ³¨å†Œç›¸å…³ API ç›¸å…³æœ‰å››ä¸ªæ¥å£ï¼š</p><ul><li>2.1 åº”ç”¨çš„æ³¨å†Œ API</li><li>2.2 åº”ç”¨å®ä¾‹çš„æ­£å¸¸æ³¨å†Œ API </li><li>2.3 åº”ç”¨å®ä¾‹çš„æ¢å¤æ³¨å†Œ API</li><li>2.4 åº”ç”¨å®ä¾‹çš„å¿ƒè·³ API</li></ul><p>API å¤„ç†çš„æµç¨‹å¤§ä½“å¦‚ä¸‹ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_25/01.png" alt=""></p><ul><li>ç»¿æ¡†éƒ¨åˆ†ï¼Œã€2.3ã€‘ã€2.4ã€‘ä¸¤ä¸ª API ï¼Œç›´æ¥ Service è°ƒç”¨ DAO æ–¹æ³•ï¼Œæ— éœ€ç»è¿‡ Graph / Stream ç›¸å…³æ–¹æ³•ã€‚</li></ul><h2 id="2-1-åº”ç”¨çš„æ³¨å†Œ-API"><a href="#2-1-åº”ç”¨çš„æ³¨å†Œ-API" class="headerlink" title="2.1 åº”ç”¨çš„æ³¨å†Œ API"></a>2.1 åº”ç”¨çš„æ³¨å†Œ API</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ API çš„å®šä¹‰ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-network/src/main/proto/ApplicationRegisterService.proto#L9" rel="external nofollow noopener noreferrer" target="_blank"><code>ApplicationRegisterService.proto</code></a> ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_25/02.png" alt=""></p><ul><li>å…¶ä¸­ï¼ŒKeyWithIntegerValue æ•°æ®ç±»å‹ï¼Œåœ¨ <a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-network/src/main/proto/KeyWithIntegerValue.proto" rel="external nofollow noopener noreferrer" target="_blank"><code>KeyWithIntegerValue.proto</code></a> ä¸­å®šä¹‰ã€‚</li></ul><h3 id="2-1-1-ApplicationRegisterServiceHandler-register-â€¦"><a href="#2-1-1-ApplicationRegisterServiceHandler-register-â€¦" class="headerlink" title="2.1.1 ApplicationRegisterServiceHandler#register(â€¦)"></a>2.1.1 ApplicationRegisterServiceHandler#register(â€¦)</h3><p><a href="https://github.com/YunaiV/skywalking/blob/b4b2ff52a7dccd000264677a7a6bbb2285a8cd53/apm-collector/apm-collector-agent-grpc/collector-agent-grpc-provider/src/main/java/org/skywalking/apm/collector/agent/grpc/handler/ApplicationRegisterServiceHandler.java#L49" rel="external nofollow noopener noreferrer" target="_blank"><code>ApplicationRegisterServiceHandler#register(Application, StreamObserver&lt;ApplicationMapping&gt;)</code></a>, ä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 51 è¡Œï¼šè·å¾—è¯·æ±‚çš„åº”ç”¨ç¼–ç ( <code>applicationCode</code> )<strong>æ•°ç»„</strong>ã€‚</li><li>ç¬¬ 54 è‡³ 64 è¡Œï¼šå¾ªç¯åº”ç”¨ç¼–ç æ•°ç»„ï¼Œ<strong>è·å–</strong>æˆ–<strong>åˆ›å»º</strong>åº”ç”¨ã€‚<ul><li>ç¬¬ 57 è¡Œï¼šè°ƒç”¨ <code>IApplicationIDService#getOrCreate(applicationCode)</code> æ–¹æ³•ï¼Œ<strong>è·å–</strong>æˆ–<strong>åˆ›å»º</strong>åº”ç”¨ï¼Œæœ€ç»ˆè·å¾—åº”ç”¨ç¼–å·( <code>applicationId</code> )ã€‚</li><li>ç¬¬ 60 è‡³ 63 è¡Œï¼šè·å¾—åˆ°åº”ç”¨ç¼–å·( <code>applicationId != 0</code> )ï¼Œåˆ™æ·»åŠ åˆ°å“åº”ã€‚<strong>ä¸ºä»€ä¹ˆä¼šå­˜åœ¨è·å¾—ä¸åˆ°çš„æƒ…å†µå‘¢</strong>ï¼Ÿåœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œå®é™…<strong>å¼‚æ­¥</strong>ä¿å­˜åº”ç”¨ï¼Œæ‰€ä»¥ä¼šå­˜åœ¨è·å–å¤±è´¥çš„æƒ…å†µã€‚å½“è·å–å¤±è´¥ï¼Œè°ƒç”¨æ–¹( ä¾‹å¦‚ Agent )å¯ä»¥é‡æ–°å‘èµ·è¯¥è¯·æ±‚è¿›è¡Œæ³¨å†Œåº”ç”¨ï¼Œä»è€Œåœ¨å¼‚æ­¥ä¿å­˜åº”ç”¨ï¼Œè·å–åˆ°åº”ç”¨ç¼–å·ã€‚</li><li>ç¬¬ 67 è‡³ 68 è¡Œï¼šå“åº”ã€‚</li></ul></li></ul><h3 id="2-1-2-IApplicationIDService-getOrCreate-â€¦"><a href="#2-1-2-IApplicationIDService-getOrCreate-â€¦" class="headerlink" title="2.1.2 IApplicationIDService#getOrCreate(â€¦)"></a>2.1.2 IApplicationIDService#getOrCreate(â€¦)</h3><p><code>org.skywalking.apm.collector.agent.stream.service.register.IApplicationIDService</code> ï¼Œç»§æ‰¿ <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Service.java" rel="external nofollow noopener noreferrer" target="_blank">Service</a> æ¥å£ï¼Œåº”ç”¨ç¼–å·æœåŠ¡æ¥å£ã€‚</p><ul><li>å®šä¹‰äº† <a href="https://github.com/YunaiV/skywalking/blob/a9873b9bf07882746bd30f29b3c64f4b44887bf2/apm-collector/apm-collector-agent-stream/collector-agent-stream-define/src/main/java/org/skywalking/apm/collector/agent/stream/service/register/IApplicationIDService.java#L36" rel="external nofollow noopener noreferrer" target="_blank"><code>#getOrCreate(applicationCode)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œæ ¹æ®åº”ç”¨ç¼–ç è·å–æˆ–åˆ›å»ºåº”ç”¨ï¼Œå¹¶è·å¾—åº”ç”¨ç¼–å·ã€‚</li></ul><p><code>org.skywalking.apm.collector.agent.stream.worker.register.ApplicationIDService</code> ï¼Œå®ç° IApplicationIDService æ¥å£ï¼Œåº”ç”¨ç¼–å·æœåŠ¡å®ç°ç±»ã€‚</p><ul><li><p>å®ç°äº† <a href="https://github.com/YunaiV/skywalking/blob/a9873b9bf07882746bd30f29b3c64f4b44887bf2/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ApplicationIDService.java#L64" rel="external nofollow noopener noreferrer" target="_blank"><code>#getOrCreate(applicationCode)</code></a> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 66 è¡Œï¼šè°ƒç”¨ <code>ApplicationCacheService#get(applicationCode)</code> æ–¹æ³•ï¼Œä»<strong>ç¼“å­˜</strong>ä¸­è·å–åº”ç”¨ç¼–å·ã€‚åœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-cache-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Cache ç¼“å­˜ç»„ä»¶ã€‹</a> æœ‰è¯¦ç»†è§£æã€‚</li><li>ç¬¬ 69 è‡³ 76 è¡Œï¼šå½“è·å–ä¸åˆ°åº”ç”¨ç¼–å·æ—¶ï¼Œè·å– Application å¯¹åº”çš„ <code>Graph&lt;Application&gt;</code> å¯¹è±¡ï¼Œè°ƒç”¨ <code>Graph#start(application)</code> æ–¹æ³•ï¼Œè¿›è¡Œæµå¼å¤„ç†ã€‚åœ¨è¿™è¿‡ç¨‹ä¸­ï¼Œä¼šä¿å­˜åº”ç”¨åˆ°å­˜å‚¨å™¨ã€‚</li><li>ç¬¬ 77 è¡Œï¼šè¿”å›åº”ç”¨ç¼–å·ã€‚</li></ul></li></ul><h3 id="2-1-3-Graph-start-application"><a href="#2-1-3-Graph-start-application" class="headerlink" title="2.1.3 Graph#start(application)"></a>2.1.3 Graph#start(application)</h3><p>åœ¨ <a href="https://github.com/YunaiV/skywalking/blob/a9873b9bf07882746bd30f29b3c64f4b44887bf2/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/graph/RegisterStreamGraph.java#L57" rel="external nofollow noopener noreferrer" target="_blank"><code>#createApplicationRegisterGraph()</code></a> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Application å¯¹åº”çš„ <code>Graph&lt;Application&gt;</code> å¯¹è±¡çš„åˆ›å»ºã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/a9873b9bf07882746bd30f29b3c64f4b44887bf2/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ApplicationRegisterRemoteWorker.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.agent.stream.worker.register.ApplicationRegisterRemoteWorker</code></a> ï¼Œç»§æ‰¿ AbstractRemoteWorker æŠ½è±¡ç±»ï¼Œåº”ç”¨æ³¨å†Œè¿œç¨‹ Worker ã€‚<ul><li><a href="https://github.com/YunaiV/skywalking/blob/a9873b9bf07882746bd30f29b3c64f4b44887bf2/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ApplicationRegisterRemoteWorker.java#L55" rel="external nofollow noopener noreferrer" target="_blank">Factory</a> å†…éƒ¨ç±»ï¼Œå®ç° AbstractRemoteWorkerProvider æŠ½è±¡ç±»ï¼Œåœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆä¸€ï¼‰ã€‹ã€Œ3.2.3 AbstractRemoteWorkerã€</a> æœ‰è¯¦ç»†è§£æã€‚</li><li><strong>AbstractRemoteWorker</strong> ï¼Œåœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆä¸€ï¼‰ã€‹ã€Œ3.2.3 AbstractRemoteWorkerã€</a> æœ‰è¯¦ç»†è§£æã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/a9873b9bf07882746bd30f29b3c64f4b44887bf2/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ApplicationRegisterRemoteWorker.java#L42" rel="external nofollow noopener noreferrer" target="_blank"><code>#id()</code></a> å®ç°æ–¹æ³•ï¼Œè¿”å› 10006 ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/a9873b9bf07882746bd30f29b3c64f4b44887bf2/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ApplicationRegisterRemoteWorker.java#L51" rel="external nofollow noopener noreferrer" target="_blank"><code>#selector</code></a> å®ç°æ–¹æ³•ï¼Œè¿”å› <code>Selector.ForeverFirst</code> ã€‚åœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Remote è¿œç¨‹é€šä¿¡æœåŠ¡ã€‹</a> æœ‰è¯¦ç»†è§£æã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/a9873b9bf07882746bd30f29b3c64f4b44887bf2/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ApplicationRegisterRemoteWorker.java#L46" rel="external nofollow noopener noreferrer" target="_blank"><code>#onWork(Application)</code></a> å®ç°æ–¹æ³•ï¼Œè°ƒç”¨ <code>Next#execute(message)</code> æ–¹æ³•ï¼Œæäº¤æ•°æ®ç»™ä¸‹é¢çš„èŠ‚ç‚¹ï¼Œç»§ç»­æµå¼å¤„ç†ã€‚</li><li>æ€»ç»“ï¼šApplicationRegisterRemoteWorker ï¼Œä½¿ç”¨ Collector é›†ç¾¤çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹( <a href="https://github.com/YunaiV/skywalking/blob/b4b2ff52a7dccd000264677a7a6bbb2285a8cd53/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteClient.java#L194" rel="external nofollow noopener noreferrer" target="_blank">æŒ‰ç…§ <code>ip</code> æ’åº</a> ) è¿›è¡Œåç»­çš„æµå¼å¤„ç†ï¼Œå³ï¼Œä¿å­˜åº”ç”¨ã€‚</li></ul></li><li><a href="https://github.com/YunaiV/skywalking/blob/a9873b9bf07882746bd30f29b3c64f4b44887bf2/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ApplicationRegisterSerialWorker.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.agent.stream.worker.register.ApplicationRegisterSerialWorker</code></a> ï¼Œç»§æ‰¿ AbstractLocalAsyncWorker æŠ½è±¡ç±»ï¼Œå¼‚æ­¥ä¿å­˜åº”ç”¨ Worker ã€‚<ul><li><a href="https://github.com/YunaiV/skywalking/blob/a9873b9bf07882746bd30f29b3c64f4b44887bf2/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ApplicationRegisterSerialWorker.java#L84" rel="external nofollow noopener noreferrer" target="_blank">Factory</a> å†…éƒ¨ç±»ï¼Œå®ç° AbstractLocalAsyncWorkerProvider æŠ½è±¡ç±»ï¼Œåœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆä¸€ï¼‰ã€‹ã€Œ3.2.2 AbstractLocalAsyncWorkerã€</a> æœ‰è¯¦ç»†è§£æã€‚</li><li><strong>AbstractLocalAsyncWorker</strong> ï¼Œåœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆä¸€ï¼‰ã€‹ã€Œ3.2.2 AbstractLocalAsyncWorkerã€</a> æœ‰è¯¦ç»†è§£æã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/a9873b9bf07882746bd30f29b3c64f4b44887bf2/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ApplicationRegisterSerialWorker.java#L52" rel="external nofollow noopener noreferrer" target="_blank"><code>#id()</code></a> å®ç°æ–¹æ³•ï¼Œè¿”å› 101 ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/69ec2bb309f4fe3cdbda56587a6193be933c4388/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ApplicationRegisterSerialWorker.java#L56" rel="external nofollow noopener noreferrer" target="_blank"><code>#onWork(Application)</code></a> å®ç°æ–¹æ³•ï¼Œä¿å­˜åº”ç”¨( Application )ã€‚ä»£ç å¦‚ä¸‹( ä»¥ ES ä½œä¸º DAO å®ç°ä¸ºä¾‹å­ )ï¼š<ul><li>ç¬¬ 58 è¡Œï¼šè°ƒç”¨ <code>ApplicationCacheService#get(applicationCode)</code> æ–¹æ³•ï¼Œä»<strong>ç¼“å­˜</strong>ä¸­è·å–åº”ç”¨ç¼–å·ã€‚</li><li>ç¬¬ 60 è¡Œï¼šå½“è·å–ä¸åˆ°åº”ç”¨ç¼–å·æ—¶ï¼Œä½¿ç”¨ <code>applicationCode</code> åˆ›å»ºåº”ç”¨å¹¶ä¿å­˜ã€‚</li><li>ç¬¬ 62 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/69ec2bb309f4fe3cdbda56587a6193be933c4388/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/ApplicationEsRegisterDAO.java#L49" rel="external nofollow noopener noreferrer" target="_blank"><code>ApplicationH2RegisterDAO#getMinApplicationId()</code></a> æ–¹æ³•ï¼Œè·å¾— Application è®°å½•çš„åº”ç”¨ç¼–å·çš„<strong>æœ€å°å€¼</strong>ã€‚</li><li>â€”â€”â€” åˆ†éš” â€”â€”â€”</li><li>ç¬¬ 63 è¡Œï¼šå½“ <code>min == 0</code> æ—¶ï¼Œè¯´æ˜æ²¡æœ‰ Application è®°å½•ã€‚</li><li>ç¬¬ 64 è‡³ 68 è¡Œï¼šåˆ›å»º<strong>ç¬¬ä¸€æ¡</strong>ã€<strong>ç‰¹æ®Š</strong>çš„ Application è®°å½•ã€‚è¯¥è®°å½• <code>applicationId = 1</code> ï¼Œ<code>applicationCode = User</code> ï¼Œç”¨äºè¡¨ç¤ºç”¨æˆ·å‘èµ·è¯·æ±‚ã€‚åœ¨ SkyWaling UI ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥æ¡ Application è®°å½•å¦‚ä¸‹å›¾ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_09_25/03.png" alt=""></li><li>ç¬¬ 70 è‡³ 74 è¡Œï¼šåˆ›å»ºå½“å‰è¯·æ±‚çš„å¯¹åº”çš„ Application è®°å½•ï¼Œå¹¶ä¸” <code>applicationId = -1</code> ã€‚</li><li>â€”â€”â€” åˆ†éš” â€”â€”â€”</li><li>ç¬¬ 76 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/69ec2bb309f4fe3cdbda56587a6193be933c4388/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/ApplicationEsRegisterDAO.java#L45" rel="external nofollow noopener noreferrer" target="_blank"><code>ApplicationH2RegisterDAO#getMaxApplicationId()</code></a> æ–¹æ³•ï¼Œè·å¾— Application è®°å½•çš„åº”ç”¨ç¼–å·çš„<strong>æœ€å¤§å€¼</strong>ã€‚</li><li>ç¬¬ 77 è¡Œï¼šè°ƒç”¨ <code>IdAutoIncrement#increment(min, max)</code> æ–¹æ³•ï¼Œè·å¾—åº”ç”¨ç¼–å·ã€‚è¯¥æ–¹æ³•è¾ƒä¸ºæœ‰è¶£ï¼Œåœ¨ä¸‹æ–‡è¯¦ç»†è§£æã€‚</li><li>ç¬¬ 79 è‡³ 82 è¡Œï¼šåˆ›å»ºå½“å‰è¯·æ±‚çš„å¯¹åº”çš„ Application è®°å½•ã€‚</li><li>â€”â€”â€” åˆ†éš” â€”â€”â€”</li><li>ç¬¬ 85 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/69ec2bb309f4fe3cdbda56587a6193be933c4388/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/ApplicationEsRegisterDAO.java#L53" rel="external nofollow noopener noreferrer" target="_blank"><code>ApplicationEsRegisterDAO#save(Application)</code></a> æ–¹æ³•ï¼Œä¿å­˜åº”ç”¨ã€‚</li></ul></li></ul></li></ul><hr><p><a href="https://github.com/YunaiV/skywalking/blob/69ec2bb309f4fe3cdbda56587a6193be933c4388/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/IdAutoIncrement.java#L36" rel="external nofollow noopener noreferrer" target="_blank"><code>IdAutoIncrement#increment(min, max)</code></a> æ–¹æ³•ï¼Œ<strong>åŒå‘</strong>å‡åŒ€è‡ªå¢ã€‚å¯èƒ½çœ‹èµ·æ¥æ¯”è¾ƒå¥‡æ€ªï¼Œä»¥ä¸Šæ–‡ Application çš„è°ƒç”¨ä¸¾ä¾‹å­ï¼š</p><table><thead><tr><th>min</th><th>max</th><th>result</th><th>applicationCode</th></tr></thead><tbody><tr><td>0</td><td>/</td><td>1</td><td>User</td></tr><tr><td>0</td><td>/</td><td>-1</td><td>åº”ç”¨ A</td></tr><tr><td>-1</td><td>1</td><td>2</td><td>åº”ç”¨ B</td></tr><tr><td>-1</td><td>2</td><td>-2</td><td>åº”ç”¨ C</td></tr><tr><td>-2</td><td>2</td><td>3</td><td>åº”ç”¨ D</td></tr></tbody></table><ul><li>ã€Userã€‘å’Œã€åº”ç”¨ Aã€‘æ˜¯ç›´æ¥è·å¾— <code>result</code> ï¼Œä¸è°ƒç”¨ <code>#increment(min, max)</code>  æ–¹æ³•ã€‚</li><li>æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä»¥ <code>min + max = 0</code> ä¸ºä¸­å¿ƒç‚¹( å®é™…ä»¥ <code>0</code> ä¸ºä¸­å¿ƒç‚¹)ï¼Œ <strong>åŒå‘</strong>å‡åŒ€è‡ªå¢ã€‚</li></ul><p>TODO ã€4007ã€‘</p><h3 id="2-1-4-Application"><a href="#2-1-4-Application" class="headerlink" title="2.1.4 Application"></a>2.1.4 Application</h3><p><a href="https://github.com/YunaiV/skywalking/blob/69ec2bb309f4fe3cdbda56587a6193be933c4388/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/register/Application.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.table.register.Application</code></a> ï¼Œåº”ç”¨ã€‚ä¾‹å¦‚è®°å½•åœ¨ ES å¦‚ä¸‹å›¾ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_25/05.png" alt=""></p><h2 id="2-2-åº”ç”¨å®ä¾‹çš„æ­£å¸¸æ³¨å†Œ-API"><a href="#2-2-åº”ç”¨å®ä¾‹çš„æ­£å¸¸æ³¨å†Œ-API" class="headerlink" title="2.2 åº”ç”¨å®ä¾‹çš„æ­£å¸¸æ³¨å†Œ API"></a>2.2 åº”ç”¨å®ä¾‹çš„æ­£å¸¸æ³¨å†Œ API</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ API çš„å®šä¹‰ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-network/src/main/proto/InstanceDiscoveryService.proto#L11" rel="external nofollow noopener noreferrer" target="_blank"><code>InstanceDiscoveryService</code></a> ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_25/04.png" alt=""></p><p>æ•´ä½“ä»£ç å’Œ <a href="#">ã€Œ2.1 åº”ç”¨çš„æ³¨å†Œ APIã€</a> éå¸¸ç›¸ä¼¼ï¼Œæ‰€ä»¥æœ¬å°èŠ‚ï¼Œæ›´å¤šçš„æ˜¯æä¾›ä»£ç çš„é“¾æ¥åœ°å€ã€‚</p><h3 id="2-2-1-InstanceDiscoveryServiceHandler-register-â€¦"><a href="#2-2-1-InstanceDiscoveryServiceHandler-register-â€¦" class="headerlink" title="2.2.1 InstanceDiscoveryServiceHandler#register(â€¦)"></a>2.2.1 InstanceDiscoveryServiceHandler#register(â€¦)</h3><p><a href="https://github.com/YunaiV/skywalking/blob/69ec2bb309f4fe3cdbda56587a6193be933c4388/apm-collector/apm-collector-agent-grpc/collector-agent-grpc-provider/src/main/java/org/skywalking/apm/collector/agent/grpc/handler/InstanceDiscoveryServiceHandler.java#L54" rel="external nofollow noopener noreferrer" target="_blank"><code>InstanceDiscoveryServiceHandler#register(ApplicationInstance, StreamObserver&lt;ApplicationInstanceMapping&gt;)</code></a>ï¼Œæ³¨å†Œåº”ç”¨å®ä¾‹ã€‚</p><h3 id="2-2-2-IInstanceIDService-getOrCreate-â€¦"><a href="#2-2-2-IInstanceIDService-getOrCreate-â€¦" class="headerlink" title="2.2.2 IInstanceIDService#getOrCreate(â€¦)"></a>2.2.2 IInstanceIDService#getOrCreate(â€¦)</h3><p><code>org.skywalking.apm.collector.agent.stream.service.register.IInstanceIDService</code> ï¼Œç»§æ‰¿ <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Service.java" rel="external nofollow noopener noreferrer" target="_blank">Service</a> æ¥å£ï¼Œåº”ç”¨å®ä¾‹ç¼–å·æœåŠ¡æ¥å£ã€‚</p><ul><li>å®šä¹‰äº† <a href="https://github.com/YunaiV/skywalking/blob/a4db2c4dd5e2adc861e7fb9e9b7b7ffdc57dfb88/apm-collector/apm-collector-agent-stream/collector-agent-stream-define/src/main/java/org/skywalking/apm/collector/agent/stream/service/register/IInstanceIDService.java#L39" rel="external nofollow noopener noreferrer" target="_blank"><code>#getOrCreate(applicationCode)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œæ ¹æ®åº”ç”¨ç¼–å· + AgentUUIDï¼Œè·å–æˆ–åˆ›å»ºåº”ç”¨å®ä¾‹ï¼Œå¹¶è·å¾—åº”ç”¨ç¼–å·ã€‚</li></ul><p><code>org.skywalking.apm.collector.agent.stream.worker.register.InstanceIDService</code> ï¼Œå®ç° IInstanceIDService æ¥å£ï¼Œåº”ç”¨ç¼–å·æœåŠ¡å®ç°ç±»ã€‚</p><ul><li>å®ç°äº† <a href="https://github.com/YunaiV/skywalking/blob/a4db2c4dd5e2adc861e7fb9e9b7b7ffdc57dfb88/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/InstanceIDService.java#L74" rel="external nofollow noopener noreferrer" target="_blank"><code>#getOrCreate(applicationCode)</code></a> æ–¹æ³•ã€‚</li></ul><h3 id="2-2-3-Graph-start-instance"><a href="#2-2-3-Graph-start-instance" class="headerlink" title="2.2.3 Graph#start(instance)"></a>2.2.3 Graph#start(instance)</h3><p>åœ¨ <a href="https://github.com/YunaiV/skywalking/blob/a9873b9bf07882746bd30f29b3c64f4b44887bf2/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/graph/RegisterStreamGraph.java#L68" rel="external nofollow noopener noreferrer" target="_blank"><code>#createInstanceRegisterGraph()</code></a> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Instance å¯¹åº”çš„ <code>Graph&lt;Instance&gt;</code> å¯¹è±¡çš„åˆ›å»ºã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/a9873b9bf07882746bd30f29b3c64f4b44887bf2/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/InstanceRegisterRemoteWorker.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.agent.stream.worker.register.InstanceRegisterRemoteWorker</code></a> ï¼Œç»§æ‰¿ AbstractRemoteWorker æŠ½è±¡ç±»ï¼Œåº”ç”¨å®ä¾‹æ³¨å†Œè¿œç¨‹ Worker ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/a9873b9bf07882746bd30f29b3c64f4b44887bf2/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ApplicationRegisterSerialWorker.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.agent.stream.worker.register.ApplicationRegisterSerialWorker</code></a> ï¼Œç»§æ‰¿ AbstractLocalAsyncWorker æŠ½è±¡ç±»ï¼Œå¼‚æ­¥ä¿å­˜åº”ç”¨ Worker ã€‚<ul><li>ä¸åŒ Application ï¼ŒInstance çš„åº”ç”¨å®ä¾‹ç¼–å·ï¼Œä» <code>&quot;1&quot;</code> <strong>æ­£å‘</strong>é€’å¢ã€‚ </li><li><a href="https://github.com/YunaiV/skywalking/blob/a4db2c4dd5e2adc861e7fb9e9b7b7ffdc57dfb88/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/InstanceEsRegisterDAO.java#L53" rel="external nofollow noopener noreferrer" target="_blank">InstanceEsRegisterDAO#save(Instance)</a></li></ul></li></ul><h3 id="2-2-4-Instance"><a href="#2-2-4-Instance" class="headerlink" title="2.2.4 Instance"></a>2.2.4 Instance</h3><p><a href="https://github.com/YunaiV/skywalking/blob/69ec2bb309f4fe3cdbda56587a6193be933c4388/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/register/Instance.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.table.register.Instance</code></a> ï¼Œåº”ç”¨å®ä¾‹ã€‚ä¾‹å¦‚è®°å½•åœ¨ ES å¦‚ä¸‹å›¾ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_25/06.png" alt=""></p><h2 id="2-3-åº”ç”¨å®ä¾‹çš„æ¢å¤æ³¨å†Œ-API"><a href="#2-3-åº”ç”¨å®ä¾‹çš„æ¢å¤æ³¨å†Œ-API" class="headerlink" title="2.3 åº”ç”¨å®ä¾‹çš„æ¢å¤æ³¨å†Œ API"></a>2.3 åº”ç”¨å®ä¾‹çš„æ¢å¤æ³¨å†Œ API</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ API çš„å®šä¹‰ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-network/src/main/proto/InstanceDiscoveryService.proto#L17" rel="external nofollow noopener noreferrer" target="_blank"><code>InstanceDiscoveryService.proto</code></a> ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_25/07.png" alt=""></p><ul><li>å…¶ä¸­ï¼ŒDownstream æ•°æ®ç±»å‹ï¼Œåœ¨ <a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-network/src/main/proto/Downstream.proto" rel="external nofollow noopener noreferrer" target="_blank"><code>Downstream.proto</code></a> ä¸­å®šä¹‰ã€‚</li></ul><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒAgent åœ¨æ³¨å†Œåº”ç”¨æ—¶å€™æˆåŠŸåï¼Œå¦‚æœå› ä¸ºå„ç§åŸå› åŸå› å’Œ Collector æ–­å¼€äº† gRPC Channel è¿æ¥( ä¾‹å¦‚ï¼Œç½‘ç»œ )ï¼Œæ¢å¤è¿æ¥åï¼Œéœ€è¦è°ƒç”¨è¯¥ API ï¼Œè¿›è¡Œ<strong>æ¢å¤</strong>æ³¨å†Œã€‚</p><h3 id="2-3-1-InstanceDiscoveryServiceHandler-recover-â€¦"><a href="#2-3-1-InstanceDiscoveryServiceHandler-recover-â€¦" class="headerlink" title="2.3.1 InstanceDiscoveryServiceHandler#recover(â€¦)"></a>2.3.1 InstanceDiscoveryServiceHandler#recover(â€¦)</h3><p><a href="https://github.com/YunaiV/skywalking/blob/9a01c67f47efc07b9754c77198324cb2d5bb212d/apm-collector/apm-collector-agent-grpc/collector-agent-grpc-provider/src/main/java/org/skywalking/apm/collector/agent/grpc/handler/InstanceDiscoveryServiceHandler.java#L69" rel="external nofollow noopener noreferrer" target="_blank"><code>InstanceDiscoveryServiceHandler#recover(ApplicationInstanceRecover, StreamObserver&lt;Downstream&gt;)</code></a>, ä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 71 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/9a01c67f47efc07b9754c77198324cb2d5bb212d/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/util/TimeBucketUtils.java#L51" rel="external nofollow noopener noreferrer" target="_blank"><code>TimeBucketUtils#getSecondTimeBucket(time)</code></a> æ–¹æ³•ï¼Œå°† <code>registerTime</code> è½¬æˆ timeBucket ã€‚</li><li>ç¬¬ 73 è¡Œï¼šè°ƒç”¨ <code>IInstanceIDService#recover(instanceId, applicationId, registerTime, osInfo)</code> æ–¹æ³•ï¼Œæ¢å¤æ³¨å†Œåº”ç”¨å®ä¾‹ã€‚</li><li>ç¬¬ 75 è‡³ 76 è¡Œï¼šå“åº”ã€‚</li></ul><h3 id="2-3-2-IInstanceIDService-recover-â€¦"><a href="#2-3-2-IInstanceIDService-recover-â€¦" class="headerlink" title="2.3.2 IInstanceIDService#recover(â€¦)"></a>2.3.2 IInstanceIDService#recover(â€¦)</h3><p><a href="https://github.com/YunaiV/skywalking/blob/bb8cb1b7dcb428c161f225f0b5d57441105f84c0/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/InstanceIDService.java#L95" rel="external nofollow noopener noreferrer" target="_blank"><code>InstanceIDService#recover(instanceId, applicationId, registerTime, osInfo)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ¢å¤æ³¨å†Œã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 96 è‡³ 103 è¡Œï¼šåˆ›å»º Instance å¯¹è±¡ï¼Œç”¨äºä¸‹é¢æ›´æ–°æ“ä½œã€‚<ul><li>ç¬¬ 99 è¡Œï¼š TODO ã€4008ã€‘</li></ul></li><li>ç¬¬ 106 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/a4db2c4dd5e2adc861e7fb9e9b7b7ffdc57dfb88/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/InstanceEsRegisterDAO.java#L53" rel="external nofollow noopener noreferrer" target="_blank">InstanceEsRegisterDAO#save(Instance)</a> æ–¹æ³•ï¼Œæ›´æ–°åº”ç”¨å®ä¾‹ã€‚</li></ul><h2 id="2-4-åº”ç”¨å®ä¾‹çš„å¿ƒè·³-API"><a href="#2-4-åº”ç”¨å®ä¾‹çš„å¿ƒè·³-API" class="headerlink" title="2.4 åº”ç”¨å®ä¾‹çš„å¿ƒè·³ API"></a>2.4 åº”ç”¨å®ä¾‹çš„å¿ƒè·³ API</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ API çš„å®šä¹‰ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-network/src/main/proto/InstanceDiscoveryService.proto#L14" rel="external nofollow noopener noreferrer" target="_blank"><code>InstanceDiscoveryService.proto</code></a> ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_25/08.png" alt=""></p><ul><li>å…¶ä¸­ï¼ŒDownstream æ•°æ®ç±»å‹ï¼Œåœ¨ <a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-network/src/main/proto/Downstream.proto" rel="external nofollow noopener noreferrer" target="_blank"><code>Downstream.proto</code></a> ä¸­å®šä¹‰ã€‚</li></ul><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒAgent åœ¨æ³¨å†Œåº”ç”¨æ—¶å€™æˆåŠŸåï¼Œå®šæ—¶å‘ Collector å‘é€<strong>å¿ƒè·³</strong>ï¼Œè®°å½•åº”ç”¨å­˜æ´»ã€‚</p><h3 id="2-4-1-InstanceDiscoveryServiceHandler-heartbeat-â€¦"><a href="#2-4-1-InstanceDiscoveryServiceHandler-heartbeat-â€¦" class="headerlink" title="2.4.1 InstanceDiscoveryServiceHandler#heartbeat(â€¦)"></a>2.4.1 InstanceDiscoveryServiceHandler#heartbeat(â€¦)</h3><p><a href="#">InstanceDiscoveryServiceHandler#heartbeat(ApplicationInstanceHeartbeat, StreamObserver<org.skywalking.apm.network.proto.downstream>)</org.skywalking.apm.network.proto.downstream></a> ï¼Œç›®å‰è¯¥æ–¹æ³•æš‚æœªå®ç°ã€‚å®ç°åï¼Œä¼šé¦–å…ˆè°ƒç”¨ä¸€ä¸ª Service æ–¹æ³•ï¼Œè€Œåè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/bb8cb1b7dcb428c161f225f0b5d57441105f84c0/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/InstanceEsRegisterDAO.java#L68" rel="external nofollow noopener noreferrer" target="_blank"><code>InstanceEsRegisterDAO#updateHeartbeatTime(instanceId, heartbeatTime)</code></a> æ–¹æ³•ï¼Œè®°å½•åº”ç”¨å®ä¾‹çš„å¿ƒè·³æ—¶é—´ã€‚</p><h1 id="3-Agent-è°ƒç”¨æ³¨å†Œ-API"><a href="#3-Agent-è°ƒç”¨æ³¨å†Œ-API" class="headerlink" title="3. Agent è°ƒç”¨æ³¨å†Œ API"></a>3. Agent è°ƒç”¨æ³¨å†Œ API</h1><p><a href="https://github.com/YunaiV/skywalking/blob/bb8cb1b7dcb428c161f225f0b5d57441105f84c0/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/AppAndServiceRegisterClient.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.remote.AppAndServiceRegisterClient</code></a> ï¼Œå®ç° BootService ã€GRPCChannelListener ã€Runnable ã€TracingContextListener æ¥å£ï¼Œæ³¨å†Œåº”ç”¨ä¸å®ä¾‹çš„å®¢æˆ·ç«¯ã€‚è¯¥å®¢æˆ·ç«¯ä¼šè°ƒç”¨ä¸Šè¿°æ‰€æœ‰ API ã€‚</p><ul><li><code>PROCESS_UUID</code> <strong>é™æ€</strong>å±æ€§ï¼ŒAgent UUID ï¼Œä½¿ç”¨ <strong>UUID</strong> ç®—æ³•ç”Ÿæˆï¼Œå»é™¤å¤šä½™ <code>&quot;-&quot;</code> ã€‚</li><li>â€”â€”â€”- åˆ†å‰²çº¿ â€”â€”â€”-</li><li><code>status</code> å±æ€§ï¼ŒgRPC è¿æ¥çŠ¶æ€ã€‚</li><li><code>applicationRegisterServiceBlockingStub</code> / <code>instanceDiscoveryServiceBlockingStub</code> / <code>serviceNameDiscoveryServiceBlockingStub</code> å±æ€§ï¼Œå¯¹åº” gRPC æä¾› API çš„<strong>é˜»å¡</strong> Stub ã€‚</li><li><code>needRegisterRecover</code> å±æ€§ï¼Œæ˜¯å¦éœ€è¦å‘èµ·æ¢å¤çš„æ³¨å†Œã€‚</li><li>å¦‚ä¸Šäº”ä¸ªå±æ€§ï¼Œåœ¨ <a href="https://github.com/YunaiV/skywalking/blob/bb8cb1b7dcb428c161f225f0b5d57441105f84c0/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/AppAndServiceRegisterClient.java#L79" rel="external nofollow noopener noreferrer" target="_blank"><code>#statusChanged(GRPCChannelStatus)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ ¹æ® gRPC è¿æ¥çŠ¶æ€çš„å˜æ›´ï¼Œåˆ›å»ºæˆ–é”€æ¯ Stub ã€‚</li><li>åœ¨ <a href="https://github.com/YunaiV/skywalking/blob/bb8cb1b7dcb428c161f225f0b5d57441105f84c0/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/AppAndServiceRegisterClient.java#L103" rel="external nofollow noopener noreferrer" target="_blank"><code>#boot()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œå°†è‡ªå·±ä½œä¸ºç›‘å¬å™¨( å› ä¸ºå®ç°äº† GRPCChannelListener æ¥å£ )æ·»åŠ åˆ° GRPCChannelManager ä¸­ï¼Œä»è€Œç›‘å¬ gRPC Channel çš„çŠ¶æ€ã€‚åœ¨ <a href="http://www.iocoder.cn/SkyWalking/agent-remote-manager/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Agent Remote è¿œç¨‹é€šä¿¡æœåŠ¡ã€‹</a> æœ‰è¯¦ç»†è§£æã€‚</li><li>â€”â€”â€”- åˆ†å‰²çº¿ â€”â€”â€”-</li><li><code>applicationRegisterFuture</code> å±æ€§ï¼Œæ³¨å†Œåº”ç”¨ä¸å®ä¾‹çš„å®šæ—¶ä»»åŠ¡ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/bb8cb1b7dcb428c161f225f0b5d57441105f84c0/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/AppAndServiceRegisterClient.java#L103" rel="external nofollow noopener noreferrer" target="_blank"><code>#boot()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œåˆ›å»º <code>applicationRegisterFuture</code> ã€‚è¯¥å®šæ—¶ä»»åŠ¡<strong>æ— åˆå§‹åŒ–å»¶è¿Ÿ</strong>ï¼Œæ¯ <code>Config.Collector.APP_AND_SERVICE_REGISTER_CHECK_INTERVAL</code> ( é»˜è®¤ï¼š3 s ) æ‰§è¡Œä¸€æ¬¡ <code>#run()</code> æ–¹æ³•ã€‚</li><li>â€”â€”â€”- åˆ†å‰²çº¿ â€”â€”â€”-</li><li><code>lastSegmentTime</code> å±æ€§ï¼Œæœ€åè®°å½• Segment çš„æ—¶é—´ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/bb8cb1b7dcb428c161f225f0b5d57441105f84c0/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/AppAndServiceRegisterClient.java#L186" rel="external nofollow noopener noreferrer" target="_blank"><code>#afterFinished()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè®°å½• Segment æœ€åçš„æ—¶é—´ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/bb8cb1b7dcb428c161f225f0b5d57441105f84c0/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/AppAndServiceRegisterClient.java#L103" rel="external nofollow noopener noreferrer" target="_blank"><code>#afterBoot()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œå°†è‡ªå·±ä½œä¸ºç›‘å¬å™¨( å› ä¸ºå®ç°äº† TracingContextListener æ¥å£ )æ·»åŠ åˆ° GRPCChannelManager ä¸­ï¼Œä»è€Œç›‘å¬ Segment çš„è®°å½•ã€‚åœ¨ <a href="http://www.iocoder.cn/SkyWalking/agent-remote-manager/?self">ã€ŠTODO ã€4009ã€‘ã€‹</a> æœ‰è¯¦ç»†è§£æã€‚</li></ul><hr><p><a href="https://github.com/YunaiV/skywalking/blob/bb8cb1b7dcb428c161f225f0b5d57441105f84c0/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/AppAndServiceRegisterClient.java#L120" rel="external nofollow noopener noreferrer" target="_blank"><code>#run()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œåº”ç”¨çš„æ³¨å†Œï¼Œåº”ç”¨å®ä¾‹çš„æ­£å¸¸æ³¨å†Œã€æ¢å¤æ³¨å†Œã€å¿ƒè·³çš„é€»è¾‘ã€‚</p><ul><li>ç¬¬ 123 è¡Œï¼šå¾ªç¯ï¼Œå½“ gRPC å¤„äº<strong>è¿æ¥ä¸­</strong>ï¼Œå¹¶ä¸”éœ€è¦é‡è¯•( <code>shouldTry</code> )ã€‚å¯èƒ½å¯¹ <code>shouldTry</code> ä¼šæ¯”è¾ƒç–‘æƒ‘ï¼Ÿè¯¥å˜é‡ç”¨äºï¼Œåº”ç”¨çš„æ³¨å†ŒæˆåŠŸåï¼Œé‡æ–°æ ‡è®° <code>shouldTry = true</code> ï¼Œç»§ç»­æ‰§è¡Œåº”ç”¨å®ä¾‹çš„æ³¨å†Œã€‚</li><li>ç¬¬ 126 è‡³ 135 è¡Œï¼šå½“æœ¬åœ°<strong>åº”ç”¨ç¼–å·</strong>ä¸ºç©ºæ—¶ï¼Œè¯´æ˜åº”ç”¨æš‚æœªæ³¨å†Œï¼Œè°ƒç”¨ <a href="#">ã€Œ2.1 åº”ç”¨çš„æ³¨å†Œ APIã€</a> ã€‚</li><li>ç¬¬ 138 è‡³ 148 è¡Œï¼šå½“æœ¬åœ°<strong>åº”ç”¨å®ä¾‹ç¼–å·</strong>ä¸ºç©ºæ—¶ï¼Œè¯´æ˜åº”ç”¨å®ä¾‹æš‚æœªæ³¨å†Œï¼Œè°ƒç”¨ <a href="#">ã€Œ2.2 åº”ç”¨å®ä¾‹çš„æ­£å¸¸æ³¨å†Œ APIã€</a> ã€‚</li><li>ç¬¬ 150 è‡³ 158 è¡Œï¼šå½“éœ€è¦å‘èµ·æ¢å¤æ³¨å†Œæ—¶ï¼Œå³ gRPC Channel æ–­å¼€åé‡è¿æˆåŠŸï¼Œè°ƒç”¨ <a href="#">ã€Œ2.3 åº”ç”¨å®ä¾‹çš„æ¢å¤æ³¨å†Œ APIã€</a> ã€‚</li><li>ç¬¬ 159 è‡³ 167 è¡Œï¼šå½“<strong>ç°åœ¨æ—¶é—´</strong>è¶…è¿‡ <code>lastSegmentTime</code> <strong>ä¸€åˆ†é’Ÿ</strong>ï¼Œè°ƒç”¨ <a href="#">ã€Œ2.4 åº”ç”¨å®ä¾‹çš„å¿ƒè·³ APIã€</a> ã€‚</li><li>ç¬¬ 170 è‡³ 173 è¡Œï¼šåŒæ­¥åº”ç”¨å­—å…¸ã€æ“ä½œå­—å…¸ã€‚åœ¨ <a href="http://www.iocoder.cn/SkyWalking/agent-dictionary/?">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Agent DictionaryManager å­—å…¸ç®¡ç†ã€‹</a> è¯¦ç»†è§£æã€‚</li><li>ç¬¬ 178 è‡³ 180 è¡Œï¼šå½“å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œè°ƒç”¨ <code>GRPCChannelManager#reportError(t)</code> æ–¹æ³•ï¼Œå¤„ç†å¼‚å¸¸ï¼Œä¾‹å¦‚è¯·æ±‚è¶…æ—¶ã€‚</li></ul><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>ğŸ˜ˆ è·ç¦» Segment å·²ç»ä¸è¿œäº†ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_25/09.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸ªæœ‹å‹åœˆå¯å¥½ï¼Ÿ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/register/&quot;&gt;http://www.iocoder.cn/SkyWalking/register/&lt;/a&gt; ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼&lt;/p&gt;
&lt;ul&gt;
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” Agent Remote è¿œç¨‹é€šä¿¡æœåŠ¡</title>
    <link href="http://www.iocoder.cn/SkyWalking/agent-remote-manager/"/>
    <id>http://www.iocoder.cn/SkyWalking/agent-remote-manager/</id>
    <published>2020-09-19T16:00:00.000Z</published>
    <updated>2017-12-26T03:21:45.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/agent-remote-manager/">http://www.iocoder.cn/SkyWalking/agent-remote-manager/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/agent-remote-manager/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-remote-manager/">2. GRPCChannelManager</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-remote-manager/">3. GRPCChannelListener</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-remote-manager/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>SkyWalking Agent Remote è¿œç¨‹é€šä¿¡æœåŠ¡</strong>ã€‚è¯¥æœåŠ¡ç”¨äº Agent å’ŒCollector é›†ç¾¤çš„é€šä¿¡ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_20/01.png" alt=""></p><p>åœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-naming-server/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Naming Server å‘½åæœåŠ¡ã€‹</a> ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼ŒAgent ä½¿ç”¨<strong>å®šæ—¶è½®è¯¢</strong>ï¼Œä» Collector Naming Server ä¸­ï¼Œè·å¾— Collector é›†ç¾¤çš„ Collector Agent gRPC Server çš„<strong>æ‰€æœ‰åœ°å€</strong>ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_20/02.jpeg" alt=""></p><ul><li><strong>çº¢æ¡†</strong>éƒ¨åˆ†ï¼Œå³ä¸º Agent å’ŒCollector é›†ç¾¤çš„é€šä¿¡éƒ¨åˆ†ã€‚</li><li>å¦å¤–ï¼ŒCollector ä¹Ÿæä¾› <a href="https://github.com/YunaiV/skywalking/tree/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-collector/apm-collector-agent-jetty" rel="external nofollow noopener noreferrer" target="_blank">Collector Agent Jetty Server</a> ï¼Œç›®å‰æš‚ä¸ä½¿ç”¨ã€‚ç›¸æ¯”æ¥è¯´ï¼Œ<a href="https://github.com/YunaiV/skywalking/tree/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-collector/apm-collector-agent-grpc" rel="external nofollow noopener noreferrer" target="_blank">Collector Agent gRPC Server</a> æ€§èƒ½æ›´ä¼˜ã€‚</li></ul><h1 id="2-GRPCChannelManager"><a href="#2-GRPCChannelManager" class="headerlink" title="2. GRPCChannelManager"></a>2. GRPCChannelManager</h1><p><code>org.skywalking.apm.agent.core.remote.GRPCChannelManager</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/ac6c98c1732d6aa62b9d244369478654411ac203/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/boot/BootService.java" rel="external nofollow noopener noreferrer" target="_blank">BootService</a> ã€Runnable <strong>æ¥å£</strong>ï¼ŒgRPC Channel ç®¡ç†å™¨ã€‚GRPCChannelManager è´Ÿè´£ç®¡ç†ä¸ Collector Agent gRPC Server é›†ç¾¤çš„<strong>è¿æ¥çš„ç®¡ç†</strong>ï¼Œ<strong>æä¾›ç»™å…¶ä»–æœåŠ¡ä½¿ç”¨</strong>ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/GRPCChannelManager.java#L54" rel="external nofollow noopener noreferrer" target="_blank"><code>managedChannel</code></a> å±æ€§ï¼Œè¿æ¥ gRPC Server çš„ Channel ã€‚<strong>åŒä¸€æ—¶é—´ï¼ŒGRPCChannelManager åªè¿æ¥ä¸€ä¸ª Collector Agent gRPC Server èŠ‚ç‚¹ï¼Œå¹¶ä¸”åœ¨ Channel ä¸å› ä¸ºå„ç§ç½‘ç»œé—®é¢˜æ–­å¼€çš„æƒ…å†µä¸‹ï¼ŒæŒç»­ä¿æŒ</strong>ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/GRPCChannelManager.java#L58" rel="external nofollow noopener noreferrer" target="_blank"><code>connectCheckFuture</code></a> å±æ€§ï¼Œå®šæ—¶é‡è¿ gRPC Server çš„<strong>å®šæ—¶ä»»åŠ¡</strong>ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/GRPCChannelManager.java#L63" rel="external nofollow noopener noreferrer" target="_blank"><code>reconnect</code></a> å±æ€§ï¼Œæ˜¯å¦é‡è¿ã€‚å½“ Channel æœªè¿æ¥éœ€è¦è¿æ¥ï¼Œæˆ–è€… Channel æ–­å¼€éœ€è¦é‡è¿æ—¶ï¼Œæ ‡è®° <code>reconnect = true</code> ã€‚åå°çº¿ç¨‹ä¼šæ ¹æ®è¯¥æ ‡è¯†è¿›è¡Œè¿æ¥( é‡è¿ )ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/GRPCChannelManager.java#L68" rel="external nofollow noopener noreferrer" target="_blank"><code>listeners</code></a> å±æ€§ï¼Œç›‘å¬å™¨( <code>org.skywalking.apm.agent.core.remote.GRPCChannelListener</code> ) æ•°ç»„ã€‚ä½¿ç”¨ Channel çš„å…¶ä»–æœåŠ¡ï¼Œæ³¨å†Œç›‘å¬å™¨åˆ° GRPCChannelManager ä¸Šï¼Œä»è€Œæ ¹æ®è¿æ¥çŠ¶æ€( <code>org.skywalking.apm.agent.core.remote.GRPCChannelStatus</code> )ï¼Œå®ç°è‡ªå®šä¹‰é€»è¾‘ã€‚ </li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/GRPCChannelManager.java#L76" rel="external nofollow noopener noreferrer" target="_blank"><code>#boot()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè°ƒç”¨ <code>ScheduledExecutorService#scheduleAtFixedRate(...)</code> æ–¹æ³•ï¼Œåˆ›å»ºå®šæ—¶ä»»åŠ¡ã€‚è¯¥å®šæ—¶ä»»åŠ¡<strong>æ— åˆå§‹åŒ–å»¶è¿Ÿ</strong>ï¼Œæ¯ <code>Config.GRPC_CHANNEL_CHECK_INTERVAL</code> ( é»˜è®¤ï¼š30 s ) æ‰§è¡Œä¸€æ¬¡ <code>#run()</code> æ–¹æ³•ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/GRPCChannelManager.java#L97" rel="external nofollow noopener noreferrer" target="_blank"><code>#run()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œ Channel çš„è¿æ¥( é‡è¿ )é€»è¾‘ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 99 è¡Œï¼šå½“ <code>reconnect = true</code> æ—¶ï¼Œæ‰æ‰§è¡Œè¿æ¥( é‡è¿ )ã€‚</li><li>ç¬¬ 100 è¡Œï¼šå½“æœ¬åœ°å·²ç»è·å–åˆ° Collector Agent gRPC Server é›†ç¾¤åœ°å€æ—¶ï¼Œå‚è§ <a href="http://www.iocoder.cn/SkyWalking/collector-naming-server/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Naming Server å‘½åæœåŠ¡ã€‹</a> ã€‚</li><li>ç¬¬ 101 è‡³ 106 è¡Œï¼š<strong>éšæœºé€‰æ‹©</strong>å‡†å¤‡é“¾æ¥çš„ Collector Agent gRPC Server ã€‚</li><li>ç¬¬ 107 è‡³ 113 è¡Œï¼šåˆ›å»º Channel å¹¶è¿›è¡Œè¿æ¥ã€‚æ­¤å¤„ä¸»è¦æ˜¯ gRPC çš„ API ä½¿ç”¨ï¼Œä¸ç†Ÿæ‚‰çš„èƒ–å‹ï¼Œè¯· Google ä¸‹è¿›è¡Œäº†è§£äº†è§£ã€‚</li><li>ç¬¬ 115 è‡³ 117 è¡Œï¼šè¿æ¥<strong>æˆåŠŸ</strong>ï¼Œæ ‡è®° <code>reconnect = false</code> ï¼Œè¿™æ ·ï¼Œä¸‹æ¬¡æ‰§è¡Œ <code>#run()</code> æ–¹æ³•ä¸ä¼šé‡è¿ã€‚è€Œåï¼Œè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/GRPCChannelManager.java#L160" rel="external nofollow noopener noreferrer" target="_blank"><code>#notify(GRPCChannelStatus.CONNECTED)</code></a> æ–¹æ³•ï¼Œé€šçŸ¥ç›‘å¬å™¨è¿æ¥æˆåŠŸã€‚</li><li>ç¬¬ 118 è‡³ 121 è¡Œï¼šè¿æ¥<strong>æˆåŠŸ</strong>ï¼Œä¸æ ‡è®° <code>reconnect</code> ï¼Œè¿™æ ·ï¼Œä¸‹æ¬¡æ‰§è¡Œ <code>#run()</code> æ–¹æ³•ä¼šç»§ç»­é‡è¿ã€‚è€Œåï¼Œè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/GRPCChannelManager.java#L160" rel="external nofollow noopener noreferrer" target="_blank"><code>#notify(GRPCChannelStatus.DISCONNECT)</code></a> æ–¹æ³•ï¼Œé€šçŸ¥ç›‘å¬å™¨è¿æ¥å¤„äºæ–­å¼€çŠ¶æ€ã€‚</li><li>ç¬¬ 124 è‡³ 126 è¡Œï¼šè¿æ¥<strong>å¼‚å¸¸</strong>ï¼Œä¸æ ‡è®° <code>reconnect</code> ï¼Œè¿™æ ·ï¼Œä¸‹æ¬¡æ‰§è¡Œ <code>#run()</code> æ–¹æ³•ä¼šç»§ç»­é‡è¿ã€‚è€Œåï¼Œè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/GRPCChannelManager.java#L160" rel="external nofollow noopener noreferrer" target="_blank"><code>#notify(GRPCChannelStatus.DISCONNECT)</code></a> æ–¹æ³•ï¼Œé€šçŸ¥ç›‘å¬å™¨è¿æ¥å¤„äºæ–­å¼€çŠ¶æ€ã€‚</li></ul><p>å®é™…ä½¿ç”¨ä¸­ï¼ŒChannel å¯èƒ½å› ä¸ºå„ç§åŸå› æ–­å¼€ï¼Œé‚£ä¹ˆ GRPCChannelManager æ˜¯æ€ä¹ˆæ£€æµ‹çš„å‘¢ï¼Ÿåœ¨ä½¿ç”¨ Channel çš„<strong>å…¶ä»–æœåŠ¡</strong>ï¼Œå½“ä½¿ç”¨ Channel æ—¶å‘ç”Ÿå¼‚å¸¸ï¼Œè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/GRPCChannelManager.java#L149" rel="external nofollow noopener noreferrer" target="_blank"><code>#reportError(Throwable)</code></a> æ–¹æ³•ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºç½‘ç»œå¼‚å¸¸( <a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/GRPCChannelManager.java#L176" rel="external nofollow noopener noreferrer" target="_blank"><code>#isNetworkError(Throwable)</code></a> ) ã€‚è‹¥æ˜¯ï¼Œæ ‡è®° <code>reconnect = true</code> ï¼Œç­‰å¾…åå°è¿›è¡Œé‡è¿ã€‚</p><h1 id="3-GRPCChannelListener"><a href="#3-GRPCChannelListener" class="headerlink" title="3. GRPCChannelListener"></a>3. GRPCChannelListener</h1><p><code>org.skywalking.apm.agent.core.remote.GRPCChannelListener</code> ï¼ŒgRPC Channel çš„ç›‘å¬å™¨<strong>æ¥å£</strong>ï¼Œå®šä¹‰äº† <a href="https://github.com/YunaiV/skywalking/blob/ba73b05b99a05bb67fd485188a6c6e0a4ad5fe57/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/GRPCChannelListener.java#L33" rel="external nofollow noopener noreferrer" target="_blank"><code>#statusChanged(GRPCChannelStatus)</code></a> ï¼Œé€šçŸ¥ gRPC Channel çŠ¶æ€å˜æ›´ã€‚</p><p>GRPCChannelListener å®ç°ç±»å¦‚ä¸‹å›¾ï¼Œåç»­æ–‡ç« ä¼šè¯¦ç»†è§£æã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_20/03.png" alt=""></p><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>â€œæ°´â€æ–‡ä¸€ç¯‡ï¼Œå“ˆå“ˆå“ˆã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_20/04.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸€æ³¢æœ‹å‹åœˆå¯å¥½ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/agent-remote-manager/&quot;&gt;http://www.iocoder.cn/SkyWalking/agent-remote-manager/&lt;/a&gt; ã€ŒèŠ‹é“æº
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” DataCarrier å¼‚æ­¥å¤„ç†åº“</title>
    <link href="http://www.iocoder.cn/SkyWalking/data-carrier/"/>
    <id>http://www.iocoder.cn/SkyWalking/data-carrier/</id>
    <published>2020-09-14T16:00:00.000Z</published>
    <updated>2017-12-25T12:46:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/data-carrier/">http://www.iocoder.cn/SkyWalking/data-carrier/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/data-carrier/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/data-carrier/">2. buffer</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/data-carrier/">2.1 Buffer</a></li><li><a href="http://www.iocoder.cn/SkyWalking/data-carrier/">2.2 Channels</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/data-carrier/">3. partition</a></li><li><a href="http://www.iocoder.cn/SkyWalking/data-carrier/">4. consumer</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/data-carrier/">4.1 IConsumer</a></li><li><a href="http://www.iocoder.cn/SkyWalking/data-carrier/">4.2 ConsumerThread</a></li><li><a href="http://www.iocoder.cn/SkyWalking/data-carrier/">4.3 ConsumerPool</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/data-carrier/">4. DataCarrier</a></li><li><a href="http://www.iocoder.cn/SkyWalking/data-carrier/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>SkyWalking DataCarrier å¼‚æ­¥å¤„ç†åº“</strong>ã€‚</p><p>åŸºäºç”Ÿäº§è€…æ¶ˆè´¹è€…çš„æ¨¡å¼ï¼Œå¤§ä½“ç»“æ„å¦‚ä¸‹å›¾ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_09_15/01.png" alt=""></p><ul><li>å®é™…é¡¹ç›®ä¸­ï¼Œæ²¡æœ‰ Producer è¿™ä¸ªç±»ã€‚æ‰€ä»¥æœ¬æ–‡æåˆ°çš„ Producer ï¼Œæ›´å¤šçš„æ˜¯ä¸€ç§<strong>è§’è‰²</strong>ã€‚</li></ul><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ•´ä½“çš„é¡¹ç›®ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_09_15/02.png" alt=""></p><h1 id="2-buffer"><a href="#2-buffer" class="headerlink" title="2. buffer"></a>2. buffer</h1><p><code>org.skywalking.apm.commons.datacarrier.buffer</code> åŒ…ï¼Œä¸»è¦åŒ…å« Channels ã€Buffer ä¸¤ä¸ªç±»ã€‚Channels æ˜¯ Buffer æ•°ç»„çš„å°è£…ã€‚</p><h2 id="2-1-Buffer"><a href="#2-1-Buffer" class="headerlink" title="2.1 Buffer"></a>2.1 Buffer</h2><p><code>org.skywalking.apm.commons.datacarrier.buffer.Buffer</code> ï¼Œç¼“å­˜åŒºã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/98217271d1b4d2075871b3e262c9b99bb9c1f657/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/buffer/Buffer.java#L35" rel="external nofollow noopener noreferrer" target="_blank"><code>buffer</code></a> å±æ€§ï¼Œç¼“å†²æ•°ç»„ã€‚Producer ä¿å­˜çš„æ•°æ®åˆ° <code>buffer</code> é‡Œã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/98217271d1b4d2075871b3e262c9b99bb9c1f657/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/buffer/Buffer.java#L39" rel="external nofollow noopener noreferrer" target="_blank"><code>strategy</code></a> ï¼Œç¼“å†²ç­–ç•¥( <a href="https://github.com/YunaiV/skywalking/blob/98217271d1b4d2075871b3e262c9b99bb9c1f657/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/buffer/BufferStrategy.java#L26" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.commons.datacarrier.buffer.BufferStrategy</code></a> ) ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/98217271d1b4d2075871b3e262c9b99bb9c1f657/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/buffer/Buffer.java#L43" rel="external nofollow noopener noreferrer" target="_blank"><code>index</code></a> å±æ€§ï¼Œé€’å¢ä½ç½®( <a href="https://github.com/YunaiV/skywalking/blob/98217271d1b4d2075871b3e262c9b99bb9c1f657/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/common/AtomicRangeInteger.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.commons.datacarrier.common.AtomicRangeInteger</code></a> )ã€‚</li></ul><p>Buffer åœ¨ä¿å­˜æ•°æ®æ—¶ï¼ŒæŠŠ <code>buffer</code> ä½œä¸ºä¸€ä¸ª â€œ<strong>ç¯</strong>â€œï¼Œä½¿ç”¨ <code>index</code> è®°å½•æœ€åå­˜å‚¨çš„ä½ç½®ï¼Œä¸æ–­å‘ä¸‹ï¼Œ<strong>å¾ªç¯</strong>å­˜å‚¨åˆ° <code>buffer</code> ä¸­ã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œå¸¦æ¥è‰¯å¥½çš„å­˜å‚¨æ€§èƒ½ï¼Œé¿å…æ‰©å®¹é—®é¢˜ã€‚But ï¼Œå­˜å‚¨ä¼šå­˜åœ¨å†²çªçš„é—®é¢˜ï¼š<code>buffer</code> å†™å…¥ä½ç½®ï¼Œæš‚æœªè¢«æ¶ˆè´¹ï¼Œå·²ç»å­˜åœ¨å€¼ã€‚æ­¤æ—¶ï¼Œæ ¹æ®ä¸åŒçš„ BufferStrategy è¿›è¡Œå¤„ç†ã€‚æ•´ä½“æµç¨‹è§ <a href="https://github.com/YunaiV/skywalking/blob/98217271d1b4d2075871b3e262c9b99bb9c1f657/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/buffer/Buffer.java#L61" rel="external nofollow noopener noreferrer" target="_blank"><code>#save(data)</code></a> æ–¹æ³•ã€‚</p><p>å½“ Buffer è¢« Consumer æ¶ˆè´¹æ—¶ï¼Œè¢«è°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/98217271d1b4d2075871b3e262c9b99bb9c1f657/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/buffer/Buffer.java#L88" rel="external nofollow noopener noreferrer" target="_blank"><code>#obtain(start, end)</code></a> æ–¹æ³•ï¼Œè·å¾—æ•°æ®å¹¶æ¸…ç©ºã€‚ä¸ºä»€ä¹ˆä¼šå¸¦ <code>start</code> ã€<code>end</code> æ–¹æ³•å‚æ•°å‘¢ï¼Ÿä¸‹æ–‡æ­æ™“ç­”æ¡ˆã€‚</p><h2 id="2-2-Channels"><a href="#2-2-Channels" class="headerlink" title="2.2 Channels"></a>2.2 Channels</h2><p><code>org.skywalking.apm.commons.datacarrier.buffer.Channels</code> ï¼Œå†…åµŒ<strong>å¤šä¸ª</strong> Buffer çš„é€šé“ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/98217271d1b4d2075871b3e262c9b99bb9c1f657/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/buffer/Channels.java#L37" rel="external nofollow noopener noreferrer" target="_blank"><code>bufferChannels</code></a> å±æ€§ï¼ŒBuffer æ•°ç»„ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/98217271d1b4d2075871b3e262c9b99bb9c1f657/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/buffer/Channels.java#L38" rel="external nofollow noopener noreferrer" target="_blank"><code>dataPartitioner</code></a> å±æ€§ï¼Œæ•°æ®åˆ†åŒº( <a href="https://github.com/YunaiV/skywalking/blob/98217271d1b4d2075871b3e262c9b99bb9c1f657/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/partition/IDataPartitioner.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.commons.datacarrier.partition.IDataPartitioner</code></a> )ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/98217271d1b4d2075871b3e262c9b99bb9c1f657/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/buffer/Buffer.java#L39" rel="external nofollow noopener noreferrer" target="_blank"><code>strategy</code></a> å±æ€§ï¼Œç¼“å†²ç­–ç•¥( <a href="https://github.com/YunaiV/skywalking/blob/98217271d1b4d2075871b3e262c9b99bb9c1f657/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/buffer/Channels.java#L42" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.commons.datacarrier.buffer.BufferStrategy</code></a> ) ã€‚</li></ul><p>Channels åœ¨ä¿å­˜æ•°æ®æ—¶ï¼Œç›¸æ¯” Buffer ï¼Œä» <code>buffer</code> å˜æˆäº†å¤š <code>buffer</code> ï¼Œå› æ­¤éœ€è¦å…ˆé€‰ä¸€ä¸ª <code>buffer</code> ã€‚é€šè¿‡ä½¿ç”¨ä¸åŒçš„ IDataPartitioner å®ç°ç±»ï¼Œè¿›è¡Œ Buffer çš„é€‰æ‹©ã€‚å½“ç¼“å†²ç­–ç•¥ä¸º <code>BufferStrategy.IF_POSSIBLE</code> æ—¶ï¼Œæ ¹æ® IDataPartitioner å®šä¹‰çš„é‡è¯•æ¬¡æ•°ï¼Œè¿›è¡Œå¤šæ¬¡ä¿å­˜æ•°æ®ç›´åˆ°æˆåŠŸã€‚æ•´ä½“æµç¨‹è§ <a href="https://github.com/YunaiV/skywalking/blob/98217271d1b4d2075871b3e262c9b99bb9c1f657/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/buffer/Channels.java#L62" rel="external nofollow noopener noreferrer" target="_blank"><code>#save(data)</code></a> æ–¹æ³•ã€‚</p><h1 id="3-partition"><a href="#3-partition" class="headerlink" title="3. partition"></a>3. partition</h1><p><a href="https://github.com/YunaiV/skywalking/blob/98217271d1b4d2075871b3e262c9b99bb9c1f657/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/partition/IDataPartitioner.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.commons.datacarrier.partition.IDataPartitioner</code></a> ï¼Œæ•°æ®åˆ†é…è€…<strong>æ¥å£</strong>ã€‚å®šä¹‰äº†å¦‚ä¸‹æ–¹æ³•ï¼š</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/98217271d1b4d2075871b3e262c9b99bb9c1f657/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/partition/IDataPartitioner.java#L37" rel="external nofollow noopener noreferrer" target="_blank"><code>#partition(total, data)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œè·å¾—æ•°æ®è¢«åˆ†é…çš„åˆ†åŒºä½ç½®ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/98217271d1b4d2075871b3e262c9b99bb9c1f657/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/partition/IDataPartitioner.java#L46" rel="external nofollow noopener noreferrer" target="_blank"><code>#maxRetryCount()</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œè·å¾—æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚</li></ul><p>IDataPartitioner ç›®å‰æœ‰ä¸¤ä¸ªå­ç±»å®ç°ï¼š</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/98217271d1b4d2075871b3e262c9b99bb9c1f657/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/partition/ProducerThreadPartitioner.java" rel="external nofollow noopener noreferrer" target="_blank">ProducerThreadPartitioner</a> ï¼ŒåŸºäºçº¿ç¨‹ç¼–å·åˆ†é…ç­–ç•¥çš„æ•°æ®åˆ†é…è€…å®ç°ç±»ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/98217271d1b4d2075871b3e262c9b99bb9c1f657/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/partition/SimpleRollingPartitioner.java" rel="external nofollow noopener noreferrer" target="_blank">SimpleRollingPartitioner</a> ï¼ŒåŸºäºé¡ºåºåˆ†é…ç­–ç•¥çš„æ•°æ®åˆ†é…è€…å®ç°ç±»ã€‚</li></ul><h1 id="4-consumer"><a href="#4-consumer" class="headerlink" title="4. consumer"></a>4. consumer</h1><p><code>org.skywalking.apm.commons.datacarrier.consumer</code> åŒ…ï¼Œä¸»è¦åŒ…å« ConsumerPool ã€ConsumerThread ã€IConsumer ä¸‰ä¸ªç±»ã€‚</p><ul><li>ConsumerThread ä½¿ç”¨ IConsumer ï¼Œæ¶ˆè´¹æ•°æ®</li><li>ConsumerPool æ˜¯ ConsumerThread çš„çº¿ç¨‹æ± å°è£…</li></ul><h2 id="4-1-IConsumer"><a href="#4-1-IConsumer" class="headerlink" title="4.1 IConsumer"></a>4.1 IConsumer</h2><p><code>org.skywalking.apm.commons.datacarrier.consumer.IConsumer</code> ï¼Œæ¶ˆè´¹è€…æ¥å£ã€‚å®šä¹‰äº†å¦‚ä¸‹æ–¹æ³•ï¼š</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/IConsumer.java#L33" rel="external nofollow noopener noreferrer" target="_blank"><code>#init()</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œåˆå§‹åŒ–æ¶ˆè´¹è€…ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/IConsumer.java#L40" rel="external nofollow noopener noreferrer" target="_blank"><code>#consume(List&lt;T&gt;)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œæ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/IConsumer.java#L48" rel="external nofollow noopener noreferrer" target="_blank"><code>#onError(List&lt;T&gt;, Throwable)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œå¤„ç†å½“æ¶ˆè´¹å‘ç”Ÿå¼‚å¸¸ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/IConsumer.java#L53" rel="external nofollow noopener noreferrer" target="_blank"><code>#onExit()</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œå¤„ç†å½“æ¶ˆè´¹ç»“æŸã€‚æ­¤å¤„çš„ç»“æŸæ—¶ï¼ŒConsumerThread å…³é—­ã€‚</li></ul><p>æˆ‘ä»¬åœ¨ä½¿ç”¨æ—¶ï¼Œè‡ªå®šä¹‰ Consumer ç±»ï¼Œå®ç° IConsumer æ¥å£ã€‚ä¾‹å¦‚ï¼š<a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteClient.java#L93" rel="external nofollow noopener noreferrer" target="_blank">RemoteMessageConsumer</a> ã€‚</p><h2 id="4-2-ConsumerThread"><a href="#4-2-ConsumerThread" class="headerlink" title="4.2 ConsumerThread"></a>4.2 ConsumerThread</h2><p><code>org.skywalking.apm.commons.datacarrier.consumer.ConsumerThread</code> ï¼Œç»§æ‰¿ <code>java.lang.Thread</code> ï¼Œæ¶ˆè´¹çº¿ç¨‹ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/ConsumerThread.java#L36" rel="external nofollow noopener noreferrer" target="_blank"><code>running</code></a> å±æ€§ï¼Œæ˜¯å¦è¿è¡Œä¸­ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/ConsumerThread.java#L40" rel="external nofollow noopener noreferrer" target="_blank"><code>consumer</code></a> å±æ€§ï¼Œæ¶ˆè´¹è€…å¯¹è±¡ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/ConsumerThread.java#L44" rel="external nofollow noopener noreferrer" target="_blank"><code>dataSources</code></a> å±æ€§ï¼Œæ¶ˆè´¹æ¶ˆæ¯çš„æ•°æ®æº( <a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/ConsumerThread.java#L139" rel="external nofollow noopener noreferrer" target="_blank">DataSource</a> )æ•°ç»„ã€‚ä¸€ä¸ª ConsumerThread ï¼Œå¯ä»¥æ¶ˆè´¹å¤šä¸ª Buffer ï¼Œå¹¶ä¸”å•ä¸ª Buffer æ¶ˆè´¹çš„åˆ†åŒºèŒƒå›´å¯é…ç½®ï¼Œå³ä¸€ä¸ª Buffer å¯ä»¥è¢«å¤šä¸ª ConsumerThread åŒæ—¶æ— å†²çªçš„æ¶ˆè´¹ã€‚åœ¨ <a href="#">ã€Œ4.3 ConsumerPoolã€</a> è¯¦ç»†è§£æ ConsumerThread åˆ†é… Buffer çš„æ–¹å¼ã€‚<ul><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/ConsumerThread.java#L60" rel="external nofollow noopener noreferrer" target="_blank"><code>#addDataSource(sourceBuffer, start, end)</code></a> æ–¹æ³•ï¼Œæ·»åŠ  Buffer éƒ¨åˆ†èŒƒå›´ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/ConsumerThread.java#L69" rel="external nofollow noopener noreferrer" target="_blank"><code>#addDataSource(sourceBuffer)</code></a> æ–¹æ³•ï¼Œæ·»åŠ  Buffer å…¨éƒ¨èŒƒå›´ã€‚</li></ul></li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/ConsumerThread.java#L74" rel="external nofollow noopener noreferrer" target="_blank"><code>#run()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œ<strong>ä¸æ–­</strong>ã€<strong>æ‰¹é‡</strong>çš„æ¶ˆè´¹æ•°æ®ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 78 è‡³ 88 è¡Œï¼š<strong>ä¸æ–­</strong>æ¶ˆè´¹ï¼Œç›´åˆ°çº¿ç¨‹å…³é—­( <a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/ConsumerThread.java#L130" rel="external nofollow noopener noreferrer" target="_blank"><code>#shutdown()</code></a> )ã€‚<ul><li>ç¬¬ 80 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/ConsumerThread.java#L103" rel="external nofollow noopener noreferrer" target="_blank"><code>#consume()</code></a> æ–¹æ³•ï¼Œ<strong>æ‰¹é‡</strong>æ¶ˆè´¹æ•°æ®ã€‚</li><li>ç¬¬ 82 è‡³ 87 è¡Œï¼šå½“æœªæ¶ˆè´¹åˆ°æ•°æ®ï¼Œè¯´æ˜ <code>dataSources</code> ä¸ºç©ºï¼Œç­‰å¾… 20 ms ï¼Œé¿å… CPU ç©ºè·‘ã€‚</li></ul></li><li>ç¬¬ 93 è¡Œï¼šå½“çº¿ç¨‹å…³é—­ï¼Œè°ƒç”¨ <code>#consume()</code> æ–¹æ³•ï¼Œæ¶ˆè´¹å®Œ <code>dataSources</code> å‰©ä½™çš„æ•°æ®ã€‚</li><li>ç¬¬ 95 è¡Œï¼šè°ƒç”¨ <code>IConsumer#onExit()</code> æ–¹æ³•ï¼Œå¤„ç†å½“æ¶ˆè´¹ç»“æŸã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/ConsumerThread.java#L103" rel="external nofollow noopener noreferrer" target="_blank"><code>#consume()</code></a> æ–¹æ³•ï¼Œ<strong>æ‰¹é‡</strong>æ¶ˆè´¹æ•°æ®ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 107 è‡³ 117 è¡Œï¼šä» <code>dataSources</code> ä¸­ï¼Œè·å–è¦æ¶ˆè´¹çš„æ•°æ®ã€‚</li><li>ç¬¬ 120 è‡³ 126 è¡Œï¼šå½“æœ‰æ•°æ®å¯æ¶ˆè´¹æ—¶ï¼Œè°ƒç”¨ <code>IConsumer#consume(List&lt;T&gt;)</code> æ–¹æ³•ã€‚å½“æ¶ˆè´¹å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œè°ƒç”¨ <code>IConsumer#onError(List&lt;T&gt;, Throwable)</code> æ–¹æ³•ã€‚</li><li>ç¬¬ 127 è¡Œï¼šè¿”å›æ˜¯å¦æœ‰æ¶ˆè´¹æ•°æ®ã€‚</li></ul><h2 id="4-3-ConsumerPool"><a href="#4-3-ConsumerPool" class="headerlink" title="4.3 ConsumerPool"></a>4.3 ConsumerPool</h2><p><code>org.skywalking.apm.commons.datacarrier.consumer.ConsumerPool</code> ï¼Œæ¶ˆè´¹è€…æ± ï¼Œæä¾›äº†å¯¹ Channels å¯åŠ¨<strong>æŒ‡å®šæ•°é‡</strong>çš„ ConsumerThread è¿›è¡Œæ¶ˆè´¹ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/ConsumerPool.java#L39" rel="external nofollow noopener noreferrer" target="_blank"><code>running</code></a> å±æ€§ï¼Œæ˜¯å¦è¿è¡Œä¸­ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/ConsumerPool.java#L43" rel="external nofollow noopener noreferrer" target="_blank"><code>consumerThreads</code></a> å±æ€§ï¼ŒConsumerThread æ•°ç»„ï¼Œé€šè¿‡æ„é€ æ–¹æ³•çš„ <code>num</code> å‚æ•°è¿›è¡ŒæŒ‡å®šã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/ConsumerPool.java#L47" rel="external nofollow noopener noreferrer" target="_blank"><code>channels</code></a> å±æ€§ï¼Œ<strong>æ•°æ®</strong>é€šé“ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/ConsumerPool.java#L51" rel="external nofollow noopener noreferrer" target="_blank"><code>lock</code></a> å±æ€§ï¼Œé”ã€‚ä¿è¯ ConsumerPool å¯åŠ¨æˆ–å…³é—­æ—¶çš„çº¿ç¨‹å®‰å…¨ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/ConsumerPool.java#L96" rel="external nofollow noopener noreferrer" target="_blank"><code>#begin()</code></a> æ–¹æ³•ï¼Œå¯åŠ¨ ConsumerPool ï¼Œè¿›è¡Œæ•°æ®æ¶ˆè´¹ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 97 è‡³ 99 è¡Œï¼šæ­£åœ¨è¿è¡Œä¸­ï¼Œç›´æ¥è¿”å›ã€‚</li><li>ç¬¬ 101 è¡Œï¼šè·å¾—é”ã€‚</li><li>ç¬¬ 104 è¡Œï¼šè°ƒç”¨ <code>#allocateBuffer2Thread()</code> æ–¹æ³•ï¼Œå°† <code>channels</code> çš„<strong>å¤šä¸ª</strong> Buffer ï¼Œåˆ†é…ç»™ <code>consumerThreads</code> çš„<strong>å¤šä¸ª</strong> ConsumerThreadã€‚</li><li>ç¬¬ 107 è‡³ 109 è¡Œï¼šå¯åŠ¨æ¯ä¸ª ConsumerThread ï¼Œå¼€å§‹æ¶ˆè´¹ã€‚</li><li>ç¬¬ 112 è¡Œï¼šæ ‡è®°æ­£åœ¨è¿è¡Œä¸­ã€‚</li><li>ç¬¬ 114 è¡Œï¼šé‡Šæ”¾é”ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/ConsumerPool.java#L166" rel="external nofollow noopener noreferrer" target="_blank"><code>close()</code></a> æ–¹æ³•ï¼Œå…³é—­ ConsumerPool ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 168 è¡Œï¼šè·å¾—é”ã€‚</li><li>ç¬¬ 169 è¡Œï¼šæ ‡è®°ä¸åœ¨è¿è¡Œä¸­ã€‚</li><li>ç¬¬ 170 è‡³ 172 è¡Œï¼šå…³é—­æ¯ä¸ª ConsumerThread ï¼Œç»“æŸæ¶ˆè´¹ã€‚</li><li>ç¬¬ 174 è¡Œï¼šé‡Šæ”¾é”ã€‚</li></ul><hr><p><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/consumer/ConsumerPool.java#L122" rel="external nofollow noopener noreferrer" target="_blank"><code>#allocateBuffer2Thread()</code></a> æ–¹æ³•ï¼Œå°† <code>channels</code> çš„<strong>å¤šä¸ª</strong> Buffer ï¼Œåˆ†é…ç»™ <code>consumerThreads</code> çš„<strong>å¤šä¸ª</strong> ConsumerThreadã€‚ä¸€å…±ä¼šæœ‰ä¸‰ç§æƒ…å†µï¼š</p><ul><li><p>Buffer æ•°é‡<strong>ç­‰äº</strong> ConsumerThread æ•°é‡ï¼Œè¿™ä¸ªååˆ†å¥½åˆ†é…ï¼Œä¸€æ¯”ä¸€ã€‚</p></li><li><p>Buffer æ•°é‡<strong>å¤§äº</strong> ConsumerThread æ•°é‡ï¼Œé‚£ä¹ˆæŒ‰ç…§ Buffer æ•°é‡ <code>%</code> ConsumerThread æ•°é‡è¿›è¡Œåˆ†ç»„ï¼Œåˆ†é…ç»™ ConsumerThread ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_09_15/03.png" alt=""></p></li><li><p>Buffer æ•°é‡<strong>å¤§äº</strong> ConsumerThread æ•°é‡ï¼Œé‚£ä¹ˆæŒ‰ç…§ ConsumerThread æ•°é‡ <code>%</code> Buffer æ•°é‡è¿›è¡Œåˆ†ç»„ï¼Œåˆ†é…ç»™ Buffer ã€‚å…¶ä¸­ï¼Œä¸€ä¸ª Buffer ä¼šè¢«<strong>å‡åˆ†</strong>ç»™å¤šä¸ª ConsumerThread ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_09_15/04.png" alt=""></p><ul><li>è¿™ä¸ªå°±æ˜¯ä¸ºä»€ä¹ˆ Buffer é‡Œé¢ï¼Œæä¾›äº† <a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/buffer/Buffer.java#L88" rel="external nofollow noopener noreferrer" target="_blank"><code>Buffer#obtain(start, end)</code></a> æ–¹æ³•çš„åŸå› ã€‚</li></ul></li></ul><h1 id="4-DataCarrier"><a href="#4-DataCarrier" class="headerlink" title="4. DataCarrier"></a>4. DataCarrier</h1><p><code>org.skywalking.apm.commons.datacarrier.DataCarrier</code> ï¼ŒDataCarrier å¼‚æ­¥å¤„ç†åº“çš„<strong>å…¥å£ç¨‹åº</strong>ã€‚é€šè¿‡åˆ›å»º DataCarrier å¯¹è±¡ï¼Œä½¿ç”¨<strong>ç”Ÿäº§è€…æ¶ˆè´¹è€…çš„æ¨¡å¼</strong>ï¼Œæ‰§è¡Œå¼‚æ­¥æ‰§è¡Œé€»è¾‘ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/DataCarrier.java#L53" rel="external nofollow noopener noreferrer" target="_blank">æ„é€ æ–¹æ³•</a> ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li><p><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/DataCarrier.java#L47" rel="external nofollow noopener noreferrer" target="_blank"><code>channels</code></a> å±æ€§ï¼Œ<strong>æ•°æ®</strong>é€šé“ã€‚åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é»˜è®¤ä½¿ç”¨ SimpleRollingPartitioner ä½œä¸ºæ•°æ®åˆ†åŒºåˆ†é…è€…ï¼Œä½¿ç”¨ <code>BufferStrategy.BLOCKING</code> ä½œä¸ºç¼“å†²ç­–ç•¥ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/DataCarrier.java#L66" rel="external nofollow noopener noreferrer" target="_blank"><code>#setPartitioner(IDataPartitioner)</code></a> æ–¹æ³•ï¼Œè®¾ç½®æ•°æ®åˆ†åŒºåˆ†é…è€…ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/DataCarrier.java#L77" rel="external nofollow noopener noreferrer" target="_blank"><code>#setBufferStrategy(BufferStrategy)</code></a> æ–¹æ³•ï¼Œè®¾ç½®ç¼“å†²ç­–ç•¥ã€‚</li></ul></li><li><p><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/DataCarrier.java#L53" rel="external nofollow noopener noreferrer" target="_blank"><code>channelSize</code></a> æ–¹æ³•å‚æ•°ï¼Œé€šé“å¤§å°ã€‚</p></li><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/DataCarrier.java#L53" rel="external nofollow noopener noreferrer" target="_blank"><code>bufferSize</code></a> æ–¹æ³•å‚æ•°ï¼Œç¼“å†²åŒºå¤§å°ã€‚</li></ul><p><strong>è®¾ç½®æ¶ˆè´¹è€…å’Œæ¶ˆè´¹çº¿ç¨‹æ•°é‡</strong>ï¼š</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/DataCarrier.java#L107" rel="external nofollow noopener noreferrer" target="_blank"><code>#consume(Class&lt;? extends IConsumer&lt;T&gt;&gt;, num)</code></a></li><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/DataCarrier.java#L124" rel="external nofollow noopener noreferrer" target="_blank"><code>#consume(IConsumer&lt;T&gt;, num)</code></a></li></ul><p><strong>ç”Ÿäº§æ¶ˆæ¯</strong></p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/DataCarrier.java#L88" rel="external nofollow noopener noreferrer" target="_blank"><code>#produce(data)</code></a></li></ul><p><strong>å…³é—­æ¶ˆè´¹</strong></p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/fbdce6d3c0fe456629a2eef40184a3dbc9df812c/apm-commons/apm-datacarrier/src/main/java/org/skywalking/apm/commons/datacarrier/DataCarrier.java#L138" rel="external nofollow noopener noreferrer" target="_blank"><code>#shutdownConsumers()</code></a></li></ul><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>æœ¬æ–‡çš„å›¾ï¼Œç”»çš„çœŸéš¾çœ‹ï¼Œæ¥è‡ªè‡ªå·±çš„åæ§½ï¼Œå“ˆå“ˆå“ˆã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_15/05.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸€æ³¢æœ‹å‹åœˆå¯å¥½ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/data-carrier/&quot;&gt;http://www.iocoder.cn/SkyWalking/data-carrier/&lt;/a&gt; ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼&lt;
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” Collector Remote è¿œç¨‹é€šä¿¡æœåŠ¡</title>
    <link href="http://www.iocoder.cn/SkyWalking/collector-remote-module/"/>
    <id>http://www.iocoder.cn/SkyWalking/collector-remote-module/</id>
    <published>2020-09-09T16:00:00.000Z</published>
    <updated>2017-12-25T12:45:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">http://www.iocoder.cn/SkyWalking/collector-remote-module/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">2. collector-remote-define</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">2.1 RemoteModule</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">2.2 RemoteSenderService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">2.3 RemoteClientService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">2.4 RemoteClient</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">2.5 CommonRemoteDataRegisterService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">2.6 RemoteSerializeService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">2.7 RemoteSerializeService</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">3. collector-remote-grpc-provider</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">3.1 RemoteModuleGRPCProvider</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">3.2 GRPCRemoteSenderService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">3.3 GRPCRemoteClientService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">3.4 GRPCRemoteClient</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">3.5 RemoteCommonServiceHandler</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">3.6 GRPCRemoteSerializeService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">3.7 GRPCRemoteDeserializeService</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">4. collector-remote-grpc-provider</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>SkyWalking Collector Remote è¿œç¨‹é€šä¿¡æœåŠ¡</strong>ã€‚è¯¥æœåŠ¡ç”¨äº Collector é›†ç¾¤å†…éƒ¨é€šä¿¡ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_10/04.png" alt=""></p><p>ç›®å‰é›†ç¾¤å†…éƒ¨é€šä¿¡çš„ç›®çš„ï¼Œè·¨èŠ‚ç‚¹çš„æµå¼å¤„ç†ã€‚Remote Module <strong>åº”ç”¨</strong>åœ¨ SkyWalking æ¶æ„å›¾å¦‚ä¸‹ä½ç½®( <strong>çº¢æ¡†</strong> ) ï¼š</p><blockquote><p>FROM <a href="https://github.com/apache/incubating-skywalking" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/apache/incubating-skywalking</a><br><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_10/01.jpeg" alt=""></p></blockquote><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ•´ä½“çš„é¡¹ç›®ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_10/02.png" alt=""></p><ul><li><code>collector-remote-define</code> ï¼šå®šä¹‰è¿œç¨‹é€šä¿¡æ¥å£ã€‚</li><li><code>collector-remote-kafka-provider</code> ï¼šåŸºäº Kafka çš„è¿œç¨‹é€šä¿¡å®ç°ã€‚<em>ç›®å‰æš‚æœªå®Œæˆ</em>ã€‚</li><li><code>collector-remote-grpc-provider</code> ï¼šåŸºäº <a href="https://grpc.io/" rel="external nofollow noopener noreferrer" target="_blank">Google gRPC</a> çš„è¿œç¨‹é€šä¿¡å®ç°ã€‚<strong>ç”Ÿäº§ç¯å¢ƒç›®å‰ä½¿ç”¨</strong></li></ul><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä»<strong>æ¥å£åˆ°å®ç°</strong>çš„é¡ºåºè¿›è¡Œåˆ†äº«ã€‚</p><h1 id="2-collector-remote-define"><a href="#2-collector-remote-define" class="headerlink" title="2. collector-remote-define"></a>2. collector-remote-define</h1><p><code>collector-remote-define</code> ï¼šå®šä¹‰è¿œç¨‹é€šä¿¡æ¥å£ã€‚é¡¹ç›®ç»“æ„å¦‚ä¸‹ ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_10/03.png" alt=""></p><p>æ•´ä½“æµç¨‹å¦‚ä¸‹å›¾ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_10/05.png" alt=""></p><p>æˆ‘ä»¬æŒ‰ç…§æ•´ä¸ªæµç¨‹çš„å¤„ç†é¡ºåºï¼Œé€ä¸ªè§£ææ¶‰åŠåˆ°çš„ç±»ä¸æ¥å£ã€‚</p><h2 id="2-1-RemoteModule"><a href="#2-1-RemoteModule" class="headerlink" title="2.1 RemoteModule"></a>2.1 RemoteModule</h2><p><code>org.skywalking.apm.collector.remote.RemoteModule</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Module.java" rel="external nofollow noopener noreferrer" target="_blank">Module</a> æŠ½è±¡ç±»ï¼Œè¿œç¨‹é€šä¿¡ Module ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/RemoteModule.java#L34" rel="external nofollow noopener noreferrer" target="_blank"><code>#name()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›æ¨¡å—åä¸º <code>&quot;remote&quot;</code> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/RemoteModule.java#L38" rel="external nofollow noopener noreferrer" target="_blank"><code>#services()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å› Service ç±»åï¼šRemoteSenderService ã€RemoteDataRegisterService ã€‚</p><h2 id="2-2-RemoteSenderService"><a href="#2-2-RemoteSenderService" class="headerlink" title="2.2 RemoteSenderService"></a>2.2 RemoteSenderService</h2><p><code>org.skywalking.apm.collector.remote.service.RemoteSenderService</code> ï¼Œç»§æ‰¿ <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Service.java" rel="external nofollow noopener noreferrer" target="_blank">Service</a> æ¥å£ï¼Œè¿œç¨‹å‘é€æœåŠ¡<strong>æ¥å£</strong>ï¼Œå®šä¹‰äº† <a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/RemoteSenderService.java#L40" rel="external nofollow noopener noreferrer" target="_blank"><code>#send(graphId, nodeId, data, selector)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œè°ƒç”¨ RemoteClient ï¼Œå‘é€æ•°æ®ã€‚</p><ul><li><code>graphId</code> æ–¹æ³•å‚æ•°ï¼ŒGraph ç¼–å·ã€‚é€šè¿‡ <code>graphId</code> ï¼Œå¯ä»¥æŸ¥æ‰¾åˆ°å¯¹åº”çš„ Graph å¯¹è±¡ã€‚<ul><li>Graph åœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆä¸€ï¼‰ã€‹ã€Œ2. apm-collector-core/graphã€</a> æœ‰è¯¦ç»†è§£æã€‚</li></ul></li><li><code>nodeId</code> æ–¹æ³•å‚æ•°ï¼ŒWorker ç¼–å·ã€‚é€šè¿‡ <code>workerId</code> ï¼Œå¯ä»¥æŸ¥æ‰¾åœ¨ Graph å¯¹è±¡ä¸­çš„ Worker å¯¹è±¡ï¼Œä»è€Œ Graph ä¸­çš„æµå¼å¤„ç†ã€‚<ul><li>Worker åœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆä¸€ï¼‰ã€‹ã€Œ3. apm-collector-streamã€</a> æœ‰è¯¦ç»†è§£æã€‚</li></ul></li><li><code>data</code> æ–¹æ³•å‚æ•°ï¼ŒData æ•°æ®å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œæµå¼å¤„ç†çš„å…·ä½“æ•°æ®å¯¹è±¡ã€‚<ul><li>Data åœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Storage å­˜å‚¨ç»„ä»¶ã€‹ã€Œ2. apm-collector-coreã€</a> æœ‰è¯¦ç»†è§£æã€‚</li></ul></li><li><code>selector</code> æ–¹æ³•å‚æ•°ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/Selector.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.remote.service.Selector</code></a> é€‰æ‹©å™¨å¯¹è±¡ã€‚æ ¹æ® Selector å¯¹è±¡ï¼Œä½¿ç”¨å¯¹åº”çš„<strong>è´Ÿè½½å‡è¡¡</strong>ç­–ç•¥ï¼Œé€‰æ‹©é›†ç¾¤å†…çš„ Collector èŠ‚ç‚¹ï¼Œå‘é€æ•°æ®ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/RemoteSenderService.java#L45" rel="external nofollow noopener noreferrer" target="_blank">RemoteSenderService.Mode</a> è¿”å›å€¼ï¼Œå‘é€æ¨¡å¼åˆ†æˆ <code>Remote</code> å’Œ <code>Local</code> ä¸¤ç§æ–¹å¼ã€‚å‰è€…ï¼Œå‘é€æ•°æ®åˆ°è¿œç¨‹çš„ Collector èŠ‚ç‚¹ï¼›åè€…ï¼Œå‘é€æ•°æ®åˆ°æœ¬åœ°ï¼Œå³æœ¬åœ°å¤„ç†ï¼Œå‚è§ <a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/RemoteWorkerRef.java#L58" rel="external nofollow noopener noreferrer" target="_blank"><code>RemoteWorkerRef#in(message)</code></a> æ–¹æ³•ã€‚</li></ul><h2 id="2-3-RemoteClientService"><a href="#2-3-RemoteClientService" class="headerlink" title="2.3 RemoteClientService"></a>2.3 RemoteClientService</h2><p><code>org.skywalking.apm.collector.remote.service.RemoteClientService</code> ï¼Œç»§æ‰¿ <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Service.java" rel="external nofollow noopener noreferrer" target="_blank">Service</a> æ¥å£ï¼Œè¿œç¨‹å®¢æˆ·ç«¯æœåŠ¡<strong>æ¥å£</strong>ï¼Œå®šä¹‰äº† <a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/RemoteClientService.java#L39" rel="external nofollow noopener noreferrer" target="_blank"><code>#create(host, port, channelSize, bufferSize)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œåˆ›å»º RemoteClient å¯¹è±¡ã€‚</p><h2 id="2-4-RemoteClient"><a href="#2-4-RemoteClient" class="headerlink" title="2.4 RemoteClient"></a>2.4 RemoteClient</h2><p><code>org.skywalking.apm.collector.remote.service.RemoteClient</code> ï¼Œç»§æ‰¿ <code>java.lang.Comparable</code> æ¥å£ï¼Œè¿œç¨‹å®¢æˆ·ç«¯<strong>æ¥å£</strong>ã€‚å®šä¹‰äº†å¦‚ä¸‹æ¥å£æ–¹æ³•ï¼š</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/RemoteClient.java#L42" rel="external nofollow noopener noreferrer" target="_blank"><code>#push(graphId, nodeId, data, selector)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œå‘é€æ•°æ®ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/RemoteClient.java#L33" rel="external nofollow noopener noreferrer" target="_blank"><code>#getAddress()</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œè¿”å›å®¢æˆ·ç«¯è¿æ¥çš„è¿œç¨‹ Collector åœ°å€ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/RemoteClient.java#L44" rel="external nofollow noopener noreferrer" target="_blank"><code>#equals(address)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œåˆ¤æ–­ RemoteClient æ˜¯å¦è¿æ¥äº†æŒ‡å®šçš„åœ°å€ã€‚</li></ul><h2 id="2-5-CommonRemoteDataRegisterService"><a href="#2-5-CommonRemoteDataRegisterService" class="headerlink" title="2.5 CommonRemoteDataRegisterService"></a>2.5 CommonRemoteDataRegisterService</h2><p>åœ¨è¯´ CommonRemoteDataRegisterService ä¹‹å‰ï¼Œé¦–å…ˆæ¥è¯´ä¸‹ CommonRemoteDataRegisterService çš„æ„å›¾ã€‚</p><p>åœ¨ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‘é€ç»™ Collector æ˜¯ Data å¯¹è±¡ï¼Œè€Œ <a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/Data.java" rel="external nofollow noopener noreferrer" target="_blank">Data</a> æ˜¯æ•°æ®çš„<strong>æŠ½è±¡ç±»</strong>ï¼Œåœ¨å…·ä½“ååºåˆ—åŒ– Data å¯¹è±¡ä¹‹å‰ï¼Œç¨‹åºæ˜¯æ— æ³•å¾—çŸ¥å®ƒæ˜¯ Data çš„å“ªä¸ªå®ç°å¯¹è±¡ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ Data å¯¹è±¡çš„æ¯ä¸ªå®ç°ç±»ï¼Œç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„<strong>æ•°æ®åè®®ç¼–å·</strong>ã€‚</p><ul><li>åœ¨å‘é€æ•°æ®ä¹‹å‰ï¼Œåºåˆ—åŒ– Data å¯¹è±¡æ—¶ï¼Œå¢åŠ è¯¥ Data å¯¹åº”çš„åè®®ç¼–å·ï¼Œä¸€èµ·å‘é€ã€‚</li><li>åœ¨æ¥æ”¶æ•°æ®ä¹‹åï¼Œååºåˆ—åŒ–æ•°æ®æ—¶ï¼Œæ ¹æ®åè®®ç¼–å·ï¼Œåˆ›å»º Data å¯¹åº”çš„å®ç°ç±»å¯¹è±¡ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/CommonRemoteDataRegisterService.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.remote.service.CommonRemoteDataRegisterService</code></a> ï¼Œé€šç”¨è¿œç¨‹æ•°æ®æ³¨å†ŒæœåŠ¡ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/CommonRemoteDataRegisterService.java#L40" rel="external nofollow noopener noreferrer" target="_blank"><code>id</code></a> å±æ€§ï¼Œæ•°æ®åè®®è‡ªå¢ç¼–å·ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/CommonRemoteDataRegisterService.java#L44" rel="external nofollow noopener noreferrer" target="_blank"><code>dataClassMapping</code></a> å±æ€§ï¼Œæ•°æ®ç±»å‹( Class&lt;? extends Data&gt; )ä¸<strong>æ•°æ®åè®®ç¼–å·</strong>çš„æ˜ å°„ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/CommonRemoteDataRegisterService.java#L48" rel="external nofollow noopener noreferrer" target="_blank"><code>dataInstanceCreatorMapping</code></a> å±æ€§ï¼Œ<strong>æ•°æ®åè®®ç¼–å·</strong>ä¸æ•°æ®å¯¹è±¡åˆ›å»ºå™¨( RemoteDataInstanceCreator )çš„æ˜ å°„ã€‚</li></ul><h3 id="2-5-1-RemoteDataRegisterService"><a href="#2-5-1-RemoteDataRegisterService" class="headerlink" title="2.5.1 RemoteDataRegisterService"></a>2.5.1 RemoteDataRegisterService</h3><p><code>org.skywalking.apm.collector.remote.service.RemoteDataRegisterService</code> ï¼Œç»§æ‰¿ <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Service.java" rel="external nofollow noopener noreferrer" target="_blank">Service</a> æ¥å£ï¼Œè¿œç¨‹å®¢æˆ·ç«¯æœåŠ¡<strong>æ¥å£</strong>ï¼Œå®šä¹‰äº† <a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/RemoteDataRegisterService.java#L37" rel="external nofollow noopener noreferrer" target="_blank"><code>#register(Class&lt;? extends Data&gt;, RemoteDataInstanceCreator)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œæ³¨å†Œæ•°æ®ç±»å‹å¯¹åº”çš„è¿œç¨‹æ•°æ®åˆ›å»ºå™¨( <a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/RemoteDataRegisterService.java#L39" rel="external nofollow noopener noreferrer" target="_blank"><code>RemoteDataRegisterService.RemoteDataInstanceCreator</code></a> )å¯¹è±¡ã€‚</p><p>CommonRemoteDataRegisterService å®ç°äº† RemoteDataRegisterService æ¥å£ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/CommonRemoteDataRegisterService.java#L56" rel="external nofollow noopener noreferrer" target="_blank"><code>#register(Class&lt;? extends Data&gt;, RemoteDataInstanceCreator)</code></a> <strong>å®ç°</strong>æ–¹æ³•ã€‚</p><p>å¦å¤–ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/AgentStreamRemoteDataRegister.java#L42" rel="external nofollow noopener noreferrer" target="_blank">AgentStreamRemoteDataRegister</a> ä¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/RemoteDataRegisterService.java#L37" rel="external nofollow noopener noreferrer" target="_blank"><code>RemoteDataRegisterService#register(Class&lt;? extends Data&gt;, RemoteDataInstanceCreator)</code></a> æ–¹æ³•ï¼Œæ³¨å†Œæ¯ä¸ªæ•°æ®ç±»å‹çš„ RemoteDataInstanceCreator å¯¹è±¡ã€‚æ³¨æ„ï¼Œä¾‹å¦‚ <code>Application::new</code> æ˜¯ RemoteDataInstanceCreator çš„<strong>åŒ¿åå®ç°ç±»</strong>ã€‚</p><h3 id="2-5-2-RemoteDataIDGetter"><a href="#2-5-2-RemoteDataIDGetter" class="headerlink" title="2.5.2 RemoteDataIDGetter"></a>2.5.2 RemoteDataIDGetter</h3><p><code>org.skywalking.apm.collector.remote.service.RemoteDataIDGetter</code> ï¼Œç»§æ‰¿ <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Service.java" rel="external nofollow noopener noreferrer" target="_blank">Service</a> æ¥å£ï¼Œè¿œç¨‹æ•°æ®åè®®ç¼–å·è·å–å™¨<strong>æ¥å£</strong>ï¼Œå®šä¹‰äº† <a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/RemoteDataIDGetter.java#L37" rel="external nofollow noopener noreferrer" target="_blank"><code>#getRemoteDataId(Class&lt;? extends Data&gt;)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œæ ¹æ®æ•°æ®ç±»å‹è·å–æ•°æ®åè®®ç¼–å·ã€‚</p><p>CommonRemoteDataRegisterService å®ç°äº† RemoteDataIDGetter æ¥å£ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/CommonRemoteDataRegisterService.java#L67" rel="external nofollow noopener noreferrer" target="_blank"><code>#getRemoteDataId(Class&lt;? extends Data&gt;)</code></a> <strong>å®ç°</strong>æ–¹æ³•ã€‚</p><h3 id="2-5-3-RemoteDataInstanceCreatorGetter"><a href="#2-5-3-RemoteDataInstanceCreatorGetter" class="headerlink" title="2.5.3 RemoteDataInstanceCreatorGetter"></a>2.5.3 RemoteDataInstanceCreatorGetter</h3><p><code>org.skywalking.apm.collector.remote.service.RemoteDataInstanceCreatorGetter</code> ï¼Œç»§æ‰¿ <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Service.java" rel="external nofollow noopener noreferrer" target="_blank">Service</a> æ¥å£ï¼Œè¿œç¨‹æ•°æ®åˆ›å»ºå™¨çš„è·å–å™¨<strong>æ¥å£</strong>ï¼Œå®šä¹‰äº† <a href="https://github.com/YunaiV/skywalking/blob/f70019926200139f9fe235ade9aaf7724ab72c8b/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/RemoteDataInstanceCreatorGetter.java#L35" rel="external nofollow noopener noreferrer" target="_blank"><code>#getInstanceCreator(remoteDataId</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œæ ¹æ®æ•°æ®åè®®ç¼–å·è·å¾—è¿œç¨‹æ•°æ®åˆ›å»ºå™¨( RemoteDataInstanceCreator )ã€‚</p><p>CommonRemoteDataRegisterService å®ç°äº† RemoteDataInstanceCreatorGetter æ¥å£ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/f70019926200139f9fe235ade9aaf7724ab72c8b/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/CommonRemoteDataRegisterService.java#L75" rel="external nofollow noopener noreferrer" target="_blank"><code>#getInstanceCreator(remoteDataId)</code></a> <strong>å®ç°</strong>æ–¹æ³•ã€‚</p><h2 id="2-6-RemoteSerializeService"><a href="#2-6-RemoteSerializeService" class="headerlink" title="2.6 RemoteSerializeService"></a>2.6 RemoteSerializeService</h2><p><code>org.skywalking.apm.collector.remote.service.RemoteSerializeService</code> ï¼Œè¿œç¨‹é€šä¿¡åºåˆ—åŒ–æœåŠ¡<strong>æ¥å£</strong>ï¼Œå®šä¹‰äº† <a href="https://github.com/YunaiV/skywalking/blob/f70019926200139f9fe235ade9aaf7724ab72c8b/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/RemoteSerializeService.java#L36" rel="external nofollow noopener noreferrer" target="_blank"><code>#serialize(Data)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œåºåˆ—åŒ–æ•°æ®ï¼Œç”Ÿæˆ Builder å¯¹è±¡ã€‚</p><h2 id="2-7-RemoteSerializeService"><a href="#2-7-RemoteSerializeService" class="headerlink" title="2.7 RemoteSerializeService"></a>2.7 RemoteSerializeService</h2><p><code>org.skywalking.apm.collector.remote.service.RemoteDeserializeService</code> ï¼Œè¿œç¨‹é€šä¿¡åºååˆ—åŒ–æœåŠ¡<strong>æ¥å£</strong>ï¼Œå®šä¹‰äº† <a href="https://github.com/YunaiV/skywalking/blob/f70019926200139f9fe235ade9aaf7724ab72c8b/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/RemoteDeserializeService.java#L36" rel="external nofollow noopener noreferrer" target="_blank"><code>#deserialize(RemoteData, Data)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œååºåˆ—åŒ–ä¼ è¾“æ•°æ®ã€‚</p><h1 id="3-collector-remote-grpc-provider"><a href="#3-collector-remote-grpc-provider" class="headerlink" title="3. collector-remote-grpc-provider"></a>3. collector-remote-grpc-provider</h1><p><code>collector-remote-grpc-provider</code> ï¼ŒåŸºäº <a href="https://grpc.io/" rel="external nofollow noopener noreferrer" target="_blank">Google gRPC</a> çš„è¿œç¨‹é€šä¿¡å®ç°ã€‚</p><p>é¡¹ç›®ç»“æ„å¦‚ä¸‹ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_09_10/06.png" alt=""></p><p><strong>é»˜è®¤é…ç½®</strong>ï¼Œåœ¨ <a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-core/src/main/resources/application-default.yml#L14" rel="external nofollow noopener noreferrer" target="_blank"><code>application-default.yml</code></a> <strong>å·²ç»</strong>é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight"><table><tr><td class="code"><pre><div class="line">remote:</div><div class="line">  gRPC:</div><div class="line">    host: localhost</div><div class="line">    port: 11800</div></pre></td></tr></table></figure><h2 id="3-1-RemoteModuleGRPCProvider"><a href="#3-1-RemoteModuleGRPCProvider" class="headerlink" title="3.1 RemoteModuleGRPCProvider"></a>3.1 RemoteModuleGRPCProvider</h2><p><a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/RemoteModuleGRPCProvider.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.remote.grpc.RemoteModuleGRPCProvider</code></a> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleProvider.java" rel="external nofollow noopener noreferrer" target="_blank">ModuleProvider</a> <strong>æŠ½è±¡ç±»</strong>ï¼ŒåŸºäº gRPC çš„ç»„ä»¶æœåŠ¡æä¾›è€…å®ç°ç±»ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/RemoteModuleGRPCProvider.java#L38" rel="external nofollow noopener noreferrer" target="_blank"><code>#name()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ç»„ä»¶æœåŠ¡æä¾›è€…åä¸º <code>&quot;gRPC&quot;</code> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/RemoteModuleGRPCProvider.java#L42" rel="external nofollow noopener noreferrer" target="_blank"><code>module()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ç»„ä»¶ç±»ä¸º RemoteModule ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/RemoteModuleGRPCProvider.java#L81" rel="external nofollow noopener noreferrer" target="_blank"><code>#requiredModules()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ä¾èµ–ç»„ä»¶ä¸º <code>cluster</code> ã€<code>gRPC_manager</code> ã€‚</p><hr><p><a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/RemoteModuleGRPCProvider.java#L46" rel="external nofollow noopener noreferrer" target="_blank"><code>#prepare(Properties)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå‡†å¤‡é˜¶æ®µé€»è¾‘ã€‚</p><ul><li>ç¬¬ 53 è‡³ 56 è¡Œ ï¼šåˆ›å»º CommonRemoteDataRegisterService ã€GRPCRemoteSenderService å¯¹è±¡ï¼Œå¹¶è°ƒç”¨ <code>#registerServiceImplementation()</code> <strong>çˆ¶ç±»</strong>æ–¹æ³•ï¼Œæ³¨å†Œåˆ° <code>services</code> ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/RemoteModuleGRPCProvider.java#L59" rel="external nofollow noopener noreferrer" target="_blank"><code>#start()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå¯åŠ¨é˜¶æ®µé€»è¾‘ã€‚</p><ul><li>Server ç›¸å…³<ul><li>ç¬¬ 65 è¡Œï¼šåˆ›å»º gRPC Server å¯¹è±¡ã€‚ </li><li>ç¬¬ 67 è¡Œï¼šæ³¨å†Œ RemoteCommonServiceHandler å¯¹è±¡åˆ° gRPC Server ä¸Šï¼Œç”¨äºæ¥æ”¶ gRPC è¯·æ±‚åçš„å¤„ç†ã€‚</li><li><a href="http://www.iocoder.cn/SkyWalking/collector-server-component/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Server Component æœåŠ¡å™¨ç»„ä»¶ã€‹ã€Œ3. gRPC å®ç°ã€</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-grpc-server-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector gRPC Server Managerã€‹</a></li></ul></li><li>æ³¨å†Œå‘ç°ç›¸å…³<ul><li>ç¬¬ 70 è‡³ 71 è¡Œï¼šåˆ›å»º <a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/RemoteModuleGRPCRegistration.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.remote.grpc.RemoteModuleGRPCRegistration</code></a> å¯¹è±¡ï¼Œå°†è‡ªå·±æ³¨å†Œåˆ°é›†ç¾¤ç®¡ç†ã€‚è¿™æ ·ï¼Œè‡ªå·±å¯ä»¥è¢« Collector é›†ç¾¤èŠ‚ç‚¹å‘ç°ï¼Œä»è€Œè¢«è°ƒç”¨ã€‚</li><li>ç¬¬ 73 è‡³ 74 è¡Œï¼šæ³¨å†Œ GRPCRemoteSenderService å¯¹è±¡åˆ°é›†ç¾¤ç®¡ç†ã€‚è¿™æ ·ï¼Œè‡ªå·±å¯ä»¥ç›‘å¬åˆ° Collector é›†ç¾¤èŠ‚ç‚¹çš„åŠ å…¥æˆ–ç¦»å¼€ï¼Œä»è€Œè°ƒç”¨ã€‚</li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Cluster é›†ç¾¤ç®¡ç†ã€‹</a> </li></ul></li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/RemoteModuleGRPCProvider.java#L77" rel="external nofollow noopener noreferrer" target="_blank"><code>#notifyAfterCompleted()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ–¹æ³•ä¸ºç©ºã€‚</p><h2 id="3-2-GRPCRemoteSenderService"><a href="#3-2-GRPCRemoteSenderService" class="headerlink" title="3.2 GRPCRemoteSenderService"></a>3.2 GRPCRemoteSenderService</h2><p><code>org.skywalking.apm.collector.remote.grpc.service.GRPCRemoteSenderService</code> ï¼Œç»§æ‰¿ ClusterModuleListener æŠ½è±¡ç±»ï¼Œå®ç° RemoteSenderService æ¥å£ï¼ŒåŸºäº gPRC çš„è¿œç¨‹å‘é€æœåŠ¡å®ç°ç±»ã€‚</p><h3 id="3-2-1-æ³¨å†Œå‘ç°"><a href="#3-2-1-æ³¨å†Œå‘ç°" class="headerlink" title="3.2.1 æ³¨å†Œå‘ç°"></a>3.2.1 æ³¨å†Œå‘ç°</h3><p>é€šè¿‡ç»§æ‰¿ ClusterModuleListener æŠ½è±¡ç±»ï¼Œå®ç°äº†ç›‘å¬ Collector é›†ç¾¤èŠ‚ç‚¹çš„åŠ å…¥æˆ–ç¦»å¼€ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteSenderService.java#L51" rel="external nofollow noopener noreferrer" target="_blank"><code>remoteClients</code></a> å±æ€§ï¼Œè¿æ¥ Collector é›†ç¾¤èŠ‚ç‚¹çš„å®¢æˆ·ç«¯æ•°ç»„ã€‚æ¯ä¸ª Collector é›†ç¾¤èŠ‚ç‚¹ï¼Œå¯¹åº”ä¸€ä¸ªå®¢æˆ·ç«¯ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteSenderService.java#L96" rel="external nofollow noopener noreferrer" target="_blank"><code>#path()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ç›‘å¬çš„ç›®å½• <code>&quot;/&quot; + RemoteModule.NAME + &quot;/&quot; + RemoteModuleGRPCProvider.NAME</code> ã€‚Collector é›†ç¾¤ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„ Remote Server éƒ½ä¼šæ³¨å†Œåˆ°è¯¥ç›®å½•ä¸‹ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteSenderService.java#L100" rel="external nofollow noopener noreferrer" target="_blank"><code>#serverJoinNotify(serverAddress)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œå½“æ–°çš„èŠ‚ç‚¹åŠ å…¥ï¼Œ<strong>åˆ›å»º</strong>æ–°çš„å®¢æˆ·ç«¯è¿æ¥ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteSenderService.java#L114" rel="external nofollow noopener noreferrer" target="_blank"><code>#serverQuitNotify(serverAddress)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œå½“è€çš„èŠ‚ç‚¹ç¦»å¼€ï¼Œ<strong>ç§»é™¤</strong>å¯¹åº”çš„å®¢æˆ·ç«¯è¿æ¥ã€‚</li></ul><h2 id="3-2-2-è´Ÿè½½å‡è¡¡"><a href="#3-2-2-è´Ÿè½½å‡è¡¡" class="headerlink" title="3.2.2 è´Ÿè½½å‡è¡¡"></a>3.2.2 è´Ÿè½½å‡è¡¡</h2><p>RemoteModuleGRPCProvider åŸºäºä¸åŒçš„é€‰æ‹©å™¨ ( <a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/Selector.java#L26" rel="external nofollow noopener noreferrer" target="_blank">Selector</a> ) ï¼Œæä¾›ä¸åŒçš„å®¢æˆ·ç«¯é€‰æ‹©( <a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/selector/RemoteClientSelector.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.remote.grpc.service.selector.RemoteClientSelector</code></a> )å®ç° ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_09_10/07.png" alt=""></p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteSenderService.java#L53" rel="external nofollow noopener noreferrer" target="_blank"><code>hashCodeSelector</code></a> å±æ€§ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/selector/HashCodeSelector.java" rel="external nofollow noopener noreferrer" target="_blank">HashCodeSelector</a> ï¼ŒåŸºäºæ•°æ®çš„å“ˆå¸Œç ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteSenderService.java#L54" rel="external nofollow noopener noreferrer" target="_blank"><code>foreverFirstSelector</code></a> å±æ€§ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/selector/ForeverFirstSelector.java" rel="external nofollow noopener noreferrer" target="_blank">ForeverFirstSelector</a> ï¼ŒåŸºäºå®¢æˆ·ç«¯æ•°ç»„çš„é¡ºåºï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteSenderService.java#L55" rel="external nofollow noopener noreferrer" target="_blank"><code>rollingSelector</code></a> å±æ€§ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/selector/RollingSelector.java" rel="external nofollow noopener noreferrer" target="_blank">RollingSelector</a> ï¼ŒåŸºäºå®¢æˆ·ç«¯æ•°ç»„çš„é¡ºåºï¼Œé¡ºåºå‘ä¸‹é€‰æ‹©ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteSenderService.java#L59" rel="external nofollow noopener noreferrer" target="_blank"><code>#send(graphId, nodeId, data, selector)</code></a> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š<ul><li>ç¬¬ 63 ã€66 ã€69 è¡Œï¼šæ ¹æ®é€‰æ‹©å™¨ï¼Œè°ƒç”¨ <code>RemoteClientSelector#select(clients, data)</code> æ–¹æ³•ï¼Œé€‰æ‹©å®¢æˆ·ç«¯ã€‚</li><li>ç¬¬ 64 ã€67 ã€70 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteSenderService.java#L75" rel="external nofollow noopener noreferrer" target="_blank"><code>#sendToRemoteWhenNotSelf(remoteClient, graphId, nodeId, data)</code></a> æ–¹æ³•ï¼Œå‘é€è¯·æ±‚æ•°æ®ã€‚<ul><li>ç¬¬ 76 è‡³ 77 è¡Œï¼šå½“é€‰æ‹©çš„å®¢æˆ·ç«¯è¿æ¥çš„æ˜¯æœ¬åœ°æ—¶ï¼Œä¸å‘é€æ•°æ®ï¼Œäº¤ç»™æœ¬åœ°å¤„ç†ï¼Œå‚è§ <a href="https://github.com/YunaiV/skywalking/blob/5e2eb23f33136c979e5056dbe32e880b130d0901/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/RemoteWorkerRef.java#L58" rel="external nofollow noopener noreferrer" target="_blank"><code>RemoteWorkerRef#in(message)</code></a> æ–¹æ³•ã€‚</li><li>ç¬¬ 78 è‡³ 81 è¡Œï¼šå½“é€‰æ‹©çš„å®¢æˆ·ç«¯è¿æ¥çš„æ˜¯è¿œç¨‹æ—¶ï¼Œè°ƒç”¨ <code>RemoteClient#push(graphId, nodeId, data)</code> æ–¹æ³•ï¼Œå‘é€æ•°æ®ã€‚</li></ul></li></ul></li></ul><h2 id="3-3-GRPCRemoteClientService"><a href="#3-3-GRPCRemoteClientService" class="headerlink" title="3.3 GRPCRemoteClientService"></a>3.3 GRPCRemoteClientService</h2><p><code>org.skywalking.apm.collector.remote.grpc.service.GRPCRemoteClientService</code> ï¼Œå®ç° RemoteClientService <strong>æ¥å£</strong>ï¼ŒåŸºäº gRPC çš„è¿œç¨‹å®¢æˆ·ç«¯æœåŠ¡å®ç°ç±»ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/0a289e159f472983a0b6f6df6bd62c675e4f0846/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteClientService.java#L44" rel="external nofollow noopener noreferrer" target="_blank"><code>#create(host, port, channelSize, bufferSize)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œåˆ›å»º GRPCRemoteClient å¯¹è±¡ã€‚</p><h2 id="3-4-GRPCRemoteClient"><a href="#3-4-GRPCRemoteClient" class="headerlink" title="3.4 GRPCRemoteClient"></a>3.4 GRPCRemoteClient</h2><blockquote><p>å‹æƒ…æç¤ºï¼šæœ¬å°èŠ‚ä¼šæ¶‰åŠè¾ƒå¤š gRPC ç›¸å…³çš„çŸ¥è¯†ï¼Œå»ºè®®ä¸ç†Ÿæ‚‰çš„èƒ–å‹è‡ªå·± Google ï¼Œè¡¥å……ä¸‹å§¿åŠ¿ã€‚</p></blockquote><p><code>org.skywalking.apm.collector.remote.grpc.service.GRPCRemoteClient</code> ï¼Œå®ç° RemoteClient <strong>æ¥å£</strong>ï¼ŒåŸºäº gRPC çš„è¿œç¨‹å®¢æˆ·ç«¯å®ç°ç±»ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/4cb80651dee25e985f974d691467a0a53d7dfbe9/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteClient.java#L48" rel="external nofollow noopener noreferrer" target="_blank"><code>client</code></a> å±æ€§ï¼ŒGRPCClient å¯¹è±¡ã€‚ç›¸æ¯”æ¥è¯´ï¼ŒGRPCRemoteClient åä¸šåŠ¡çš„å°è£…ï¼Œå†…éƒ¨è°ƒç”¨ GRPCClient å¯¹è±¡ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/4cb80651dee25e985f974d691467a0a53d7dfbe9/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteClient.java#L52" rel="external nofollow noopener noreferrer" target="_blank"><code>carrier</code></a> å±æ€§ï¼ŒDataCarrier å¯¹è±¡ï¼Œæœ¬åœ°æ¶ˆæ¯é˜Ÿåˆ—ã€‚GRPCRemoteClient åœ¨è¢«è°ƒç”¨å‘é€æ•°æ®æ—¶ï¼Œå…ˆæäº¤åˆ°æœ¬åœ°é˜Ÿåˆ—ï¼Œå¼‚æ­¥æ¶ˆè´¹è¿›è¡Œå‘é€åˆ°è¿œç¨‹ Collector èŠ‚ç‚¹ã€‚DataCarrier åœ¨ <a href="http://www.iocoder.cn/SkyWalking/data-carrier/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” DataCarrier å¼‚æ­¥å¤„ç†åº“ã€‹</a> è¯¦ç»†è§£æã€‚<ul><li>ç¬¬ 63 è¡Œï¼šè°ƒç”¨ <code>DataCarrier#consume(IConsumer, num)</code> æ–¹æ³•ï¼Œè®¾ç½®æ¶ˆè´¹è€…ä¸º RemoteMessageConsumer å¯¹è±¡ã€‚</li></ul></li></ul><hr><p><a href="https://github.com/YunaiV/skywalking/blob/4cb80651dee25e985f974d691467a0a53d7dfbe9/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteClient.java#L70" rel="external nofollow noopener noreferrer" target="_blank"><code>#push(graphId, nodeId, data)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œ<strong>å¼‚æ­¥</strong>å‘é€æ¶ˆæ¯åˆ°è¿œç¨‹ Collector ã€‚</p><ul><li>ç¬¬ 73 è¡Œï¼šè°ƒç”¨ <code>RemoteDataIDGetter#getRemoteDataId(Class&lt;? extends Data&gt;)</code> æ–¹æ³•ï¼Œè·å¾—<strong>æ•°æ®åè®®ç¼–å·</strong>ã€‚</li><li>ç¬¬ 76 è‡³ 80 è¡Œï¼šåˆ›å»ºä¼ è¾“æ•°æ®( RemoteMessage.Builder ) å¯¹è±¡ã€‚RemoteMessage é€šè¿‡ <a href="https://github.com/google/protobuf" rel="external nofollow noopener noreferrer" target="_blank">Protobuf</a> åˆ›å»ºå®šä¹‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_09_10/08.png" alt=""></li><li>ç¬¬ 83 è¡Œï¼šè°ƒç”¨ <code>DataCarrier#produce(data)</code> æ–¹æ³•ï¼Œå‘é€æ•°æ®åˆ°æœ¬åœ°é˜Ÿåˆ—ã€‚ </li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/4cb80651dee25e985f974d691467a0a53d7dfbe9/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteClient.java#L93" rel="external nofollow noopener noreferrer" target="_blank">RemoteMessageConsumer</a> ï¼Œ<strong>æ‰¹é‡</strong>æ¶ˆè´¹æœ¬åœ°é˜Ÿåˆ—çš„æ•°æ®ï¼Œé€æ¡å‘é€æ•°æ®åˆ°è¿œç¨‹ Collector èŠ‚ç‚¹ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/4cb80651dee25e985f974d691467a0a53d7dfbe9/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteClient.java#L98" rel="external nofollow noopener noreferrer" target="_blank"><code>#consume(List&lt;RemoteMessage&gt;)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š<ul><li>ç¬¬ 100 è¡Œï¼šåˆ›å»º <a href="https://github.com/YunaiV/skywalking/blob/4cb80651dee25e985f974d691467a0a53d7dfbe9/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteClient.java#L118" rel="external nofollow noopener noreferrer" target="_blank">StreamObserver</a> å¯¹è±¡ã€‚StreamObserver ä¸»è¦æ˜¯ gPRC ç›¸å…³çš„ API çš„è°ƒç”¨ã€‚</li><li>ç¬¬ 101 è‡³ 103 è¡Œï¼šè°ƒç”¨ <code>io.grpc.stub.StreamObserver#onNext(RemoteMessage)</code> æ–¹æ³•ï¼Œé€æ¡å‘é€æ•°æ®ã€‚</li><li>ç¬¬ 106 è¡Œï¼šè°ƒç”¨ <code>io.grpc.stub.StreamObserver#onCompleted()</code> æ–¹æ³•ï¼Œå…¨éƒ¨è¯·æ±‚æ•°æ®å‘é€<strong>å®Œæˆ</strong>ã€‚</li></ul></li></ul><h2 id="3-5-RemoteCommonServiceHandler"><a href="#3-5-RemoteCommonServiceHandler" class="headerlink" title="3.5 RemoteCommonServiceHandler"></a>3.5 RemoteCommonServiceHandler</h2><p><code>org.skywalking.apm.collector.remote.grpc.handler.RemoteCommonServiceHandler</code> ï¼Œå®ç° <code>org.skywalking.apm.collector.server.grpc.GRPCHandler</code> æ¥å£ï¼Œç»§æ‰¿ RemoteCommonServiceGrpc.RemoteCommonServiceImplBase <strong>æŠ½è±¡ç±»</strong>ï¼Œè¿œç¨‹é€šä¿¡é€šç”¨é€»è¾‘å¤„ç†å™¨ã€‚</p><p>å…¶ä¸­ï¼ŒRemoteCommonServiceGrpc.RemoteCommonServiceImplBase åœ¨ <code>RemoteCommonService.proto</code> æ–‡ä»¶çš„å®šä¹‰å¦‚ä¸‹å›¾ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_09_10/09.png" alt=""></p><p><a href="https://github.com/YunaiV/skywalking/blob/ece7d2e156d4434edcc6ef08a5ed79e2a7b39fa1/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/handler/RemoteCommonServiceHandler.java#L55" rel="external nofollow noopener noreferrer" target="_blank"><code>#call(StreamObserver&lt;Empty&gt;)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/ece7d2e156d4434edcc6ef08a5ed79e2a7b39fa1/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/handler/RemoteCommonServiceHandler.java#L57" rel="external nofollow noopener noreferrer" target="_blank"><code>#onNext(RemoteMessage)</code></a> æ–¹æ³•ï¼Œå¤„ç†æ¯ä¸€æ¡æ¶ˆæ¯ï¼Œä»£ç å¦‚ä¸‹ï¼š<ul><li>ç¬¬ 65 è¡Œï¼šè°ƒç”¨ <code>RemoteDataInstanceCreatorGetter#getInstanceCreator(remoteDataId)</code> æ–¹æ³•ï¼Œè·å¾—<strong>æ•°æ®åè®®ç¼–å·</strong>å¯¹åº”çš„ RemoteDataInstanceCreator å¯¹è±¡ã€‚ç„¶åï¼Œè°ƒç”¨ <code>RemoteDataInstanceCreator#createInstance(id)</code> æ–¹æ³•ï¼Œåˆ›å»º<strong>æ•°æ®åè®®ç¼–å·</strong>å¯¹åº”çš„ Data å®ç°ç±»å¯¹åº”çš„å¯¹è±¡ã€‚</li><li>ç¬¬ 70 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/ece7d2e156d4434edcc6ef08a5ed79e2a7b39fa1/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/graph/GraphManager.java#L60" rel="external nofollow noopener noreferrer" target="_blank"><code>GraphManager#findGraph(graphId)</code></a> æ–¹æ³•ï¼Œè·å¾— <code>graphId</code> å¯¹åº”çš„ Graph å¯¹è±¡ã€‚ç„¶åï¼Œè°ƒåŠ¨ <a href="https://github.com/YunaiV/skywalking/blob/ece7d2e156d4434edcc6ef08a5ed79e2a7b39fa1/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/graph/GraphNodeFinder.java#L52" rel="external nofollow noopener noreferrer" target="_blank"><code>GraphNodeFinder#findNext(nodeId)</code></a> æ–¹æ³•ï¼Œè·å¾— Next å¯¹è±¡ã€‚</li><li>ç¬¬ 71 è¡Œï¼šè°ƒç”¨ <code>Next#execute(Data)</code> æ–¹æ³•ï¼Œç»§ç»­æµå¼å¤„ç†ã€‚</li></ul></li></ul><h2 id="3-6-GRPCRemoteSerializeService"><a href="#3-6-GRPCRemoteSerializeService" class="headerlink" title="3.6 GRPCRemoteSerializeService"></a>3.6 GRPCRemoteSerializeService</h2><p><a href="https://github.com/YunaiV/skywalking/blob/ece7d2e156d4434edcc6ef08a5ed79e2a7b39fa1/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteSerializeService.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.remote.grpc.service.GRPCRemoteSerializeService</code></a> ï¼Œå®ç° RemoteSerializeService æ¥å£ï¼ŒåŸºäº gRPC çš„è¿œç¨‹é€šä¿¡åºåˆ—åŒ–æœåŠ¡å®ç°ç±»ã€‚</p><h2 id="3-7-GRPCRemoteDeserializeService"><a href="#3-7-GRPCRemoteDeserializeService" class="headerlink" title="3.7 GRPCRemoteDeserializeService"></a>3.7 GRPCRemoteDeserializeService</h2><p><a href="https://github.com/YunaiV/skywalking/blob/ece7d2e156d4434edcc6ef08a5ed79e2a7b39fa1/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/GRPCRemoteDeserializeService.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.remote.grpc.service.GRPCRemoteDeserializeService</code></a> ï¼Œå®ç° GRPCRemoteDeserializeService æ¥å£ï¼ŒåŸºäº gRPC çš„è¿œç¨‹é€šä¿¡ååºåˆ—åŒ–æœåŠ¡å®ç°ç±»ã€‚</p><h1 id="4-collector-remote-grpc-provider"><a href="#4-collector-remote-grpc-provider" class="headerlink" title="4. collector-remote-grpc-provider"></a>4. collector-remote-grpc-provider</h1><p><code>collector-remote-kafka-provider</code> ï¼šåŸºäº Kafka çš„è¿œç¨‹é€šä¿¡å®ç°ã€‚</p><p><em>ç›®å‰æš‚æœªå®Œæˆ</em>ã€‚</p><p>TODO ã€4005ã€‘collector-remote-grpc-provider</p><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>å†™çš„æœ‰ä¸¢ä¸¢çƒ¦èºï¼Œä¸æ¸…æ™°æˆ–è€…é”™è¯¯çš„åœ°æ–¹ï¼Œèƒ–å‹æœ›è§è°…ã€‚</p><p>æ¬¢è¿å¾®ä¿¡æˆ‘ä¸€èµ·äº¤æµã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_10/10.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸€æ³¢æœ‹å‹åœˆå¯å¥½ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/collector-remote-module/&quot;&gt;http://www.iocoder.cn/SkyWalking/collector-remote-module/&lt;/a
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” Collector Cache ç¼“å­˜ç»„ä»¶</title>
    <link href="http://www.iocoder.cn/SkyWalking/collector-cache-module/"/>
    <id>http://www.iocoder.cn/SkyWalking/collector-cache-module/</id>
    <published>2020-09-04T16:00:00.000Z</published>
    <updated>2017-12-24T03:14:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/collector-cache-module/">http://www.iocoder.cn/SkyWalking/collector-cache-module/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-cache-module/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cache-module/">2. collector-cache-define</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-cache-module/">2.1 CacheModule</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cache-module/">2.2 ApplicationCacheService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cache-module/">2.3 InstanceCacheService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cache-module/">2.4 ServiceNameCacheService</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cache-module/">3. collector-cache-guava-provider</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-cache-module/">3.1 CacheModuleGuavaProvider</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cache-module/">3.2 ApplicationCacheGuavaService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cache-module/">3.3 InstanceCacheGuavaService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cache-module/">3.4 ServiceNameCacheGuavaService</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cache-module/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>SkyWalking Collector Cache Module</strong>ï¼Œç¼“å­˜ç»„ä»¶ã€‚è¯¥ç»„ä»¶ç”¨äºç¼“å­˜ Application ã€Instance ã€ServiceName ç­‰<strong>å¸¸ç”¨</strong>ä¸”<strong>ä¸å˜</strong>çš„æ•°æ®ï¼Œä»¥æå‡æ€§èƒ½ã€‚</p><blockquote><p>å‹æƒ…æç¤ºï¼šæœ¬æ–‡å†…å®¹è¾ƒä¸ºç®€å•ï¼Œèƒ–å‹å¯å¿«é€Ÿé˜…è¯»ã€‚</p></blockquote><p>Cache Module åœ¨ SkyWalking æ¶æ„å›¾å¤„äºå¦‚ä¸‹ä½ç½®( <strong>çº¢æ¡†</strong> ) ï¼š</p><blockquote><p>FROM <a href="https://github.com/apache/incubating-skywalking" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/apache/incubating-skywalking</a><br><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_05/01.jpeg" alt=""></p></blockquote><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ•´ä½“çš„é¡¹ç›®ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_05/02.png" alt=""></p><ul><li><code>collector-cache-define</code> ï¼šå®šä¹‰ç¼“å­˜ç»„ä»¶æ¥å£ã€‚</li><li><code>collector-cache-guava-provider</code> ï¼šåŸºäº <a href="https://github.com/google/guava" rel="external nofollow noopener noreferrer" target="_blank">Google Guava</a> çš„ç¼“å­˜ç»„ä»¶å®ç°ã€‚</li></ul><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä»<strong>æ¥å£åˆ°å®ç°</strong>çš„é¡ºåºè¿›è¡Œåˆ†äº«ã€‚</p><h1 id="2-collector-cache-define"><a href="#2-collector-cache-define" class="headerlink" title="2. collector-cache-define"></a>2. collector-cache-define</h1><p><code>collector-cache-define</code> ï¼šå®šä¹‰é˜Ÿåˆ—ç»„ä»¶æ¥å£ã€‚é¡¹ç›®ç»“æ„å¦‚ä¸‹ ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_05/03.png" alt=""></p><h2 id="2-1-CacheModule"><a href="#2-1-CacheModule" class="headerlink" title="2.1 CacheModule"></a>2.1 CacheModule</h2><p><code>org.skywalking.apm.collector.cache.CacheModule</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Module.java" rel="external nofollow noopener noreferrer" target="_blank">Module</a> æŠ½è±¡ç±»ï¼Œç¼“å­˜ Module ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ed68f92bf1f5ac397c0bb0a5cc23fa4f3e3c32d1/apm-collector/apm-collector-cache/collector-cache-define/src/main/java/org/skywalking/apm/collector/cache/CacheModule.java#L36" rel="external nofollow noopener noreferrer" target="_blank"><code>#name()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›æ¨¡å—åä¸º <code>&quot;cache&quot;</code> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ed68f92bf1f5ac397c0bb0a5cc23fa4f3e3c32d1/apm-collector/apm-collector-cache/collector-cache-define/src/main/java/org/skywalking/apm/collector/cache/CacheModule.java#L40" rel="external nofollow noopener noreferrer" target="_blank"><code>#services()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å› Service ç±»åï¼šApplicationCacheService ã€InstanceCacheService ã€ServiceIdCacheService ã€ServiceNameCacheService ã€‚</p><h2 id="2-2-ApplicationCacheService"><a href="#2-2-ApplicationCacheService" class="headerlink" title="2.2 ApplicationCacheService"></a>2.2 ApplicationCacheService</h2><p><a href="https://github.com/YunaiV/skywalking/blob/ed68f92bf1f5ac397c0bb0a5cc23fa4f3e3c32d1/apm-collector/apm-collector-cache/collector-cache-define/src/main/java/org/skywalking/apm/collector/cache/service/ApplicationCacheService.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.cache.service.ApplicationCacheService</code></a> ï¼Œåº”ç”¨æ•°æ®ç¼“å­˜æœåŠ¡<strong>æ¥å£</strong>ã€‚</p><ul><li>Table ï¼š<a href="https://github.com/YunaiV/skywalking/blob/ed68f92bf1f5ac397c0bb0a5cc23fa4f3e3c32d1/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/register/ApplicationTable.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.table.register.ApplicationTable</code></a></li><li>Data ï¼š<a href="https://github.com/YunaiV/skywalking/blob/ed68f92bf1f5ac397c0bb0a5cc23fa4f3e3c32d1/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/register/Application.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.table.register.Application</code></a></li></ul><h2 id="2-3-InstanceCacheService"><a href="#2-3-InstanceCacheService" class="headerlink" title="2.3 InstanceCacheService"></a>2.3 InstanceCacheService</h2><p><a href="https://github.com/YunaiV/skywalking/blob/a1667a9ecf4eecf77cc2390f0af709c3b1bb7e4b/apm-collector/apm-collector-cache/collector-cache-define/src/main/java/org/skywalking/apm/collector/cache/service/InstanceCacheService.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.cache.service.InstanceCacheService</code></a> ï¼Œåº”ç”¨å®ä¾‹æ•°æ®ç¼“å­˜æœåŠ¡<strong>æ¥å£</strong>ã€‚</p><ul><li>Table ï¼š<a href="https://github.com/YunaiV/skywalking/blob/a1667a9ecf4eecf77cc2390f0af709c3b1bb7e4b/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/register/InstanceTable.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.table.register.InstanceTable</code></a></li><li>Data ï¼š<a href="https://github.com/YunaiV/skywalking/blob/a1667a9ecf4eecf77cc2390f0af709c3b1bb7e4b/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/register/Instance.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.table.register.Instance</code></a></li></ul><h2 id="2-4-ServiceNameCacheService"><a href="#2-4-ServiceNameCacheService" class="headerlink" title="2.4 ServiceNameCacheService"></a>2.4 ServiceNameCacheService</h2><p><a href="https://github.com/YunaiV/skywalking/blob/a859f4751203d73f10f30bb7c9cf2adfdecf955c/apm-collector/apm-collector-cache/collector-cache-define/src/main/java/org/skywalking/apm/collector/cache/service/ServiceNameCacheService.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.cache.service.ServiceNameCacheService</code></a> ï¼ŒæœåŠ¡åæ•°æ®ç¼“å­˜æœåŠ¡<strong>æ¥å£</strong>ã€‚<br><a href="https://github.com/YunaiV/skywalking/blob/a859f4751203d73f10f30bb7c9cf2adfdecf955c/apm-collector/apm-collector-cache/collector-cache-define/src/main/java/org/skywalking/apm/collector/cache/service/ServiceIdCacheService.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.cache.service.ServiceIdCacheService</code></a> ï¼ŒæœåŠ¡ç¼–å·æ•°æ®ç¼“å­˜æœåŠ¡<strong>æ¥å£</strong>ã€‚</p><ul><li>Table ï¼š<a href="https://github.com/YunaiV/skywalking/blob/a859f4751203d73f10f30bb7c9cf2adfdecf955c/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/register/ServiceNameTable.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.table.register.ServiceNameTable</code></a></li><li>Data ï¼š<a href="https://github.com/YunaiV/skywalking/blob/a859f4751203d73f10f30bb7c9cf2adfdecf955c/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/register/ServiceName.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.table.register.ServiceName</code></a></li></ul><h1 id="3-collector-cache-guava-provider"><a href="#3-collector-cache-guava-provider" class="headerlink" title="3. collector-cache-guava-provider"></a>3. collector-cache-guava-provider</h1><p><code>collector-cache-guava-provider</code> ï¼ŒåŸºäº <a href="https://github.com/google/guava" rel="external nofollow noopener noreferrer" target="_blank">Google Guava</a> çš„ç¼“å­˜ç»„ä»¶å®ç°ã€‚</p><p>é¡¹ç›®ç»“æ„å¦‚ä¸‹ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_09_05/04.png" alt=""></p><p><strong>é»˜è®¤é…ç½®</strong>ï¼Œåœ¨ <a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-core/src/main/resources/application-default.yml#L5" rel="external nofollow noopener noreferrer" target="_blank"><code>application-default.yml</code></a> <strong>å·²ç»</strong>é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight"><table><tr><td class="code"><pre><div class="line">cache:</div><div class="line">  guava:</div></pre></td></tr></table></figure><h2 id="3-1-CacheModuleGuavaProvider"><a href="#3-1-CacheModuleGuavaProvider" class="headerlink" title="3.1 CacheModuleGuavaProvider"></a>3.1 CacheModuleGuavaProvider</h2><p><code>org.skywalking.apm.collector.cache.guava.CacheModuleGuavaProvider</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleProvider.java" rel="external nofollow noopener noreferrer" target="_blank">ModuleProvider</a> <strong>æŠ½è±¡ç±»</strong>ï¼ŒåŸºäº Guava çš„ç¼“å­˜ç»„ä»¶æœåŠ¡æä¾›è€…ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ed68f92bf1f5ac397c0bb0a5cc23fa4f3e3c32d1/apm-collector/apm-collector-cache/collector-cache-guava-provider/src/main/java/org/skywalking/apm/collector/cache/guava/CacheModuleGuavaProvider.java#L44" rel="external nofollow noopener noreferrer" target="_blank"><code>#name()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ç»„ä»¶æœåŠ¡æä¾›è€…åä¸º <code>&quot;guava&quot;</code> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ed68f92bf1f5ac397c0bb0a5cc23fa4f3e3c32d1/apm-collector/apm-collector-cache/collector-cache-guava-provider/src/main/java/org/skywalking/apm/collector/cache/guava/CacheModuleGuavaProvider.java#L48" rel="external nofollow noopener noreferrer" target="_blank"><code>module()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ç»„ä»¶ç±»ä¸º CacheModule ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ed68f92bf1f5ac397c0bb0a5cc23fa4f3e3c32d1/apm-collector/apm-collector-cache/collector-cache-guava-provider/src/main/java/org/skywalking/apm/collector/cache/guava/CacheModuleGuavaProvider.java#L66" rel="external nofollow noopener noreferrer" target="_blank"><code>#requiredModules()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ä¾èµ–ç»„ä»¶ä¸ºç©ºã€‚</p><hr><p><a href="https://github.com/YunaiV/skywalking/blob/ed68f92bf1f5ac397c0bb0a5cc23fa4f3e3c32d1/apm-collector/apm-collector-cache/collector-cache-guava-provider/src/main/java/org/skywalking/apm/collector/cache/guava/CacheModuleGuavaProvider.java#L52" rel="external nofollow noopener noreferrer" target="_blank"><code>#prepare(Properties)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå‡†å¤‡é˜¶æ®µé€»è¾‘ã€‚</p><ul><li>ç¬¬ 44 è¡Œ ï¼šåˆ›å»º ApplicationCacheGuavaService ã€InstanceCacheGuavaService ã€ServiceIdCacheGuavaService ã€ServiceNameCacheGuavaService å¯¹è±¡ï¼Œå¹¶è°ƒç”¨ <code>#registerServiceImplementation()</code> <strong>çˆ¶ç±»</strong>æ–¹æ³•ï¼Œæ³¨å†Œåˆ° <code>services</code> ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/ed68f92bf1f5ac397c0bb0a5cc23fa4f3e3c32d1/apm-collector/apm-collector-cache/collector-cache-guava-provider/src/main/java/org/skywalking/apm/collector/cache/guava/CacheModuleGuavaProvider.java#L59" rel="external nofollow noopener noreferrer" target="_blank"><code>#start()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ–¹æ³•ä¸ºç©ºã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ed68f92bf1f5ac397c0bb0a5cc23fa4f3e3c32d1/apm-collector/apm-collector-cache/collector-cache-guava-provider/src/main/java/org/skywalking/apm/collector/cache/guava/CacheModuleGuavaProvider.java#L62" rel="external nofollow noopener noreferrer" target="_blank"><code>#notifyAfterCompleted()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ–¹æ³•ä¸ºç©ºã€‚</p><h2 id="3-2-ApplicationCacheGuavaService"><a href="#3-2-ApplicationCacheGuavaService" class="headerlink" title="3.2 ApplicationCacheGuavaService"></a>3.2 ApplicationCacheGuavaService</h2><p><a href="https://github.com/YunaiV/skywalking/blob/ed68f92bf1f5ac397c0bb0a5cc23fa4f3e3c32d1/apm-collector/apm-collector-cache/collector-cache-guava-provider/src/main/java/org/skywalking/apm/collector/cache/guava/service/ApplicationCacheGuavaService.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.cache.guava.service.ApplicationCacheGuavaService</code></a> ï¼Œå®ç° ApplicationCacheService æ¥å£ï¼ŒåŸºäº Guava çš„åº”ç”¨æ•°æ®ç¼“å­˜æœåŠ¡<strong>å®ç°ç±»</strong>ã€‚</p><ul><li>EsDAO ï¼š<a href="https://github.com/YunaiV/skywalking/blob/ed68f92bf1f5ac397c0bb0a5cc23fa4f3e3c32d1/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/ApplicationEsCacheDAO.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.es.dao.ApplicationEsCacheDAO</code></a></li></ul><h2 id="3-3-InstanceCacheGuavaService"><a href="#3-3-InstanceCacheGuavaService" class="headerlink" title="3.3 InstanceCacheGuavaService"></a>3.3 InstanceCacheGuavaService</h2><p><a href="https://github.com/YunaiV/skywalking/blob/a1667a9ecf4eecf77cc2390f0af709c3b1bb7e4b/apm-collector/apm-collector-cache/collector-cache-guava-provider/src/main/java/org/skywalking/apm/collector/cache/guava/service/InstanceCacheGuavaService.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.cache.guava.service.InstanceCacheGuavaService</code></a> ï¼Œå®ç° InstanceCacheService æ¥å£ï¼ŒåŸºäº Guava çš„åº”ç”¨å®ä¾‹æ•°æ®ç¼“å­˜æœåŠ¡<strong>å®ç°ç±»</strong>ã€‚</p><ul><li>EsDAO ï¼š<a href="https://github.com/YunaiV/skywalking/blob/a1667a9ecf4eecf77cc2390f0af709c3b1bb7e4b/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/InstanceEsCacheDAO.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.es.dao.InstanceEsCacheDAO</code></a></li></ul><h2 id="3-4-ServiceNameCacheGuavaService"><a href="#3-4-ServiceNameCacheGuavaService" class="headerlink" title="3.4 ServiceNameCacheGuavaService"></a>3.4 ServiceNameCacheGuavaService</h2><p><a href="https://github.com/YunaiV/skywalking/blob/a859f4751203d73f10f30bb7c9cf2adfdecf955c/apm-collector/apm-collector-cache/collector-cache-guava-provider/src/main/java/org/skywalking/apm/collector/cache/guava/service/ServiceIdCacheGuavaService.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.cache.guava.service.ServiceNameCacheGuavaService</code></a> ï¼Œå®ç° ServiceNameCacheService æ¥å£ï¼ŒåŸºäº Guava çš„æœåŠ¡åæ•°æ®ç¼“å­˜æœåŠ¡<strong>å®ç°ç±»</strong>ã€‚<br><a href="https://github.com/YunaiV/skywalking/blob/a859f4751203d73f10f30bb7c9cf2adfdecf955c/apm-collector/apm-collector-cache/collector-cache-guava-provider/src/main/java/org/skywalking/apm/collector/cache/guava/service/ServiceNameCacheGuavaService.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.cache.guava.service.ServiceIdCacheGuavaService</code></a> ï¼Œå®ç° ServiceNameCacheService æ¥å£ï¼ŒåŸºäº Guava çš„æœåŠ¡ç¼–å·æ•°æ®ç¼“å­˜æœåŠ¡<strong>å®ç°ç±»</strong>ã€‚</p><ul><li>EsDAO ï¼š<a href="https://github.com/YunaiV/skywalking/blob/a859f4751203d73f10f30bb7c9cf2adfdecf955c/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/ServiceNameEsCacheDAO.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.es.dao.ServiceNameEsCacheDAO</code></a></li></ul><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>çœŸçš„æ˜¯ä¸€ç¯‡æ°´æ–‡ï¼Œéƒ½å†™çš„æ— ä»ä¸‹æ‰‹ï¼Œåªå¥½ç½—åˆ—äº†ç›¸å…³çš„ç±»ã€‚è§è°…ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_05/05.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸€æ³¢æœ‹å‹åœˆå¯å¥½ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/collector-cache-module/&quot;&gt;http://www.iocoder.cn/SkyWalking/collector-cache-module/&lt;/a&gt; 
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆäºŒï¼‰</title>
    <link href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/"/>
    <id>http://www.iocoder.cn/SkyWalking/collector-streaming-second/</id>
    <published>2020-08-31T16:00:00.000Z</published>
    <updated>2017-12-23T23:23:23.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/">http://www.iocoder.cn/SkyWalking/collector-streaming-second/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/">2. Data</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/">2.1 Collection</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/">2.2 DataCollection</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/">2.3 Window</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/">2.4 DataCache</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/">3. AggregationWorker</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/">4. PersistenceWorker</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/">4.1 WorkerCreateListener</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/">4.2 PersistenceTimer</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡æ¥ <a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆä¸€ï¼‰ã€‹</a> ï¼Œä¸»è¦åˆ†äº« <strong>Collector Streaming æµå¼å¤„ç†çš„ç¬¬äºŒéƒ¨åˆ†</strong>ã€‚ä¸»è¦åŒ…å«å¦‚ä¸‹éƒ¨åˆ†ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_09_01/01.png" alt=""></p><ul><li>AggregationWorker ï¼šèšåˆå¤„ç†æ•°æ®ï¼Œåæäº¤ Data åˆ° Next èŠ‚ç‚¹ä»¬å¤„ç†ã€‚</li><li>PersistenceWorker ï¼šèšåˆå¤„ç†æ•°æ®ï¼Œåå­˜å‚¨ Data ã€‚</li></ul><h1 id="2-Data"><a href="#2-Data" class="headerlink" title="2. Data"></a>2. Data</h1><p>AggregationWorker å’Œ PersistenceWorker ï¼Œéƒ½å…ˆ<strong>èšåˆ</strong>å¤„ç†æ•°æ®ï¼Œåœ¨è¿›è¡Œå„è‡ªçš„åç»­å¤„ç†ã€‚é‚£ä¹ˆèšåˆå¤„ç†çš„æ•°æ®ç»“æœï¼Œéœ€è¦æœ‰<strong>å®¹å™¨</strong>è¿›è¡Œç¼“å­˜æš‚å­˜ï¼š</p><ul><li><code>org.skywalking.apm.collector.core.cache</code> ï¼šæ¥å£</li><li><code>org.skywalking.apm.collector.stream.worker.impl.data</code> ï¼šå®ç°</li></ul><p>ç±»å›¾å¦‚ä¸‹ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_09_01/02.png" alt=""></p><ul><li>Collection ï¼šæ•°æ®é‡‡é›†ï¼Œæä¾›æœ‰è¯»ã€å†™<strong>ä¸¤ä¸ªçŠ¶æ€</strong>çš„æ•°æ®å®¹å™¨ã€‚</li><li>Window ï¼šçª—å£( ğŸ˜ˆè¿™ä¸ªè§£é‡Šæ€ªæ€ªçš„ )ï¼Œå†…æœ‰<strong>ä¸¤ä¸ª Collection</strong>ã€‚<ul><li>ä¸€ä¸ª Collection ï¼Œè´Ÿè´£å†™å…¥<strong>æ•°æ®</strong>æ•°æ®</li><li>ä¸€ä¸ª Collection ï¼Œè´Ÿè´£è¯»å‡º<strong>å¤„ç†</strong>æ•°æ®</li><li>å½“å†™çš„ Collection <strong>ç¬¦åˆå¤„ç†çš„æ¡ä»¶</strong>ï¼Œè¯»å†™ Collection åˆ‡æ¢</li></ul></li></ul><h2 id="2-1-Collection"><a href="#2-1-Collection" class="headerlink" title="2.1 Collection"></a>2.1 Collection</h2><p><a href="https://github.com/YunaiV/skywalking/blob/d6019b49d686f79d07528a19b09d4f0ccc4eca9b/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/cache/Collection.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.core.cache.Collection</code></a> ï¼Œæ•°æ®é‡‡é›†<strong>æ¥å£</strong>ã€‚</p><ul><li>æ•°æ®ç›¸å…³ ï¼š<code>#collection()</code> / <code>#size()</code> / <code>#clear()</code></li><li>è¯»ç›¸å…³ ï¼š<code>#reading()</code> / <code>#isReading()</code> / <code>#finishReading()</code></li><li>å†™ç›¸å…³ ï¼š<code>#writing()</code> / <code>#isWriting()</code> / <code>#finishWriting()</code></li></ul><h2 id="2-2-DataCollection"><a href="#2-2-DataCollection" class="headerlink" title="2.2 DataCollection"></a>2.2 DataCollection</h2><p><a href="https://github.com/YunaiV/skywalking/blob/d6019b49d686f79d07528a19b09d4f0ccc4eca9b/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/data/DataCollection.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.stream.worker.impl.data.DataCollection</code></a> ï¼Œå®ç° Collection æ¥å£ï¼Œæ•°æ®é‡‡é›†å®ç°ç±»ï¼Œä½¿ç”¨ <a href="https://github.com/YunaiV/skywalking/blob/d6019b49d686f79d07528a19b09d4f0ccc4eca9b/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/data/DataCollection.java#L38" rel="external nofollow noopener noreferrer" target="_blank"><code>Map&lt;String, Data&gt;</code></a> ä½œä¸ºæ•°æ®å®¹å™¨ã€‚</p><h2 id="2-3-Window"><a href="#2-3-Window" class="headerlink" title="2.3 Window"></a>2.3 Window</h2><p><code>org.skywalking.apm.collector.core.cache.Window</code> ï¼Œçª—å£<strong>æŠ½è±¡ç±»</strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/d6019b49d686f79d07528a19b09d4f0ccc4eca9b/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/cache/Window.java#L50" rel="external nofollow noopener noreferrer" target="_blank">æ„é€ æ–¹æ³•</a> ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/d6019b49d686f79d07528a19b09d4f0ccc4eca9b/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/cache/Window.java#L44" rel="external nofollow noopener noreferrer" target="_blank"><code>windowDataA</code></a> å±æ€§ï¼Œçª—å£æ•°æ®A ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/d6019b49d686f79d07528a19b09d4f0ccc4eca9b/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/cache/Window.java#L48" rel="external nofollow noopener noreferrer" target="_blank"><code>windowDataB</code></a> å±æ€§ï¼Œçª—å£æ•°æ®B ã€‚</li><li>é€šè¿‡ <a href="https://github.com/YunaiV/skywalking/blob/d6019b49d686f79d07528a19b09d4f0ccc4eca9b/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/cache/Window.java#L61" rel="external nofollow noopener noreferrer" target="_blank"><code>#collectionInstance()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œåˆ›å»ºçª—å£æ•°æ®( Collection )å¯¹è±¡ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/d6019b49d686f79d07528a19b09d4f0ccc4eca9b/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/cache/Window.java#L39" rel="external nofollow noopener noreferrer" target="_blank"><code>pointer</code></a> å±æ€§ï¼Œæ•°æ®æŒ‡å‘ <code>windowDataA</code> æˆ– <code>windowDataA</code>ã€‚<ul><li><a href="https://github.com/YunaiV/skywalking/blob/d6019b49d686f79d07528a19b09d4f0ccc4eca9b/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/cache/Window.java#L111" rel="external nofollow noopener noreferrer" target="_blank"><code>#getCurrent()</code></a> æ–¹æ³•ï¼Œè·å¾—<strong>ç°</strong>æ•°æ®æŒ‡å‘ï¼Œå³ <code>pointer</code> ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/d6019b49d686f79d07528a19b09d4f0ccc4eca9b/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/cache/Window.java#L118" rel="external nofollow noopener noreferrer" target="_blank"><code>#getLast()</code></a> æ–¹æ³•ï¼Œè·å¾—<strong>åŸ</strong>æ•°æ®æŒ‡å‘ï¼Œå³<strong>é</strong> <code>pointer</code> ã€‚</li></ul></li><li><a href="https://github.com/YunaiV/skywalking/blob/d6019b49d686f79d07528a19b09d4f0ccc4eca9b/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/cache/Window.java#L33" rel="external nofollow noopener noreferrer" target="_blank"><code>windowSwitch</code></a> å±æ€§ï¼Œçª—å£åˆ‡æ¢è®¡æ•°ã€‚</li></ul><hr><p><strong>åˆ‡æ¢ Collection ç›¸å…³</strong>ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/d6019b49d686f79d07528a19b09d4f0ccc4eca9b/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/cache/Window.java#L68" rel="external nofollow noopener noreferrer" target="_blank"><code>#trySwitchPointer()</code></a> æ–¹æ³•ï¼Œè¿”å›æ˜¯å¦å¯ä»¥åˆ‡æ¢ Collection ã€‚å¯ä»¥åˆ‡æ¢éœ€è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š<ul><li>åªæœ‰<strong>ä¸€ä¸ªè°ƒç”¨æ–¹</strong>ç”³è¯·åˆ‡æ¢ï¼Œé€šè¿‡ <code>windowSwitch</code> å±æ€§è¿›è¡Œè®¡æ•°ã€‚</li><li><strong>åŸ</strong>æ•°æ®æŒ‡å‘<strong>ä¸å¤„äºæ­£åœ¨è¯»å–çŠ¶æ€</strong>ã€‚å¦‚æœåˆ‡æ¢ï¼Œä¸€è¾¹è¯»ä¸€è¾¹å†™ï¼Œå¯èƒ½ä¼šæœ‰å¹¶å‘é—®é¢˜ã€‚</li><li>æ— è®ºæ˜¯å¦å¯ä»¥åˆ‡æ¢ Collection ï¼Œéœ€è¦è°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/d6019b49d686f79d07528a19b09d4f0ccc4eca9b/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/cache/Window.java#L75" rel="external nofollow noopener noreferrer" target="_blank"><code>#trySwitchPointerFinally()</code></a> æ–¹æ³•ï¼Œ<strong>é‡Šæ”¾</strong> <code>windowSwitch</code> çš„è®¡æ•°ã€‚</li></ul></li><li><a href="https://github.com/YunaiV/skywalking/blob/d6019b49d686f79d07528a19b09d4f0ccc4eca9b/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/cache/Window.java#L82" rel="external nofollow noopener noreferrer" target="_blank"><code>#switchPointer()</code></a> æ–¹æ³•ï¼Œåˆ‡æ¢æ•°æ®æŒ‡å‘ï¼Œå¹¶æ ‡è®°<strong>åŸ</strong>æ•°æ®æŒ‡å‘çš„ Collection <strong>æ­£åœ¨è¯»å–ä¸­</strong>ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/d6019b49d686f79d07528a19b09d4f0ccc4eca9b/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/cache/Window.java#L129" rel="external nofollow noopener noreferrer" target="_blank"><code>#finishReadingLast()</code></a> æ–¹æ³•ï¼Œæ¸…ç©º<strong>åŸ</strong>æ•°æ®æŒ‡å‘çš„ Collection æ•°æ®ï¼Œå¹¶æ ‡è®°<strong>åŸ</strong>æ•°æ®æŒ‡å‘çš„ Collection <strong>å®Œæˆè¯»å–</strong>( <strong>ä¸åœ¨æ­£åœ¨è¯»å–ä¸­</strong> )ã€‚</li></ul><hr><p><strong>å†™ Collection ç›¸å…³</strong>ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/d6019b49d686f79d07528a19b09d4f0ccc4eca9b/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/cache/Window.java#L98" rel="external nofollow noopener noreferrer" target="_blank"><code>#getCurrentAndWriting()</code></a> æ–¹æ³•ï¼Œè·å¾—<strong>ç°</strong>æ•°æ®æŒ‡å‘ï¼Œå¹¶æ ‡è®°<strong>æ­£åœ¨å†™å…¥ä¸­</strong>ã€‚é€šè¿‡<strong>æ­£åœ¨å†™å…¥</strong>æ ‡è®°ï¼Œåˆ‡æ¢ Collection å®Œæˆåï¼Œå¯ä»¥åˆ¤æ–­è¯¥ Collection æ­£åœ¨å†™å…¥ä¸­ï¼Œ<strong>è‹¥æ˜¯ï¼Œç­‰å¾…ä¸åœ¨å†™å…¥ä¸­ï¼Œå¼€å§‹æ•°æ®è¯»å–å¹¶å¤„ç†</strong>ã€‚</li></ul><h2 id="2-4-DataCache"><a href="#2-4-DataCache" class="headerlink" title="2.4 DataCache"></a>2.4 DataCache</h2><p><code>org.skywalking.apm.collector.stream.worker.impl.data.DataCache</code> ï¼Œå®ç° Window æŠ½è±¡ç±»ï¼Œæ•°æ®ç¼“å­˜ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/e6e1a7899e7b0e674a61f323447d4b66cffa8136/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/data/DataCache.java#L36" rel="external nofollow noopener noreferrer" target="_blank"><code>#collectionInstance()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œåˆ›å»º DataCollection å¯¹è±¡ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/e6e1a7899e7b0e674a61f323447d4b66cffa8136/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/data/DataCache.java#L82" rel="external nofollow noopener noreferrer" target="_blank"><code>#currentCollectionSize()</code></a> æ–¹æ³•ï¼Œè·å¾—å½“å‰æ•°æ®æŒ‡å‘( å†™å…¥ Collection )çš„æ•°æ®æ•°é‡ã€‚</li></ul><hr><p><strong>å†™ Collection ç›¸å…³</strong>ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/e6e1a7899e7b0e674a61f323447d4b66cffa8136/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/data/DataCache.java#L73" rel="external nofollow noopener noreferrer" target="_blank"><code>#writing()</code></a> æ–¹æ³•ï¼Œè°ƒç”¨ <code>#getCurrentAndWriting()</code> æ–¹æ³•ï¼Œå¼€å§‹å†™å…¥ã€‚å³ï¼Œè·å¾—<strong>ç°</strong>æ•°æ®æŒ‡å‘ï¼Œå¹¶æ ‡è®°<strong>æ­£åœ¨å†™å…¥ä¸­</strong>ã€‚<ul><li><a href="https://github.com/YunaiV/skywalking/blob/e6e1a7899e7b0e674a61f323447d4b66cffa8136/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/data/DataCache.java#L34" rel="external nofollow noopener noreferrer" target="_blank"><code>lockedDataCollection</code></a> å±æ€§ï¼Œå†™å…¥çš„çª—å£æ•°æ®ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/e6e1a7899e7b0e674a61f323447d4b66cffa8136/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/data/DataCache.java#L66" rel="external nofollow noopener noreferrer" target="_blank"><code>#put(id, data)</code></a> æ–¹æ³•ï¼Œå‘ <code>lockedDataCollection</code> å±æ€§ï¼Œå†™å…¥ Data ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/e6e1a7899e7b0e674a61f323447d4b66cffa8136/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/data/DataCache.java#L56" rel="external nofollow noopener noreferrer" target="_blank"><code>#get(id)</code></a> æ–¹æ³•ï¼Œå‘ <code>lockedDataCollection</code> å±æ€§ï¼Œæ ¹æ® ID è·å¾— Data ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/e6e1a7899e7b0e674a61f323447d4b66cffa8136/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/data/DataCache.java#L46" rel="external nofollow noopener noreferrer" target="_blank"><code>#containsKey(id)</code></a> æ–¹æ³•ï¼Œå‘ <code>lockedDataCollection</code> å±æ€§ï¼Œæ ¹æ® ID åˆ¤æ–­ Data æ˜¯å¦å­˜åœ¨ ã€‚</li></ul></li><li><a href="https://github.com/YunaiV/skywalking/blob/e6e1a7899e7b0e674a61f323447d4b66cffa8136/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/data/DataCache.java#L89" rel="external nofollow noopener noreferrer" target="_blank"><code>#finishWriting()</code></a> æ–¹æ³•ï¼Œå®Œæˆå†™å…¥ã€‚å³ï¼Œæ ‡è®° <code>lockedDataCollection</code> <strong>ä¸åœ¨æ­£åœ¨å†™å…¥ä¸­</strong>ã€‚</li></ul><h1 id="3-AggregationWorker"><a href="#3-AggregationWorker" class="headerlink" title="3. AggregationWorker"></a>3. AggregationWorker</h1><p><code>org.skywalking.apm.collector.stream.worker.impl.AggregationWorker</code> ï¼Œå®ç° AbstractLocalAsyncWorker æŠ½è±¡ç±»ï¼Œ<strong>å¼‚æ­¥èšåˆ</strong> Workerï¼Œè´Ÿè´£èšåˆå¤„ç†æ•°æ®ï¼Œåæäº¤ Data åˆ° Next èŠ‚ç‚¹ä»¬å¤„ç†ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ccd030f6b449954fccc7be4e19c15290e8affc77/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/AggregationWorker.java#L47" rel="external nofollow noopener noreferrer" target="_blank"><strong>æ„é€ æ–¹æ³•</strong></a> ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/ccd030f6b449954fccc7be4e19c15290e8affc77/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/AggregationWorker.java#L41" rel="external nofollow noopener noreferrer" target="_blank"><code>dataCache</code></a> å±æ€§ï¼Œæ•°æ®ç¼“å­˜ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/ccd030f6b449954fccc7be4e19c15290e8affc77/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/AggregationWorker.java#L45" rel="external nofollow noopener noreferrer" target="_blank"><code>messageNum</code></a> å±æ€§ï¼Œæ¶ˆæ¯è®¡æ•°ã€‚å½“è¶…è¿‡ä¸€å®šæ•°é‡( ç›®å‰æ˜¯ 100 )ï¼Œé‡ç½®è®¡æ•°å½’é›¶ã€‚</li></ul><hr><p><a href="https://github.com/YunaiV/skywalking/blob/ccd030f6b449954fccc7be4e19c15290e8affc77/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/AggregationWorker.java#L52" rel="external nofollow noopener noreferrer" target="_blank"><code>#onWork(message)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œèšåˆå¤„ç†æ•°æ®ï¼Œå½“æ»¡è¶³æ¡ä»¶æ—¶ï¼Œæäº¤ Data åˆ° Next èŠ‚ç‚¹ä»¬å¤„ç†ã€‚</p><ul><li>ç¬¬ 53 è¡Œï¼š<code>messageNum</code> è®¡æ•°å¢åŠ ã€‚</li><li>ç¬¬ 56 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/ccd030f6b449954fccc7be4e19c15290e8affc77/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/AggregationWorker.java#L97" rel="external nofollow noopener noreferrer" target="_blank"><code>#aggregate(message)</code></a> æ–¹æ³•ï¼Œèšåˆæ¶ˆæ¯åˆ°æ•°æ®ã€‚</li><li>ç¬¬ 59 è‡³ 62 è¡Œï¼š<code>messageNum &gt;= 100</code> æ—¶ï¼Œè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/ccd030f6b449954fccc7be4e19c15290e8affc77/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/AggregationWorker.java#L70" rel="external nofollow noopener noreferrer" target="_blank"><code>#sendToNext()</code></a> ï¼Œæäº¤ç¼“å­˜æ•°æ®çš„<strong>è¯» Collection çš„æ•°æ®</strong>ç»™ Next èŠ‚ç‚¹ä»¬ç»§ç»­å¤„ç†ã€‚</li><li>ç¬¬ 65 è‡³ 67 è¡Œï¼š<code>messageNum.endOfBatch == true</code> æ—¶ï¼Œå½“æ¶ˆæ¯æ˜¯æ‰¹å¤„ç†çš„æœ€åä¸€æ¡æ—¶ï¼Œè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/ccd030f6b449954fccc7be4e19c15290e8affc77/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/AggregationWorker.java#L70" rel="external nofollow noopener noreferrer" target="_blank"><code>#sendToNext()</code></a> ï¼Œæäº¤ç¼“å­˜æ•°æ®çš„<strong>è¯» Collection çš„æ•°æ®</strong>ç»™ Next èŠ‚ç‚¹ä»¬ç»§ç»­å¤„ç†ã€‚</li></ul><hr><p><a href="https://github.com/YunaiV/skywalking/blob/ccd030f6b449954fccc7be4e19c15290e8affc77/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/AggregationWorker.java#L70" rel="external nofollow noopener noreferrer" target="_blank"><code>#sendToNext()</code></a> æ–¹æ³•ï¼Œæäº¤ç¼“å­˜æ•°æ®çš„<strong>è¯» Collection çš„æ•°æ®</strong>ç»™ Next èŠ‚ç‚¹ä»¬ç»§ç»­å¤„ç†ã€‚</p><ul><li>ç¬¬ 72 è¡Œï¼š<strong>ç›´æ¥</strong>è°ƒç”¨ <code>Window#switchPointer()</code> æ–¹æ³•ï¼Œåˆ‡æ¢æ•°æ®æŒ‡é’ˆï¼Œå¹¶æ ‡è®°<strong>åŸ</strong>æŒ‡å‘æ­£åœ¨è¯»å–ä¸­ã€‚è¿™é‡Œå¹¶æœªå…ˆè°ƒç”¨ <code>Window#trySwitchPointer()</code> æ–¹æ³•ï¼Œ<strong>æ˜¯å¦ä¼šæœ‰å¹¶å‘é—®é¢˜</strong>ï¼Ÿç›®å‰è¿™é‡Œæ˜¯<strong>å¼‚æ­¥å•çº¿ç¨‹</strong>ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰é—®é¢˜ï¼Œå‚è§ <a href="http://www.iocoder.cn/SkyWalking/collector-queue-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Queue é˜Ÿåˆ—ç»„ä»¶ã€‹</a> ã€‚å¦å¤–ï¼Œåœ¨ <a href="#">ã€Œ4. PersistenceWorkerã€</a> ä¼šçœ‹åˆ°å¹¶å‘çš„æƒ…å†µå¤„ç†ã€‚</li><li>ç¬¬ 74 è‡³ 80 è¡Œï¼šç­‰å¾…<strong>åŸ</strong>æŒ‡å‘ä¸åœ¨è¯»å–ä¸­ã€‚</li><li>ç¬¬ 82 è‡³ 85 è¡Œï¼šæäº¤æ•°æ®ç»™ Next èŠ‚ç‚¹ä»¬ç»§ç»­å¤„ç†ã€‚</li><li>ç¬¬ 87 è¡Œï¼šæ ‡è®°<strong>åŸ</strong>æŒ‡å‘å®Œæˆè¯»å–ã€‚</li></ul><h1 id="4-PersistenceWorker"><a href="#4-PersistenceWorker" class="headerlink" title="4. PersistenceWorker"></a>4. PersistenceWorker</h1><p><code>org.skywalking.apm.collector.stream.worker.impl.PersistenceWorker</code> ï¼Œå®ç° AbstractLocalAsyncWorker æŠ½è±¡ç±»ï¼Œ<strong>å¼‚æ­¥æ‰¹é‡å­˜å‚¨</strong> Workerï¼Œè´Ÿè´£èšåˆå¤„ç†æ•°æ®ï¼Œåå­˜å‚¨ Data ã€‚</p><p>è€ƒè™‘åˆ°éœ€è¦ä¿è¯å­˜å‚¨çš„æ—¶æ•ˆæ€§ï¼ŒPersistenceWorker ä½¿ç”¨ PersistenceTimer ï¼Œå®šæ—¶å­˜å‚¨ Data ï¼Œåœ¨ <a href="#">ã€Œ4.2 PersistenceWorkerã€</a> è¯¦ç»†è§£æã€‚</p><hr><p><a href="https://github.com/YunaiV/skywalking/blob/ccd030f6b449954fccc7be4e19c15290e8affc77/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/AggregationWorker.java#L47" rel="external nofollow noopener noreferrer" target="_blank"><strong>æ„é€ æ–¹æ³•</strong></a> ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/bf563461e75b6717d7b4589d7c3f579acf305541/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/PersistenceWorker.java#L49" rel="external nofollow noopener noreferrer" target="_blank"><code>dataCache</code></a> å±æ€§ï¼Œæ•°æ®ç¼“å­˜ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/bf563461e75b6717d7b4589d7c3f579acf305541/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/PersistenceWorker.java#L53" rel="external nofollow noopener noreferrer" target="_blank"><code>batchDAO</code></a> å±æ€§ï¼Œæ‰¹é‡æ“ä½œ DAO ï¼Œåœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Storage å­˜å‚¨ç»„ä»¶ã€‹</a> æœ‰è¯¦ç»†è§£æã€‚</li></ul><hr><p><a href="https://github.com/YunaiV/skywalking/blob/bf563461e75b6717d7b4589d7c3f579acf305541/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/PersistenceWorker.java#L186" rel="external nofollow noopener noreferrer" target="_blank"><code>#needMergeDBData()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œå­˜å‚¨æ—¶ï¼Œæ˜¯å¦éœ€è¦åˆå¹¶æ•°æ®ã€‚ä¸€äº› Data åªæœ‰æ–°å¢æ“ä½œï¼Œæ²¡æœ‰æ›´æ–°æ“ä½œã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/bf563461e75b6717d7b4589d7c3f579acf305541/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/PersistenceWorker.java#L181" rel="external nofollow noopener noreferrer" target="_blank"><code>#persistenceDAO()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œè·å¾— Data å¯¹åº”çš„æŒä¹…åŒ– DAO æ¥å£çš„<strong>å®ç°ç±»</strong>å¯¹è±¡ã€‚</p><p>ä¸Šè¿°ä¸¤ä¸ª<strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œç”¨äº <a href="https://github.com/YunaiV/skywalking/blob/bf563461e75b6717d7b4589d7c3f579acf305541/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/PersistenceWorker.java#L121" rel="external nofollow noopener noreferrer" target="_blank"><code>#prepareBatch(dataMap)</code></a> æ–¹æ³•ï¼Œç”Ÿæˆæ‰¹é‡æ“ä½œå¯¹è±¡æ•°ç»„ï¼Œæœ€ç»ˆè°ƒç”¨ <code>IBatchDAO#batchPersistence(List&lt;?&gt;)</code> æ–¹æ³•ï¼Œé€šè¿‡æ‰§è¡Œæ‰¹é‡æ“ä½œå¯¹è±¡æ•°ç»„ï¼Œå®ç°æ‰¹é‡æŒä¹…åŒ–æ•°æ®ï¼Œåœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Storage å­˜å‚¨ç»„ä»¶ã€‹</a> æœ‰è¯¦ç»†è§£æã€‚</p><hr><p><a href="https://github.com/YunaiV/skywalking/blob/bf563461e75b6717d7b4589d7c3f579acf305541/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/PersistenceWorker.java#L71" rel="external nofollow noopener noreferrer" target="_blank"><code>#onWork(message)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œå½“æ»¡è¶³æ¡ä»¶æ—¶å­˜å‚¨ Data ï¼Œè€Œåèšåˆæ•°æ®ã€‚è¿™ç‚¹å’Œ AggregationWorker ç›¸åçš„ï¼Œå› ä¸ºè¦è€ƒè™‘å¹¶å‘é—®é¢˜ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 72 è¡Œï¼šè°ƒç”¨ <code>DataCache#currentCollectionSize()</code> æ–¹æ³•ï¼Œè·å¾—å½“å‰å†™å…¥ Collection çš„æ•°æ®æ•°é‡ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡ 5000 ã€‚<ul><li>ç¬¬ 75 è¡Œï¼šè°ƒç”¨ <code>DataCache#trySwitchPointer()</code> æ–¹æ³•ï¼Œ<strong>åˆ¤æ–­</strong>æ˜¯å¦å¯ä»¥åˆ‡æ¢ Collection ã€‚é€šè¿‡è¯¥åˆ¤æ–­ï¼Œä¿è¯å’Œ PersistenceTimer ä¸€èµ·æ—¶ï¼Œä¸ä¼šå‡ºç°<strong>å¹¶å‘é—®é¢˜</strong>ã€‚</li><li>ç¬¬ 77 è¡Œï¼šè°ƒç”¨ <code>Window#switchPointer()</code> æ–¹æ³•ï¼Œåˆ‡æ¢æ•°æ®æŒ‡é’ˆï¼Œå¹¶æ ‡è®°<strong>åŸ</strong>æŒ‡å‘æ­£åœ¨è¯»å–ä¸­ã€‚</li><li>ç¬¬ 80 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/bf563461e75b6717d7b4589d7c3f579acf305541/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/PersistenceWorker.java#L100" rel="external nofollow noopener noreferrer" target="_blank"><code>#buildBatchCollection()</code></a> æ–¹æ³•ï¼Œåˆ›å»ºæ‰¹é‡æ“ä½œå¯¹è±¡æ•°ç»„ã€‚è¯¥æ–¹æ³•å’Œ <code>AggregationWorker#sendToNext()</code> æ–¹æ³•<strong>åŸºæœ¬ç±»ä¼¼</strong>ã€‚</li><li>ç¬¬ 83 è¡Œï¼šè°ƒç”¨ <code>IBatchDAO#batchPersistence(List&lt;?&gt;)</code> æ–¹æ³•ï¼Œé€šè¿‡æ‰§è¡Œæ‰¹é‡æ“ä½œå¯¹è±¡æ•°ç»„ï¼Œå®ç°æ‰¹é‡æŒä¹…åŒ–æ•°æ®ã€‚</li><li>ç¬¬ 86 è¡Œï¼šè°ƒç”¨ <code>DataCache#trySwitchPointerFinally()</code> æ–¹æ³•ï¼Œ<strong>é‡Šæ”¾</strong> <code>DataCache.windowSwitch</code> çš„è®¡æ•°ã€‚</li></ul></li><li>ç¬¬ 91 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/bf563461e75b6717d7b4589d7c3f579acf305541/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/PersistenceWorker.java#L164" rel="external nofollow noopener noreferrer" target="_blank"><code>#aggregate(message)</code></a> æ–¹æ³•ï¼Œèšåˆæ•°æ®ã€‚è¯¥æ–¹æ³•å’Œ <code>AggregationWorker#aggregate(message)</code> æ–¹æ³•<strong>åŸºæœ¬ç›¸ä¼¼</strong>ã€‚</li></ul><h2 id="4-1-WorkerCreateListener"><a href="#4-1-WorkerCreateListener" class="headerlink" title="4.1 WorkerCreateListener"></a>4.1 WorkerCreateListener</h2><p><code>org.skywalking.apm.collector.stream.worker.base.WorkerCreateListener</code> ï¼ŒWorker åˆ›å»ºç›‘å¬å™¨ã€‚</p><p>Worker åœ¨åˆ›å»ºæ—¶ï¼Œä¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/bf563461e75b6717d7b4589d7c3f579acf305541/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/WorkerCreateListener.java#L36" rel="external nofollow noopener noreferrer" target="_blank"><code>WorkerCreateListener#addWorker</code></a> æ–¹æ³•ï¼Œè®°å½•æ‰€æœ‰çš„ PersistenceWorker å¯¹è±¡ã€‚</p><p><strong>è®°å½•ä¸‹æ¥æœ‰ä»€ä¹ˆç”¨å‘¢</strong>ï¼Ÿåœ¨ <a href="https://github.com/YunaiV/skywalking/blob/bf563461e75b6717d7b4589d7c3f579acf305541/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/AgentStreamBootStartup.java#L47" rel="external nofollow noopener noreferrer" target="_blank">AgentStreamBootStartup</a> å¯åŠ¨æ—¶ï¼Œåˆ›å»º PersistenceTimer å¯¹è±¡ï¼Œå¹¶å°† WorkerCreateListener è®°å½•çš„ PersistenceWorker å¯¹è±¡é›†åˆ<strong>ä¼ é€’</strong>ç»™ PersistenceTimer å¯¹è±¡ã€‚è¿™æ ·ï¼ŒPersistenceTimer èƒ½å¤Ÿâ€<strong>è®¿é—®</strong>â€œåˆ° PersistenceWorker å¯¹è±¡ä»¬çš„ DataCache ï¼Œ<strong>å®šæ—¶</strong>å­˜å‚¨æ•°æ®ã€‚</p><h2 id="4-2-PersistenceTimer"><a href="#4-2-PersistenceTimer" class="headerlink" title="4.2 PersistenceTimer"></a>4.2 PersistenceTimer</h2><p><code>org.skywalking.apm.collector.stream.timer.PersistenceTimer</code> ï¼ŒæŒä¹…åŒ–å®šæ—¶ä»»åŠ¡ï¼Œè´Ÿè´£<strong>å®šæ—¶</strong>ã€<strong>æ‰¹é‡</strong>å­˜å‚¨ PersistenceWorker ç¼“å­˜çš„æ•°æ®ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ec95c9966b7e013c8a44ea2e0f748ad339363ce3/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/timer/PersistenceTimer.java#L43" rel="external nofollow noopener noreferrer" target="_blank"><code>#start(IBatchDAO, List&lt;PersistenceWorker&gt;)</code></a> æ–¹æ³•ï¼Œåˆ›å»ºå»¶è¿Ÿ 1 ç§’ï¼Œæ¯ 1 ç§’æ‰§è¡Œä¸€æ¬¡ <code>#extractDataAndSave()</code> æ–¹æ³•çš„å®šæ—¶ä»»åŠ¡ï¼Œç”¨äº<strong>å®šæ—¶</strong>ã€<strong>æ‰¹é‡</strong>å­˜å‚¨ PersistenceWorker ç¼“å­˜çš„æ•°æ®ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ec95c9966b7e013c8a44ea2e0f748ad339363ce3/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/timer/PersistenceTimer.java#L52" rel="external nofollow noopener noreferrer" target="_blank"><code>#extractDataAndSave(IBatchDAO, List&lt;PersistenceWorker&gt;)</code></a> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li><p>ç¬¬ 55 è‡³ 68 è¡Œï¼šè·å¾—æ‰€æœ‰ PersistenceWorker è¯» Collection ç¼“å­˜çš„æ•°æ®ã€‚</p><ul><li>ç¬¬ 60 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/ec95c9966b7e013c8a44ea2e0f748ad339363ce3/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/PersistenceWorker.java#L61" rel="external nofollow noopener noreferrer" target="_blank"><code>PersistenceWorker#flushAndSwitch()</code></a> åˆ‡æ¢æ•°æ®æŒ‡é’ˆï¼Œå³åˆ‡æ¢è¯»å†™ Collection ã€‚</li><li>ç¬¬ 62 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/ec95c9966b7e013c8a44ea2e0f748ad339363ce3/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/PersistenceWorker.java#L100" rel="external nofollow noopener noreferrer" target="_blank"><code>PersistenceWorker#buildBatchCollection()</code></a> æ–¹æ³•ï¼Œåˆ›å»ºæ‰¹é‡æ“ä½œå¯¹è±¡æ•°ç»„ã€‚</li><li><strong>æ€ä¹ˆä¿è¯å¹¶å‘å®‰å…¨</strong>ï¼Ÿé€šè¿‡ <code>Window#trySwitchPointer()</code> æ–¹æ³•ï¼Œä¿è¯è¯» Collection <strong>æ­£åœ¨è¢«è¯»å–ä¸­</strong>æ—¶ï¼ŒPersistenceWorker å’Œ PersistenceTimer æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªåˆ‡æ¢é˜Ÿåˆ—ï¼Œè¯»å–æ•°æ®ã€‚å½“è¯»å–å®Œæˆåï¼Œè°ƒç”¨ <code>Window#finishReadingLast()</code> æ–¹æ³•ï¼Œæ¸…ç©ºåŸæ•°æ®æŒ‡å‘ï¼Œå¹¶æ ‡è®°åŸæ•°æ®æŒ‡å‘å®Œæˆæ­£åœ¨è¯»å–ä¸­ã€‚</li></ul></li><li><p>ç¬¬ 71 è¡Œï¼šè°ƒç”¨ <code>IBatchDAO#batchPersistence(List&lt;?&gt;)</code> æ–¹æ³•ï¼Œæ‰§è¡Œæ‰¹é‡æ“ä½œï¼Œè¿›è¡Œå­˜å‚¨ã€‚</p></li></ul><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>å‘¼å‘¼ï¼Œç»ˆäºæŠŠæµå¼å¤„ç†ç»™å†™å®Œäº†ï¼Œå¦‚æœå†™çš„ä¸è¯¦ç»†æˆ–è€…ä¸åˆé€‚çš„ï¼Œèƒ–å‹çœ‹åˆ°éº»çƒ¦å‘ŠçŸ¥ç¬”è€…ï¼Œè°¢è°¢ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_09_01/03.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸€æ³¢æœ‹å‹åœˆå¯å¥½ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/collector-streaming-second/&quot;&gt;http://www.iocoder.cn/SkyWalking/collector-streaming-seco
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆä¸€ï¼‰</title>
    <link href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/"/>
    <id>http://www.iocoder.cn/SkyWalking/collector-streaming-first/</id>
    <published>2020-08-24T16:00:00.000Z</published>
    <updated>2017-12-25T04:34:53.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/">http://www.iocoder.cn/SkyWalking/collector-streaming-first/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/">2. apm-collector-core/graph</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/">2.1 Graph åˆ›å»º</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/">2.2 Graph å¯åŠ¨</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/">3. apm-collector-stream</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/">3.1 WayToNode å®ç°ç±»</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/">3.2 NodeProcessor å®ç°ç±»</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>Collector Streaming æµå¼å¤„ç†</strong>ã€‚ä¸»è¦åŒ…å«å¦‚ä¸‹éƒ¨åˆ†ï¼š</p><ul><li><p><code>apm-collector-core</code> æ¨¡å—çš„ <code>graph</code> åŒ…ï¼Œæä¾›<strong>æœ€ç²¾ç®€</strong>ã€<strong>å•èŠ‚ç‚¹</strong>çš„æµå¼å¤„ç†çš„å°è£…ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_25/01.png" alt=""></p></li><li><p><code>apm-collector-stream</code> æ¨¡å—ï¼Œåœ¨ <code>graph</code> åŒ…çš„åŸºç¡€ä¸Šï¼Œæä¾›<strong>å¼‚æ­¥</strong>ã€<strong>è·¨èŠ‚ç‚¹</strong>ç­‰ç­‰çš„æµå¼å¤„ç†çš„å°è£…ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_25/02.png" alt=""></p></li></ul><blockquote><p>å…æ‰“è„¸å¤§ä¿å¥ï¼šç¬”è€…å¯¹æµå¼å¤„ç†éå¸¸ä¸äº†è§£ï¼Œæœ¬æ–‡å¯èƒ½æ˜¯ä¸€æœ¬æ­£ç»çš„èƒ¡è¯´å…«é“ã€‚è€ƒè™‘åˆ°ç¬”è€…æ˜¯é è„¸åƒé¥­ï¼ˆé¢œå€¼æˆ‘åªæœæˆ‘çº¢é›·å“¥ï¼‰ï¼Œæ‰€ä»¥è¯»è€…è€çˆ·è¯·çˆ±æŠ¤ä¸‹ç¬”è€…ã€‚</p></blockquote><p>Collector Streaming åœ¨ SkyWalking æ¶æ„å›¾å¤„äºå¦‚ä¸‹ä½ç½®( <strong>çº¢æ¡†</strong> ) ï¼š</p><blockquote><p>FROM <a href="https://github.com/apache/incubating-skywalking" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/apache/incubating-skywalking</a><br><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_25/03.jpeg" alt=""></p></blockquote><p>OKï¼Œä¸‹é¢æ¥ä¸€æœ¬æ­£ç»çš„ä»£ç èµ°èµ·ï¼</p><h1 id="2-apm-collector-core-graph"><a href="#2-apm-collector-core-graph" class="headerlink" title="2. apm-collector-core/graph"></a>2. apm-collector-core/graph</h1><p>æ•´ä½“ç±»å›¾å¦‚ä¸‹ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_25/04.png" alt=""></p><p>çœ‹èµ·æ¥ç•¥å¤æ‚ï¼Œä¸è¦æ–¹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªæµå¼å¤§æ•°æ®å¤„ç†æ¡†æ¶ Apache Storm çš„è¯´æ˜ï¼š</p><blockquote><p>FROM <a href="http://www.csdn.net/article/2015-03-09/2824135" rel="external nofollow noopener noreferrer" target="_blank">ã€Šæµå¼å¤§æ•°æ®å¤„ç†çš„ä¸‰ç§æ¡†æ¶ï¼šStormï¼ŒSparkå’ŒSamzaã€‹</a><br>åœ¨ <a href="https://storm.apache.org/" rel="external nofollow noopener noreferrer" target="_blank">Storm</a> ä¸­ï¼Œå…ˆè¦è®¾è®¡ä¸€ä¸ªç”¨äºå®æ—¶è®¡ç®—çš„å›¾çŠ¶ç»“æ„ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ‹“æ‰‘ï¼ˆtopologyï¼‰ã€‚è¿™ä¸ªæ‹“æ‰‘å°†ä¼šè¢«æäº¤ç»™é›†ç¾¤ï¼Œç”±é›†ç¾¤ä¸­çš„ä¸»æ§èŠ‚ç‚¹ï¼ˆmaster nodeï¼‰åˆ†å‘ä»£ç ï¼Œå°†ä»»åŠ¡åˆ†é…ç»™å·¥ä½œèŠ‚ç‚¹ï¼ˆworker nodeï¼‰æ‰§è¡Œã€‚</p></blockquote><ul><li>Graph ï¼šå®šä¹‰äº†ä¸€ä¸ª<strong>æ•°æ®</strong>åœ¨<strong>å„ä¸ª</strong> Node çš„å¤„ç†æ‹“æ‰‘å›¾ã€‚</li><li>WayToNode ï¼šæäº¤<strong>æ•°æ®</strong>ç»™ Node çš„<strong>æ–¹å¼</strong>ã€‚</li><li>Node ï¼šèŠ‚ç‚¹ï¼ŒåŒ…å«ä¸€ä¸ª NodeProcessor å’Œ ä¸€ä¸ª Next ã€‚ <ul><li>NodeProcessor ï¼šNode å¤„ç†å™¨ï¼Œå¤„ç†<strong>æ•°æ®</strong>ã€‚</li><li>Next ï¼šåŒ…å« WayToNode æ•°ç»„ï¼Œå³ Node æäº¤<strong>æ•°æ®</strong>ç»™ Next çš„ Node <strong>æ•°ç»„</strong>çš„<strong>æ–¹å¼</strong>ã€‚</li></ul></li></ul><p>æ•´ä½“äº¤äº’æµç¨‹å¦‚ä¸‹ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_25/05.png" alt=""></p><ul><li><strong>ç²‰è‰²</strong>ç®­å¤´ï¼šå½“æ•°æ®è¿›æ¥æ—¶ï¼Œæäº¤ç»™ Grpah ã€‚æŒ‰ç…§å®šä¹‰çš„æ‹“æ‰‘å›¾ï¼Œä½¿ç”¨ NodeWay æäº¤ç»™ Node ï¼ŒNodeProcessor è¿›è¡Œå¤„ç†ã€‚</li><li><strong>è“è‰²</strong>ç®­å¤´ï¼šå½“ NodeProcessor å¤„ç†å®Œæˆåï¼ŒNext <strong>é€ä¸ª</strong>ä½¿ç”¨ NodeWay <strong>æ•°ç»„</strong>æäº¤ç»™ä¸‹é¢çš„ Node ï¼Œç»§ç»­å¤„ç†ã€‚<ul><li>ps ï¼š<strong>æ³¨æ„</strong>ï¼Œè¿™å—æµç¨‹ï¼Œæ ¹æ®ä¸åŒçš„ NodeProcessor çš„å®ç°ç±»ä¼šæœ‰ä¸åŒï¼Œ<strong>è“è‰²</strong>ç®­å¤´çš„è¿‡ç¨‹ï¼Œåªæ˜¯<strong>å…¶ä¸­çš„ä¸€ç§</strong>ï¼Œä¸‹é¢ä¼šè¯¦ç»†è§£æã€‚</li></ul></li></ul><p>æ•´ä½“é¡ºåºå›¾å¦‚ä¸‹ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_25/06.png" alt=""></p><ul><li>DirectWay æ˜¯ WayToNode <strong>æ¥å£</strong>çš„ä¸€ç§å®ç°ï¼Œæ­£å¦‚å…¶åï¼Œ<strong>ç›´æ¥</strong>æäº¤æ•°æ®ç»™ Node ã€‚åœ¨ <a href="#">ã€Œ3. apm-collector-streamã€</a> ä¼šçœ‹åˆ°å…¶ä»–å®ç°ï¼Œä¾‹å¦‚æäº¤åˆ°å…¶ä»–æœåŠ¡å™¨èŠ‚ç‚¹çš„ Nodeï¼Œä»è€Œå®ç°è·¨æœåŠ¡å™¨èŠ‚ç‚¹çš„æµå¼å¤„ç†ã€‚</li><li>AbstractWorker åœ¨ <code>apm-collector-stream</code> æ¨¡å—ï¼Œæ˜¯ NodeProcessor <strong>æ¥å£</strong>çš„ä¸€ç§å®ç°ï¼Œå¤„ç†æäº¤ç»™ Node çš„æ•°æ®ã€‚åœ¨ <code>#onWork(message)</code> <strong>æŠ½è±¡</strong>æ–¹æ³•é‡Œï¼Œå­ç±»å¯ä»¥å®ç°è¯¥æ–¹æ³•ï¼Œæ ¹æ®è‡ªèº«éœ€æ±‚ï¼Œæ˜¯å¦è°ƒç”¨ <code>#onNext(message)</code> æ–¹æ³•ï¼ŒNext é€ä¸ªä½¿ç”¨ NodeWay æ•°ç»„æäº¤ç»™ä¸‹é¢çš„ Node ï¼Œç»§ç»­å¤„ç†ã€‚</li></ul><hr><p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†åˆ†åˆ«çœ‹çœ‹å¦‚ä¸‹é€»è¾‘çš„è¯¦ç»†ä»£ç å®ç°ï¼š</p><ul><li>Graph åˆ›å»º</li><li>Graph å¯åŠ¨</li></ul><h2 id="2-1-Graph-åˆ›å»º"><a href="#2-1-Graph-åˆ›å»º" class="headerlink" title="2.1 Graph åˆ›å»º"></a>2.1 Graph åˆ›å»º</h2><p>åˆ›å»º Graph çš„é¡ºåºå›¾å¦‚ä¸‹ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_25/07.png" alt=""></p><ul><li>ç¬¬ä¸€æ­¥ï¼Œè°ƒç”¨ <code>GraphManager#createIfAbsent(graphId, input)</code> æ–¹æ³•( <code>input</code> å‚æ•°æ²¡ç”¨ )ï¼Œåˆ›å»ºä¸€ä¸ª Graph å¯¹è±¡ã€‚</li><li>ç¬¬äºŒæ­¥ï¼Œè°ƒç”¨ <code>Graph#addNode(WayToNode)</code> æ–¹æ³•ï¼Œåˆ›å»ºè¯¥ Graph çš„<strong>é¦–ä¸ª</strong> Node å¯¹è±¡ã€‚</li><li>ç¬¬ä¸‰æ­¥ï¼Œè°ƒç”¨ <code>Node#addNext(WayToNode)</code> æ–¹æ³•ï¼Œåˆ›å»ºè¯¥ Node çš„ä¸‹ä¸€ä¸ª Node å¯¹è±¡ã€‚</li></ul><p>å¦‚ä¸‹æ˜¯ <code>collector-agent-stream-provider</code> æ¨¡å—ï¼Œ<code>TraceStreamGraph#createServiceReferenceGraph()</code> æ–¹æ³•çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createServiceReferenceGraph</span><span class="params">()</span> </span>&#123;</div><div class="line">    QueueCreatorService&lt;ServiceReference&gt; queueCreatorService = moduleManager.find(QueueModule.NAME).getService(QueueCreatorService.class);</div><div class="line">    RemoteSenderService remoteSenderService = moduleManager.find(RemoteModule.NAME).getService(RemoteSenderService.class);</div><div class="line"></div><div class="line">    Graph&lt;ServiceReference&gt; graph = GraphManager.INSTANCE.createIfAbsent(SERVICE_REFERENCE_GRAPH_ID, ServiceReference.class);</div><div class="line">    graph.addNode(<span class="keyword">new</span> ServiceReferenceAggregationWorker.Factory(moduleManager, queueCreatorService).create(workerCreateListener))</div><div class="line">        .addNext(<span class="keyword">new</span> ServiceReferenceRemoteWorker.Factory(moduleManager, remoteSenderService, SERVICE_REFERENCE_GRAPH_ID).create(workerCreateListener))</div><div class="line">        .addNext(<span class="keyword">new</span> ServiceReferencePersistenceWorker.Factory(moduleManager, queueCreatorService).create(workerCreateListener));</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ¯ä¸ªæ–¹æ³•çš„å…·ä½“ä»£ç å®ç°ã€‚</p><hr><p><strong>ç¬¬ä¸€æ­¥</strong></p><p><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/graph/GraphManager.java#L50" rel="external nofollow noopener noreferrer" target="_blank"><code>GraphManager#createIfAbsent(graphId, input)</code></a> æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ª Graph å¯¹è±¡ï¼Œå¹¶æ·»åŠ åˆ° Graph æ˜ å°„ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul><li><code>INSTANCE</code> å±æ€§ï¼Œå•ä¾‹ã€‚</li><li><code>allGraphs</code> å±æ€§ï¼ŒGraph æ˜ å°„ã€‚å…¶ä¸­æ˜ å°„çš„ KEY ä¸º<strong>æ¯ä¸ª</strong> Graph å…¨å±€å”¯ä¸€ç¼–å·ã€‚åœ¨ <a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/graph/JvmMetricStreamGraph.java" rel="external nofollow noopener noreferrer" target="_blank">JvmMetricStreamGraph</a> ã€<a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/graph/RegisterStreamGraph.java" rel="external nofollow noopener noreferrer" target="_blank">RegisterStreamGraph</a> ã€<a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/graph/TraceStreamGraph.java" rel="external nofollow noopener noreferrer" target="_blank">TraceStreamGraph</a> ç±»ä¸­ï¼Œæšä¸¾äº†å®é™…ä½¿ç”¨çš„ Graph ç¼–å·ä»¬ã€‚</li><li>ç¬¬ 50 è‡³ 58 è¡Œï¼šå½“ Graph æ˜ å°„é‡Œä¸å­˜åœ¨æŒ‡å®š Graph ç¼–å·æ—¶ï¼Œåˆ›å»º Graph å¯¹è±¡ï¼Œå¹¶è¿”å›ã€‚</li></ul><hr><p><strong>ç¬¬äºŒæ­¥</strong></p><p><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/graph/Graph.java#L56" rel="external nofollow noopener noreferrer" target="_blank"><code>Graph#addNode(WayToNode)</code></a> æ–¹æ³•ï¼Œåˆ›å»ºè¯¥ Graph çš„<strong>é¦–ä¸ª</strong> Node å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul><li><code>id</code> å±æ€§ï¼ŒGraph ç¼–å·ã€‚</li><li><code>entryWay</code>ï¼Œ<strong>é¦–ä¸ª</strong>æäº¤æ•°æ®ç»™ Node çš„æ–¹å¼ã€‚</li><li>ç¬¬ 58 è¡Œ ï¼šå°†æ–¹æ³•å‚æ•° <code>entryWay</code> èµ‹å€¼ç»™ <code>this.entryWay</code> å±æ€§ã€‚åœ¨ä¸‹åˆ†äº«çš„ <code>Graph#start(input)</code> æ–¹æ³•é‡Œï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è¿™æ˜¯ Graph å¯åŠ¨çš„å…¥å£ï¼Œ<strong>é¦–ä¸ª</strong>æäº¤ç»™ Node çš„æ–¹å¼ã€‚</li><li>ç¬¬ 60 è‡³ 62 è¡Œ ï¼šè°ƒç”¨ <code>WayToNode#buildDestination(Graph)</code> æ–¹æ³•ï¼Œåˆ›å»º Node å¯¹è±¡ï¼Œå¹¶<strong>è¿”å›è¯¥ Node</strong> ã€‚åœ¨ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»è¯´è¿‡åˆ›å»ºçš„ Node å¯¹è±¡ï¼Œä¸ºè¯¥ Graph çš„<strong>é¦–ä¸ª</strong> Node ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/graph/WayToNode.java#L41" rel="external nofollow noopener noreferrer" target="_blank"><code>WayToNode#buildDestination()</code></a> æ–¹æ³•ï¼Œåˆ›å»ºè¯¥ <strong>WayToNode</strong> çš„ Node å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul><li><code>destination</code> å±æ€§ï¼Œç›®æ ‡ Node ã€‚å³è¯¥ WayToNode æäº¤<strong>æ•°æ®</strong>åˆ°çš„ Node ã€‚</li><li><code>destinationHandler</code> å±æ€§ï¼Œç›®æ ‡ Node çš„å¤„ç†å™¨ã€‚è§ <a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/graph/WayToNode.java#L47" rel="external nofollow noopener noreferrer" target="_blank"><code>#out(INPUT)</code></a> æ–¹æ³•ã€‚</li><li>ç¬¬ 42 è¡Œï¼šåˆ›å»º Node å¯¹è±¡ã€‚<ul><li>ç›®å‰ï¼Œ<code>destinationHandler</code> å±æ€§ï¼Œé™¤äº†ç”¨äºåˆ›å»º Node å¯¹è±¡ï¼Œæ— å…¶ä»–ç”¨é€”ã€‚</li></ul></li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/graph/Node.java#L40" rel="external nofollow noopener noreferrer" target="_blank">Node <code>æ„é€ æ–¹æ³•</code></a> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li><code>nodeProcessor</code> å±æ€§ï¼ŒèŠ‚ç‚¹å¤„ç†å™¨ã€‚</li><li><code>next</code> å±æ€§ï¼ŒåŒ…å« WayToNode æ•°ç»„ï¼Œå³ Node æäº¤æ•°æ®ç»™ Next çš„ Node æ•°ç»„çš„æ–¹å¼ã€‚</li><li>ç¬¬ 44 è¡Œï¼šè°ƒç”¨ <code>Graph#checkForNewNode(Node)</code> æ–¹æ³•ï¼Œæ ¡éªŒ Node çš„ NodeProcessor åœ¨å…¶ Graph é‡Œï¼Œ<strong>ç¼–å·å”¯ä¸€</strong>ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/graph/Graph.java#L71" rel="external nofollow noopener noreferrer" target="_blank"><code>Graph#checkForNewNode(Node)</code></a> æ–¹æ³•ï¼Œæ ¡éªŒ Node çš„ NodeProcessor åœ¨ Graph é‡Œï¼Œ<strong>ç¼–å·å”¯ä¸€</strong>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li><code>nodeIndex</code> å±æ€§ï¼Œå¤„ç†å™¨ç¼–å·ä¸ Node çš„æ˜ å°„ã€‚å…¶ä¸­æ˜ å°„çš„ KEY ä¸º <code>NodeProcessor#id()</code> ã€‚ </li><li>ç¬¬ 72 è‡³ 78 è¡Œï¼šæ ¡éªŒ Node çš„ NodeProcessor åœ¨ Graph é‡Œï¼Œ<strong>ç¼–å·å”¯ä¸€</strong>ã€‚</li></ul><hr><p><strong>ç¬¬ä¸‰æ­¥</strong></p><p><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/graph/Node.java#L51" rel="external nofollow noopener noreferrer" target="_blank"><code>Node#addNext(WayToNode)</code></a> æ–¹æ³•ï¼Œåˆ›å»ºè¯¥ Node çš„ä¸‹ä¸€ä¸ª Node å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 54 è¡Œï¼šè°ƒç”¨ <code>WayToNode#buildDestination(Graph)</code> æ–¹æ³•ï¼Œåˆ›å»ºè¯¥ Node çš„ä¸‹é¢çš„ Node å¯¹è±¡ã€‚</li><li>ç¬¬ 56 è¡Œï¼šæ·»åŠ åˆ›å»ºçš„ Node å¯¹è±¡åˆ° <code>next</code> å±æ€§ã€‚</li><li>ç¬¬ 58 è¡Œï¼šè¿”å›åˆ›å»ºçš„ Node å¯¹è±¡ã€‚</li></ul><h2 id="2-2-Graph-å¯åŠ¨"><a href="#2-2-Graph-å¯åŠ¨" class="headerlink" title="2.2 Graph å¯åŠ¨"></a>2.2 Graph å¯åŠ¨</h2><p>åˆ›å»º Graph çš„é¡ºåºå›¾å¦‚ä¸‹ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_25/08.png" alt=""></p><table><thead><tr><th>æ•°æ®æµå‘</th><th>FROM</th><th>TO</th><th>é€»è¾‘</th></tr></thead><tbody><tr><td>ç¬¬ä¸€æ­¥</td><td>Graph</td><td>WayToNode</td><td></td></tr><tr><td>ç¬¬äºŒæ­¥</td><td>WayToNode</td><td>Node</td><td></td></tr><tr><td>ç¬¬ä¸‰æ­¥</td><td>Node</td><td>NodeProcessor</td><td></td></tr><tr><td>ç¬¬å››æ­¥</td><td>NodeProcessor</td><td>Next</td><td>æ ¹æ®å…·ä½“å®ç°ï¼Œè‹¥åˆ° Next ï¼Œé‡å¤ç¬¬ä¸€æ­¥</td></tr></tbody></table><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_25/09.png" alt=""></p><hr><p><strong>ç¬¬ä¸€æ­¥</strong></p><p><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/graph/Graph.java#L48" rel="external nofollow noopener noreferrer" target="_blank"><code>Graph#start(input)</code></a> æ–¹æ³•ï¼Œå¯åŠ¨ Graph ï¼Œå¤„ç†æ•°æ®ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 49 è¡Œï¼šè°ƒç”¨ <code>WayToNode#in(input)</code> æ–¹æ³•ï¼Œè¾“å…¥æ•°æ®ç»™ WayToNode ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/graph/WayToNode.java#L45" rel="external nofollow noopener noreferrer" target="_blank"><code>WayToNode#in(input)</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œä»¥ <a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/graph/DirectWay.java#L29" rel="external nofollow noopener noreferrer" target="_blank"><code>DirectWay#in(input)</code></a> <strong>å®ç°</strong>æ–¹æ³•ä¸¾ä¾‹å­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 30 è¡Œï¼šè°ƒç”¨ <code>super#out(input)</code> æ–¹æ³•ï¼Œ<strong>ç›´æ¥</strong>è¾“å‡ºæ•°æ®ï¼Œè°ƒç”¨ <code>Node#execute(input)</code> æ–¹æ³•ï¼Œæäº¤æ•°æ®ç»™ Node ï¼Œè¿›è¡Œå¤„ç†ã€‚</li></ul><hr><p><strong>ç¬¬äºŒæ­¥</strong></p><p><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/graph/Node.java#L62" rel="external nofollow noopener noreferrer" target="_blank"><code>Node#execute</code></a> æ–¹æ³•ï¼Œè°ƒç”¨ <code>NodeProcessor#process(input, next)</code> æ–¹æ³•ï¼Œå¤„ç†æ•°æ®ã€‚</p><hr><p><strong>ç¬¬ä¸‰æ­¥</strong></p><p><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/graph/NodeProcessor.java#L34" rel="external nofollow noopener noreferrer" target="_blank"><code>NodeProcessor#process(input, next)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œä»¥ <a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/AbstractWorker.java#L62" rel="external nofollow noopener noreferrer" target="_blank"><code>AbstractWorker#process(input, next)</code></a> <strong>å®ç°</strong>æ–¹æ³•ä¸¾ä¾‹å­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 64 è¡Œï¼šå°†æ–¹æ³•å‚æ•° <code>next</code> èµ‹å€¼ç»™ <code>this.next</code> å±æ€§ã€‚<code>this.next</code> å±æ€§ï¼Œç”¨äºå°è£…çš„ <code>#onNext(OUTPUT)</code> æ–¹æ³•ï¼Œæäº¤æ•°æ®ç»™å½“å‰ Node çš„ Next ( ä¸‹é¢çš„ Node ä»¬ )ç»§ç»­å¤„ç†æ•°æ®ã€‚</li><li>ç¬¬ 67 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/AbstractWorker.java#L60" rel="external nofollow noopener noreferrer" target="_blank"><code>#onWork</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œå¤„ç†æ•°æ®ã€‚å½“ AbstractWorker <strong>æŠ½è±¡ç±»</strong>çš„å®ç°ç±»éœ€è¦ç»§ç»­è®²æ•°æ®æäº¤ç»™ Next æ—¶ï¼Œéœ€è¦åœ¨ <code>#onWork</code> æ–¹æ³•é‡Œï¼Œè°ƒç”¨ <code>#onNext(OUTPUT)</code> æ–¹æ³•ï¼Œä¾‹å¦‚ <a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ApplicationRegisterRemoteWorker.java#L46" rel="external nofollow noopener noreferrer" target="_blank"><code>ApplicationRegisterRemoteWorker#onWork(Application)</code></a> ã€‚</li></ul><hr><p><strong>ç¬¬å››æ­¥</strong></p><p><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/graph/Next.java#L50" rel="external nofollow noopener noreferrer" target="_blank"><code>Next#execute(INPUT)</code></a> æ–¹æ³•ï¼Œ<strong>å¾ªç¯</strong> WayToNode æ•°ç»„ï¼Œè¾“å…¥æ•°æ®ç»™ WayNode ï¼Œç›¸å½“äºâ€<strong>é‡å›</strong>â€œã€ç¬¬ä¸€æ­¥ã€‘ã€‚</p><h1 id="3-apm-collector-stream"><a href="#3-apm-collector-stream" class="headerlink" title="3. apm-collector-stream"></a>3. apm-collector-stream</h1><p>åœ¨æ–‡ç« çš„å¼€å¤´ï¼Œæˆ‘ä»¬æåˆ°äº† <code>apm-collector-stream</code> æ¨¡å—ï¼Œåœ¨ <code>graph</code> åŒ…çš„åŸºç¡€ä¸Šï¼Œæä¾›<strong>å¼‚æ­¥</strong>ã€<strong>è·¨èŠ‚ç‚¹</strong>ç­‰ç­‰çš„æµå¼å¤„ç†çš„å°è£…ã€‚ä¸»è¦åœ¨ WayToNode ã€NodeProcessor çš„å®ç°ç±»ä¸Šåšæ–‡ç« ã€‚</p><h2 id="3-1-WayToNode-å®ç°ç±»"><a href="#3-1-WayToNode-å®ç°ç±»" class="headerlink" title="3.1 WayToNode å®ç°ç±»"></a>3.1 WayToNode å®ç°ç±»</h2><p>æ•´ä½“ç±»å›¾å¦‚ä¸‹ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_25/10.png" alt=""></p><h3 id="3-1-1-WorkerRef"><a href="#3-1-1-WorkerRef" class="headerlink" title="3.1.1 WorkerRef"></a>3.1.1 WorkerRef</h3><p><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/WorkerRef.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.stream.worker.base.WorkerRef</code></a> ï¼ŒWorker å¼•ç”¨<strong>æŠ½è±¡ç±»</strong>ã€‚</p><p>åœ¨ <code>apm-collector-stream</code> æ¨¡å—é‡Œï¼Œæˆ‘ä»¬ä¼šå‘ç°ç±»çš„å‘½åä» Node / NodeProcessor è½¬å‘äº† Worker ï¼Ÿ<strong>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢</strong>ï¼Ÿå…³äºè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬ç‰¹æ„<del>é‡‡è®¿</del>( è¯·æ•™ )äº†å®˜æ–¹å¤§ä½¬ã€‚</p><blockquote><p>Worker æ›´å…·ä¸šåŠ¡å«ä¹‰<br>Node / Processor æ›´åæŠ€æœ¯å«ä¹‰</p></blockquote><p>ç›®å‰ï¼ŒWorkerRef æ— å…·ä½“çš„æ–¹æ³•ã€‚</p><h3 id="3-1-2-LocalAsyncWorkerRef"><a href="#3-1-2-LocalAsyncWorkerRef" class="headerlink" title="3.1.2 LocalAsyncWorkerRef"></a>3.1.2 LocalAsyncWorkerRef</h3><p><code>org.skywalking.apm.collector.stream.worker.base.LocalAsyncWorkerRef</code> ï¼Œå¼‚æ­¥ Worker å¼•ç”¨<strong>å®ç°ç±»</strong>ï¼Œæä¾›äº†<strong>å¼‚æ­¥</strong>çš„æµå¼å¤„ç†å°è£…ã€‚</p><p>æˆ‘ä»¬å›åˆ° <a href="#">ã€Œ2.2 Graph åˆ›å»ºã€</a> çš„ã€ç¬¬ä¸€æ­¥ã€‘ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/LocalAsyncWorkerRef.java#L50" rel="external nofollow noopener noreferrer" target="_blank"><code>LocalAsyncWorkerRef#in(INPUT)</code></a> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/LocalAsyncWorkerRef.java#L36" rel="external nofollow noopener noreferrer" target="_blank"><code>queueEventHandler</code></a> å±æ€§ï¼Œé˜Ÿåˆ—äº‹ä»¶å¤„ç†å™¨ã€‚åœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-queue-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Queue é˜Ÿåˆ—ç»„ä»¶ã€‹</a> æˆ‘ä»¬ä¼šè¯¦ç»†è§£æå®ƒçš„ä»£ç å®ç°ï¼Œè¿™é‡Œåªç®€å•ä»‹ç»ä¸‹ã€‚</li><li>ç¬¬ 47 è¡Œï¼šå°†è¾“å…¥çš„æ•°æ®ï¼Œä½œä¸ºâ€<strong>äº‹ä»¶</strong>â€œï¼Œæäº¤åˆ°é˜Ÿåˆ—äº‹ä»¶å¤„ç†å™¨ä¸­ï¼Œä¸å†æ‰§è¡Œåç»­é€»è¾‘ã€‚æ­¤åï¼Œé˜Ÿåˆ—äº‹ä»¶å¤„ç†å™¨ï¼Œä¼šåœ¨<strong>åå°</strong>å¤„ç†åˆ°è¯¥â€<strong>äº‹ä»¶</strong>â€œ( æ•°æ® )ï¼Œå›è°ƒ <a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/LocalAsyncWorkerRef.java#L46" rel="external nofollow noopener noreferrer" target="_blank"><code>LocalAsyncWorkerRef#execute</code></a> æ–¹æ³•ï¼Œä»è€Œæäº¤æ•°æ®åˆ° Worker ( Node )ã€‚è¯¦ç»†å‚è§ <a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-queue/collector-queue-disruptor-provider/src/main/java/org/skywalking/apm/collector/queue/disruptor/base/DisruptorEventHandler.java#L54" rel="external nofollow noopener noreferrer" target="_blank">DisruptorEventHandler#onEvent(â€¦)</a> æ–¹æ³•ã€‚</li></ul><p><strong>é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šå›è°ƒå‘¢</strong>ï¼ŸLocalAsyncWorkerRef å®ç°äº† <a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-queue/collector-queue-define/src/main/java/org/skywalking/apm/collector/queue/base/QueueExecutor.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.queue.base.QueueExecutor</code></a> æ¥å£ï¼Œå®ƒè‡ªèº«è¢«è®¾ç½®åˆ° QueueEventHandler ä¸­ï¼Œ ä½œä¸ºâ€<strong>äº‹ä»¶</strong>â€œçš„æ‰§è¡Œå™¨ã€‚</p><p>æ•´ä½“æµç¨‹å¦‚ä¸‹ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_25/11.png" alt=""></p><h3 id="3-1-3-RemoteWorkerRef"><a href="#3-1-3-RemoteWorkerRef" class="headerlink" title="3.1.3 RemoteWorkerRef"></a>3.1.3 RemoteWorkerRef</h3><p><code>org.skywalking.apm.collector.stream.worker.base.RemoteWorkerRef</code> ï¼Œè¿œç¨‹ Worker å¼•ç”¨<strong>å®ç°ç±»</strong>ï¼Œæä¾›äº†<strong>è¿œç¨‹è·¨èŠ‚ç‚¹</strong>çš„æµå¼å¤„ç†çš„å°è£…ã€‚</p><p>æˆ‘ä»¬å†å›åˆ° <a href="#">ã€Œ2.2 Graph åˆ›å»ºã€</a> çš„ã€ç¬¬ä¸€æ­¥ã€‘ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/RemoteWorkerRef.java#L53" rel="external nofollow noopener noreferrer" target="_blank"><code>RemoteWorkerRef#in(INPUT)</code></a> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li><code>remoteSenderService</code> å±æ€§ï¼Œè¿œç¨‹å‘é€æœåŠ¡ã€‚åœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-remote-module?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Remote è¿œç¨‹é€šä¿¡æœåŠ¡ã€‹ã€Œ3.2 GRPCRemoteSenderServiceã€</a> æˆ‘ä»¬ä¼šè¯¦ç»†è§£æå®ƒçš„ä»£ç å®ç°ï¼Œè¿™é‡Œåªç®€å•ä»‹ç»ä¸‹ã€‚</li><li><code>remoteWorker</code> å±æ€§ï¼Œè¿œç¨‹ Worker ã€‚åœ¨ä¸‹æ–‡ä¼šè¯¦ç»†åˆ†äº«å®ƒçš„å®ç°ã€‚</li><li>ç¬¬ 56 è¡Œï¼šè°ƒç”¨ <code>RemoteSenderService#send(...)</code> æ–¹æ³•ï¼Œæ ¹æ®è¿œç¨‹ Worker çš„ <a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/Selector.java" rel="external nofollow noopener noreferrer" target="_blank">Selector é€‰æ‹©å™¨</a>ï¼Œé€‰æ‹©ä¸€ä¸ª Worker è¿›è¡Œå‘é€ã€‚</li><li>ç¬¬ 58 è‡³ 60 è¡Œï¼šå½“é€‰æ‹©çš„ Worker ä¸ºæœ¬åœ°æ¨¡å¼( <a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-remote/collector-remote-define/src/main/java/org/skywalking/apm/collector/remote/service/RemoteSenderService.java#L36" rel="external nofollow noopener noreferrer" target="_blank">Mode</a> )æ—¶ï¼Œè°ƒç”¨ <code>#out(INPUT)</code> æ–¹æ³•ï¼Œæäº¤æ•°æ®åˆ°æœ¬åœ°çš„ Worker ( Node )ã€‚</li></ul><h2 id="3-2-NodeProcessor-å®ç°ç±»"><a href="#3-2-NodeProcessor-å®ç°ç±»" class="headerlink" title="3.2 NodeProcessor å®ç°ç±»"></a>3.2 NodeProcessor å®ç°ç±»</h2><p>æ•´ä½“ç±»å›¾å¦‚ä¸‹ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_25/12.png" alt=""></p><ul><li><a href="todo"><code>org.skywalking.apm.collector.stream.worker.base.Provider</code></a> ï¼ŒWorker ä¾›åº”è€…<strong>æ¥å£</strong>ï¼Œç”¨äºåˆ›å»º Worker å’Œ WorkerRef å¯¹è±¡çš„<strong>å·¥å‚</strong>ã€‚</li></ul><h3 id="3-2-1-AbstractWorker"><a href="#3-2-1-AbstractWorker" class="headerlink" title="3.2.1 AbstractWorker"></a>3.2.1 AbstractWorker</h3><p>AbstractWorker çš„ä»£ç å®ç°ï¼Œåœ¨ <a href="#">ã€Œ2.2 Graph å¯åŠ¨ã€</a> å·²ç»è¯¦ç»†è§£æã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/AbstractWorkerProvider.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.stream.worker.base.AbstractWorkerProvider</code></a> ï¼ŒWorker ä¾›åº”è€…<strong>æŠ½è±¡ç±»</strong>ï¼Œå®šä¹‰äº† <a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/AbstractWorkerProvider.java#L46" rel="external nofollow noopener noreferrer" target="_blank"><code>#workerInstance(ModuleManager)</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œç”¨äºåˆ›å»º Worker å¯¹è±¡ã€‚</p><h3 id="3-2-2-AbstractLocalAsyncWorker"><a href="#3-2-2-AbstractLocalAsyncWorker" class="headerlink" title="3.2.2 AbstractLocalAsyncWorker"></a>3.2.2 AbstractLocalAsyncWorker</h3><p><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/AbstractLocalAsyncWorker.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.stream.worker.base.AbstractLocalAsyncWorker</code></a> ï¼Œå¼‚æ­¥ Worker <strong>æŠ½è±¡ç±»</strong>ã€‚</p><p>ç›®å‰ï¼ŒAbstractLocalAsyncWorker æ— å…·ä½“çš„æ–¹æ³•ã€‚</p><p>å®é™…ä½¿ç”¨æ—¶ï¼Œç»§æ‰¿ AbstractLocalAsyncWorker ç±»ï¼Œå®ç° <code>#work(INPUT)</code> æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š<a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ApplicationRegisterSerialWorker.java#L56" rel="external nofollow noopener noreferrer" target="_blank">ApplicationRegisterSerialWorker</a> ã€‚</p><hr><p><code>org.skywalking.apm.collector.stream.worker.base.AbstractLocalAsyncWorkerProvider</code> ï¼ŒLocalAsyncWorker ä¾›åº”è€…<strong>æŠ½è±¡ç±»</strong>ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/AbstractLocalAsyncWorkerProvider.java#L35" rel="external nofollow noopener noreferrer" target="_blank"><code>queueCreatorService</code></a> å±æ€§ï¼Œé˜Ÿåˆ—åˆ›å»ºæœåŠ¡ï¼Œç”¨äºåˆ›å»º QueueEventHandler å¯¹è±¡ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/AbstractLocalAsyncWorkerProvider.java#L40" rel="external nofollow noopener noreferrer" target="_blank"><code>#queueSize()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œå£°æ˜é˜Ÿåˆ—å¤§å°ã€‚</li><li><a href=""><code>#create(WorkerCreateListener)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œåˆ›å»º AbstractLocalAsyncWorker å’Œ LocalAsyncWorkerRef å¯¹è±¡ã€‚<ul><li>ç¬¬ 51 è¡Œï¼šåˆ›å»º AbstractLocalAsyncWorker <strong>å®ç°ç±»</strong>çš„å¯¹è±¡ã€‚å‚è§ <a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ApplicationRegisterSerialWorker.java#L90" rel="external nofollow noopener noreferrer" target="_blank">ApplicationRegisterSerialWorker.Factory#workerInstance(ModuleManager)</a> æ–¹æ³•ã€‚</li><li>ç¬¬ 54 è¡Œï¼šæ·»åŠ  AbstractLocalAsyncWorker åˆ° WorkerCreateListener ( Worker åˆ›å»ºç›‘å¬å™¨ )ã€‚WorkerCreateListener åœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆäºŒï¼‰ã€‹ã€Œ4.1 WorkerCreateListenerã€</a> è¯¦ç»†è§£æã€‚</li><li>ç¬¬ 57 è¡Œï¼šåˆ›å»º LocalAsyncWorkerRef å¯¹è±¡ã€‚</li><li>ç¬¬ 60 è¡Œï¼šè°ƒç”¨ <code>QueueCreatorService#create(...)</code> æ–¹æ³•ï¼Œåˆ›å»º QueueEventHandler å¯¹è±¡ï¼Œ<strong>å¹¶è®¾ç½® LocalAsyncWorkerRef ä½œä¸ºå®ƒçš„æ‰§è¡Œå™¨</strong>ã€‚</li><li>ç¬¬ 63 è¡Œï¼šè®¾ç½® LocalAsyncWorkerRef çš„ QueueEventHandler å±æ€§ã€‚</li></ul></li></ul><h3 id="3-2-3-AbstractRemoteWorker"><a href="#3-2-3-AbstractRemoteWorker" class="headerlink" title="3.2.3 AbstractRemoteWorker"></a>3.2.3 AbstractRemoteWorker</h3><p><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/AbstractRemoteWorker.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.stream.worker.base.AbstractRemoteWorker</code></a> ï¼Œè¿œç¨‹ Worker <strong>æŠ½è±¡ç±»</strong>ï¼Œå®šä¹‰äº† <a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/AbstractRemoteWorker.java#L45" rel="external nofollow noopener noreferrer" target="_blank"><code>#selector()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œè·å¾—é€‰æ‹©å™¨ã€‚RemoteSenderService æ ¹æ®é€‰æ‹©å™¨ï¼Œè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/service/selector/RemoteClientSelector.java#L31" rel="external nofollow noopener noreferrer" target="_blank"><code>RemoteClientSelector#select(...)</code></a> æ–¹æ³•ï¼Œé€‰æ‹©å¥½è¿œç¨‹èŠ‚ç‚¹ï¼Œè€Œåè¿›è¡Œå‘é€æ•°æ®ã€‚</p><p>å®é™…ä½¿ç”¨æ—¶ï¼Œç»§æ‰¿ AbstractLocalAsyncWorker ç±»ï¼Œå®ç° <code>#work(INPUT)</code> æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š<a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ApplicationRegisterRemoteWorker.java" rel="external nofollow noopener noreferrer" target="_blank">ApplicationRegisterRemoteWorker</a> ã€‚</p><hr><p><code>org.skywalking.apm.collector.stream.worker.base.AbstractRemoteWorkerProvider</code> ï¼ŒAbstractRemoteWorker ä¾›åº”è€…<strong>æŠ½è±¡ç±»</strong>ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/AbstractRemoteWorkerProvider.java#L40" rel="external nofollow noopener noreferrer" target="_blank"><code>remoteSenderService</code></a> å±æ€§ï¼Œè¿œç¨‹å‘é€æœåŠ¡ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/base/AbstractRemoteWorkerProvider.java#L56" rel="external nofollow noopener noreferrer" target="_blank"><code>#create(WorkerCreateListener)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œåˆ›å»º AbstractRemoteWorker å’Œ RemoteWorkerRef å¯¹è±¡ã€‚<ul><li>ç¬¬ 58 è¡Œï¼šåˆ›å»º AbstractRemoteWorker <strong>å®ç°ç±»</strong>çš„å¯¹è±¡ã€‚å‚è§ <a href="https://github.com/YunaiV/skywalking/blob/a0d559d08e87879a08bd7269b9651188083ce05e/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/register/ApplicationRegisterRemoteWorker.java#L61" rel="external nofollow noopener noreferrer" target="_blank">ApplicationRegisterRemoteWorker.Factory#workerInstance(ModuleManager)</a> æ–¹æ³•ã€‚</li><li>ç¬¬ 61 è¡Œï¼šæ·»åŠ  AbstractLocalAsyncWorker åˆ° WorkerCreateListener ( Worker åˆ›å»ºç›‘å¬å™¨ )ã€‚WorkerCreateListener åœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆäºŒï¼‰ã€‹ã€Œ4.1 WorkerCreateListenerã€</a> è¯¦ç»†è§£æã€‚</li><li>ç¬¬ 64 è¡Œï¼šåˆ›å»º RemoteWorkerRef å¯¹è±¡ã€‚</li></ul></li></ul><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>å‘¼å‘¼ï¼Œè›®å—¨çš®çš„ã€‚å¡äº†ä¸€ä¸ªå‘¨æœ«ï¼Œå·®ç‚¹åˆå •è½äº†ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_25/13.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸€æ³¢æœ‹å‹åœˆå¯å¥½ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/collector-streaming-first/&quot;&gt;http://www.iocoder.cn/SkyWalking/collector-streaming-first
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” Collector Storage å­˜å‚¨ç»„ä»¶</title>
    <link href="http://www.iocoder.cn/SkyWalking/collector-storage-module/"/>
    <id>http://www.iocoder.cn/SkyWalking/collector-storage-module/</id>
    <published>2020-08-19T16:00:00.000Z</published>
    <updated>2017-12-23T23:29:33.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">http://www.iocoder.cn/SkyWalking/collector-storage-module/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">2. apm-collector-core</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">2.1 Table</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">2.2 TableDefine</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">2.3 Data</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">3. collector-storage-define</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">3.1 StorageModule</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">3.2 table åŒ…</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">3.3 StorageInstaller</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">3.4 dao åŒ…</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">4. collector-storage-h2-provider</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">5. collector-storage-es-provider</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">5.1 StorageModuleEsProvider</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">5.2 define åŒ…</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">5.3 dao åŒ…</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">5.4 DataTTLKeeperTimer</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>SkyWalking Collector Storage å­˜å‚¨ç»„ä»¶</strong>ã€‚é¡¾åæ€ä¹‰ï¼Œè´Ÿè´£å°†è°ƒç”¨é“¾è·¯ã€åº”ç”¨ã€åº”ç”¨å®ä¾‹ç­‰ç­‰ä¿¡æ¯å­˜å‚¨åˆ°å­˜å‚¨å™¨ï¼Œä¾‹å¦‚ï¼ŒES ã€H2 ã€‚</p><blockquote><p>å‹æƒ…æç¤ºï¼šå»ºè®®å…ˆé˜…è¯» <a href="http://www.iocoder.cn/SkyWalking/collector-init/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector åˆå§‹åŒ–ã€‹</a> ï¼Œä»¥äº†è§£ Collector ç»„ä»¶ä½“ç³»ã€‚</p><p>FROM <a href="https://github.com/apache/incubating-skywalking" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/apache/incubating-skywalking</a><br><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_20/01.jpeg" alt=""></p></blockquote><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ•´ä½“çš„é¡¹ç›®ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_20/02.png" alt=""></p><ul><li><code>apm-collector-core</code> çš„ <code>data</code> å’Œ <code>define</code> <strong>åŒ…</strong> ï¼šæ•°æ®çš„æŠ½è±¡ã€‚ </li><li><code>collector-storage-define</code> ï¼šå®šä¹‰å­˜å‚¨ç»„ä»¶æ¥å£ã€‚</li><li><code>collector-storage-h2-provider</code> ï¼šåŸºäº H2 çš„ å­˜å‚¨ç»„ä»¶å®ç°ã€‚<strong>è¯¥å®ç°æ˜¯å•æœºç‰ˆï¼Œå»ºè®®ä»…ç”¨äº SkyWalking å¿«é€Ÿä¸Šæ‰‹ï¼Œç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨</strong>ã€‚</li><li><code>collector-storage-es-provider</code> ï¼šåŸºäº Elasticsearch çš„é›†ç¾¤ç®¡ç†å®ç°ã€‚<strong>ç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨</strong>ã€‚</li></ul><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä»<strong>æ¥å£åˆ°å®ç°</strong>çš„é¡ºåºè¿›è¡Œåˆ†äº«ã€‚</p><h1 id="2-apm-collector-core"><a href="#2-apm-collector-core" class="headerlink" title="2. apm-collector-core"></a>2. apm-collector-core</h1><p><code>apm-collector-core</code> çš„ <code>data</code> å’Œ <code>define</code> <strong>åŒ…</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_20/03.png" alt=""></p><p>æˆ‘ä»¬å¯¹ç±»è¿›è¡Œæ¢³ç†åˆ†ç±»ï¼Œå¦‚ä¸‹å›¾ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_20/04.png" alt=""></p><ul><li>Table ï¼šData å’Œ TableDefine ä¹‹é—´çš„æ¡¥æ¢ï¼Œæ¯ä¸ª Table å®šä¹‰äº†è¯¥è¡¨çš„<strong>è¡¨å</strong>ï¼Œ<strong>å­—æ®µåä»¬</strong>ã€‚</li><li>TableDefine ï¼šTable çš„è¯¦ç»†å®šä¹‰ï¼ŒåŒ…æ‹¬<strong>è¡¨å</strong>ï¼Œ<strong>å­—æ®µå®šä¹‰</strong>( ColumnDefine )ä»¬ã€‚åœ¨ä¸‹æ–‡ä¸­ï¼Œ<a href="https://github.com/apache/incubator-skywalking/blob/15328202b8b7df89a609885d9110361ff29ce668/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/apache/skywalking/apm/collector/storage/StorageInstaller.java" rel="external nofollow noopener noreferrer" target="_blank">StorageInstaller</a> ä¼šåŸºäº TableDefine åˆå§‹åŒ–è¡¨çš„ç›¸å…³ä¿¡æ¯ã€‚</li><li>Data ï¼šæ•°æ®ï¼ŒåŒ…æ‹¬<strong>ä¸€æ¡</strong>æ•°æ®çš„æ•°æ®å€¼ä»¬å’Œæ•°æ®å­—æ®µ( Column )ä»¬ã€‚åœ¨ä¸‹æ–‡ä¸­ï¼Œ<a href="https://github.com/apache/incubator-skywalking/blob/15328202b8b7df89a609885d9110361ff29ce668/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/apache/skywalking/apm/collector/storage/base/dao/DAO.java" rel="external nofollow noopener noreferrer" target="_blank">Dao</a> ä¼šå­˜å‚¨ Data åˆ°å­˜å‚¨å™¨ä¸­ã€‚å¦å¤–ï¼Œåœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆä¸€ï¼‰ã€‹</a> ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¼šçœ‹åˆ°å¯¹ Data çš„æµå¼å¤„ç†<strong>é€šç”¨</strong>å°è£…ã€‚</li></ul><h2 id="2-1-Table"><a href="#2-1-Table" class="headerlink" title="2.1 Table"></a>2.1 Table</h2><p><a href="https://github.com/YunaiV/skywalking/blob/beebd8f8f419ca0b25dc086c71a9b1c580a083d4/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/CommonTable.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.core.data.CommonTable</code></a> ï¼Œé€šç”¨è¡¨ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/beebd8f8f419ca0b25dc086c71a9b1c580a083d4/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/CommonTable.java#L33" rel="external nofollow noopener noreferrer" target="_blank"><code>TABLE_TYPE</code></a> <strong>é™æ€</strong>å±æ€§ï¼Œè¡¨ç±»å‹ã€‚ç›®å‰åªæœ‰ ES å­˜å‚¨ç»„ä»¶ä½¿ç”¨åˆ°ï¼Œä¸‹æ–‡è¯¦ç»†è§£æã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/beebd8f8f419ca0b25dc086c71a9b1c580a083d4/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/CommonTable.java#L37" rel="external nofollow noopener noreferrer" target="_blank"><code>COLUMN_</code></a> å‰ç¼€çš„<strong>é™æ€</strong>å±æ€§ï¼Œé€šç”¨çš„å­—æ®µåã€‚</li></ul><p>åœ¨ <code>collector-storage-define</code> çš„ <a href="https://github.com/YunaiV/skywalking/tree/beebd8f8f419ca0b25dc086c71a9b1c580a083d4/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table" rel="external nofollow noopener noreferrer" target="_blank"><code>table</code></a> <strong>åŒ…</strong>ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰€æœ‰ Table ç±»ï¼Œä»¥ <code>&quot;Table&quot;</code> ç»“å°¾ã€‚æ¯ä¸ª Table çš„è¡¨åï¼Œåœ¨æ¯ä¸ªå®ç°ç±»é‡Œï¼Œä¾‹å¦‚ <a href="https://github.com/YunaiV/skywalking/blob/beebd8f8f419ca0b25dc086c71a9b1c580a083d4/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/register/ApplicationTable.java" rel="external nofollow noopener noreferrer" target="_blank">ApplicationTable</a> ã€‚</p><h2 id="2-2-TableDefine"><a href="#2-2-TableDefine" class="headerlink" title="2.2 TableDefine"></a>2.2 TableDefine</h2><p><code>org.skywalking.apm.collector.core.data.TableDefine</code> ï¼Œè¡¨å®šä¹‰<strong>æŠ½è±¡ç±»</strong>ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/beebd8f8f419ca0b25dc086c71a9b1c580a083d4/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/TableDefine.java#L34" rel="external nofollow noopener noreferrer" target="_blank"><code>name</code></a> å±æ€§ï¼Œè¡¨åã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/beebd8f8f419ca0b25dc086c71a9b1c580a083d4/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/TableDefine.java#L38" rel="external nofollow noopener noreferrer" target="_blank"><code>columnDefines</code></a> å±æ€§ï¼ŒColumnDefineæ•°ç»„ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/578ea4f66f11bdfe5dcda25f574a1ed57ca47d24/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/TableDefine.java#L48" rel="external nofollow noopener noreferrer" target="_blank"><code>#initialize()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œåˆå§‹åŒ–è¡¨å®šä¹‰ã€‚ä¾‹å¦‚ï¼š<a href="https://github.com/YunaiV/skywalking/blob/578ea4f66f11bdfe5dcda25f574a1ed57ca47d24/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/define/ApplicationEsTableDefine.java#L38" rel="external nofollow noopener noreferrer" target="_blank">ApplicationEsTableDefine</a> ã€‚</li></ul><p>ä¸åŒçš„å­˜å‚¨ç»„ä»¶å®ç°ï¼Œæœ‰ä¸åŒçš„ TableDefine å®ç°ç±»ï¼Œå¦‚ä¸‹å›¾ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_20/05.png" alt=""></p><ul><li><p>ElasticSearchTableDefine ï¼šåŸºäº Elasticsearch çš„è¡¨å®šä¹‰<strong>æŠ½è±¡ç±»</strong>ï¼Œåœ¨ <code>collector-storage-es-provider</code> çš„ <a href="https://github.com/YunaiV/skywalking/tree/beebd8f8f419ca0b25dc086c71a9b1c580a083d4/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/define" rel="external nofollow noopener noreferrer" target="_blank"><code>define</code></a> <strong>åŒ…</strong>ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<strong>æ‰€æœ‰</strong> ES çš„ TableDefine ç±»ã€‚</p></li><li><p>H2TableDefine ï¼šåŸºäº H2 çš„è¡¨å®šä¹‰<strong>æŠ½è±¡ç±»</strong>ï¼Œåœ¨ <code>collector-storage-h2-provider</code> çš„ <a href="https://github.com/YunaiV/skywalking/tree/beebd8f8f419ca0b25dc086c71a9b1c580a083d4/apm-collector/apm-collector-storage/collector-storage-h2-provider/src/main/java/org/skywalking/apm/collector/storage/h2/define" rel="external nofollow noopener noreferrer" target="_blank"><code>define</code></a> <strong>åŒ…</strong>ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<strong>æ‰€æœ‰</strong> H2 çš„ TableDefine ç±»ã€‚</p></li></ul><h3 id="2-2-1-ColumnDefine"><a href="#2-2-1-ColumnDefine" class="headerlink" title="2.2.1 ColumnDefine"></a>2.2.1 ColumnDefine</h3><p> <a href="https://github.com/YunaiV/skywalking/blob/beebd8f8f419ca0b25dc086c71a9b1c580a083d4/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/ColumnDefine.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.core.data.ColumnDefine</code></a> ï¼Œå­—æ®µå®šä¹‰<strong>æŠ½è±¡ç±»</strong>ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/beebd8f8f419ca0b25dc086c71a9b1c580a083d4/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/ColumnDefine.java#L31" rel="external nofollow noopener noreferrer" target="_blank"><code>name</code></a> å±æ€§ï¼Œå­—æ®µåã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/beebd8f8f419ca0b25dc086c71a9b1c580a083d4/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/ColumnDefine.java#L35" rel="external nofollow noopener noreferrer" target="_blank"><code>type</code></a> å±æ€§ï¼Œå­—æ®µç±»å‹ã€‚</li></ul><p>åœ¨ <code>collector-storage-xxx-provider</code> æ¨¡å—ä¸­ï¼ŒH2ColumnDefine ã€ElasticSearchColumnDefine å®ç° ColumnDefine ã€‚</p><h3 id="2-2-2-Loader"><a href="#2-2-2-Loader" class="headerlink" title="2.2.2 Loader"></a>2.2.2 Loader</h3><p>æ¶‰åŠåˆ°çš„ç±»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_20/06.png" alt=""></p><p><a href="https://github.com/YunaiV/skywalking/blob/0aa5e6a49c1f29b43824ebabf6bb7d76b80e3eb7/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/StorageDefineLoader.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.core.data.StorageDefineLoader</code></a> ï¼Œè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/0aa5e6a49c1f29b43824ebabf6bb7d76b80e3eb7/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/define/DefinitionLoader.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.core.define.DefinitionLoader</code></a> ï¼Œä» <a href="https://github.com/YunaiV/skywalking/blob/0aa5e6a49c1f29b43824ebabf6bb7d76b80e3eb7/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/StorageDefinitionFile.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.core.data.StorageDefinitionFile</code></a> ä¸­ï¼ŒåŠ è½½ TableDefine å®ç°ç±»æ•°ç»„ã€‚</p><p>å¦å¤–ï¼Œåœ¨ <code>collector-storage-es-provider</code> å’Œ <code>collector-storage-h2-provider</code> é‡Œéƒ½æœ‰ <code>storage.define</code> æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_20/07.png" alt=""></p><ul><li>StorageDefinitionFile å£°æ˜äº†è¯»å–è¯¥æ–‡ä»¶ã€‚</li><li><strong>æ³¨æ„</strong>ï¼ŒDefinitionLoader åœ¨åŠ è½½æ—¶ï¼Œä¸¤ä¸ªæ–‡ä»¶éƒ½ä¼šè¢«è¯»å–ï¼Œæœ€ç»ˆåœ¨ <code>StorageInstaller#defineFilter(List&lt;TableDefine&gt;)</code> æ–¹æ³•ï¼Œè¿›è¡Œè¿‡æ»¤ã€‚</li></ul><p>ä»£ç æ¯”è¾ƒç®€å•ï¼Œä¸­æ–‡æ³¨é‡Šå·²åŠ ï¼Œèƒ–å‹è‡ªå·±é˜…è¯»ç†è§£ä¸‹ã€‚</p><h2 id="2-3-Data"><a href="#2-3-Data" class="headerlink" title="2.3 Data"></a>2.3 Data</h2><p><code>org.skywalking.apm.collector.core.data.Data</code>  ï¼Œæ•°æ®<strong>æŠ½è±¡ç±»</strong>ã€‚</p><ul><li><a href=""><code>dataXXX</code></a> <strong>å‰ç¼€</strong>çš„å±æ€§ï¼Œå­—æ®µå€¼ä»¬ã€‚<ul><li><a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/Data.java#L30" rel="external nofollow noopener noreferrer" target="_blank"><code>dataStrings</code></a> å±æ€§çš„ç¬¬ä¸€ä½ï¼Œæ˜¯ <strong>ID</strong> å±æ€§ã€‚å‚è§ <a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/Data.java#L51" rel="external nofollow noopener noreferrer" target="_blank"><strong>æ„é€ æ–¹æ³•</strong></a>çš„ã€ç¬¬ 51 è¡Œã€‘ æˆ–è€… <a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/Data.java#L142" rel="external nofollow noopener noreferrer" target="_blank"><code>#setId(id)</code></a> æ–¹æ³•ã€‚</li></ul></li><li><a href=""><code>xxxColumns</code></a> <strong>åç¼€</strong>çš„å±æ€§ï¼Œå­—æ®µ( Column )ä»¬ã€‚</li><li>é€šè¿‡ä¸Šè¿°ä¸¤ç§å±æ€§ + è‡ªèº«ç±»ï¼Œå¯ä»¥ç¡®å®šä¸€æ¡æ•°æ®è®°å½•çš„è¡¨ã€å­—æ®µç±»å‹ã€å­—æ®µåã€å­—æ®µå€¼ã€‚</li><li><strong>ç»§æ‰¿</strong> <a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/EndOfBatchQueueMessage.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.core.data.EndOfBatchQueueMessage</code></a> ï¼Œå¸¦æ˜¯å¦æ¶ˆæ¯æ‰¹å¤„ç†çš„æœ€åä¸€æ¡æ ‡è®°çš„<strong>æ¶ˆæ¯æŠ½è±¡ç±»</strong>ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/EndOfBatchQueueMessage.java#L31" rel="external nofollow noopener noreferrer" target="_blank"><code>endOfBatch</code></a> å±æ€§ï¼Œåœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆäºŒï¼‰ã€‹ã€Œ3. AggregationWorkerã€</a> è¯¦ç»†è§£æã€‚<ul><li><strong>ç»§æ‰¿</strong> <a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/AbstractHashMessage.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.core.data.AbstractHashMessage</code></a> ï¼Œå¸¦å“ˆå¸Œç çš„<strong>æ¶ˆæ¯æŠ½è±¡ç±»</strong>ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/AbstractHashMessage.java#L38" rel="external nofollow noopener noreferrer" target="_blank"><code>hashCode</code></a> å±æ€§ï¼Œåœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆäºŒï¼‰ã€‹ã€Œ3. AggregationWorkerã€</a> è¯¦ç»†è§£æã€‚</li></ul></li><li><a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/Data.java#L154" rel="external nofollow noopener noreferrer" target="_blank"><code>#mergeData(Data)</code></a> æ–¹æ³•ï¼Œåˆå¹¶ä¼ å…¥çš„æ•°æ®åˆ°è‡ªèº«ã€‚è¯¥æ–¹æ³•è¢« <a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-stream/src/main/java/org/skywalking/apm/collector/stream/worker/impl/AggregationWorker.java#L94" rel="external nofollow noopener noreferrer" target="_blank"><code>AggregationWorker#aggregate(message)</code></a> è°ƒç”¨ï¼Œåœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆäºŒï¼‰ã€‹ã€Œ3. AggregationWorkerã€</a> è¯¦ç»†è§£æã€‚</li></ul><p>åœ¨ <code>collector-storage-define</code> çš„ <a href="https://github.com/YunaiV/skywalking/tree/beebd8f8f419ca0b25dc086c71a9b1c580a083d4/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table" rel="external nofollow noopener noreferrer" target="_blank"><code>table</code></a> <strong>åŒ…</strong>ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰€æœ‰ Data ç±»ï¼Œ<strong>é</strong> <code>&quot;Table&quot;</code> ç»“å°¾ï¼Œä¾‹å¦‚ <a href="https://github.com/YunaiV/skywalking/blob/beebd8f8f419ca0b25dc086c71a9b1c580a083d4/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/register/Application.java" rel="external nofollow noopener noreferrer" target="_blank">Application</a> ã€‚</p><h3 id="2-3-1-Column"><a href="#2-3-1-Column" class="headerlink" title="2.3.1 Column"></a>2.3.1 Column</h3><p><a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/Column.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.core.data.Column</code></a> ï¼Œå­—æ®µã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/Column.java#L31" rel="external nofollow noopener noreferrer" target="_blank"><code>name</code></a> å±æ€§ï¼Œå­—æ®µåã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/Column.java#L35" rel="external nofollow noopener noreferrer" target="_blank"><code>operation</code></a> å±æ€§ï¼Œæ“ä½œ( Operation )ã€‚</li></ul><h3 id="2-3-2-Operation"><a href="#2-3-2-Operation" class="headerlink" title="2.3.2 Operation"></a>2.3.2 Operation</h3><p><a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/Operation.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.core.data.Operation</code></a> ï¼Œæ“ä½œ<strong>æ¥å£</strong>ã€‚ç”¨äºä¸¤ä¸ªå€¼ä¹‹é—´çš„æ“ä½œï¼Œä¾‹å¦‚ï¼Œç›¸åŠ ç­‰ç­‰ã€‚ç›®å‰å®ç°ç±»æœ‰ï¼š</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/operator/AddOperation.java" rel="external nofollow noopener noreferrer" target="_blank">AddOperation</a> ï¼šå€¼ç›¸åŠ æ“ä½œã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/operator/CoverOperation.java" rel="external nofollow noopener noreferrer" target="_blank">CoverOperation</a> ï¼šå€¼è¦†ç›–æ“ä½œï¼Œå³ä»¥æ–°å€¼ä¸ºè¿”å›ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/data/operator/NonOperation.java" rel="external nofollow noopener noreferrer" target="_blank">NonOperation</a> ï¼šç©ºæ“ä½œï¼Œå³ä»¥è€å€¼ä¸ºè¿”å›ã€‚</li></ul><h1 id="3-collector-storage-define"><a href="#3-collector-storage-define" class="headerlink" title="3. collector-storage-define"></a>3. collector-storage-define</h1><p><code>collector-cluster-define</code> ï¼šå®šä¹‰å­˜å‚¨ç»„ä»¶æ¥å£ã€‚é¡¹ç›®ç»“æ„å¦‚ä¸‹ ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_20/08.png" alt=""></p><h2 id="3-1-StorageModule"><a href="#3-1-StorageModule" class="headerlink" title="3.1 StorageModule"></a>3.1 StorageModule</h2><p><code>org.skywalking.apm.collector.storage.StorageModule</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Module.java" rel="external nofollow noopener noreferrer" target="_blank">Module</a> æŠ½è±¡ç±»ï¼Œé›†ç¾¤ç®¡ç† Module ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/StorageModule.java#L67" rel="external nofollow noopener noreferrer" target="_blank"><code>#name()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›æ¨¡å—åä¸º <code>&quot;storage&quot;</code> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/StorageModule.java#L71" rel="external nofollow noopener noreferrer" target="_blank"><code>#services()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å› Service ç±»åï¼šåœ¨ <a href="https://github.com/YunaiV/skywalking/tree/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/dao" rel="external nofollow noopener noreferrer" target="_blank">org.skywalking.apm.collector.storage.dao</a> <strong>åŒ…</strong>ä¸‹çš„æ‰€æœ‰ç±» å’Œ IBatchDAOã€‚</p><h2 id="3-2-table-åŒ…"><a href="#3-2-table-åŒ…" class="headerlink" title="3.2 table åŒ…"></a>3.2 table åŒ…</h2><p>åœ¨ <a href="https://github.com/YunaiV/skywalking/tree/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.table</code></a> åŒ…ä¸‹ï¼Œå®šä¹‰äº†å­˜å‚¨æ¨¡å—æ‰€æœ‰çš„ Table å’Œ Data å®ç°ç±»ã€‚</p><h2 id="3-3-StorageInstaller"><a href="#3-3-StorageInstaller" class="headerlink" title="3.3 StorageInstaller"></a>3.3 StorageInstaller</h2><p><code>org.skywalking.apm.collector.storage.StorageInstaller</code> ï¼Œå­˜å‚¨å®‰è£…å™¨<strong>æŠ½è±¡ç±»</strong>ï¼ŒåŸºäº TableDefine ï¼Œåˆå§‹åŒ–å­˜å‚¨ç»„ä»¶çš„è¡¨ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/2b700457124e7d4f788343d8bcd9a03d2e273aca/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/StorageInstaller.java#L71" rel="external nofollow noopener noreferrer" target="_blank"><code>#defineFilter(List&lt;TableDefine&gt;)</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œè¿‡æ»¤ TableDefine æ•°ç»„ä¸­ï¼Œéè‡ªèº«éœ€è¦çš„ã€‚ä¾‹å¦‚è¯´ï¼ŒElasticSearchStorageInstaller è¿‡æ»¤åï¼Œåªä¿ç•™ ElasticSearchTableDefine å¯¹è±¡ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/2b700457124e7d4f788343d8bcd9a03d2e273aca/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/StorageInstaller.java#L81" rel="external nofollow noopener noreferrer" target="_blank"><code>#isExists(Client, TableDefine)</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œåˆ¤æ–­è¡¨æ˜¯å¦å­˜åœ¨ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/2b700457124e7d4f788343d8bcd9a03d2e273aca/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/StorageInstaller.java#L81" rel="external nofollow noopener noreferrer" target="_blank"><code>#deleteTable(Client, TableDefine)</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œåˆ é™¤è¡¨ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/2b700457124e7d4f788343d8bcd9a03d2e273aca/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/StorageInstaller.java#L81" rel="external nofollow noopener noreferrer" target="_blank"><code>#createTable(Client, TableDefine)</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œåˆ›å»ºè¡¨ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/2b700457124e7d4f788343d8bcd9a03d2e273aca/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/StorageInstaller.java#L39" rel="external nofollow noopener noreferrer" target="_blank"><code>#install(Client)</code></a> æ–¹æ³•ï¼ŒåŸºäº TableDefine ï¼Œåˆå§‹åŒ–å­˜å‚¨ç»„ä»¶çš„è¡¨ã€‚<ul><li>è¯¥æ–¹æ³•ä¼šè¢« StorageModuleH2Provider æˆ– StorageModuleEsProvider å¯åŠ¨æ—¶è°ƒç”¨ã€‚</li></ul></li></ul><h2 id="3-4-dao-åŒ…"><a href="#3-4-dao-åŒ…" class="headerlink" title="3.4 dao åŒ…"></a>3.4 dao åŒ…</h2><p>åœ¨ <code>collector-storage-define</code> é¡¹ç›®ç»“æ„å›¾ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸€å…±æœ‰<strong>ä¸¤</strong>ä¸ª <code>bao</code> åŒ…ï¼š</p><ul><li><code>org.skywalking.apm.collector.storage.base.dao</code> ï¼Œ<strong>ç³»ç»Ÿ</strong>çš„ DAO æ¥å£ã€‚</li><li><code>org.skywalking.apm.collector.storage.dao</code> ï¼Œ<strong>ä¸šåŠ¡</strong>çš„ DAO æ¥å£ã€‚<ul><li><strong>ç»§æ‰¿</strong>ç³»ç»Ÿçš„ DAO æ¥å£ã€‚</li><li>è¢« <code>collector-storage-xxx-provider</code> çš„ <code>dao</code> åŒ…<strong>å®ç°</strong>ã€‚</li></ul></li></ul><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_20/09.png" alt=""></p><h3 id="3-4-1-ç³»ç»Ÿ-DAO"><a href="#3-4-1-ç³»ç»Ÿ-DAO" class="headerlink" title="3.4.1 ç³»ç»Ÿ DAO"></a>3.4.1 ç³»ç»Ÿ DAO</h3><p><a href="https://github.com/YunaiV/skywalking/blob/2b700457124e7d4f788343d8bcd9a03d2e273aca/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/base/dao/DAO.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.base.dao.DAO</code></a> ï¼Œç»§æ‰¿ <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Service.java" rel="external nofollow noopener noreferrer" target="_blank">Service</a> æ¥å£ï¼ŒDAO <strong>æ¥å£</strong>ã€‚</p><p>æ— ä»»ä½•æ–¹æ³•ã€‚</p><h4 id="3-4-1-1-AbstractDAO"><a href="#3-4-1-1-AbstractDAO" class="headerlink" title="3.4.1.1 AbstractDAO"></a>3.4.1.1 AbstractDAO</h4><p><a href="https://github.com/YunaiV/skywalking/blob/2b700457124e7d4f788343d8bcd9a03d2e273aca/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/base/dao/AbstractDAO.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.base.dao.AbstractDAO</code></a> ï¼Œå®ç° DAO æ¥å£ï¼ŒDAO æŠ½è±¡åŸºç±»ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/2b700457124e7d4f788343d8bcd9a03d2e273aca/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/base/dao/AbstractDAO.java#L33" rel="external nofollow noopener noreferrer" target="_blank"><code>client</code></a> å±æ€§ï¼Œæ•°æ®æ“ä½œå®¢æˆ·ç«¯ã€‚ä¾‹å¦‚ï¼ŒH2Client ã€ElasticSearchClient ã€‚</li></ul><p>åœ¨ <code>collector-storage-xxx-provider</code> æ¨¡å—ä¸­ï¼ŒH2DAO ã€EsDAO å®ç° AbstractDAO ã€‚</p><h4 id="3-4-1-2-IPersistenceDAO"><a href="#3-4-1-2-IPersistenceDAO" class="headerlink" title="3.4.1.2 IPersistenceDAO"></a>3.4.1.2 IPersistenceDAO</h4><p><code>org.skywalking.apm.collector.storage.base.dao.IPersistenceDAO</code> ï¼Œå®ç° DAO æ¥å£ï¼ŒæŒä¹…åŒ– DAO <strong>æ¥å£</strong>ï¼Œå®šä¹‰äº† Data çš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/2b700457124e7d4f788343d8bcd9a03d2e273aca/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/base/dao/IPersistenceDAO.java#L38" rel="external nofollow noopener noreferrer" target="_blank"><code>#get(id)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œæ ¹æ® ID æŸ¥è¯¢ä¸€æ¡ Data ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/2b700457124e7d4f788343d8bcd9a03d2e273aca/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/base/dao/IPersistenceDAO.java#L68" rel="external nofollow noopener noreferrer" target="_blank"><code>#deleteHistory(startTimestamp, endTimestamp)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œåˆ é™¤æ—¶é—´èŒƒå›´å†…çš„ Data ä»¬ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/2b700457124e7d4f788343d8bcd9a03d2e273aca/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/base/dao/IPersistenceDAO.java#L50" rel="external nofollow noopener noreferrer" target="_blank"><code>#prepareBatchInsert(data)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œå‡†å¤‡æ‰¹é‡æ’å…¥æ“ä½œå¯¹è±¡ã€‚ä¾‹å¦‚ï¼š<a href="https://github.com/YunaiV/skywalking/blob/2b700457124e7d4f788343d8bcd9a03d2e273aca/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/CpuMetricEsPersistenceDAO.java" rel="external nofollow noopener noreferrer" target="_blank"><code>CpuMetricEsPersistenceDAO#prepareBatchInsert(CpuMetric)</code></a> æ–¹æ³•ï¼Œè¿”å›çš„æ˜¯ <code>org.elasticsearch.action.index.IndexRequestBuilder</code> å¯¹è±¡ã€‚æ³¨æ„ï¼š<ul><li>è¯¥æ–¹æ³•ä¸ä¼šå‘èµ·å…·ä½“çš„ DAO æ“ä½œï¼Œä»…ä»…æ˜¯åˆ›å»ºæ’å…¥æ“ä½œå¯¹è±¡ï¼Œæœ€ç»ˆçš„æ‰§è¡Œåœ¨ <code>IBatchDAO#batchPersistence(List&lt;?&gt;)</code>ã€‚</li><li>è¯¥æ–¹æ³•åˆ›å»ºçš„æ˜¯æ‰¹é‡æ’å…¥æ“ä½œå¯¹è±¡ä»¬ä¸­çš„ä¸€ä¸ªã€‚</li></ul></li><li><a href="https://github.com/YunaiV/skywalking/blob/2b700457124e7d4f788343d8bcd9a03d2e273aca/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/base/dao/IPersistenceDAO.java#L60" rel="external nofollow noopener noreferrer" target="_blank"><code>#prepareBatchUpdate(data)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œå‡†å¤‡æ‰¹é‡æ›´æ–°æ“ä½œå¯¹è±¡ã€‚ç±»ä¼¼ <code>#prepareBatchInsert(data)</code> æ–¹æ³•ã€‚</li></ul><h4 id="3-4-1-3-IBatchDAO"><a href="#3-4-1-3-IBatchDAO" class="headerlink" title="3.4.1.3 IBatchDAO"></a>3.4.1.3 IBatchDAO</h4><p><code>org.skywalking.apm.collector.storage.base.dao.IBatchDAO</code> ï¼Œå®ç° DAO æ¥å£ï¼Œæ‰¹é‡æ“ä½œ DAO <strong>æ¥å£</strong>ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/2b700457124e7d4f788343d8bcd9a03d2e273aca/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/base/dao/IBatchDAO.java#L39" rel="external nofollow noopener noreferrer" target="_blank"><code>#batchPersistence(List&lt;?&gt; batchCollection)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œé€šè¿‡æ‰§è¡Œæ‰¹é‡æ“ä½œå¯¹è±¡æ•°ç»„ï¼Œå®ç°æ‰¹é‡æŒä¹…åŒ–æ•°æ®ã€‚<ul><li><code>batchCollection</code> <strong>æ–¹æ³•å‚æ•°</strong>ï¼Œé€šè¿‡ <code>IPersistenceDAO#prepareBatchInsert</code> æˆ– <code>IPersistenceDAO#prepareBatchUpdate</code> æ–¹æ³•ï¼Œç”Ÿæˆ<strong>æ¯ä¸ª</strong>æ“ä½œæ•°ç»„å…ƒç´ ã€‚</li><li>è¯¥æ–¹æ³•ä¼šè¢« <code>PersistenceTimer#extractDataAndSave(...)</code> æˆ– <code>PersistenceWorker#onWork(...)</code> æ–¹æ³•è°ƒç”¨ï¼Œåœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆäºŒï¼‰ã€‹ã€Œ4. PersistenceWorkerã€</a> è¯¦ç»†è§£æã€‚</li></ul></li></ul><p>åœ¨ <code>collector-storage-xxx-provider</code> æ¨¡å—ä¸­ï¼ŒBatchH2DAO ã€BatchEsDAO å®ç° IBatchDAO ã€‚</p><h3 id="3-4-2-ä¸šåŠ¡-DAO"><a href="#3-4-2-ä¸šåŠ¡-DAO" class="headerlink" title="3.4.2 ä¸šåŠ¡ DAO"></a>3.4.2 ä¸šåŠ¡ DAO</h3><p>åœ¨ <a href="https://github.com/YunaiV/skywalking/blob/445bf9da669784b28d24f2e31576d3b0673c2852/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/StorageModule.java#L71" rel="external nofollow noopener noreferrer" target="_blank"><code>StorageModule#services()</code></a> æ–¹æ³•é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸šåŠ¡ DAO æŒ‰ç…§<strong>ç”¨é€”</strong>å¯ä»¥æ‹†åˆ†æˆ<strong>å››ç§</strong>ï¼š</p><ul><li>Cache ï¼šç¼“å­˜åº”ç”¨ã€åº”ç”¨å®ä¾‹ã€æœåŠ¡å</li><li>Register ï¼šæ³¨å†Œåº”ç”¨ã€åº”ç”¨å®ä¾‹ã€æœåŠ¡å</li><li>Persistence ï¼šæŒä¹…åŒ–ï¼Œå®é™…å¯ä»¥ç†è§£æˆæ‰¹é‡æŒä¹…åŒ–</li><li>UI ï¼šSkyWaling UI æŸ¥è¯¢ä½¿ç”¨ã€‚</li></ul><p>é‚£ä¹ˆæ•´ç†å¦‚ä¸‹ï¼š</p><table><thead><tr><th>Package</th><th>Data</th><th>Cache / Register</th><th>Persistence</th><th>UI</th><th>å…³è”æ–‡ç« </th></tr></thead><tbody><tr><td>register</td><td>Application</td><td>âˆš</td><td></td><td></td><td></td></tr><tr><td>register</td><td>Instance</td><td>âˆš</td><td>âˆš</td><td>âˆš</td><td></td></tr><tr><td>register</td><td>ServiceName</td><td>âˆš</td><td></td><td></td><td></td></tr><tr><td>jvm</td><td>CpuMetric</td><td></td><td>âˆš</td><td>âˆš</td><td></td></tr><tr><td>jvm</td><td>CMetric</td><td></td><td>âˆš</td><td>âˆš</td><td></td></tr><tr><td>jvm</td><td>MemoryMetric</td><td></td><td>âˆš</td><td>âˆš</td><td></td></tr><tr><td>jvm</td><td>MemoryPoolMetric</td><td></td><td>âˆš</td><td>âˆš</td><td></td></tr><tr><td>global</td><td>GlobalTrace</td><td></td><td>âˆš</td><td>âˆš</td><td></td></tr><tr><td>instance</td><td>InstPerformance</td><td></td><td>âˆš</td><td>âˆš</td><td></td></tr><tr><td>node</td><td>NodeComponent</td><td></td><td>âˆš</td><td>âˆš</td><td></td></tr><tr><td>node</td><td>NodeMapping</td><td></td><td>âˆš</td><td>âˆš</td><td></td></tr><tr><td>noderef</td><td>NodeReference</td><td></td><td>âˆš</td><td>âˆš</td><td></td></tr><tr><td>segment</td><td>SegmentCost</td><td></td><td>âˆš</td><td>âˆš</td><td></td></tr><tr><td>segment</td><td>Segment</td><td></td><td>âˆš</td><td>âˆš</td><td></td></tr><tr><td>service</td><td>ServiceEntry</td><td></td><td>âˆš</td><td>âˆš</td><td></td></tr><tr><td>serviceref</td><td>ServiceReference</td><td></td><td>âˆš</td><td>âˆš</td></tr></tbody></table><h1 id="4-collector-storage-h2-provider"><a href="#4-collector-storage-h2-provider" class="headerlink" title="4. collector-storage-h2-provider"></a>4. collector-storage-h2-provider</h1><p><code>collector-storage-h2-provider</code> ï¼ŒåŸºäº H2 çš„å­˜å‚¨ç»„ä»¶å®ç°ã€‚é¡¹ç›®ç»“æ„å¦‚ä¸‹ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_20/12.png" alt=""></p><p><strong>è¯¥å®ç°æ˜¯å•æœºç‰ˆï¼Œå»ºè®®ä»…ç”¨äº SkyWalking å¿«é€Ÿä¸Šæ‰‹ï¼Œç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨</strong>ã€‚</p><p>ç”±äºç”Ÿäº§ç¯å¢ƒä¸»è¦ä½¿ç”¨ ES çš„å­˜å‚¨ç»„ä»¶å®ç°ï¼Œæ‰€ä»¥æœ¬æ–‡æš‚ä¸è§£æç›¸å…³å®ç°ï¼Œæ„Ÿå…´è¶£çš„èƒ–å‹è‡ªå·±å—¨èµ·æ¥ã€‚</p><h1 id="5-collector-storage-es-provider"><a href="#5-collector-storage-es-provider" class="headerlink" title="5. collector-storage-es-provider"></a>5. collector-storage-es-provider</h1><p><code>collector-storage-es-provider</code> ï¼ŒåŸºäº ES çš„å­˜å‚¨ç»„ä»¶å®ç°ã€‚é¡¹ç›®ç»“æ„å¦‚ä¸‹ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_20/10.png" alt=""></p><p>å®é™…ä½¿ç”¨æ—¶ï¼Œé€šè¿‡ <code>application.yml</code> é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight"><table><tr><td class="code"><pre><div class="line">storage:</div><div class="line">  elasticsearch:</div><div class="line">    cluster_name: elasticsearch</div><div class="line">    cluster_transport_sniffer: true</div><div class="line">    cluster_nodes: 127.0.0.1:9300</div><div class="line">    index_shards_number: 2</div><div class="line">    index_replicas_number: 0</div><div class="line">    ttl: 7</div></pre></td></tr></table></figure><ul><li>ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæ¨è Elasticsearch é…ç½®æˆé›†ç¾¤ã€‚</li><li><code>cluster_name</code> ã€<code>cluster_transport_sniffer</code> ã€<code>cluster_nodes</code> ã€<code>index_shards_number</code> ã€<code>index_replicas_number</code> å‚æ•°ï¼ŒElasticsearch ç›¸å…³å‚æ•°ã€‚</li><li><code>ttl</code> ï¼šä¿ç•™ N å¤©å†…çš„æ•°æ®ã€‚è¶…è¿‡ N å¤©çš„æ•°æ®ï¼Œå°†è¢«è‡ªåŠ¨æ»šåŠ¨åˆ é™¤ã€‚<ul><li>è¯¥åŠŸèƒ½ç›®å‰ç‰ˆæœ¬<strong>æš‚æœªå‘å¸ƒ</strong>ï¼Œéœ€è¦ç­‰åˆ° 5.0 ç‰ˆæœ¬åã€‚</li></ul></li><li><a href="https://github.com/apache/incubator-skywalking/blob/master/docs/cn/Deploy-collector-in-cluster-mode-CN.md" rel="external nofollow noopener noreferrer" target="_blank">ã€Šéƒ¨ç½²é›†ç¾¤collectorã€‹</a></li></ul><h2 id="5-1-StorageModuleEsProvider"><a href="#5-1-StorageModuleEsProvider" class="headerlink" title="5.1 StorageModuleEsProvider"></a>5.1 StorageModuleEsProvider</h2><p><code>org.skywalking.apm.collector.storage.es.StorageModuleEsProvider</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleProvider.java" rel="external nofollow noopener noreferrer" target="_blank">ModuleProvider</a> <strong>æŠ½è±¡ç±»</strong>ï¼ŒåŸºäº ES çš„å­˜å‚¨ç»„ä»¶æœåŠ¡æä¾›è€…ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/7eecc004e69685fe6f5ce3b3dc4822475d6aa713/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/StorageModuleEsProvider.java#L62" rel="external nofollow noopener noreferrer" target="_blank"><code>#name()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ç»„ä»¶æœåŠ¡æä¾›è€…åä¸º <code>&quot;elasticsearch&quot;</code> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/7eecc004e69685fe6f5ce3b3dc4822475d6aa713/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/StorageModuleEsProvider.java#L66" rel="external nofollow noopener noreferrer" target="_blank"><code>module()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ç»„ä»¶ç±»ä¸º StorageModule ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/7eecc004e69685fe6f5ce3b3dc4822475d6aa713/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/StorageModuleEsProvider.java#L119" rel="external nofollow noopener noreferrer" target="_blank"><code>#requiredModules()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ä¾èµ–ç»„ä»¶ä¸º <code>&quot;cluster&quot;</code> ã€‚</p><hr><p><a href="https://github.com/YunaiV/skywalking/blob/7eecc004e69685fe6f5ce3b3dc4822475d6aa713/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/StorageModuleEsProvider.java#L70" rel="external nofollow noopener noreferrer" target="_blank"><code>#prepare(Properties)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå‡†å¤‡é˜¶æ®µé€»è¾‘ã€‚</p><ul><li>ç¬¬ 71 è‡³ 75 è¡Œ ï¼šåˆ›å»º <a href="https://github.com/YunaiV/skywalking/blob/7eecc004e69685fe6f5ce3b3dc4822475d6aa713/apm-collector/apm-collector-component/client-component/src/main/java/org/skywalking/apm/collector/client/elasticsearch/ElasticSearchClient.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.client.elasticsearch.ElasticSearchClient</code></a> å¯¹è±¡ã€‚</li><li>ç¬¬ 77 è‡³ 82 è¡Œ ï¼šåˆ›å»º DAO å¯¹è±¡ä»¬ï¼Œå¹¶è°ƒç”¨ <code>#registerServiceImplementation()</code> <strong>çˆ¶ç±»</strong>æ–¹æ³•ï¼Œæ³¨å†Œåˆ° <code>services</code> ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/7eecc004e69685fe6f5ce3b3dc4822475d6aa713/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/StorageModuleEsProvider.java#L85" rel="external nofollow noopener noreferrer" target="_blank"><code>#start()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå¯åŠ¨é˜¶æ®µé€»è¾‘ã€‚</p><ul><li>ç¬¬ 90 è¡Œ ï¼šè°ƒç”¨ <code>ElasticSearchClient#initialize()</code> æ–¹æ³•ï¼Œåˆå§‹åŒ– ZookeeperClient ã€‚</li><li>ç¬¬ 93 è‡³ 94 è¡Œ ï¼šåˆ›å»º ElasticSearchStorageInstaller å¯¹è±¡ï¼Œåˆå§‹åŒ–å­˜å‚¨ç»„ä»¶çš„è¡¨ã€‚åœ¨ <a href="#">ã€Œ5.2.4 ElasticSearchStorageInstallerã€</a> è¯¦ç»†è§£æã€‚</li><li>ç¬¬ 100 è‡³ 102 è¡Œ ï¼šåˆ›å»º <a href="https://github.com/YunaiV/skywalking/blob/7eecc004e69685fe6f5ce3b3dc4822475d6aa713/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/StorageModuleEsRegistration.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.es.StorageModuleEsRegistration</code></a> å¯¹è±¡ï¼Œå¹¶æ³¨å†Œä¿¡æ¯åˆ°é›†ç¾¤ç®¡ç†ã€‚åœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Cluster é›†ç¾¤ç®¡ç†ã€‹</a> æœ‰è¯¦ç»†è§£æã€‚</li><li>ç¬¬ 105 è‡³ 107 è¡Œ ï¼šåˆ›å»º <a href="https://github.com/YunaiV/skywalking/blob/7eecc004e69685fe6f5ce3b3dc4822475d6aa713/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/StorageModuleEsNamingListener.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.es.StorageModuleEsNamingListener</code></a> å¯¹è±¡ï¼Œå¹¶æ³¨å†Œä¿¡æ¯åˆ°é›†ç¾¤ç®¡ç†ã€‚åœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Cluster é›†ç¾¤ç®¡ç†ã€‹</a> æœ‰è¯¦ç»†è§£æã€‚</li><li>ç¬¬ 110 è‡³ 111 è¡Œ ï¼šåˆ›å»º DataTTLKeeperTimer å¯¹è±¡ã€‚åœ¨ <a href="#">ã€Œ5.4 DataTTLKeeperTimerã€</a> è¯¦ç»†è§£æã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/7eecc004e69685fe6f5ce3b3dc4822475d6aa713/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/StorageModuleEsProvider.java#L114" rel="external nofollow noopener noreferrer" target="_blank"><code>#notifyAfterCompleted()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå¯åŠ¨å®Œæˆé€»è¾‘ã€‚</p><ul><li>ç¬¬ 115 è¡Œ ï¼šè°ƒç”¨ <code>DataTTLKeeperTimer#start()</code> æ–¹æ³•ï¼Œå¯åŠ¨ DataTTLKeeperTimer ã€‚åœ¨æœ¬æ–‡ <a href="#">ã€Œ5.4 DataTTLKeeperTimerã€</a> è¯¦ç»†è§£æã€‚</li></ul><h2 id="5-2-define-åŒ…"><a href="#5-2-define-åŒ…" class="headerlink" title="5.2 define åŒ…"></a>5.2 define åŒ…</h2><p>åœ¨ <code>collector-storage-es-provider</code> é¡¹ç›®ç»“æ„å›¾ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸€å…±æœ‰<strong>ä¸¤</strong>ä¸ª <code>define</code> åŒ…ï¼š</p><ul><li><code>org.skywalking.apm.collector.storage.es.base.define</code> ï¼Œ<strong>ç³»ç»Ÿ</strong>çš„ TableDefine æŠ½è±¡ç±»ã€‚</li><li><code>org.skywalking.apm.collector.storage.es.define</code> ï¼Œ<strong>ä¸šåŠ¡</strong>çš„ TableDefine å®ç°ç±»ã€‚<ul><li><strong>ç»§æ‰¿</strong>ç³»ç»Ÿçš„ TableDefine æŠ½è±¡ç±»ã€‚</li></ul></li></ul><h3 id="5-2-1-ElasticSearchTableDefine"><a href="#5-2-1-ElasticSearchTableDefine" class="headerlink" title="5.2.1 ElasticSearchTableDefine"></a>5.2.1 ElasticSearchTableDefine</h3><p><code>org.skywalking.apm.collector.storage.es.base.define.ElasticSearchTableDefine</code> ï¼Œå®ç° TableDefine æ¥å£ï¼ŒåŸºäº Elasticsearch çš„è¡¨å®šä¹‰<strong>æŠ½è±¡ç±»</strong>ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/7a4a409e266b953e523dca14a7ba88af07039f57/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/base/define/ElasticSearchTableDefine.java#L39" rel="external nofollow noopener noreferrer" target="_blank"><code>#type()</code></a> æ–¹æ³•ï¼Œæ–‡æ¡£å…ƒæ•°æ® <code>_type</code> å­—æ®µï¼Œå‚è§  <a href="http://geosmart.github.io/2016/07/22/Elasticsearch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#type" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠElasticsearchå­¦ä¹ ç¬”è®°ã€‹ã€Œ_typeã€</a> ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/7a4a409e266b953e523dca14a7ba88af07039f57/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/base/define/ElasticSearchTableDefine.java#L46" rel="external nofollow noopener noreferrer" target="_blank"><code>#refreshInterval()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œæ–‡æ¡£ç´¢å¼•åˆ·æ–°é¢‘ç‡ï¼Œå‚è§ <a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/near-real-time.html#refresh-api" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠElasticsearch: æƒå¨æŒ‡å— Â» åŸºç¡€å…¥é—¨ Â» åˆ†ç‰‡å†…éƒ¨åŸç† Â» è¿‘å®æ—¶æœç´¢ã€‹ã€Œrefresh APIã€</a>ã€‚</li></ul><h3 id="5-2-2-ElasticSearchColumnDefine"><a href="#5-2-2-ElasticSearchColumnDefine" class="headerlink" title="5.2.2 ElasticSearchColumnDefine"></a>5.2.2 ElasticSearchColumnDefine</h3><p><code>org.skywalking.apm.collector.storage.es.base.define.ElasticSearchColumnDefine</code> ï¼Œå®ç° ColumnDefine æŠ½è±¡ç±»ï¼ŒåŸºäº ES çš„å­—æ®µå®šä¹‰ã€‚</p><ul><li><a href="https://github.com/peng-yongsheng/incubator-skywalking/blob/89c601ba386d30acb04b3713a90b52e6c0d501d8/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/apache/skywalking/apm/collector/storage/es/base/define/ElasticSearchColumnDefine.java#L32" rel="external nofollow noopener noreferrer" target="_blank">Type</a> <strong>æšä¸¾</strong>ç±»ï¼šæšä¸¾ ES å­—æ®µç±»å‹ã€‚</li></ul><h3 id="5-2-3-ä¸šåŠ¡-TableDefine-å®ç°ç±»"><a href="#5-2-3-ä¸šåŠ¡-TableDefine-å®ç°ç±»" class="headerlink" title="5.2.3 ä¸šåŠ¡ TableDefine å®ç°ç±»"></a>5.2.3 ä¸šåŠ¡ TableDefine å®ç°ç±»</h3><p>åœ¨ <a href="https://github.com/peng-yongsheng/incubator-skywalking/tree/89c601ba386d30acb04b3713a90b52e6c0d501d8/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/apache/skywalking/apm/collector/storage/es/define" rel="external nofollow noopener noreferrer" target="_blank"><code>org.apache.skywalking.apm.collector.storage.es.define</code></a> <strong>åŒ…</strong>é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<strong>æ‰€æœ‰</strong>åŸºäº ES çš„ä¸šåŠ¡ TableDefine å®ç°ç±»ã€‚ä¾‹å¦‚ï¼š<a href="https://github.com/peng-yongsheng/incubator-skywalking/blob/89c601ba386d30acb04b3713a90b52e6c0d501d8/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/apache/skywalking/apm/collector/storage/es/define/ApplicationEsTableDefine.java" rel="external nofollow noopener noreferrer" target="_blank">ApplicationEsTableDefine</a> ã€‚</p><p>æ•´ä½“ <code>#refreshInterval()</code> æ–¹æ³•è¿”å›çš„ç»“æœå¦‚ä¸‹ï¼š</p><ul><li>1 s<ul><li>CpuMetricEsTableDefine</li><li>GCMetricEsTableDefine</li><li>MemoryMetricEsTableDefine</li><li>MemoryPoolMetricEsTableDefine</li></ul></li><li>2 s<ul><li>InstPerformanceEsTableDefine </li><li>NodeComponentEsTableDefine</li><li>NodeMappingEsTableDefine</li><li>NodeReferenceEsTableDefine</li><li>ServiceEntryEsTableDefine</li><li>ServiceReferenceEsTableDefine</li></ul></li><li>2 s &amp;&amp; <a href="https://static.javadoc.io/org.elasticsearch/elasticsearch/5.0.0/org/elasticsearch/action/support/WriteRequest.RefreshPolicy.html#IMMEDIATE" rel="external nofollow noopener noreferrer" target="_blank">WriteRequest.RefreshPolicy.IMMEDIATE</a><ul><li>ã€WriteRequest.RefreshPolicy.IMMEDIATEã€‘å‚è§ <a href="https://github.com/YunaiV/skywalking/blob/6f925c180fbd1bb543fbf5bbf6fafe118f031d11/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/ApplicationEsRegisterDAO.java#L60" rel="external nofollow noopener noreferrer" target="_blank"><code>ApplicationEsRegisterDAO#save(Application)</code></a> æ–¹æ³•</li><li>ApplicationEsTableDefine</li><li>InstanceEsTableDefine</li><li>ServiceNameEsTableDefine</li></ul></li><li>5 s<ul><li>GlobalTraceEsTableDefine</li><li>SegmentCostEsTableDefine</li></ul></li><li>10 s<ul><li>SegmentEsTableDefine</li></ul></li></ul><h3 id="5-2-4-ElasticSearchStorageInstaller"><a href="#5-2-4-ElasticSearchStorageInstaller" class="headerlink" title="5.2.4 ElasticSearchStorageInstaller"></a>5.2.4 ElasticSearchStorageInstaller</h3><blockquote><p>å‹æƒ…æç¤ºï¼šElasticSearchStorageInstaller ä¸»è¦æ˜¯å¯¹ Elasticsearch Java API çš„ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸ç†Ÿæ‚‰çš„èƒ–å‹ï¼Œå¯ä»¥ Google ä¸‹ã€‚</p></blockquote><p><code>org.skywalking.apm.collector.storage.es.base.define.ElasticSearchStorageInstaller</code> ï¼Œå®ç° StorageInstaller æŠ½è±¡ç±»ï¼Œ åŸºäº ES å­˜å‚¨å®‰è£…å™¨å®ç°ç±»ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/222024defff2d1a7647dbeb5811cad146c49a604/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/base/define/ElasticSearchStorageInstaller.java#L53" rel="external nofollow noopener noreferrer" target="_blank"><code>#defineFilter(List&lt;TableDefine&gt;)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿‡æ»¤æ•°ç»„ä¸­ï¼Œé ElasticSearchTableDefine çš„å…ƒç´ ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/222024defff2d1a7647dbeb5811cad146c49a604/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/base/define/ElasticSearchStorageInstaller.java#L63" rel="external nofollow noopener noreferrer" target="_blank"><code>#createTable(Client, TableDefine)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œåˆ›å»º Elasticsearch ç´¢å¼•ã€‚<ul><li>æ–‡æ¡£æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š<ul><li><code>_id</code> ï¼šæ•°æ®ç¼–å·ï¼ŒString ç±»å‹ã€‚</li><li><code>_type</code> ï¼š<code>&quot;type&quot;</code> ã€‚</li><li><code>_index</code> ï¼šTableDefine å®šä¹‰çš„<strong>è¡¨å</strong>ã€‚</li><li><code>source</code>  ï¼šData æ•°æ®ã€‚</li></ul></li><li>äº†è§£ Elasticsearch çš„èƒ–å‹å¯èƒ½æœ‰å’Œç¬”è€…ä¸€æ ·çš„ç–‘æƒ‘ï¼Œç½‘ç»œä¸Šå¾ˆå¤šæ–‡ç« æŠŠ <code>_index</code> ç±»æ¯”æˆå…³ç³»æ•°æ®åº“çš„ DB ï¼Œ<code>_type</code> ç±»æ¯”æˆå…³ç³»æ•°æ®åº“çš„ Table ï¼Œå’Œ SkyWalking ç›®å‰ä½¿ç”¨çš„æ–¹å¼<strong>ä¸ä¸€è‡´</strong>ï¼Ÿ<ul><li>SkyWalking <a href="https://github.com/peng-yongsheng" rel="external nofollow noopener noreferrer" target="_blank">å½­å‹‡å‡</a> ï¼š<code>_index</code>å’Œ <code>_type</code> æ˜¯ ES ç‰¹æœ‰çš„ï¼Œè€ƒè™‘å…¶ä»–æ•°æ®åº“æ¥å…¥ï¼Œæ‰€ä»¥æ²¡æœ‰ç”¨ä»–è¿™ä¸ªç‰¹æ€§ã€‚</li><li>SkyWalking QQäº¤æµç¾¤( 392443393 ) ï¼Œ<a href="#">å°å¿ƒ</a> ç¾¤å‹ ï¼š<code>_type</code> æœ¬æ¥å°±æ²¡åšç‰©ç†éš”ç¦»ï¼ŒLucene å±‚é¢ä¹Ÿä¸å­˜åœ¨ï¼ŒES 6.x å·²ç»åºŸå¼ƒäº†ã€‚</li><li><a href="https://elasticsearch.cn/article/158" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠElasticsearch 6.0 å°†ç§»é™¤ Typeã€‹</a></li></ul></li></ul></li><li><a href="https://github.com/YunaiV/skywalking/blob/222024defff2d1a7647dbeb5811cad146c49a604/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/base/define/ElasticSearchStorageInstaller.java#L131" rel="external nofollow noopener noreferrer" target="_blank"><code>#deleteTable(Client, TableDefine)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œåˆ é™¤ Elasticsearch ç´¢å¼•ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/222024defff2d1a7647dbeb5811cad146c49a604/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/base/define/ElasticSearchStorageInstaller.java#L141" rel="external nofollow noopener noreferrer" target="_blank"><code>#isExists(Client, TableDefine)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œåˆ¤æ–­ Elasticsearch ç´¢å¼•æ˜¯å¦å­˜åœ¨ã€‚</li><li>åœ¨æ–¹æ³•é‡Œï¼Œç¬”è€…æ·»åŠ äº†ä¸€äº› API çš„è¯´æ˜ï¼Œä¸ç†Ÿæ‚‰çš„èƒ–å‹ï¼Œå¯ä»¥ä»”ç»†é˜…è¯»ç†è§£ã€‚</li></ul><h2 id="5-3-dao-åŒ…"><a href="#5-3-dao-åŒ…" class="headerlink" title="5.3 dao åŒ…"></a>5.3 dao åŒ…</h2><p>åœ¨ <code>collector-storage-es-provider</code> é¡¹ç›®ç»“æ„å›¾ï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸€å…±æœ‰<strong>ä¸¤</strong>ä¸ª <code>dao</code> åŒ…ï¼š</p><ul><li><code>org.skywalking.apm.collector.storage.es.base.dao</code> ï¼Œ<strong>ç³»ç»Ÿ</strong>çš„ DAO æŠ½è±¡ç±»ã€‚</li><li><code>org.skywalking.apm.collector.storage.es.dao</code> ï¼Œ<strong>ä¸šåŠ¡</strong>çš„ DAO å®ç°ç±»ã€‚<ul><li><strong>ç»§æ‰¿</strong>ç³»ç»Ÿçš„ DAO æŠ½è±¡ç±»ã€‚</li></ul></li></ul><h3 id="5-3-1-EsDAO"><a href="#5-3-1-EsDAO" class="headerlink" title="5.3.1 EsDAO"></a>5.3.1 EsDAO</h3><p><code>org.skywalking.apm.collector.storage.es.base.dao.EsDAO</code> ï¼Œå®ç° AbstractDAO æŠ½è±¡ç±»ï¼ŒåŸºäº ES çš„ DAO <strong>æŠ½è±¡ç±»</strong>ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/6f925c180fbd1bb543fbf5bbf6fafe118f031d11/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/base/dao/EsDAO.java#L49" rel="external nofollow noopener noreferrer" target="_blank"><code>#getMaxId(indexName, columnName)</code></a> æ–¹æ³•ï¼Œè·å¾—ç´¢å¼•åçš„æŒ‡å®šå­—æ®µçš„<strong>æœ€å¤§å€¼</strong>ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/6f925c180fbd1bb543fbf5bbf6fafe118f031d11/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/base/dao/EsDAO.java#L75" rel="external nofollow noopener noreferrer" target="_blank"><code>#getMinId(indexName, columnName)</code></a> æ–¹æ³•ï¼Œè·å¾—ç´¢å¼•åçš„æŒ‡å®šå­—æ®µçš„<strong>æœ€å°å€¼</strong>ã€‚</li></ul><h3 id="5-3-2-BatchEsDAO"><a href="#5-3-2-BatchEsDAO" class="headerlink" title="5.3.2 BatchEsDAO"></a>5.3.2 BatchEsDAO</h3><p><code>org.skywalking.apm.collector.storage.es.base.dao.BatchEsDAO</code> ï¼Œå®ç° IBatchDAO æ¥å£ï¼Œç»§æ‰¿ EsDAO æŠ½è±¡ç±»ï¼ŒåŸºäº ES æ‰¹é‡æ“ä½œ DAO å®ç°ç±»ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/6f925c180fbd1bb543fbf5bbf6fafe118f031d11/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/base/dao/BatchEsDAO.java#L46" rel="external nofollow noopener noreferrer" target="_blank"><code>#batchPersistence(List&lt;?&gt;)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œå°† <code>org.elasticsearch.action.index.IndexRequestBuilder</code> å’Œ <code>org.elasticsearch.action.index.UpdateRequestBuilder</code> æ•°ç»„ï¼Œåˆ›å»ºæˆ <code>org.elasticsearch.action.bulk.BulkRequestBuilder</code> å¯¹è±¡ï¼Œæ‰¹é‡æŒä¹…åŒ–ã€‚<ul><li>IndexRequestBuilder å’Œ UpdateRequestBuilder çš„åˆ›å»ºï¼Œåœ¨ <a href="#">ã€Œ5.3.3 ä¸šåŠ¡ DAO å®ç°ç±»ã€</a> ä¼šçœ‹åˆ°ã€‚</li></ul></li></ul><h3 id="5-3-3-ä¸šåŠ¡-DAO-å®ç°ç±»"><a href="#5-3-3-ä¸šåŠ¡-DAO-å®ç°ç±»" class="headerlink" title="5.3.3 ä¸šåŠ¡ DAO å®ç°ç±»"></a>5.3.3 ä¸šåŠ¡ DAO å®ç°ç±»</h3><p>åœ¨ <a href="https://github.com/YunaiV/skywalking/tree/6f925c180fbd1bb543fbf5bbf6fafe118f031d11/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao" rel="external nofollow noopener noreferrer" target="_blank"><code>org.apache.skywalking.apm.collector.storage.es.dao</code></a> <strong>åŒ…</strong>é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<strong>æ‰€æœ‰</strong>åŸºäº ES çš„ä¸šåŠ¡ DAO å®ç°ç±»ã€‚</p><p>å®ç°ä»£ç æ˜“æ‡‚ï¼Œèƒ–å‹å¯ä»¥è‡ªå·±é˜…è¯»ã€‚è‰¯å¿ƒå¦‚æˆ‘ä»¬ï¼ŒæŒ‰ç…§ DAO çš„ä¸šåŠ¡ç”¨é€”ï¼Œæ¨èä¾‹å­å¦‚ä¸‹ï¼š</p><ul><li>Cache ï¼š<a href="https://github.com/YunaiV/skywalking/blob/6f925c180fbd1bb543fbf5bbf6fafe118f031d11/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/ApplicationEsCacheDAO.java" rel="external nofollow noopener noreferrer" target="_blank">ApplicationEsCacheDAO</a></li><li>Register ï¼š<a href="https://github.com/YunaiV/skywalking/blob/6f925c180fbd1bb543fbf5bbf6fafe118f031d11/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/ApplicationEsRegisterDAO.java" rel="external nofollow noopener noreferrer" target="_blank">ApplicationEsRegisterDAO</a> </li><li>Persistence ï¼š<a href="https://github.com/YunaiV/skywalking/blob/6f925c180fbd1bb543fbf5bbf6fafe118f031d11/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/SegmentEsPersistenceDAO.java" rel="external nofollow noopener noreferrer" target="_blank">SegmentEsPersistenceDAO</a><ul><li>æ­¤å¤„å¯è§ IndexRequestBuilder å’Œ UpdateRequestBuilder çš„åˆ›å»ºã€‚</li></ul></li><li>UI ï¼š<a href="https://github.com/YunaiV/skywalking/blob/6f925c180fbd1bb543fbf5bbf6fafe118f031d11/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/SegmentEsUIDAO.java" rel="external nofollow noopener noreferrer" target="_blank">SegmentEsUIDAO</a> </li></ul><h2 id="5-4-DataTTLKeeperTimer"><a href="#5-4-DataTTLKeeperTimer" class="headerlink" title="5.4 DataTTLKeeperTimer"></a>5.4 DataTTLKeeperTimer</h2><p><code>org.skywalking.apm.collector.storage.es.DataTTLKeeperTimer</code> ï¼Œè¿‡æœŸæ•°æ®åˆ é™¤<strong>å®šæ—¶å™¨</strong>ã€‚é€šè¿‡è¯¥å®šæ—¶å™¨ï¼Œåªä¿ç•™ N å¤©å†…çš„æ•°æ®ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/efe2967813b706ae97901d7620fef9d7f975e745/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/DataTTLKeeperTimer.java#L47" rel="external nofollow noopener noreferrer" target="_blank"><code>#start()</code></a> æ–¹æ³•ï¼Œå¯åŠ¨å®šæ—¶ä»»åŠ¡ã€‚<ul><li>ç¬¬ 49 è¡Œï¼šåˆ›å»ºå»¶è¿Ÿ 1 å°æ—¶ï¼Œæ¯ 8 å°æ—¶æ‰§è¡Œä¸€æ¬¡ <code>#delete()</code> æ–¹æ³•çš„å®šæ—¶ä»»åŠ¡ã€‚ç›®å‰è¯¥è¡Œä»£ç è¢«æ³¨é‡Šï¼Œèƒ–å‹å¯ä»¥ç­‰å¾… SkyWallking 5.0 ç‰ˆæœ¬çš„å‘å¸ƒã€‚</li></ul></li><li><a href="https://github.com/YunaiV/skywalking/blob/efe2967813b706ae97901d7620fef9d7f975e745/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/DataTTLKeeperTimer.java#L53" rel="external nofollow noopener noreferrer" target="_blank"><code>#delete()</code></a> æ–¹æ³•ï¼Œåˆ é™¤è¿‡æœŸæ•°æ®ã€‚<ul><li>ç¬¬ 54 è‡³ 66 è¡Œï¼šè®¡ç®—åˆ é™¤çš„å¼€å§‹ä¸ç»“æŸæ—¶é—´ï¼Œå³æŒ‡å®šæ—¶é—´çš„<strong>å‰ä¸€å¤©</strong>ã€‚ä¾‹å¦‚ï¼Œ2017-12-23 æ‰§è¡Œæ—¶ï¼Œåˆ é™¤ 2017-12-16 é‚£å¤©çš„æ•°æ®ã€‚</li><li>ç¬¬ 69 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/efe2967813b706ae97901d7620fef9d7f975e745/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/DataTTLKeeperTimer.java#L73" rel="external nofollow noopener noreferrer" target="_blank"><code>#deleteJVMRelatedData(startTimestamp, endTimestamp)</code></a> æ–¹æ³•ï¼Œåˆ é™¤ JVM ç›¸å…³çš„æ•°æ®ã€‚</li><li>ç¬¬ 70 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/efe2967813b706ae97901d7620fef9d7f975e745/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/DataTTLKeeperTimer.java#L87" rel="external nofollow noopener noreferrer" target="_blank"><code>#deleteTraceRelatedData(startTimestamp, endTimestamp)</code></a> æ–¹æ³•ï¼Œåˆ é™¤ Trace ç›¸å…³çš„æ•°æ®ã€‚</li></ul></li></ul><p>å¦‚ä¸‹æ˜¯<strong>ä¸ä¼šåˆ é™¤</strong>çš„æ•°æ®çš„è¡¨ï¼š</p><ul><li>Application</li><li>Instance</li><li>ServiceName</li><li>ServiceEntry</li></ul><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>ğŸ˜ˆ æœ‰ç§è‡ªå·±æŠŠç®€å•çš„ä¸œè¥¿å†™çš„å¤ªå¤æ‚äº†ï¼Œæ‚²ä¼¤ã€‚</p><p>èƒ–å‹æœ›è§è°…ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_20/11.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸€æ³¢æœ‹å‹åœˆå¯å¥½ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/collector-storage-module/&quot;&gt;http://www.iocoder.cn/SkyWalking/collector-storage-module/&lt;
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” Collector Queue é˜Ÿåˆ—ç»„ä»¶</title>
    <link href="http://www.iocoder.cn/SkyWalking/collector-queue-module/"/>
    <id>http://www.iocoder.cn/SkyWalking/collector-queue-module/</id>
    <published>2020-08-14T16:00:00.000Z</published>
    <updated>2017-12-24T01:26:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/collector-queue-module/">http://www.iocoder.cn/SkyWalking/collector-queue-module/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-queue-module/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-queue-module/">2. collector-queue-define</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-queue-module/">2.1 QueueModule</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-queue-module/">2.2 QueueCreatorService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-queue-module/">2.3 MessageHolder</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-queue-module/">2.4 QueueEventHandler</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-queue-module/">2.5 DaemonThreadFactory</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-queue-module/">3. collector-queue-disruptor-provider</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-queue-module/">3.1 QueueModuleDisruptorProvider</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-queue-module/">2.2 DisruptorQueueCreatorService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-queue-module/">3.3 DisruptorEventHandler</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-queue-module/">4. collector-queue-datacarrier-provider</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-queue-module/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>SkyWalking Collector Queue Module</strong>ï¼Œé˜Ÿåˆ—ç»„ä»¶ã€‚è¯¥ç»„ä»¶è¢« Collector Streaming Module æµå¼å¤„ç†ä½¿ç”¨ï¼Œæä¾›<strong>å¼‚æ­¥</strong>æ‰§è¡Œçš„ç‰¹æ€§ã€‚</p><blockquote><p>å‹æƒ…æç¤ºï¼šå»ºè®®å…ˆé˜…è¯» <a href="http://www.iocoder.cn/SkyWalking/collector-init/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector åˆå§‹åŒ–ã€‹</a> ï¼Œä»¥äº†è§£ Collector ç»„ä»¶ä½“ç³»ã€‚</p></blockquote><p>Cluster Module åœ¨ SkyWalking æ¶æ„å›¾å¤„äºå¦‚ä¸‹ä½ç½®( <strong>çº¢æ¡†</strong> ) ï¼š</p><blockquote><p>FROM <a href="https://github.com/apache/incubating-skywalking" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/apache/incubating-skywalking</a><br><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_15/01.jpeg" alt=""></p></blockquote><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ•´ä½“çš„é¡¹ç›®ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_15/02.png" alt=""></p><ul><li><code>collector-queue-define</code> ï¼šå®šä¹‰é˜Ÿåˆ—ç»„ä»¶æ¥å£ã€‚</li><li><code>collector-queue-datacarrier-provider</code> ï¼šåŸºäº <a href="https://github.com/YunaiV/skywalking/tree/master/apm-commons/apm-datacarrier" rel="external nofollow noopener noreferrer" target="_blank">apm-datacarrier</a> çš„é˜Ÿåˆ—ç»„ä»¶å®ç°ã€‚<em>ç›®å‰æš‚æœªå®Œæˆ</em>ã€‚</li><li><code>collector-queue-zookeeper-provider</code> ï¼šåŸºäº <a href="https://github.com/LMAX-Exchange/disruptor" rel="external nofollow noopener noreferrer" target="_blank">Disruptor</a> çš„é˜Ÿåˆ—ç»„ä»¶å®ç°ã€‚</li></ul><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä»<strong>æ¥å£åˆ°å®ç°</strong>çš„é¡ºåºè¿›è¡Œåˆ†äº«ã€‚</p><h1 id="2-collector-queue-define"><a href="#2-collector-queue-define" class="headerlink" title="2. collector-queue-define"></a>2. collector-queue-define</h1><p><code>collector-queue-define</code> ï¼šå®šä¹‰é˜Ÿåˆ—ç»„ä»¶æ¥å£ã€‚é¡¹ç›®ç»“æ„å¦‚ä¸‹ ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_15/03.png" alt=""></p><h2 id="2-1-QueueModule"><a href="#2-1-QueueModule" class="headerlink" title="2.1 QueueModule"></a>2.1 QueueModule</h2><p><code>org.skywalking.apm.collector.queue.QueueModule</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Module.java" rel="external nofollow noopener noreferrer" target="_blank">Module</a> æŠ½è±¡ç±»ï¼Œé˜Ÿåˆ— Module ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-define/src/main/java/org/skywalking/apm/collector/queue/QueueModule.java#L33" rel="external nofollow noopener noreferrer" target="_blank"><code>#name()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›æ¨¡å—åä¸º <code>&quot;queue&quot;</code> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-define/src/main/java/org/skywalking/apm/collector/queue/QueueModule.java#L37" rel="external nofollow noopener noreferrer" target="_blank"><code>#services()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å› Service ç±»åï¼šQueueCreatorService ã€‚</p><h2 id="2-2-QueueCreatorService"><a href="#2-2-QueueCreatorService" class="headerlink" title="2.2 QueueCreatorService"></a>2.2 QueueCreatorService</h2><p><code>org.skywalking.apm.collector.queue.service.QueueCreatorService</code> ï¼Œç»§æ‰¿ <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Service.java" rel="external nofollow noopener noreferrer" target="_blank">Service</a> æ¥å£ï¼Œé˜Ÿåˆ—åˆ›å»ºæœåŠ¡<strong>æ¥å£</strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-define/src/main/java/org/skywalking/apm/collector/queue/service/QueueCreatorService.java#L39" rel="external nofollow noopener noreferrer" target="_blank"><code>#create(queueSize, executor)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œåˆ›å»ºé˜Ÿåˆ—å¤„ç†å™¨ã€‚</p><ul><li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå®ç°è¯¥æ¥å£æ–¹æ³•ï¼Œè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-define/src/main/java/org/skywalking/apm/collector/queue/base/QueueCreator.java#L35" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.queue.base.QueueCreator#create(queueSize, executor)</code></a> æ–¹æ³•ï¼Œåˆ›å»ºé˜Ÿåˆ—å¤„ç†å™¨ã€‚</li></ul><h2 id="2-3-MessageHolder"><a href="#2-3-MessageHolder" class="headerlink" title="2.3 MessageHolder"></a>2.3 MessageHolder</h2><p><code>org.skywalking.apm.collector.queue.base.MessageHolder</code> ï¼Œæ¶ˆæ¯æŒæœ‰è€…ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-define/src/main/java/org/skywalking/apm/collector/queue/base/MessageHolder.java#L33" rel="external nofollow noopener noreferrer" target="_blank"><code>message</code></a> å±æ€§ï¼ŒæŒæœ‰çš„æ¶ˆæ¯ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-define/src/main/java/org/skywalking/apm/collector/queue/base/MessageHolder.java#L46" rel="external nofollow noopener noreferrer" target="_blank"><code>#reset()</code></a> æ–¹æ³•ï¼Œ<strong>æ¸…ç©º</strong>æ¶ˆæ¯ã€‚ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªæ–¹æ³•ï¼Œä¸‹æ–‡èƒ–å‹ä¼šçœ‹åˆ°ã€‚</li></ul><h2 id="2-4-QueueEventHandler"><a href="#2-4-QueueEventHandler" class="headerlink" title="2.4 QueueEventHandler"></a>2.4 QueueEventHandler</h2><p><a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-define/src/main/java/org/skywalking/apm/collector/queue/base/QueueEventHandler.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.queue.base.QueueEventHandler</code></a>ï¼Œé˜Ÿåˆ—å¤„ç†å™¨<strong>æ¥å£</strong>ã€‚å®ƒå®šä¹‰äº† <a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-define/src/main/java/org/skywalking/apm/collector/queue/base/QueueEventHandler.java#L33" rel="external nofollow noopener noreferrer" target="_blank"><code>#tell(message)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œè¾“å…¥æ¶ˆæ¯ç»™è‡ªå·±ã€‚æœ€ç»ˆï¼ŒQueueEventHandler ä¼šâ€<strong>æäº¤</strong>â€œæ¶ˆæ¯ç»™ <a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-define/src/main/java/org/skywalking/apm/collector/queue/base/QueueExecutor.java#L28" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.queue.base.QueueExecutor</code></a>ï¼Œæ‰§è¡Œå¤„ç†è¯¥æ¶ˆæ¯ã€‚</p><p>LocalAsyncWorkerRef å®ç° QueueEventHandler æ¥å£ï¼Œåœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆä¸€ï¼‰ã€‹ã€Œ3.1.2 LocalAsyncWorkerRefã€</a> æœ‰è¯¦ç»†è§£æã€‚</p><h2 id="2-5-DaemonThreadFactory"><a href="#2-5-DaemonThreadFactory" class="headerlink" title="2.5 DaemonThreadFactory"></a>2.5 DaemonThreadFactory</h2><p><a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-define/src/main/java/org/skywalking/apm/collector/queue/base/DaemonThreadFactory.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.queue.base.DaemonThreadFactory</code></a>ï¼Œå®ˆæŠ¤è¿›ç¨‹çº¿ç¨‹<strong>å·¥å‚</strong>ï¼Œè¢«ç”¨äºåˆ›å»ºæ¶ˆæ¯å¤„ç†å™¨çš„çº¿ç¨‹ã€‚</p><h1 id="3-collector-queue-disruptor-provider"><a href="#3-collector-queue-disruptor-provider" class="headerlink" title="3. collector-queue-disruptor-provider"></a>3. collector-queue-disruptor-provider</h1><p><code>collector-queue-disruptor-provider</code> ï¼ŒåŸºäº <a href="https://github.com/LMAX-Exchange/disruptor" rel="external nofollow noopener noreferrer" target="_blank">Disruptor</a> çš„é˜Ÿåˆ—ç»„ä»¶å®ç°ã€‚</p><p>é¡¹ç›®ç»“æ„å¦‚ä¸‹ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_15/04.png" alt=""></p><p><strong>é»˜è®¤é…ç½®</strong>ï¼Œåœ¨ <a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-core/src/main/resources/application-default.yml#L7" rel="external nofollow noopener noreferrer" target="_blank"><code>application-default.yml</code></a> <strong>å·²ç»</strong>é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight"><table><tr><td class="code"><pre><div class="line">queue:</div><div class="line">  disruptor:</div></pre></td></tr></table></figure><h2 id="3-1-QueueModuleDisruptorProvider"><a href="#3-1-QueueModuleDisruptorProvider" class="headerlink" title="3.1 QueueModuleDisruptorProvider"></a>3.1 QueueModuleDisruptorProvider</h2><p><code>org.skywalking.apm.collector.queue.disruptor.CQueueModuleDisruptorProvider</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleProvider.java" rel="external nofollow noopener noreferrer" target="_blank">ModuleProvider</a> <strong>æŠ½è±¡ç±»</strong>ï¼ŒåŸºäº Disruptor çš„é˜Ÿåˆ—æœåŠ¡æä¾›è€…ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-disruptor-provider/src/main/java/org/skywalking/apm/collector/queue/disruptor/QueueModuleDisruptorProvider.java#L35" rel="external nofollow noopener noreferrer" target="_blank"><code>#name()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ç»„ä»¶æœåŠ¡æä¾›è€…åä¸º <code>&quot;disruptor&quot;</code> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-disruptor-provider/src/main/java/org/skywalking/apm/collector/queue/disruptor/QueueModuleDisruptorProvider.java#L39" rel="external nofollow noopener noreferrer" target="_blank"><code>module()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ç»„ä»¶ç±»ä¸º QueueModule ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-disruptor-provider/src/main/java/org/skywalking/apm/collector/queue/disruptor/QueueModuleDisruptorProvider.java#L55" rel="external nofollow noopener noreferrer" target="_blank"><code>#requiredModules()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ä¾èµ–ç»„ä»¶ä¸ºç©ºã€‚</p><hr><p><a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-disruptor-provider/src/main/java/org/skywalking/apm/collector/queue/disruptor/QueueModuleDisruptorProvider.java#L43" rel="external nofollow noopener noreferrer" target="_blank"><code>#prepare(Properties)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå‡†å¤‡é˜¶æ®µé€»è¾‘ã€‚</p><ul><li>ç¬¬ 44 è¡Œ ï¼šåˆ›å»º DisruptorQueueCreatorService å¯¹è±¡ï¼Œå¹¶è°ƒç”¨ <code>#registerServiceImplementation()</code> <strong>çˆ¶ç±»</strong>æ–¹æ³•ï¼Œæ³¨å†Œåˆ° <code>services</code> ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-disruptor-provider/src/main/java/org/skywalking/apm/collector/queue/disruptor/QueueModuleDisruptorProvider.java#L47" rel="external nofollow noopener noreferrer" target="_blank"><code>#start()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ–¹æ³•ä¸ºç©ºã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-disruptor-provider/src/main/java/org/skywalking/apm/collector/queue/disruptor/QueueModuleDisruptorProvider.java#L51" rel="external nofollow noopener noreferrer" target="_blank"><code>#notifyAfterCompleted()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ–¹æ³•ä¸ºç©ºã€‚</p><h2 id="2-2-DisruptorQueueCreatorService"><a href="#2-2-DisruptorQueueCreatorService" class="headerlink" title="2.2 DisruptorQueueCreatorService"></a>2.2 DisruptorQueueCreatorService</h2><p><code>org.skywalking.apm.collector.queue.disruptor.service.DisruptorQueueCreatorService</code> ï¼Œå®ç° QueueCreatorService <strong>æ¥å£</strong>ï¼ŒåŸºäº Disruptor çš„é˜Ÿåˆ—åˆ›å»ºæœåŠ¡<strong>å®ç°ç±»</strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-disruptor-provider/src/main/java/org/skywalking/apm/collector/queue/disruptor/service/DisruptorQueueCreatorService.java#L42" rel="external nofollow noopener noreferrer" target="_blank"><code>#create(queueSize, executor)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè°ƒç”¨ <code>DisruptorQueueCreator#register(queueSize, executor)</code> æ–¹æ³•ï¼Œåˆ›å»ºé˜Ÿåˆ—å¤„ç†å™¨ã€‚</p><h3 id="3-2-1-DisruptorQueueCreator"><a href="#3-2-1-DisruptorQueueCreator" class="headerlink" title="3.2.1 DisruptorQueueCreator"></a>3.2.1 DisruptorQueueCreator</h3><blockquote><p>å‹æƒ…æç¤ºï¼šå¦‚æœèƒ–å‹å¯¹ Disruptor æš‚æ—¶ä¸äº†è§£ï¼Œå»ºè®®å…ˆä½¿ç”¨ Disruptor å†™ä¸ªå° Demo ã€‚</p><p>å¦‚ä¸‹æ˜¯ç¬”è€…é˜…è¯»çš„æ–‡ç« ï¼š  </p><ul><li><a href="http://colobu.com/2014/08/01/3-steps-to-create-a-disruptor-application/" rel="external nofollow noopener noreferrer" target="_blank">ã€Šä¸‰æ­¥åˆ›å»ºDisruptoråº”ç”¨ã€‹</a></li><li><a href="http://ifeve.com/disruptor-getting-started/" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠDisruptorå…¥é—¨ã€‹</a></li><li><a href="http://ifeve.com/dissecting-disruptor-whats-so-special/" rel="external nofollow noopener noreferrer" target="_blank">ã€Šå‰–æDisruptor:ä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆå¿«ï¼Ÿï¼ˆä¸€ï¼‰Ringbufferçš„ç‰¹åˆ«ä¹‹å¤„ã€‹</a> </li></ul></blockquote><p><code>org.skywalking.apm.collector.queue.disruptor.base.DisruptorQueueCreator</code> ï¼Œå®ç° QueueCreator <strong>æ¥å£</strong>ï¼ŒåŸºäº Disruptor çš„é˜Ÿåˆ—åˆ›å»ºå™¨<strong>å®ç°ç±»</strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-disruptor-provider/src/main/java/org/skywalking/apm/collector/queue/disruptor/base/DisruptorQueueCreator.java#L41" rel="external nofollow noopener noreferrer" target="_blank"><code>#create(queueSize, executor)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 42 è‡³ 45 è¡Œï¼š<strong>æ ¡éªŒ</strong>é˜Ÿåˆ—å¤§å°ä¸º 2 çš„æŒ‡æ•°ï¼Œå¦åˆ™åˆ›å»º Disruptor å¯¹è±¡ä¼šæŠ¥ <code>&quot;bufferSize must be a power of 2&quot;</code> çš„å¼‚å¸¸ï¼Œå‚è§ <a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/AbstractSequencer.java#L50" rel="external nofollow noopener noreferrer" target="_blank">AbstractSequencer</a> çš„ä»£ç ã€‚</li><li>ç¬¬ 49 è¡Œï¼š<strong>åˆ›å»º</strong> Disruptor å¯¹è±¡ã€‚<ul><li><a href="https://github.com/YunaiV/skywalking/blob/8b7205313e60e84d50579261992042c8b581492f/apm-collector/apm-collector-queue/collector-queue-disruptor-provider/src/main/java/org/skywalking/apm/collector/queue/disruptor/base/MessageHolderFactory.java#L29" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.queue.disruptor.base.MessageHolderFactory</code></a> ï¼ŒMessageHolder <strong>å·¥å‚</strong>ã€‚</li></ul></li><li>ç¬¬ 51 è‡³ 64 è¡Œï¼šè®¾ç½® Disruptor å¯¹è±¡çš„<strong>é»˜è®¤å¼‚å¸¸å¤„ç†å™¨</strong>ã€‚</li><li>ç¬¬ 67 è‡³ 70 è¡Œï¼šåˆ›å»º DisruptorEventHandler å¯¹è±¡ï¼Œå¹¶è®¾ç½®ä¸º Disruptor å¯¹è±¡çš„<strong>äº‹ä»¶å¤„ç†å™¨</strong>ã€‚</li><li>ç¬¬ 74 è¡Œï¼š<strong>å¯åŠ¨</strong> Disruptor å¯¹è±¡ã€‚</li></ul><p><strong>ä¸ºä»€ä¹ˆ Disruptor è¦æ±‚é˜Ÿåˆ—å¤§å°ä¸º 2 çš„æŒ‡æ•°å‘¢</strong>ï¼Ÿå¦‚ä¸‹æ˜¯ç›¸å…³èµ„æ–™ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥çœ‹çœ‹( å¯è·³è¿‡ )ï¼š</p><ul><li>FROM <a href="https://zh.wikipedia.org/wiki/%E7%92%B0%E5%BD%A2%E7%B7%A9%E8%A1%9D%E5%8D%80#Linux.E5.86.85.E6.A0.B8.E7.9A.84kfifo" rel="external nofollow noopener noreferrer" target="_blank">ã€Šç¯å½¢ç¼“å†²å™¨ã€‹</a></li></ul><blockquote><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_15/05.png" alt=""></p></blockquote><ul><li><code>SingleProducerSequencer#hasAvailableCapacity(requiredCapacity)</code> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_15/06.png" alt=""></li></ul><h2 id="3-3-DisruptorEventHandler"><a href="#3-3-DisruptorEventHandler" class="headerlink" title="3.3 DisruptorEventHandler"></a>3.3 DisruptorEventHandler</h2><p><code>org.skywalking.apm.collector.queue.disruptor.base.DisruptorEventHandler</code> ï¼ŒåŸºäº Disruptor çš„é˜Ÿåˆ—å¤„ç†å™¨<strong>å®ç°ç±»</strong>ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/0feb6bce291fa945eff5bf52100c82c960851143/apm-collector/apm-collector-queue/collector-queue-disruptor-provider/src/main/java/org/skywalking/apm/collector/queue/disruptor/base/DisruptorEventHandler.java#L43" rel="external nofollow noopener noreferrer" target="_blank"><code>ringBuffer</code></a> å±æ€§ï¼ŒDisruptor RingBuffer å¯¹è±¡ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/0feb6bce291fa945eff5bf52100c82c960851143/apm-collector/apm-collector-queue/cæ–¹æ³•å‚æ•°ollector-queue-disruptor-provider/src/main/java/org/skywalking/apm/collector/queue/disruptor/base/DisruptorEventHandler.java#L47" rel="external nofollow noopener noreferrer" target="_blank"><code>executor</code></a> å±æ€§ï¼Œæ‰§è¡Œå™¨ã€‚</li><li>å®ç° <code>org.skywalking.apm.collector.queue.base.QueueEventHandler</code> <strong>æ¥å£</strong> çš„ <a href="https://github.com/YunaiV/skywalking/blob/0feb6bce291fa945eff5bf52100c82c960851143/apm-collector/apm-collector-queue/collector-queue-disruptor-provider/src/main/java/org/skywalking/apm/collector/queue/disruptor/base/DisruptorEventHandler.java#L80" rel="external nofollow noopener noreferrer" target="_blank"><code>#tell(message)</code></a> æ¥å£æ–¹æ³•ï¼Œæ ‡å‡†çš„ Disruptor å‘å¸ƒäº‹ä»¶çš„ä»£ç ã€‚</li><li>å®ç° <a href="https://github.com/LMAX-Exchange/disruptor/blob/master/src/main/java/com/lmax/disruptor/EventHandler.java" rel="external nofollow noopener noreferrer" target="_blank"><code>com.lmax.disruptor.EventHandler</code></a> çš„ <a href="https://github.com/YunaiV/skywalking/blob/0feb6bce291fa945eff5bf52100c82c960851143/apm-collector/apm-collector-queue/collector-queue-disruptor-provider/src/main/java/org/skywalking/apm/collector/queue/disruptor/base/DisruptorEventHandler.java#L62" rel="external nofollow noopener noreferrer" target="_blank"><code>#onEvent(event, sequence, endOfBatch)</code></a> æ¥å£æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š<ul><li><code>endOfBatch</code> <strong>æ–¹æ³•å‚æ•°</strong>ï¼Œæ ‡è®°è¯¥äº‹ä»¶( æ¶ˆæ¯ )æ˜¯å¦æ˜¯ Disruptor <strong>æ¯æ¬¡æ‰¹å¤„ç†</strong>çš„æœ€åä¸€ä¸ªäº‹ä»¶ã€‚èƒ–å‹å¯ä»¥å‚è§ <a href="https://stackoverflow.com/questions/33716825/lmax-disruptor-what-determines-the-batch-size" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠLMAX Disruptor - what determines the batch size?ã€‹</a> è¿™ç¯‡æ–‡ç« ï¼Œè‡ªå·±æ­å»ºä¸€ä¸ª Demo ç†è§£ä¸‹è¯¥å‚æ•°ã€‚</li><li>ç¬¬ 66 è¡Œï¼šè°ƒç”¨ <code>MessageHolder#reset()</code> æ–¹æ³•ï¼Œæ¸…ç©ºæ¶ˆæ¯ï¼Œå› ä¸ºåœ¨ Disruptor RingBuffer é‡Œï¼Œäº‹ä»¶( æ¶ˆæ¯ )å¯¹è±¡æ˜¯<strong>é‡ç”¨</strong>çš„ï¼Œè™½ç„¶åç»­å‘å¸ƒäº‹ä»¶( æ¶ˆæ¯ )å¯ä»¥è¿›è¡Œ<strong>è¦†ç›–</strong>ï¼Œè€ƒè™‘åˆ°å®‰å…¨æ€§è¿›è¡Œæ¸…ç©ºã€‚</li><li>ç¬¬ 69 è¡Œï¼šè®¾ç½®æ¶ˆæ¯ä¸ºè¯¥æ‰¹é‡çš„ç»“å°¾( æœ€åä¸€æ¡ )ã€‚<strong>ä¸ºä»€ä¹ˆ</strong>ï¼Ÿåœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆäºŒï¼‰ã€‹ã€Œ3. AggregationWorkerã€</a> æ­æ™“ç­”æ¡ˆã€‚</li><li>ç¬¬ 72 è¡Œï¼šè°ƒç”¨ <code>QueueExecutor#execute(message)</code> æ–¹æ³•ï¼Œæ‰§è¡Œå¤„ç†æ¶ˆæ¯ã€‚</li></ul></li></ul><h1 id="4-collector-queue-datacarrier-provider"><a href="#4-collector-queue-datacarrier-provider" class="headerlink" title="4. collector-queue-datacarrier-provider"></a>4. collector-queue-datacarrier-provider</h1><p><code>collector-queue-datacarrier-provider</code> ï¼šåŸºäº <a href="https://github.com/YunaiV/skywalking/tree/master/apm-commons/apm-datacarrier" rel="external nofollow noopener noreferrer" target="_blank">apm-datacarrier</a> çš„é˜Ÿåˆ—ç»„ä»¶å®ç°ã€‚</p><p><em>ç›®å‰æš‚æœªå®Œæˆ</em>ã€‚</p><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>åœ¨åœ°é“é‡Œï¼Œå¤¹ç¼ä¸­å†™ä»£ç ( ğŸ˜ˆ å½“ç„¶æœ‰åº§ä½ )ã€‚</p><p>ä¸å®¹æ˜“ï¼Œå›å®¶çœ‹ã€Šèœ˜è››ä¾ ã€‹ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_15/07.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸€æ³¢æœ‹å‹åœˆå¯å¥½ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/collector-queue-module/&quot;&gt;http://www.iocoder.cn/SkyWalking/collector-queue-module/&lt;/a&gt; 
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” Collector Naming Server å‘½åæœåŠ¡</title>
    <link href="http://www.iocoder.cn/SkyWalking/collector-naming-server/"/>
    <id>http://www.iocoder.cn/SkyWalking/collector-naming-server/</id>
    <published>2020-08-09T16:00:00.000Z</published>
    <updated>2017-12-15T11:36:23.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/collector-naming-server/">http://www.iocoder.cn/SkyWalking/collector-naming-server/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-naming-server/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-naming-server/">2. Collector Naming Server</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-naming-server/">2.1 NamingModule</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-naming-server/">2.2 NamingModuleJettyProvider</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-naming-server/">2.3 NamingHandlerRegisterService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-naming-server/">2.4 é…ç½®æ–‡ä»¶</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-naming-server/">3. CollectorDiscoveryService</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-naming-server/">3.1 CollectorDiscoveryService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-naming-server/">3.2 é…ç½®æ–‡ä»¶</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-naming-server/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>Collector Naming Server å‘½åæœåŠ¡</strong>ã€‚ä¸»è¦åŒ…å«å¦‚ä¸‹éƒ¨åˆ†ï¼š</p><ul><li>Collector Naming Server æä¾› Http ä¸¤ä¸ªæ¥å£ï¼Œæä¾› Agent <strong>åˆ†åˆ«</strong>æŸ¥è¯¢ Collector Agent Jetty Server ã€Collector Agent gRPC Server é›†ç¾¤ã€‚</li><li>Collector Agent Jetty Server ã€Collector Agent gRPC Server é›†ç¾¤å†…éƒ¨çš„æ³¨å†Œä¸å‘ç°ã€‚</li></ul><blockquote><p>å‹æƒ…æç¤ºï¼Œå»ºè®®èƒ–å‹å·²ç»è¯»è¿‡ <a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module//?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Server Component æœåŠ¡å™¨ç»„ä»¶ã€‹</a> ã€<a href="http://www.iocoder.cn/SkyWalking/collector-server-component/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Server Component æœåŠ¡å™¨ç»„ä»¶ã€‹</a></p></blockquote><p>Collector Agent Server ( åŒ…æ‹¬ Jetty å’Œ gRPC )ï¼Œæä¾›ä¸Šä¼ è°ƒç”¨é“¾è·¯ï¼ŒJVM Metric ç­‰ç­‰ API ç»™ Agent è°ƒç”¨ã€‚<br>Agent é€šè¿‡ Collector Naming Server è°ƒç”¨ Collector Agent Server çš„ API ï¼ŒæŸ¥è¯¢ Collector Agent Server <strong>æœ€æ–°</strong>çš„é›†ç¾¤åœ°å€ã€‚</p><p>Naming Server åœ¨ SkyWalking æ¶æ„å›¾å¤„äºå¦‚ä¸‹ä½ç½®( <strong>çº¢æ¡†</strong> ) ï¼š</p><blockquote><p>FROM <a href="https://github.com/apache/incubating-skywalking" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/apache/incubating-skywalking</a><br><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_10/01.jpeg" alt=""></p></blockquote><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ•´ä½“çš„é¡¹ç›®ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_10/02.png" alt=""></p><h1 id="2-Collector-Naming-Server"><a href="#2-Collector-Naming-Server" class="headerlink" title="2. Collector Naming Server"></a>2. Collector Naming Server</h1><p>Collector Naming Server é€šè¿‡ <code>apm-collector-naming</code> é¡¹ç›®å®ç°ï¼Œå…¶ä¸­ï¼š</p><ul><li><code>collector-naming-define</code> é¡¹ç›®ï¼šå®šä¹‰äº† Naming Server çš„æ¥å£ã€‚</li><li><code>collector-naming-jetty-provider</code> é¡¹ç›®ï¼šåŸºäº Jetty Server çš„ Naming Server å®ç°ã€‚</li></ul><h2 id="2-1-NamingModule"><a href="#2-1-NamingModule" class="headerlink" title="2.1 NamingModule"></a>2.1 NamingModule</h2><p><code>org.skywalking.apm.collector.cluster.ClusterModule</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Module.java" rel="external nofollow noopener noreferrer" target="_blank">Module</a> æŠ½è±¡ç±»ï¼Œé›†ç¾¤ç®¡ç† Module ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/8eece7df8a9174067793f0714b8b71d09f142312/apm-collector/apm-collector-naming/collector-naming-define/src/main/java/org/skywalking/apm/collector/naming/NamingModule.java#L34" rel="external nofollow noopener noreferrer" target="_blank"><code>#name()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›æ¨¡å—åä¸º <code>&quot;naming&quot;</code> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/8eece7df8a9174067793f0714b8b71d09f142312/apm-collector/apm-collector-naming/collector-naming-define/src/main/java/org/skywalking/apm/collector/naming/NamingModule.java#L38" rel="external nofollow noopener noreferrer" target="_blank"><code>#services()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å› Service ç±»åï¼šNamingHandlerRegisterService ã€‚</p><h2 id="2-2-NamingModuleJettyProvider"><a href="#2-2-NamingModuleJettyProvider" class="headerlink" title="2.2 NamingModuleJettyProvider"></a>2.2 NamingModuleJettyProvider</h2><p><code>org.skywalking.apm.collector.naming.jetty.NamingModuleJettyProvider</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleProvider.java" rel="external nofollow noopener noreferrer" target="_blank">ModuleProvider</a> <strong>æŠ½è±¡ç±»</strong>ï¼ŒåŸºäº Jetty çš„å‘½åç»„ä»¶æœåŠ¡æä¾›è€…å®ç°ç±»ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/8eece7df8a9174067793f0714b8b71d09f142312/apm-collector/apm-collector-naming/collector-naming-jetty-provider/src/main/java/org/skywalking/apm/collector/naming/jetty/NamingModuleJettyProvider.java#L44" rel="external nofollow noopener noreferrer" target="_blank"><code>#name()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ç»„ä»¶æœåŠ¡æä¾›è€…åä¸º <code>&quot;jetty&quot;</code> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/8eece7df8a9174067793f0714b8b71d09f142312/apm-collector/apm-collector-naming/collector-naming-jetty-provider/src/main/java/org/skywalking/apm/collector/naming/jetty/NamingModuleJettyProvider.java#L48" rel="external nofollow noopener noreferrer" target="_blank"><code>module()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ç»„ä»¶ç±»ä¸º NamingModule ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-zookeeper-provider/src/main/java/org/skywalking/apm/collector/cluster/zookeeper/ClusterModuleZookeeperProvider.java#L94" rel="external nofollow noopener noreferrer" target="_blank"><code>#requiredModules()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ä¾èµ–ç»„ä»¶ä¸º ClusterModule ã€JettyManagerModuleã€‚</p><hr><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-zookeeper-provider/src/main/java/org/skywalking/apm/collector/cluster/zookeeper/ClusterModuleZookeeperProvider.java#L52" rel="external nofollow noopener noreferrer" target="_blank"><code>#prepare(Properties)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå‡†å¤‡é˜¶æ®µé€»è¾‘ã€‚</p><ul><li>ç¬¬ 55 è¡Œ ï¼šåˆ›å»º ZookeeperModuleListenerService / NamingJettyHandlerRegisterService å¯¹è±¡ï¼Œå¹¶è°ƒç”¨ <code>#registerServiceImplementation()</code> <strong>çˆ¶ç±»</strong>æ–¹æ³•ï¼Œæ³¨å†Œåˆ° <code>services</code> ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/8eece7df8a9174067793f0714b8b71d09f142312/apm-collector/apm-collector-naming/collector-naming-jetty-provider/src/main/java/org/skywalking/apm/collector/naming/jetty/NamingModuleJettyProvider.java#L58" rel="external nofollow noopener noreferrer" target="_blank"><code>#start()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå¯åŠ¨é˜¶æ®µé€»è¾‘ã€‚</p><ul><li>ç¬¬ 65 è¡Œ ï¼šè°ƒç”¨ <code>JettyManagerService#createIfAbsent(host, port, contextPath)</code> æ–¹æ³•ï¼Œåˆ›å»º Jetty Server ï¼Œ<strong>æ­¤æ—¶ä¸ä¼šå¯åŠ¨ Jetty Server</strong>ã€‚åœ¨ <code>JettyManagerProvider#notifyAfterCompleted()</code> æ–¹æ³•ï¼Œç»Ÿä¸€å¯åŠ¨æ‰€æœ‰ Jetty Serverï¼Œåœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-jetty-server-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Jetty Server Managerã€‹ã€Œ3. JettyManagerProviderã€</a> æœ‰è¯¦ç»†è§£æã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/8eece7df8a9174067793f0714b8b71d09f142312/apm-collector/apm-collector-naming/collector-naming-jetty-provider/src/main/java/org/skywalking/apm/collector/naming/jetty/NamingModuleJettyProvider.java#L68" rel="external nofollow noopener noreferrer" target="_blank"><code>#notifyAfterCompleted()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå¯åŠ¨å®Œæˆé€»è¾‘ã€‚ç›®å‰æ˜¯ä¸ªç©ºæ–¹æ³•ã€‚</p><h2 id="2-3-NamingHandlerRegisterService"><a href="#2-3-NamingHandlerRegisterService" class="headerlink" title="2.3 NamingHandlerRegisterService"></a>2.3 NamingHandlerRegisterService</h2><p><code>org.skywalking.apm.collector.naming.service.NamingHandlerRegisterService</code> ï¼Œç»§æ‰¿ <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Service.java" rel="external nofollow noopener noreferrer" target="_blank">Service</a> æ¥å£ï¼Œå‘½åå¤„ç†å™¨æ³¨å†ŒæœåŠ¡<strong>æ¥å£</strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/8eece7df8a9174067793f0714b8b71d09f142312/apm-collector/apm-collector-naming/collector-naming-define/src/main/java/org/skywalking/apm/collector/naming/service/NamingHandlerRegisterService.java#L36" rel="external nofollow noopener noreferrer" target="_blank"><code>#register(ServerHandler)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œæ³¨å†Œ Server è¯·æ±‚å¤„ç†å™¨ã€‚Collector Agent Server ä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œå°†å…¶å®ç°çš„ ç”¨äº Naming çš„ ServerHandler è¿›è¡Œæ³¨å†Œã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_10/03.png" alt=""></p><h3 id="2-3-1-NamingJettyHandlerRegisterService"><a href="#2-3-1-NamingJettyHandlerRegisterService" class="headerlink" title="2.3.1 NamingJettyHandlerRegisterService"></a>2.3.1 NamingJettyHandlerRegisterService</h3><p><code>org.skywalking.apm.collector.naming.jetty.service.service.NamingJettyHandlerRegisterService</code> ï¼ŒåŸºäº Jetty çš„å‘½åå¤„ç†å™¨æ³¨å†ŒæœåŠ¡<strong>å®ç°ç±»</strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/8eece7df8a9174067793f0714b8b71d09f142312/apm-collector/apm-collector-naming/collector-naming-jetty-provider/src/main/java/org/skywalking/apm/collector/naming/jetty/service/NamingJettyHandlerRegisterService.java#L48" rel="external nofollow noopener noreferrer" target="_blank"><code>#register(moduleName, providerName, registration)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè°ƒç”¨ <code>JettyManagerService#addHandler(path, registration)</code> æ–¹æ³•ï¼Œæ³¨å†Œ Jetty Server è¯·æ±‚å¤„ç†å™¨ã€‚</p><h3 id="2-3-2-AgentJettyNamingHandler"><a href="#2-3-2-AgentJettyNamingHandler" class="headerlink" title="2.3.2 AgentJettyNamingHandler"></a>2.3.2 AgentJettyNamingHandler</h3><p><code>org.skywalking.apm.collector.agent.jetty.handler.naming.AgentJettyNamingHandler</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/8eece7df8a9174067793f0714b8b71d09f142312/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/jetty/JettyHandler.java" rel="external nofollow noopener noreferrer" target="_blank">JettyHandler</a> <strong>æŠ½è±¡ç±»</strong>ï¼ŒCollector Agent Jetty Server å®ç°çš„å‘½åå¤„ç†å™¨ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/8eece7df8a9174067793f0714b8b71d09f142312/apm-collector/apm-collector-agent-jetty/collector-agent-jetty-provider/src/main/java/org/skywalking/apm/collector/agent/jetty/handler/naming/AgentJettyNamingHandler.java#L39" rel="external nofollow noopener noreferrer" target="_blank"><code>#pathSpec()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè·å¾—è¯·æ±‚è·¯å¾„ä¸º <code>&quot;/agent/jetty&quot;</code> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/8eece7df8a9174067793f0714b8b71d09f142312/apm-collector/apm-collector-agent-jetty/collector-agent-jetty-provider/src/main/java/org/skywalking/apm/collector/agent/jetty/handler/naming/AgentJettyNamingHandler.java#L43" rel="external nofollow noopener noreferrer" target="_blank"><code>#doGet()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè°ƒç”¨ <code>AgentJettyNamingListener#getAddresses()</code> æ–¹æ³•ï¼Œè·å¾— Collector Agent Jetty Server é›†ç¾¤åœ°å€ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/8eece7df8a9174067793f0714b8b71d09f142312/apm-collector/apm-collector-agent-jetty/collector-agent-jetty-provider/src/main/java/org/skywalking/apm/collector/agent/jetty/handler/naming/AgentJettyNamingListener.java#L28" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.agent.jetty.handler.naming.AgentJettyNamingListener</code></a> åŸºäº Collector Cluster ç»„ä»¶ï¼Œ<strong>å®ç°äº†é›†ç¾¤åœ°å€å˜åŒ–çš„å‘ç°</strong>ï¼Œåœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Cluster é›†ç¾¤ç®¡ç†ã€‹</a> æœ‰è¯¦ç»†è§£æã€‚</li></ul><h3 id="2-3-3-AgentGRPCNamingHandler"><a href="#2-3-3-AgentGRPCNamingHandler" class="headerlink" title="2.3.3 AgentGRPCNamingHandler"></a>2.3.3 AgentGRPCNamingHandler</h3><p><code>org.skywalking.apm.collector.agent.grpc.handler.naming.AgentGRPCNamingHandler</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/8eece7df8a9174067793f0714b8b71d09f142312/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/jetty/JettyHandler.java" rel="external nofollow noopener noreferrer" target="_blank">JettyHandler</a> <strong>æŠ½è±¡ç±»</strong>ï¼ŒCollector Agent gRPC Server å®ç°çš„å‘½åå¤„ç†å™¨ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ac6c98c1732d6aa62b9d244369478654411ac203/apm-collector/apm-collector-agent-grpc/collector-agent-grpc-provider/src/main/java/org/skywalking/apm/collector/agent/grpc/handler/naming/AgentGRPCNamingHandler.java#L42" rel="external nofollow noopener noreferrer" target="_blank"><code>#pathSpec()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè·å¾—è¯·æ±‚è·¯å¾„ä¸º <code>&quot;/agent/gRPC&quot;</code> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ac6c98c1732d6aa62b9d244369478654411ac203/apm-collector/apm-collector-agent-grpc/collector-agent-grpc-provider/src/main/java/org/skywalking/apm/collector/agent/grpc/handler/naming/AgentGRPCNamingHandler.java#L46" rel="external nofollow noopener noreferrer" target="_blank"><code>#doGet()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè°ƒç”¨ <code>AgentGRPCNamingListener#getAddresses()</code> æ–¹æ³•ï¼Œè·å¾— Collector Agent gRPC Server é›†ç¾¤åœ°å€ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/ac6c98c1732d6aa62b9d244369478654411ac203/apm-collector/apm-collector-agent-grpc/collector-agent-grpc-provider/src/main/java/org/skywalking/apm/collector/agent/grpc/handler/naming/AgentGRPCNamingListener.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.agent.grpc.handler.naming.AgentGRPCNamingListener</code></a> åŸºäº Collector Cluster ç»„ä»¶ï¼Œ<strong>å®ç°äº†é›†ç¾¤åœ°å€å˜åŒ–çš„å‘ç°</strong>ï¼Œåœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Cluster é›†ç¾¤ç®¡ç†ã€‹</a> æœ‰è¯¦ç»†è§£æã€‚</li></ul><h2 id="2-4-é…ç½®æ–‡ä»¶"><a href="#2-4-é…ç½®æ–‡ä»¶" class="headerlink" title="2.4 é…ç½®æ–‡ä»¶"></a>2.4 é…ç½®æ–‡ä»¶</h2><p>é…ç½®æ–‡ä»¶å¦‚ä¸‹ ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_10/02.png" alt=""></p><ul><li>é…ç½® Naming Server å¯åŠ¨åœ¨ 10800 ç«¯å£ã€‚</li><li>Naming Server <strong>å†…åµŒ</strong>åœ¨ Collector Server ã€‚é€šè¿‡å¯åŠ¨å¤šä¸ª Collector Server èŠ‚ç‚¹ï¼Œå½¢æˆ Naming Server é›†ç¾¤ã€‚Agent é…ç½®å¤šä¸ª Naming Server åœ°å€ã€‚</li></ul><h1 id="3-CollectorDiscoveryService"><a href="#3-CollectorDiscoveryService" class="headerlink" title="3. CollectorDiscoveryService"></a>3. CollectorDiscoveryService</h1><p><code>org.skywalking.apm.agent.core.remote.CollectorDiscoveryService</code> ï¼Œ å®ç° Agent çš„ <a href="https://github.com/YunaiV/skywalking/blob/ac6c98c1732d6aa62b9d244369478654411ac203/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/boot/BootService.java" rel="external nofollow noopener noreferrer" target="_blank">BootService</a> <strong>æ¥å£</strong>ï¼ŒCollector Agent Server åœ°å€<strong>å‘ç°</strong>æœåŠ¡ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ac6c98c1732d6aa62b9d244369478654411ac203/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/CollectorDiscoveryService.java#L45" rel="external nofollow noopener noreferrer" target="_blank"><code>#boot()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè°ƒç”¨ <code>ScheduledExecutorService#scheduleAtFixedRate(...)</code> æ–¹æ³•ï¼Œåˆ›å»ºå®šæ—¶ä»»åŠ¡ã€‚è¯¥å®šæ—¶ä»»åŠ¡<strong>æ— åˆå§‹åŒ–å»¶è¿Ÿ</strong>ï¼Œæ¯ <code>Config.Collector.DISCOVERY_CHECK_INTERVAL</code> ( é»˜è®¤ï¼š60 s ) æ‰§è¡Œä¸€æ¬¡ã€‚</p><ul><li>DiscoveryRestServiceClient å®ç° <code>java.lang.Runnable</code> <strong>æ¥å£</strong>ï¼Œå³åˆ›å»ºçš„ä»»åŠ¡ã€‚</li></ul><h2 id="3-1-CollectorDiscoveryService"><a href="#3-1-CollectorDiscoveryService" class="headerlink" title="3.1 CollectorDiscoveryService"></a>3.1 CollectorDiscoveryService</h2><p><code>org.skywalking.apm.agent.core.remote.CollectorDiscoveryService</code> ï¼Œå®ç° <code>java.lang.Runnable</code> <strong>æ¥å£</strong>ï¼ŒCollector æœåŠ¡å‘ç°å®¢æˆ·ç«¯ï¼ŒåŸºäº <strong>Rest</strong> æ–¹å¼é€šä¿¡ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/e30787c3a7ce91ae6314003cd488e71c1a534d7c/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/DiscoveryRestServiceClient.java#L61" rel="external nofollow noopener noreferrer" target="_blank"><strong>æ„é€ æ–¹æ³•</strong></a> ï¼Œé¦–å…ˆéšæœºé€‰æ‹©ä¸€ä¸ª Collector Naming Server ï¼Œç”¨äºä¸‹é¢ <code>#findServerList()</code> æ–¹æ³•ï¼Œé¦–æ¬¡è·å– Collector Agent Server é›†ç¾¤åœ°å€ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/e30787c3a7ce91ae6314003cd488e71c1a534d7c/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/DiscoveryRestServiceClient.java#L76" rel="external nofollow noopener noreferrer" target="_blank"><code>#run()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè°ƒç”¨ <code>#findServerList()</code> æ–¹æ³•ï¼Œè·å– Collector Agent Server é›†ç¾¤åœ°å€ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/e30787c3a7ce91ae6314003cd488e71c1a534d7c/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/DiscoveryRestServiceClient.java#L84" rel="external nofollow noopener noreferrer" target="_blank"><code>#findServerList()</code></a> æ–¹æ³•ï¼Œè·å– Collector Agent Server é›†ç¾¤åœ°å€ã€‚</p><ul><li>ç¬¬ 85 è¡Œ ï¼šåˆ›å»º <code>org.apache.http.impl.client.CloseableHttpClient</code> å¯¹è±¡ã€‚ç›®å‰ä½¿ç”¨ HttpClient <code>4.5.3</code> ç‰ˆæœ¬ã€‚</li><li>ç¬¬ 87 è¡Œ ï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/e30787c3a7ce91ae6314003cd488e71c1a534d7c/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/remote/DiscoveryRestServiceClient.java#L142" rel="external nofollow noopener noreferrer" target="_blank"><code>#buildGet()</code></a> æ–¹æ³•ï¼Œåˆ›å»º <code>org.apache.http.client.methods.HttpGet</code> å¯¹è±¡ã€‚ç›®å‰ Agent æŸ¥è¯¢çš„æ˜¯ Collector Agent gRPC Server é›†ç¾¤åœ°å€ï¼Œå› ä¸º gRPC çš„æ€§èƒ½ç›¸æ¯” HTTP æ›´ä¼˜ç§€ã€‚</li><li>ç¬¬ 89 è¡Œ ï¼šå‘ Collector Naming Server å‘èµ·è¯·æ±‚ã€‚</li><li>ç¬¬ 90 è‡³ 93 è¡Œ ï¼šå½“å“åº”çŠ¶æ€ç é <code>200</code> æ—¶ï¼Œè°ƒç”¨ <code>#findBackupServer()</code> æ–¹æ³•ï¼Œ<strong>é¡ºåº</strong>é€‰æ‹© Collector Naming Server åˆ—è¡¨çš„ä¸‹ä¸€ä¸ªã€‚<strong>æ³¨æ„</strong>ï¼Œæ­¤æ—¶ä¸ä¼šå†å‘èµ·è¯·æ±‚ï¼Œéœ€è¦ç­‰ä¸‹ä¸€æ¬¡æ‰§è¡Œã€‚</li><li>ç¬¬ 95 è‡³ 111 è¡Œ ï¼šå¤„ç†å“åº”ç»“æœï¼Œè‹¥ Collector Agent gRPC Server é›†ç¾¤åœ°å€å‘ç”Ÿå˜åŒ–ï¼Œè¿›è¡Œæ›´æ–°åˆ° <code>RemoteDownstreamConfig.Collector.GRPC_SERVERS</code> ã€‚</li><li>ç¬¬ 114 è‡³ 117 è¡Œ ï¼šè¯·æ±‚å‘ç”Ÿå¼‚å¸¸ï¼Œè°ƒç”¨ <code>#findBackupServer()</code> æ–¹æ³•ï¼Œ<strong>é¡ºåº</strong>é€‰æ‹© Collector Naming Server åˆ—è¡¨çš„ä¸‹ä¸€ä¸ªã€‚</li><li>ç¬¬ 119 è¡Œ ï¼šè°ƒç”¨ <code>CloseableHttpClient#close()</code> æ–¹æ³•ï¼Œè¿›è¡Œå…³é—­ã€‚</li></ul><h2 id="3-2-é…ç½®æ–‡ä»¶"><a href="#3-2-é…ç½®æ–‡ä»¶" class="headerlink" title="3.2 é…ç½®æ–‡ä»¶"></a>3.2 é…ç½®æ–‡ä»¶</h2><p>é…ç½®æ–‡ä»¶å¦‚ä¸‹ ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_10/05.png" alt=""></p><ul><li>ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ—¶ï¼Œ<strong>æ¨è</strong> Agent é…ç½®å¤šä¸ª Naming Server åœ°å€ã€‚</li></ul><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>2017.12.15 å½’é€” ä»åŒ—äº¬å›ä¸Šæµ·ã€‚</p><p>çªç„¶æœ‰ç§æ„Ÿè§‰ï¼Œè·å¾—åƒåŒ…æ–¹ä¾¿é¢ï¼Œå¿«æ·è€Œä¸è¥å…»ã€‚</p><p>æœ‰ç‚¹â€ä¸§â€ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_10/06.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸€æ³¢æœ‹å‹åœˆå¯å¥½ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/collector-naming-server/&quot;&gt;http://www.iocoder.cn/SkyWalking/collector-naming-server/&lt;/a
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” Collector gRPC Server Manager</title>
    <link href="http://www.iocoder.cn/SkyWalking/collector-grpc-server-module/"/>
    <id>http://www.iocoder.cn/SkyWalking/collector-grpc-server-module/</id>
    <published>2020-08-04T16:00:00.000Z</published>
    <updated>2017-12-14T16:41:13.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/collector-grpc-server-module/">http://www.iocoder.cn/SkyWalking/collector-grpc-server-module/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-grpc-server-module/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-grpc-server-module/">2. GRPCManagerModule</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-grpc-server-module/">3. GRPCManagerProvider</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-grpc-server-module/">4. GRPCManagerService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-grpc-server-module/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>Collector gRPC Server Manager</strong>ã€‚Collector é€šè¿‡è¯¥ç®¡ç†å™¨ï¼Œç®¡ç†å¯åŠ¨çš„å¤šä¸ª gRPC Serverï¼Œä¾‹å¦‚ Agent gRPC Serverã€Remote gRPC Server ã€‚<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_05/02.png" alt=""></p><blockquote><p>å‹æƒ…æç¤ºï¼šå»ºè®®èƒ–å‹å·²ç»è¯»è¿‡ <a href="http://www.iocoder.cn/SkyWalking/collector-server-component/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Server Component æœåŠ¡å™¨ç»„ä»¶ã€‹</a></p><p>å¦å¤–ï¼Œæœ¬æ–‡å’Œ <a href="http://www.iocoder.cn/SkyWalking/collector-jetty-server-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Jetty Server Managerã€‹</a> ç›¸ä¼¼åº¦ 99%</p></blockquote><p>gRPC Server Manager åœ¨ SkyWalking æ¶æ„å›¾å¤„äºå¦‚ä¸‹ä½ç½®( <strong>çº¢æ¡†</strong> ) ï¼š</p><blockquote><p>FROM <a href="https://github.com/apache/incubating-skywalking" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/apache/incubating-skywalking</a><br><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_05/01.jpeg" alt=""></p></blockquote><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ•´ä½“çš„é¡¹ç›®ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_05/03.png" alt=""></p><p>ğŸ˜ˆ ä»£ç é‡éå¸¸å°‘ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯ä¸ªå•ç‹¬çš„é¡¹ç›®ï¼Œæ‰€ä»¥å•ç‹¬æˆæ–‡ã€‚</p><h1 id="2-GRPCManagerModule"><a href="#2-GRPCManagerModule" class="headerlink" title="2. GRPCManagerModule"></a>2. GRPCManagerModule</h1><p><code>org.skywalking.apm.collector.grpc.manager.GRPCManagerModule</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Module.java" rel="external nofollow noopener noreferrer" target="_blank">Module</a> æŠ½è±¡ç±»ï¼ŒgRPC Server ç®¡ç†å™¨ Module ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/621598af465bfcefee3432c2ef80aff25a33f1bf/apm-collector/apm-collector-grpc-manager/collector-grpc-manager-define/src/main/java/org/skywalking/apm/collector/grpc/manager/GRPCManagerModule.java#L33" rel="external nofollow noopener noreferrer" target="_blank"><code>#name()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›æ¨¡å—åä¸º <code>&quot;gRPC_manager&quot;</code> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/621598af465bfcefee3432c2ef80aff25a33f1bf/apm-collector/apm-collector-grpc-manager/collector-grpc-manager-define/src/main/java/org/skywalking/apm/collector/grpc/manager/GRPCManagerModule.java#L37" rel="external nofollow noopener noreferrer" target="_blank"><code>#services()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å› Service ç±»åï¼šGRPCManagerService ã€‚</p><h1 id="3-GRPCManagerProvider"><a href="#3-GRPCManagerProvider" class="headerlink" title="3. GRPCManagerProvider"></a>3. GRPCManagerProvider</h1><p><code>org.skywalking.apm.collector.grpc.manager.GRPCManagerProvider</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleProvider.java" rel="external nofollow noopener noreferrer" target="_blank">ModuleProvider</a> <strong>æŠ½è±¡ç±»</strong>ï¼ŒgRPC Server ç®¡ç†å™¨ç»„ä»¶æœåŠ¡æä¾›è€…ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/f9de7bf75f62c16fd05cc0d1beb8f5b756108ec3/apm-collector/apm-collector-grpc-manager/collector-grpc-manager-provider/src/main/java/org/skywalking/apm/collector/grpc/manager/GRPCManagerProvider.java#L46" rel="external nofollow noopener noreferrer" target="_blank"><code>#name()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ç»„ä»¶æœåŠ¡æä¾›è€…åä¸º <code>&quot;gRPC&quot;</code> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/f9de7bf75f62c16fd05cc0d1beb8f5b756108ec3/apm-collector/apm-collector-grpc-manager/collector-grpc-manager-provider/src/main/java/org/skywalking/apm/collector/grpc/manager/GRPCManagerProvider.java#L50" rel="external nofollow noopener noreferrer" target="_blank"><code>module()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ç»„ä»¶ç±»ä¸º GRPCManagerModule ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/f9de7bf75f62c16fd05cc0d1beb8f5b756108ec3/apm-collector/apm-collector-grpc-manager/collector-grpc-manager-provider/src/main/java/org/skywalking/apm/collector/grpc/manager/GRPCManagerProvider.java#L72" rel="external nofollow noopener noreferrer" target="_blank"><code>#requiredModules()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ä¾èµ–ç»„ä»¶ä¸ºç©ºã€‚</p><hr><p><a href="https://github.com/YunaiV/skywalking/blob/f9de7bf75f62c16fd05cc0d1beb8f5b756108ec3/apm-collector/apm-collector-grpc-manager/collector-grpc-manager-provider/src/main/java/org/skywalking/apm/collector/grpc/manager/GRPCManagerProvider.java#L54" rel="external nofollow noopener noreferrer" target="_blank"><code>#prepare(Properties)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå‡†å¤‡é˜¶æ®µé€»è¾‘ã€‚</p><ul><li>ç¬¬ 55 è¡Œ ï¼šåˆ›å»º GRPCManagerServiceImpl å¯¹è±¡ï¼Œå¹¶è°ƒç”¨ <code>#registerServiceImplementation(...)</code> <strong>çˆ¶ç±»</strong>æ–¹æ³•ï¼Œæ³¨å†Œåˆ° <code>services</code> ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/f9de7bf75f62c16fd05cc0d1beb8f5b756108ec3/apm-collector/apm-collector-grpc-manager/collector-grpc-manager-provider/src/main/java/org/skywalking/apm/collector/grpc/manager/GRPCManagerProvider.java#L58" rel="external nofollow noopener noreferrer" target="_blank"><code>#start()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå¯åŠ¨é˜¶æ®µé€»è¾‘ã€‚ç›®å‰æ˜¯ä¸ª<strong>ç©ºæ–¹æ³•</strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/f9de7bf75f62c16fd05cc0d1beb8f5b756108ec3/apm-collector/apm-collector-grpc-manager/collector-grpc-manager-provider/src/main/java/org/skywalking/apm/collector/grpc/manager/GRPCManagerProvider.java#L62" rel="external nofollow noopener noreferrer" target="_blank"><code>#notifyAfterCompleted()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå¯åŠ¨å®Œæˆé€»è¾‘ã€‚</p><ul><li>ç¬¬ 63 è‡³ 69 è¡Œ ï¼šéå†æ³¨å†Œçš„æœåŠ¡å™¨åˆ—è¡¨ï¼Œé€ä¸ªè°ƒç”¨ <code>GRPCServer#start()</code> æ–¹æ³•ï¼Œè¿›è¡Œå¯åŠ¨ã€‚</li></ul><h1 id="4-GRPCManagerService"><a href="#4-GRPCManagerService" class="headerlink" title="4. GRPCManagerService"></a>4. GRPCManagerService</h1><p><code>org.skywalking.apm.collector.grpc.manager.service.GRPCManagerService</code> ï¼Œç»§æ‰¿ <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Service.java" rel="external nofollow noopener noreferrer" target="_blank">Service</a> <strong>æ¥å£</strong>ï¼ŒgRPC Server ç®¡ç†å™¨æœåŠ¡<strong>æ¥å£</strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/48f76a555c043fee2932230077a8112d4888d10f/apm-collector/apm-collector-grpc-manager/collector-grpc-manager-define/src/main/java/org/skywalking/apm/collector/grpc/manager/service/GRPCManagerService.java#L38" rel="external nofollow noopener noreferrer" target="_blank"><code>#createIfAbsent(host, port)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œåˆ›å»º gRPC Server ï¼Œè‹¥ä¸å­˜åœ¨ã€‚</p><p><strong>æ€ä¹ˆæ²¡æœ‰ç±»ä¼¼ JettyManagerService çš„ <code>#addHandler(...)</code> æ–¹æ³•</strong>ï¼Ÿç›®å‰æ˜¯è°ƒç”¨æ–¹ç›´æ¥è°ƒç”¨ <code>#createIfAbsent(host, port)</code> æ–¹æ³•ï¼Œè·å¾— gRPC Server åï¼Œåè°ƒç”¨ <code>Server#addHandler(ServerHandler)</code> æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/9c586ca730cc89d4d5ad6b4294f2779a23925a8c/apm-collector/apm-collector-agent-grpc/collector-agent-grpc-provider/src/main/java/org/skywalking/apm/collector/agent/grpc/AgentModuleGRPCProvider.java#L72" rel="external nofollow noopener noreferrer" target="_blank"><code>AgentModuleGRPCProvider#start(Properties)</code></a></li><li><a href="https://github.com/YunaiV/skywalking/blob/9c586ca730cc89d4d5ad6b4294f2779a23925a8c/apm-collector/apm-collector-remote/collector-remote-grpc-provider/src/main/java/org/skywalking/apm/collector/remote/grpc/RemoteModuleGRPCProvider.java#L61" rel="external nofollow noopener noreferrer" target="_blank"><code>RemoteModuleGRPCProvider#start(Properties)</code></a></li></ul><h2 id="4-1-GRPCManagerServiceImpl"><a href="#4-1-GRPCManagerServiceImpl" class="headerlink" title="4.1 GRPCManagerServiceImpl"></a>4.1 GRPCManagerServiceImpl</h2><p><code>org.skywalking.apm.collector.grpc.manager.service.GRPCManagerServiceImpl</code> ï¼ŒgRPC Server ç®¡ç†å™¨æœåŠ¡<strong>å®ç°ç±»</strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/9c586ca730cc89d4d5ad6b4294f2779a23925a8c/apm-collector/apm-collector-grpc-manager/collector-grpc-manager-provider/src/main/java/org/skywalking/apm/collector/grpc/manager/service/GRPCManagerServiceImpl.java#L44" rel="external nofollow noopener noreferrer" target="_blank"><strong>æ„é€ æ–¹æ³•</strong></a> ï¼Œä½¿ç”¨æ¥è‡ª GRPCManagerProvider çš„ <code>servers</code> æœåŠ¡å™¨æ•°ç»„ã€‚<strong>è¿™æ˜¯ä¸ºä»€ä¹ˆ GRPCManagerProvider æ²¡æœ‰å¯¹ <code>servers</code> åšæ–°å¢æ“ä½œï¼Œç»“æœé‡Œé¢æœ‰æ•°æ®çš„åŸå› </strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/9c586ca730cc89d4d5ad6b4294f2779a23925a8c/apm-collector/apm-collector-grpc-manager/collector-grpc-manager-provider/src/main/java/org/skywalking/apm/collector/grpc/manager/service/GRPCManagerServiceImpl.java#L48" rel="external nofollow noopener noreferrer" target="_blank"><code>#createIfAbsent(host, port)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œåˆ›å»º gRPC Server ï¼Œè‹¥ä¸å­˜åœ¨ã€‚åˆ¤æ–­æ–¹å¼ä¸º <code>host + port</code> ä¸ºå”¯ä¸€ã€‚</p><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>å‘µå‘µå“’çš„ä¸€ç¯‡ï¼Œå˜¿å˜¿ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_05/04.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸ªæœ‹å‹åœˆå¯å¥½ï¼Ÿ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/collector-grpc-server-module/&quot;&gt;http://www.iocoder.cn/SkyWalking/collector-grpc-server-
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” Collector Jetty Server Manager</title>
    <link href="http://www.iocoder.cn/SkyWalking/collector-jetty-server-module/"/>
    <id>http://www.iocoder.cn/SkyWalking/collector-jetty-server-module/</id>
    <published>2020-07-31T16:00:00.000Z</published>
    <updated>2017-12-14T16:30:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/collector-jetty-server-module/">http://www.iocoder.cn/SkyWalking/collector-jetty-server-module/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-jetty-server-module/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-jetty-server-module/">2. JettyManagerModule</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-jetty-server-module/">3. JettyManagerProvider</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-jetty-server-module/">4. JettyManagerService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-jetty-server-module/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>Collector Jetty Server Manager</strong>ã€‚Collector é€šè¿‡è¯¥ç®¡ç†å™¨ï¼Œç®¡ç†å¯åŠ¨çš„å¤šä¸ª Jetty Serverï¼Œä¾‹å¦‚ Agent Jetty Serverã€Naming Jetty Serverã€UI Jetty Serverã€‚<img src="http://www.iocoder.cn/images/SkyWalking/2020_08_01/02.png" alt=""></p><blockquote><p>å‹æƒ…æç¤ºï¼šå»ºè®®èƒ–å‹å·²ç»è¯»è¿‡ <a href="http://www.iocoder.cn/SkyWalking/collector-server-component/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Server Component æœåŠ¡å™¨ç»„ä»¶ã€‹</a></p></blockquote><p>Jetty Server Manager åœ¨ SkyWalking æ¶æ„å›¾å¤„äºå¦‚ä¸‹ä½ç½®( <strong>çº¢æ¡†</strong> ) ï¼š</p><blockquote><p>FROM <a href="https://github.com/apache/incubating-skywalking" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/apache/incubating-skywalking</a><br><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_01/01.jpeg" alt=""></p></blockquote><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ•´ä½“çš„é¡¹ç›®ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_01/03.png" alt=""></p><p>ğŸ˜ˆ ä»£ç é‡éå¸¸å°‘ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯ä¸ªå•ç‹¬çš„é¡¹ç›®ï¼Œæ‰€ä»¥å•ç‹¬æˆæ–‡ã€‚</p><h1 id="2-JettyManagerModule"><a href="#2-JettyManagerModule" class="headerlink" title="2. JettyManagerModule"></a>2. JettyManagerModule</h1><p><code>org.skywalking.apm.collector.jetty.manager.JettyManagerModule</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Module.java" rel="external nofollow noopener noreferrer" target="_blank">Module</a> æŠ½è±¡ç±»ï¼ŒJetty ç®¡ç†å™¨ Module ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/39ee2260b8463316550c52276109a5af917e34e8/apm-collector/apm-collector-jetty-manager/collector-jetty-manager-define/src/main/java/org/skywalking/apm/collector/jetty/manager/JettyManagerModule.java#L33" rel="external nofollow noopener noreferrer" target="_blank"><code>#name()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›æ¨¡å—åä¸º <code>&quot;jetty_manager&quot;</code> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/39ee2260b8463316550c52276109a5af917e34e8/apm-collector/apm-collector-jetty-manager/collector-jetty-manager-define/src/main/java/org/skywalking/apm/collector/jetty/manager/JettyManagerModule.java#L37" rel="external nofollow noopener noreferrer" target="_blank"><code>#services()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å› Service ç±»åï¼šJettyManagerService ã€‚</p><h1 id="3-JettyManagerProvider"><a href="#3-JettyManagerProvider" class="headerlink" title="3. JettyManagerProvider"></a>3. JettyManagerProvider</h1><p><code>org.skywalking.apm.collector.jetty.manager.JettyManagerProvider</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleProvider.java" rel="external nofollow noopener noreferrer" target="_blank">ModuleProvider</a> <strong>æŠ½è±¡ç±»</strong>ï¼ŒJetty ç®¡ç†å™¨ç»„ä»¶æœåŠ¡æä¾›è€…ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/39ee2260b8463316550c52276109a5af917e34e8/apm-collector/apm-collector-jetty-manager/collector-jetty-manager-provider/src/main/java/org/skywalking/apm/collector/jetty/manager/JettyManagerProvider.java#L46" rel="external nofollow noopener noreferrer" target="_blank"><code>#name()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ç»„ä»¶æœåŠ¡æä¾›è€…åä¸º <code>&quot;jetty&quot;</code> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/39ee2260b8463316550c52276109a5af917e34e8/apm-collector/apm-collector-jetty-manager/collector-jetty-manager-provider/src/main/java/org/skywalking/apm/collector/jetty/manager/JettyManagerProvider.java#L50" rel="external nofollow noopener noreferrer" target="_blank"><code>module()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ç»„ä»¶ç±»ä¸º JettyManagerModule ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/39ee2260b8463316550c52276109a5af917e34e8/apm-collector/apm-collector-jetty-manager/collector-jetty-manager-provider/src/main/java/org/skywalking/apm/collector/jetty/manager/JettyManagerProvider.java#L72" rel="external nofollow noopener noreferrer" target="_blank"><code>#requiredModules()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ä¾èµ–ç»„ä»¶ä¸ºç©ºã€‚</p><hr><p><a href="https://github.com/YunaiV/skywalking/blob/39ee2260b8463316550c52276109a5af917e34e8/apm-collector/apm-collector-jetty-manager/collector-jetty-manager-provider/src/main/java/org/skywalking/apm/collector/jetty/manager/JettyManagerProvider.java#L54" rel="external nofollow noopener noreferrer" target="_blank"><code>#prepare(Properties)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå‡†å¤‡é˜¶æ®µé€»è¾‘ã€‚</p><ul><li>ç¬¬ 55 è¡Œ ï¼šåˆ›å»º JettyManagerServiceImpl å¯¹è±¡ï¼Œå¹¶è°ƒç”¨ <code>#registerServiceImplementation(...)</code> <strong>çˆ¶ç±»</strong>æ–¹æ³•ï¼Œæ³¨å†Œåˆ° <code>services</code> ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/39ee2260b8463316550c52276109a5af917e34e8/apm-collector/apm-collector-jetty-manager/collector-jetty-manager-provider/src/main/java/org/skywalking/apm/collector/jetty/manager/JettyManagerProvider.java#L58" rel="external nofollow noopener noreferrer" target="_blank"><code>#start()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå¯åŠ¨é˜¶æ®µé€»è¾‘ã€‚ç›®å‰æ˜¯ä¸ª<strong>ç©ºæ–¹æ³•</strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/39ee2260b8463316550c52276109a5af917e34e8/apm-collector/apm-collector-jetty-manager/collector-jetty-manager-provider/src/main/java/org/skywalking/apm/collector/jetty/manager/JettyManagerProvider.java#L61" rel="external nofollow noopener noreferrer" target="_blank"><code>#notifyAfterCompleted()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå¯åŠ¨å®Œæˆé€»è¾‘ã€‚</p><ul><li>ç¬¬ 63 è‡³ 69 è¡Œ ï¼šéå†æ³¨å†Œçš„æœåŠ¡å™¨åˆ—è¡¨ï¼Œé€ä¸ªè°ƒç”¨ <code>JettyServer#start()</code> æ–¹æ³•ï¼Œè¿›è¡Œå¯åŠ¨ã€‚</li></ul><h1 id="4-JettyManagerService"><a href="#4-JettyManagerService" class="headerlink" title="4. JettyManagerService"></a>4. JettyManagerService</h1><p><code>org.skywalking.apm.collector.jetty.manager.service.JettyManagerService</code> ï¼Œç»§æ‰¿ <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Service.java" rel="external nofollow noopener noreferrer" target="_blank">Service</a> <strong>æ¥å£</strong>ï¼ŒJetty ç®¡ç†å™¨æœåŠ¡<strong>æ¥å£</strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/71993b1790b29df66644334dcfe1796e889ddc9b/apm-collector/apm-collector-jetty-manager/collector-jetty-manager-define/src/main/java/org/skywalking/apm/collector/jetty/manager/service/JettyManagerService.java#L40" rel="external nofollow noopener noreferrer" target="_blank"><code>#createIfAbsent(host, port, contextPath)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œåˆ›å»º Jetty Server ï¼Œè‹¥ä¸å­˜åœ¨ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/71993b1790b29df66644334dcfe1796e889ddc9b/apm-collector/apm-collector-jetty-manager/collector-jetty-manager-define/src/main/java/org/skywalking/apm/collector/jetty/manager/service/JettyManagerService.java#L49" rel="external nofollow noopener noreferrer" target="_blank"><code>#addHandler(host, port, serverHandler)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œæ·»åŠ  Jetty Server è¯·æ±‚å¤„ç†å™¨ã€‚</p><h2 id="4-1-JettyManagerServiceImpl"><a href="#4-1-JettyManagerServiceImpl" class="headerlink" title="4.1 JettyManagerServiceImpl"></a>4.1 JettyManagerServiceImpl</h2><p><code>org.skywalking.apm.collector.jetty.manager.service.JettyManagerServiceImpl</code> ï¼ŒJetty ç®¡ç†å™¨æœåŠ¡<strong>å®ç°ç±»</strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/21a84f89165f74c7fe702650ff4d12db5a9613e4/apm-collector/apm-collector-jetty-manager/collector-jetty-manager-provider/src/main/java/org/skywalking/apm/collector/jetty/manager/service/JettyManagerServiceImpl.java#L46" rel="external nofollow noopener noreferrer" target="_blank"><strong>æ„é€ æ–¹æ³•</strong></a> ï¼Œä½¿ç”¨æ¥è‡ª JettyManagerProvider çš„ <code>servers</code> æœåŠ¡å™¨æ•°ç»„ã€‚<strong>è¿™æ˜¯ä¸ºä»€ä¹ˆ JettyManagerProvider æ²¡æœ‰å¯¹ <code>servers</code> åšæ–°å¢æ“ä½œï¼Œç»“æœé‡Œé¢æœ‰æ•°æ®çš„åŸå› </strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/21a84f89165f74c7fe702650ff4d12db5a9613e4/apm-collector/apm-collector-jetty-manager/collector-jetty-manager-provider/src/main/java/org/skywalking/apm/collector/jetty/manager/service/JettyManagerServiceImpl.java#L50" rel="external nofollow noopener noreferrer" target="_blank"><code>#createIfAbsent(host, port, contextPath)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œåˆ›å»º Jetty Server ï¼Œè‹¥ä¸å­˜åœ¨ã€‚åˆ¤æ–­æ–¹å¼ä¸º <code>host + port</code> ä¸ºå”¯ä¸€ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/21a84f89165f74c7fe702650ff4d12db5a9613e4/apm-collector/apm-collector-jetty-manager/collector-jetty-manager-provider/src/main/java/org/skywalking/apm/collector/jetty/manager/service/JettyManagerServiceImpl.java#L66" rel="external nofollow noopener noreferrer" target="_blank"><code>#addHandler(host, port, serverHandler)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ·»åŠ  Jetty Server è¯·æ±‚å¤„ç†å™¨ã€‚åˆ¤æ–­æ–¹å¼ä¸º <code>host + port</code> ä¸ºå”¯ä¸€ã€‚</p><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>å‘µå‘µå“’çš„ä¸€ç¯‡ï¼Œå˜¿å˜¿ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_08_01/04.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸ªæœ‹å‹åœˆå¯å¥½ï¼Ÿ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/collector-jetty-server-module/&quot;&gt;http://www.iocoder.cn/SkyWalking/collector-jetty-serve
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” Collector Server Component æœåŠ¡å™¨ç»„ä»¶</title>
    <link href="http://www.iocoder.cn/SkyWalking/collector-server-component/"/>
    <id>http://www.iocoder.cn/SkyWalking/collector-server-component/</id>
    <published>2020-07-27T16:00:00.000Z</published>
    <updated>2017-12-14T14:44:47.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/collector-server-component/">http://www.iocoder.cn/SkyWalking/collector-server-component/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-server-component/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-server-component/">2. æ¥å£</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-server-component/">2.1 Server</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-server-component/">2.2 ServerHandler</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-server-component/">3. gRPC å®ç°</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-server-component/">3.1 GRPCServer</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-server-component/">3.2 GRPCHandler</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-server-component/">4. Jetty å®ç°</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-server-component/">3.1 JettyServer</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-server-component/">3.2 JettyHandler</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-server-component/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>SkyWalking Collector Server Component æœåŠ¡å™¨ç»„ä»¶</strong>ã€‚Collector é€šè¿‡æœåŠ¡å™¨ï¼Œæä¾› API æ¥å£ç»™è°ƒç”¨æ–¹ï¼Œä¾‹å¦‚ Agent ã€WebUI ã€‚</p><p>Server Component åœ¨ SkyWalking æ¶æ„å›¾å¤„äºå¦‚ä¸‹ä½ç½®( <strong>çº¢æ¡†</strong> ) ï¼š</p><blockquote><p>FROM <a href="https://github.com/apache/incubating-skywalking" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/apache/incubating-skywalking</a><br><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_25/01.jpeg" alt=""></p></blockquote><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ•´ä½“çš„é¡¹ç›®ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_28/02.png" alt=""></p><p>OKï¼Œæˆ‘ä»¬ä»<strong>æ¥å£åˆ°å®ç°</strong>çš„é¡ºåºè¿›è¡Œåˆ†äº«ã€‚</p><h1 id="2-æ¥å£"><a href="#2-æ¥å£" class="headerlink" title="2. æ¥å£"></a>2. æ¥å£</h1><h2 id="2-1-Server"><a href="#2-1-Server" class="headerlink" title="2.1 Server"></a>2.1 Server</h2><p><code>org.skywalking.apm.collector.server.Server</code> ï¼ŒæœåŠ¡å™¨<strong>æ¥å£</strong>ã€‚å…¶å®ç°å­ç±»ï¼Œå¦‚ä¸‹ç±»å›¾ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_28/03.png" alt=""></p><p><a href="https://github.com/YunaiV/skywalking/blob/ceee65ca1e03c34a756922034f85c5d95b8f2178/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/Server.java#L31" rel="external nofollow noopener noreferrer" target="_blank"><code>#hostPort()</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œè·å¾—æœåŠ¡å™¨åœ°å€ã€‚<br><a href="https://github.com/YunaiV/skywalking/blob/ceee65ca1e03c34a756922034f85c5d95b8f2178/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/Server.java#L36" rel="external nofollow noopener noreferrer" target="_blank"><code>#serverClassify()</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œè·å¾—æœåŠ¡å™¨åˆ†ç±»ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ceee65ca1e03c34a756922034f85c5d95b8f2178/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/Server.java#L43" rel="external nofollow noopener noreferrer" target="_blank"><code>#initialize()</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œåˆå§‹åŒ–æœåŠ¡å™¨ã€‚<br><a href="https://github.com/YunaiV/skywalking/blob/ceee65ca1e03c34a756922034f85c5d95b8f2178/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/Server.java#L50" rel="external nofollow noopener noreferrer" target="_blank"><code>#start()</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œå¯åŠ¨æœåŠ¡å™¨ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ceee65ca1e03c34a756922034f85c5d95b8f2178/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/Server.java#L57" rel="external nofollow noopener noreferrer" target="_blank"><code>#addHandler()</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œæ·»åŠ è¯·æ±‚å¤„ç†å™¨( ServerHandler )</p><h2 id="2-2-ServerHandler"><a href="#2-2-ServerHandler" class="headerlink" title="2.2 ServerHandler"></a>2.2 ServerHandler</h2><p><a href="https://github.com/YunaiV/skywalking/blob/ceee65ca1e03c34a756922034f85c5d95b8f2178/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/ServerHandler.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.server.ServerHandler</code></a> ï¼ŒæœåŠ¡å™¨å¤„ç†å™¨<strong>æ¥å£</strong>ã€‚å…¶å®ç°å­ç±»ï¼Œå¦‚ä¸‹ç±»å›¾ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_28/04.png" alt=""></p><p>ServerHandler æ— ä»»ä½•æ¥å£æ–¹æ³•ã€‚</p><p>ä¸€ä¸ª ServerHandler å¯¹åº”ä¸€ä¸ªè¯·æ±‚çš„å¤„ç†ã€‚</p><h1 id="3-gRPC-å®ç°"><a href="#3-gRPC-å®ç°" class="headerlink" title="3. gRPC å®ç°"></a>3. gRPC å®ç°</h1><h2 id="3-1-GRPCServer"><a href="#3-1-GRPCServer" class="headerlink" title="3.1 GRPCServer"></a>3.1 GRPCServer</h2><p><code>org.skywalking.apm.collector.server.grpc.GRPCServer</code> ï¼ŒåŸºäº gRPC çš„æœåŠ¡å™¨å®ç°ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ceee65ca1e03c34a756922034f85c5d95b8f2178/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/grpc/GRPCServer.java#L47" rel="external nofollow noopener noreferrer" target="_blank"><code>#hostPort()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè·å¾—æœåŠ¡å™¨åœ°å€ã€‚<br><a href="https://github.com/YunaiV/skywalking/blob/ceee65ca1e03c34a756922034f85c5d95b8f2178/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/grpc/GRPCServer.java#L51" rel="external nofollow noopener noreferrer" target="_blank"><code>#serverClassify()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè·å¾—æœåŠ¡å™¨åˆ†ç±»ä¸º <code>&quot;Google-RPC&quot;</code>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ceee65ca1e03c34a756922034f85c5d95b8f2178/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/grpc/GRPCServer.java#L55" rel="external nofollow noopener noreferrer" target="_blank"><code>#initialize()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè°ƒç”¨ <code>io.grpc.netty.NettyServerBuilder#forAddress(address)</code> æ–¹æ³•ï¼ŒNettyServerBuilder ã€‚æ­¤å¤„ï¼ŒæœåŠ¡å™¨å¹¶æœªåˆ›å»ºä¸å¯åŠ¨ã€‚<br><a href="https://github.com/YunaiV/skywalking/blob/ceee65ca1e03c34a756922034f85c5d95b8f2178/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/grpc/GRPCServer.java#L61" rel="external nofollow noopener noreferrer" target="_blank"><code>#start()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œåˆ›å»º <code>io.grpc.Server</code> å¯¹è±¡ï¼Œå¹¶å¯åŠ¨æœåŠ¡å™¨ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ceee65ca1e03c34a756922034f85c5d95b8f2178/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/grpc/GRPCServer.java#L70" rel="external nofollow noopener noreferrer" target="_blank"><code>#addHandler(handler)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè°ƒç”¨ <code>NettyServerBuilder#addService(...)</code> æ–¹æ³•ï¼Œæ·»åŠ  gRPC è¯·æ±‚å¤„ç†å™¨( GRPCHandler )ã€‚</p><p>ç›®å‰ï¼ŒGRPCServer ä½¿ç”¨åœ¨ <a href="https://github.com/YunaiV/skywalking/blob/ceee65ca1e03c34a756922034f85c5d95b8f2178/apm-collector/apm-collector-agent-grpc/collector-agent-grpc-provider/" rel="external nofollow noopener noreferrer" target="_blank"><code>collector-agent-grpc-provider</code></a> / <a href="https://github.com/YunaiV/skywalking/tree/ceee65ca1e03c34a756922034f85c5d95b8f2178/apm-collector/apm-collector-remote/collector-remote-grpc-provider" rel="external nofollow noopener noreferrer" target="_blank"><code>collector-remote-grpc-provider</code></a> é¡¹ç›®ã€‚</p><h2 id="3-2-GRPCHandler"><a href="#3-2-GRPCHandler" class="headerlink" title="3.2 GRPCHandler"></a>3.2 GRPCHandler</h2><p><a href="https://github.com/YunaiV/skywalking/blob/ceee65ca1e03c34a756922034f85c5d95b8f2178/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/ServerHandler.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.server.grpc.GRPCHandler</code></a> ï¼ŒgRPC è¯·æ±‚å¤„ç†å™¨<strong>æ¥å£</strong>ã€‚å…¶å®ç°å­ç±»ï¼Œå¦‚ä¸‹ç±»å›¾ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_28/05.png" alt=""></p><p>GRPCHandler æ— ä»»ä½•æ¥å£æ–¹æ³•ã€‚</p><h1 id="4-Jetty-å®ç°"><a href="#4-Jetty-å®ç°" class="headerlink" title="4. Jetty å®ç°"></a>4. Jetty å®ç°</h1><h2 id="3-1-JettyServer"><a href="#3-1-JettyServer" class="headerlink" title="3.1 JettyServer"></a>3.1 JettyServer</h2><p><code>org.skywalking.apm.collector.server.jetty.JettyServer</code> ï¼ŒåŸºäº Jetty çš„æœåŠ¡å™¨å®ç°ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/3c964d8b5678cf6f715dc252e6fe48ba87d0f9e9/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/jetty/JettyServer.java#L52" rel="external nofollow noopener noreferrer" target="_blank"><code>#hostPort()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè·å¾—æœåŠ¡å™¨åœ°å€ã€‚<br><a href="https://github.com/YunaiV/skywalking/blob/3c964d8b5678cf6f715dc252e6fe48ba87d0f9e9/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/jetty/JettyServer.java#L56" rel="external nofollow noopener noreferrer" target="_blank"><code>#serverClassify()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè·å¾—æœåŠ¡å™¨åˆ†ç±»ä¸º <code>&quot;Jetty&quot;</code>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/3c964d8b5678cf6f715dc252e6fe48ba87d0f9e9/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/jetty/JettyServer.java#L60" rel="external nofollow noopener noreferrer" target="_blank"><code>#initialize()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œåˆ›å»º <code>org.eclipse.jetty.server.Server</code> å’Œ <code>org.eclipse.jetty.servle.ServletContextHandler</code> å¯¹è±¡ã€‚æ­¤å¤„ï¼ŒæœåŠ¡å™¨å¹¶æœªå¯åŠ¨ã€‚<br><a href="https://github.com/YunaiV/skywalking/blob/3c964d8b5678cf6f715dc252e6fe48ba87d0f9e9/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/jetty/JettyServer.java#L80" rel="external nofollow noopener noreferrer" target="_blank"><code>#start()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œå¯åŠ¨æœåŠ¡å™¨ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/3c964d8b5678cf6f715dc252e6fe48ba87d0f9e9/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/jetty/JettyServer.java#L72" rel="external nofollow noopener noreferrer" target="_blank"><code>#addHandler(handler)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œä½¿ç”¨ ServerHandler åˆ›å»º <code>org.eclipse.jetty.servlet.ServletHolder</code> å¯¹è±¡ï¼Œå¹¶è°ƒç”¨ <code>ServletContextHandler#addServlet(servlet, pathSpec)</code> æ–¹æ³•è¿›è¡Œæ·»åŠ ã€‚</p><p>ç›®å‰ï¼ŒJettyServer ä½¿ç”¨åœ¨ <a href="https://github.com/YunaiV/skywalking/tree/3c964d8b5678cf6f715dc252e6fe48ba87d0f9e9/apm-collector/apm-collector-agent-jetty/collector-agent-jetty-provider" rel="external nofollow noopener noreferrer" target="_blank"><code>collector-agent-jetty-provider</code></a> / <a href="https://github.com/YunaiV/skywalking/tree/3c964d8b5678cf6f715dc252e6fe48ba87d0f9e9/apm-collector/apm-collector-ui/collector-ui-jetty-provider" rel="external nofollow noopener noreferrer" target="_blank"><code>collector-ui-jetty-provider</code></a> é¡¹ç›®ã€‚</p><h2 id="3-2-JettyHandler"><a href="#3-2-JettyHandler" class="headerlink" title="3.2 JettyHandler"></a>3.2 JettyHandler</h2><p><code>org.skywalking.apm.collector.server.jetty.JettyHandler</code> ï¼Œç»§æ‰¿ <code>javax.servlet.http.HttpServlet</code> <strong>æŠ½è±¡ç±»</strong>ï¼ŒJetty è¯·æ±‚å¤„ç†ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/3c964d8b5678cf6f715dc252e6fe48ba87d0f9e9/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/jetty/JettyHandler.java#L43" rel="external nofollow noopener noreferrer" target="_blank"><code>#pathSpec()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œè¯·æ±‚è·¯å¾„å®šä¹‰ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/3c964d8b5678cf6f715dc252e6fe48ba87d0f9e9/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/jetty/JettyHandler.java#L61" rel="external nofollow noopener noreferrer" target="_blank"><code>#doGet(HttpServletRequest)</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œå¤„ç† Get è¯·æ±‚ï¼Œå¹¶è¿”å› <code>com.google.gson.JsonElement</code> å¯¹è±¡ã€‚</p><ul><li>è¯¥æŠ½è±¡æ–¹æ³•ä¼šè¢« <a href="https://github.com/YunaiV/skywalking/blob/3c964d8b5678cf6f715dc252e6fe48ba87d0f9e9/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/jetty/JettyHandler.java#L46" rel="external nofollow noopener noreferrer" target="_blank"><code>#doGet(HttpServletRequest, HttpServletResponse)</code></a> æ–¹æ³•è°ƒç”¨ã€‚<ul><li>æˆåŠŸæ—¶ï¼Œè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/3c964d8b5678cf6f715dc252e6fe48ba87d0f9e9/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/jetty/JettyHandler.java#L174" rel="external nofollow noopener noreferrer" target="_blank"><code>#reply(HttpServletResponse, JsonElement)</code></a> æ–¹æ³•ï¼Œè¿”å› JSON ã€‚</li><li>é”™è¯¯æ—¶ï¼Œè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/3c964d8b5678cf6f715dc252e6fe48ba87d0f9e9/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/jetty/JettyHandler.java#L195" rel="external nofollow noopener noreferrer" target="_blank"><code>#replyError(HttpServletResponse, errorMessage, status)</code></a> æ–¹æ³•ï¼Œè¿”å› JSON ã€‚</li></ul></li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/3c964d8b5678cf6f715dc252e6fe48ba87d0f9e9/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/jetty/JettyHandler.java#L79" rel="external nofollow noopener noreferrer" target="_blank"><code>#doPost(HttpServletRequest)</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œå¤„ç† Post è¯·æ±‚ï¼Œå¹¶è¿”å› <code>com.google.gson.JsonElement</code> å¯¹è±¡ã€‚</p><ul><li>è¯¥æŠ½è±¡æ–¹æ³•ä¼šè¢« <a href="https://github.com/YunaiV/skywalking/blob/3c964d8b5678cf6f715dc252e6fe48ba87d0f9e9/apm-collector/apm-collector-component/server-component/src/main/java/org/skywalking/apm/collector/server/jetty/JettyHandler.java#L64" rel="external nofollow noopener noreferrer" target="_blank"><code>#doPost(HttpServletRequest, HttpServletResponse)</code></a> æ–¹æ³•è°ƒç”¨ã€‚</li></ul><p><strong>HttpServlet æ‰€æœ‰æ–¹æ³•è¢«é‡å†™ï¼Œå¹¶æ ‡è®° <code>final</code> ä¿®é¥°ç¬¦ï¼Œä¸å…è®¸å­ç±»é‡å†™</strong>ã€‚</p><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>åˆåŒå’å•æˆåŠŸæ›´æ–°äº†ä¸€ç¯‡æ°´æ–‡ã€‚ğŸ˜œ</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_28/06.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸ªæœ‹å‹åœˆå¯å¥½ï¼Ÿ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/collector-server-component/&quot;&gt;http://www.iocoder.cn/SkyWalking/collector-server-compone
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” Collector Client Component å®¢æˆ·ç«¯ç»„ä»¶</title>
    <link href="http://www.iocoder.cn/SkyWalking/collector-client-component/"/>
    <id>http://www.iocoder.cn/SkyWalking/collector-client-component/</id>
    <published>2020-07-24T16:00:00.000Z</published>
    <updated>2017-12-14T14:44:42.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/collector-client-component/">http://www.iocoder.cn/SkyWalking/collector-client-component/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-client-component/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-client-component/">2. Client</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-client-component/">3. ElasticSearchClient</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-client-component/">4. GRPCClient</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-client-component/">5. H2Client</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-client-component/">6. RedisClient</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-client-component/">7. ZookeeperClient</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-client-component/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>SkyWalking Collector Client Component å®¢æˆ·ç«¯ç»„ä»¶</strong>ã€‚Collector é€šè¿‡å®¢æˆ·ç«¯ï¼Œå’Œå…¶ä»–æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œä¾‹å¦‚ Elastic Search ã€Zookeeper ã€H2 ç­‰ç­‰ã€‚</p><p>Client Component åœ¨ SkyWalking æ¶æ„å›¾å¤„äºå¦‚ä¸‹ä½ç½®( <strong>çº¢æ¡†</strong> ) ï¼š</p><blockquote><p>FROM <a href="https://github.com/apache/incubating-skywalking" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/apache/incubating-skywalking</a><br><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_25/01.jpeg" alt=""></p></blockquote><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ•´ä½“çš„é¡¹ç›®ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_25/02.png" alt=""></p><p>OKï¼Œæˆ‘ä»¬ä»<strong>æ¥å£åˆ°å®ç°</strong>çš„é¡ºåºè¿›è¡Œåˆ†äº«ã€‚</p><h1 id="2-Client"><a href="#2-Client" class="headerlink" title="2. Client"></a>2. Client</h1><p><a href="https://github.com/YunaiV/skywalking/blob/c546a9a4d4588d99bf532da519ae721ef60b918e/apm-collector/apm-collector-component/client-component/src/main/java/org/skywalking/apm/collector/client/Client.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.client.Client</code></a> ï¼Œå®¢æˆ·ç«¯<strong>æ¥å£</strong>ã€‚å…¶å®šä¹‰æ¥å£æ–¹æ³•å¦‚ä¸‹ï¼š</p><ul><li><code>#initialize()</code> æ–¹æ³•ï¼Œåˆå§‹åŒ–å®¢æˆ·ç«¯ã€‚</li><li><code>#shutdown()</code> æ–¹æ³•ï¼Œå…³é—­å®¢æˆ·ç«¯ã€‚</li></ul><p>Client çš„å®ç°ç±»ï¼Œå¦‚ä¸‹ç±»å›¾ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_25/03.png" alt=""></p><h1 id="3-ElasticSearchClient"><a href="#3-ElasticSearchClient" class="headerlink" title="3. ElasticSearchClient"></a>3. ElasticSearchClient</h1><p><a href="https://github.com/YunaiV/skywalking/blob/001f700612ad52bc1eb1a278bc0e2ff9e5330df8/apm-collector/apm-collector-component/client-component/src/main/java/org/skywalking/apm/collector/client/elasticsearch/ElasticSearchClient.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.client.elasticsearch.ElasticSearchClient</code></a> ï¼ŒElastic Search å®¢æˆ·ç«¯ã€‚ </p><p>åŸºäº <code>org.elasticsearch.client.transport</code> çš„ <code>5.5.0</code> ç‰ˆæœ¬ï¼Œå°è£… SkyWalking éœ€è¦çš„ Elastic Search æ“ä½œã€‚ç›®å‰ç”¨äº <a href="https://github.com/YunaiV/skywalking/blob/001f700612ad52bc1eb1a278bc0e2ff9e5330df8/apm-collector/apm-collector-storage/collector-storage-es-provider" rel="external nofollow noopener noreferrer" target="_blank"><code>collector-storage-es-provider</code></a> æ¨¡å—ã€‚</p><h1 id="4-GRPCClient"><a href="#4-GRPCClient" class="headerlink" title="4. GRPCClient"></a>4. GRPCClient</h1><p><a href="https://github.com/YunaiV/skywalking/blob/001f700612ad52bc1eb1a278bc0e2ff9e5330df8/apm-collector/apm-collector-component/client-component/src/main/java/org/skywalking/apm/collector/client/grpc/GRPCClient.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.client.grpc.GRPCClient</code></a> ï¼ŒgRPC å®¢æˆ·ç«¯ã€‚</p><p>åŸºäº <code>io.grpc.grpc-core</code> çš„ <code>1.8.0</code> ç‰ˆæœ¬ï¼Œå°è£… SkyWalking éœ€è¦çš„ gRPC æ“ä½œã€‚ç›®å‰ç”¨äº <a href="https://github.com/YunaiV/skywalking/tree/001f700612ad52bc1eb1a278bc0e2ff9e5330df8/apm-collector/apm-collector-remote/collector-remote-grpc-provider" rel="external nofollow noopener noreferrer" target="_blank"><code>collector-remote-grpc-provider</code></a> æ¨¡å—ã€‚ </p><h1 id="5-H2Client"><a href="#5-H2Client" class="headerlink" title="5. H2Client"></a>5. H2Client</h1><p><a href="https://github.com/YunaiV/skywalking/blob/001f700612ad52bc1eb1a278bc0e2ff9e5330df8/apm-collector/apm-collector-component/client-component/src/main/java/org/skywalking/apm/collector/client/h2/H2Client.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.client.h2.H2Client</code></a> ï¼ŒH2 æ•°æ®åº“å®¢æˆ·ç«¯ã€‚</p><p>åŸºäº <code>com.h2database.h2</code> çš„ <code>1.4.196</code> ç‰ˆæœ¬ï¼Œå°è£… SkyWalking éœ€è¦çš„ H2 æ•°æ®åº“æ“ä½œã€‚ç›®å‰ç”¨äº <a href="https://github.com/YunaiV/skywalking/tree/001f700612ad52bc1eb1a278bc0e2ff9e5330df8/apm-collector/apm-collector-storage/collector-storage-h2-provider" rel="external nofollow noopener noreferrer" target="_blank"><code>collector-storage-h2-provider</code></a> / <a href="https://github.com/YunaiV/skywalking/tree/001f700612ad52bc1eb1a278bc0e2ff9e5330df8/apm-collector/apm-collector-cluster/collector-cluster-standalone-provider" rel="external nofollow noopener noreferrer" target="_blank"><code>collector-cluster-standalone-provider</code></a> æ¨¡å—ã€‚</p><h1 id="6-RedisClient"><a href="#6-RedisClient" class="headerlink" title="6. RedisClient"></a>6. RedisClient</h1><p><a href="https://github.com/YunaiV/skywalking/blob/001f700612ad52bc1eb1a278bc0e2ff9e5330df8/apm-collector/apm-collector-component/client-component/src/main/java/org/skywalking/apm/collector/client/redis/RedisClient.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.client.redis.RedisClient</code></a> ï¼ŒRedis å®¢æˆ·ç«¯ã€‚</p><p>åŸºäº <code>redis.clients.jedis</code> çš„ <code>2.9.0</code> ç‰ˆæœ¬ï¼Œå°è£… SkyWalking éœ€è¦çš„ Reids æ“ä½œã€‚é¢„è®¡æœªæ¥ç”¨äº <a href="https://github.com/YunaiV/skywalking/tree/001f700612ad52bc1eb1a278bc0e2ff9e5330df8/apm-collector/apm-collector-cluster/collector-cluster-redis-provider" rel="external nofollow noopener noreferrer" target="_blank"><code>collector-cluster-redis-provider</code></a> æ¨¡å—ã€‚</p><h1 id="7-ZookeeperClient"><a href="#7-ZookeeperClient" class="headerlink" title="7. ZookeeperClient"></a>7. ZookeeperClient</h1><p><a href="https://github.com/YunaiV/skywalking/blob/001f700612ad52bc1eb1a278bc0e2ff9e5330df8/apm-collector/apm-collector-component/client-component/src/main/java/org/skywalking/apm/collector/client/zookeeper/ZookeeperClient.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.client.zookeeper.ZookeeperClient</code></a> ï¼ŒZookeeper å®¢æˆ·ç«¯ã€‚</p><p>åŸºäº <code>org.apache.zookeeper.zookeeper</code> çš„ <code>3.4.10</code> ç‰ˆæœ¬ï¼Œå°è£… SkyWalking éœ€è¦çš„ Zookeeper æ“ä½œã€‚é¢„è®¡æœªæ¥ç”¨äº <a href="https://github.com/YunaiV/skywalking/tree/001f700612ad52bc1eb1a278bc0e2ff9e5330df8/apm-collector/apm-collector-cluster/collector-cluster-zookeeper-provider" rel="external nofollow noopener noreferrer" target="_blank"><code>collector-cluster-zookeeper-provider</code></a> æ¨¡å—ã€‚</p><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>å“ˆå“ˆå“ˆï¼Œæ˜¯ä¸æ˜¯çœ‹çš„å¾ˆæœ‰æˆå°±æ„Ÿ( ç¬”è€…åˆåœ¨æ°´æ›´äº† )ã€‚</p><p>ä¸è¦æ–¹ï¼Œä¸‹é¢è¿˜æœ‰ä¸€ç¯‡æ°´æ›´ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_25/04.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸ªæœ‹å‹åœˆå¯å¥½ï¼Ÿ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/collector-client-component/&quot;&gt;http://www.iocoder.cn/SkyWalking/collector-client-compone
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” Collector Cluster é›†ç¾¤ç®¡ç†</title>
    <link href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/"/>
    <id>http://www.iocoder.cn/SkyWalking/collector-cluster-module/</id>
    <published>2020-07-19T16:00:00.000Z</published>
    <updated>2017-12-25T04:31:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/">http://www.iocoder.cn/SkyWalking/collector-cluster-module/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/">2. collector-cluster-define</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/">2.1 ClusterModule</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/">2.2 ModuleRegisterService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/">2.3 ModuleListenerService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/">2.4 DataMonitor</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/">3. collector-cluster-zookeeper-provider</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/">3.1 ClusterModuleZookeeperProvider</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/">3.2 ZookeeperModuleRegisterService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/">3.3 ZookeeperModuleListenerService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/">3.4 ClusterZKDataMonitor</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/">3.5 ZookeeperClient</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/">4. collector-cluster-standalone-provider</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/">5. collector-cluster-redis-provider</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>SkyWalking Collector Cluster Module</strong>ï¼Œè´Ÿè´£é›†ç¾¤çš„ç®¡ç†ï¼Œå³ Collector èŠ‚ç‚¹çš„æ³¨å†Œäºå‘ç°ã€‚</p><blockquote><p>å‹æƒ…æç¤ºï¼šå»ºè®®å…ˆé˜…è¯» <a href="http://www.iocoder.cn/SkyWalking/collector-init/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector åˆå§‹åŒ–ã€‹</a> ï¼Œä»¥äº†è§£ Collector ç»„ä»¶ä½“ç³»ã€‚</p></blockquote><p>Cluster Module åœ¨ SkyWalking æ¶æ„å›¾å¤„äºå¦‚ä¸‹ä½ç½®( <strong>çº¢æ¡†</strong> ) ï¼š</p><blockquote><p>FROM <a href="https://github.com/apache/incubating-skywalking" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/apache/incubating-skywalking</a><br><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_20/01.jpeg" alt=""></p></blockquote><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ•´ä½“çš„é¡¹ç›®ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_20/02.png" alt=""></p><ul><li><code>collector-cluster-define</code> ï¼šå®šä¹‰é›†ç¾¤ç®¡ç†æ¥å£ã€‚</li><li><code>collector-cluster-standalone-provider</code> ï¼šåŸºäº H2 çš„ é›†ç¾¤ç®¡ç†å®ç°ã€‚<strong>è¯¥å®ç°æ˜¯å•æœºç‰ˆï¼Œå»ºè®®ä»…ç”¨äº SkyWalking å¿«é€Ÿä¸Šæ‰‹ï¼Œç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨</strong>ã€‚</li><li><code>collector-cluster-redis-provider</code> ï¼šåŸºäº Redis çš„é›†ç¾¤ç®¡ç†å®ç°ã€‚<em>ç›®å‰æš‚æœªå®Œæˆ</em>ã€‚</li><li><code>collector-cluster-zookeeper-provider</code> ï¼šåŸºäº Zookeeper çš„é›†ç¾¤ç®¡ç†å®ç°ã€‚<strong>ç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨</strong></li></ul><p>ä¸‹é¢ï¼Œæˆ‘ä»¬ä»<strong>æ¥å£åˆ°å®ç°</strong>çš„é¡ºåºè¿›è¡Œåˆ†äº«ã€‚</p><h1 id="2-collector-cluster-define"><a href="#2-collector-cluster-define" class="headerlink" title="2. collector-cluster-define"></a>2. collector-cluster-define</h1><p><code>collector-cluster-define</code> ï¼šå®šä¹‰é›†ç¾¤ç®¡ç†æ¥å£ã€‚é¡¹ç›®ç»“æ„å¦‚ä¸‹ ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_20/03.png" alt=""></p><ul><li><p>äº¤äº’å¦‚ä¸‹å›¾ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_20/04.png" alt=""></p></li><li><p>ModuleListenerService æš´éœ²ç»™å…¶ä»– Module æ³¨å†Œç›‘å¬å™¨ ( ClusterModuleListener ) åˆ° DataMonitor ã€‚</p></li><li>ModuleRegisterService æš´éœ²ç»™å…¶ä»– Module æ³¨å†Œç»„ä»¶ç™»è®°( ModuleRegistration ) åˆ° DataMonitor ã€‚</li><li>é€šè¿‡å®ç° DataMonitor æ¥å£ï¼ŒåŸºäºä¸åŒçš„å­˜å‚¨å™¨å®ç°æ³¨å†Œå‘ç°ã€‚</li></ul><h2 id="2-1-ClusterModule"><a href="#2-1-ClusterModule" class="headerlink" title="2.1 ClusterModule"></a>2.1 ClusterModule</h2><p><code>org.skywalking.apm.collector.cluster.ClusterModule</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Module.java" rel="external nofollow noopener noreferrer" target="_blank">Module</a> æŠ½è±¡ç±»ï¼Œé›†ç¾¤ç®¡ç† Module ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-cluster/collector-cluster-define/src/main/java/org/skywalking/apm/collector/cluster/ClusterModule.java#L33" rel="external nofollow noopener noreferrer" target="_blank"><code>#name()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›æ¨¡å—åä¸º <code>&quot;cluster&quot;</code> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-cluster/collector-cluster-define/src/main/java/org/skywalking/apm/collector/cluster/ClusterModule.java#L37" rel="external nofollow noopener noreferrer" target="_blank"><code>#services()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å› Service ç±»åï¼šModuleListenerService / ModuleRegisterService ã€‚</p><h2 id="2-2-ModuleRegisterService"><a href="#2-2-ModuleRegisterService" class="headerlink" title="2.2 ModuleRegisterService"></a>2.2 ModuleRegisterService</h2><p><code>org.skywalking.apm.collector.cluster.service.ModuleRegisterService</code> ï¼Œç»§æ‰¿ <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Service.java" rel="external nofollow noopener noreferrer" target="_blank">Service</a> æ¥å£ï¼Œæ¨¡å—æ³¨å†ŒæœåŠ¡<strong>æ¥å£</strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-define/src/main/java/org/skywalking/apm/collector/cluster/service/ModuleRegisterService.java#L38" rel="external nofollow noopener noreferrer" target="_blank"><code>#register(moduleName, providerName, registration)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œæ³¨å†Œæ¨¡å—æ³¨å†Œä¿¡æ¯ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå®ç°è¯¥æ¥å£æ–¹æ³•ï¼Œè°ƒç”¨ <code>DataMonitor#register(path, registration)</code> æ–¹æ³•ã€‚</p><h3 id="2-2-1-ModuleRegistration"><a href="#2-2-1-ModuleRegistration" class="headerlink" title="2.2.1 ModuleRegistration"></a>2.2.1 ModuleRegistration</h3><p><code>org.skywalking.apm.collector.cluster.ModuleRegistration</code> ï¼Œæ¨¡å—æ³¨å†Œä¿¡æ¯<strong>æŠ½è±¡ç±»</strong>ã€‚ä¸åŒ Module é€šè¿‡å®ç° ModuleRegistration ï¼Œå°†å®ƒä»¬æ³¨å†Œåˆ° ModuleRegisterServiceã€‚ç›®å‰å­ç±»å¦‚ä¸‹ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_20/05.png" alt=""></p><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-define/src/main/java/org/skywalking/apm/collector/cluster/ModuleRegistration.java" rel="external nofollow noopener noreferrer" target="_blank"><code>#buildValue()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œè·å¾—æ¨¡å—æ³¨å†Œä¿¡æ¯( <a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-define/src/main/java/org/skywalking/apm/collector/cluster/ModuleRegistration.java#L30" rel="external nofollow noopener noreferrer" target="_blank">Value</a> )ã€‚</p><h2 id="2-3-ModuleListenerService"><a href="#2-3-ModuleListenerService" class="headerlink" title="2.3 ModuleListenerService"></a>2.3 ModuleListenerService</h2><p><code>org.skywalking.apm.collector.cluster.service.ModuleListenerService</code> ï¼Œç»§æ‰¿ <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Service.java" rel="external nofollow noopener noreferrer" target="_blank">Service</a> æ¥å£ï¼Œæ³¨å†Œç›‘å¬å™¨æœåŠ¡<strong>æ¥å£</strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-define/src/main/java/org/skywalking/apm/collector/cluster/service/ModuleListenerService.java#L36" rel="external nofollow noopener noreferrer" target="_blank"><code>#addListener(listener)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œæ·»åŠ ç›‘å¬å™¨ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå®ç°è¯¥æ¥å£æ–¹æ³•ï¼Œè°ƒç”¨ <code>DataMonitor#addListener(listener)</code> æ–¹æ³•ã€‚</p><h3 id="2-3-1-ClusterModuleListener"><a href="#2-3-1-ClusterModuleListener" class="headerlink" title="2.3.1 ClusterModuleListener"></a>2.3.1 ClusterModuleListener</h3><p><code>org.skywalking.apm.collector.cluster.ClusterModuleListener</code> ï¼Œé›†ç¾¤ç»„ä»¶ç›‘å¬å™¨<strong>æŠ½è±¡ç±»</strong>ã€‚ç›®å‰å­ç±»å¦‚ä¸‹ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_20/11.png" alt=""></p><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-define/src/main/java/org/skywalking/apm/collector/cluster/ClusterModuleListener.java#L36" rel="external nofollow noopener noreferrer" target="_blank"><strong>æ„é€ æ–¹æ³•</strong></a>ï¼Œåˆ›å»ºåœ°å€æ•°ç»„( <code>addresses</code> )ã€‚è¯¥æ•°ç»„çš„è¯»å†™æ–¹æ³•å¦‚ä¸‹ï¼š</p><ul><li><code>#addAddress(address)</code></li><li><code>#removeAddress(address)</code></li><li><code>#getAddresses()</code></li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-define/src/main/java/org/skywalking/apm/collector/cluster/ClusterModuleListener.java#L43" rel="external nofollow noopener noreferrer" target="_blank"><code>#path()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œè¿”å›è·¯å¾„ã€‚è¯¥è·¯å¾„å³ä¸º ClusterModuleListener ç›‘å¬çš„<strong>â€œäº‹ä»¶â€</strong>ã€‚å¤šä¸ª Collector èŠ‚ç‚¹çš„ç›¸åŒ Module ï¼Œ<strong>é€šè¿‡è·¯å¾„åˆ†ç»„å½¢æˆé›†ç¾¤</strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-define/src/main/java/org/skywalking/apm/collector/cluster/ClusterModuleListener.java#L62" rel="external nofollow noopener noreferrer" target="_blank"><code>#serverJoinNotify(serverAddress)</code></a> / <a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-define/src/main/java/org/skywalking/apm/collector/cluster/ClusterModuleListener.java#L69" rel="external nofollow noopener noreferrer" target="_blank"><code>#serverQuitNotify(serverAddress)</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œé€šçŸ¥æœåŠ¡çš„åŠ å…¥ / ä¸‹çº¿ã€‚ç›®å‰åªæœ‰ GRPCRemoteSenderService <strong>çœŸæ­£</strong>( å…¶å®ƒéƒ½æ˜¯ç©ºæ–¹æ³• )å®ç°è¯¥æ–¹æ³•ï¼Œåœ¨ <a href="http://www.iocoder.cn/SkyWalking/collector-remote-module">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Remote è¿œç¨‹é€šä¿¡æœåŠ¡ã€‹ã€Œ3.2 GRPCRemoteSenderServiceã€</a> è¯¦ç»†è§£æã€‚</p><h2 id="2-4-DataMonitor"><a href="#2-4-DataMonitor" class="headerlink" title="2.4 DataMonitor"></a>2.4 DataMonitor</h2><p><code>org.skywalking.apm.collector.cluster.DataMonitor</code> ï¼Œæ•°æ®ç›‘<strong>è§†</strong>å™¨<strong>æ¥å£</strong>ã€‚é€šè¿‡å®ç° DataMonitor æ¥å£ï¼ŒåŸºäºä¸åŒçš„å­˜å‚¨å™¨å®ç°æ³¨å†Œå‘ç°ã€‚ç›®å‰å­ç±»å¦‚ä¸‹ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_20/06.png" alt=""></p><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-define/src/main/java/org/skywalking/apm/collector/cluster/DataMonitor.java#L40" rel="external nofollow noopener noreferrer" target="_blank"><code>#register(path, registration)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œæ³¨å†Œæ¨¡å—æ³¨å†Œä¿¡æ¯ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-define/src/main/java/org/skywalking/apm/collector/cluster/DataMonitor.java#L38" rel="external nofollow noopener noreferrer" target="_blank"><code>#addListener(ClusterModuleListener)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œæ·»åŠ ç›‘å¬å™¨ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-define/src/main/java/org/skywalking/apm/collector/cluster/DataMonitor.java#L42" rel="external nofollow noopener noreferrer" target="_blank"><code>#getListener(path)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œè·å¾—ç›‘å¬<strong>æŒ‡å®šè·¯å¾„</strong>çš„ç›‘å¬å™¨ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-define/src/main/java/org/skywalking/apm/collector/cluster/DataMonitor.java#L36" rel="external nofollow noopener noreferrer" target="_blank"><code>#setClient(Client)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œè®¾ç½® <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-component/client-component/src/main/java/org/skywalking/apm/collector/client/Client.java" rel="external nofollow noopener noreferrer" target="_blank">Client</a> ã€‚åœ¨ <a href="https://github.com/YunaiV/skywalking/tree/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-component/client-component/src/main/java/org/skywalking/apm/collector/client" rel="external nofollow noopener noreferrer" target="_blank"><code>client-component</code></a> æœ‰ ZookeeperClient / H2Client / ElasticSearchClient ç­‰å¤šç§å®ç°ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-define/src/main/java/org/skywalking/apm/collector/cluster/DataMonitor.java#L34" rel="external nofollow noopener noreferrer" target="_blank"><code>BASE_CATALOG</code></a> å±æ€§ï¼ŒåŸºç¡€ç›®å½•ä¸º <code>&quot;/skywalking&quot;</code> ã€‚ä¾‹å¦‚è¯´ï¼Œåœ¨ Zookeeper ä¸ºæ ¹èŠ‚ç‚¹çš„è·¯å¾„ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-define/src/main/java/org/skywalking/apm/collector/cluster/DataMonitor.java#L44" rel="external nofollow noopener noreferrer" target="_blank"><code>#createPath(path)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œä½¿ç”¨ Client åˆ›å»ºè·¯å¾„ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-define/src/main/java/org/skywalking/apm/collector/cluster/DataMonitor.java#L46" rel="external nofollow noopener noreferrer" target="_blank"><code>#setData(path)</code></a> <strong>æ¥å£</strong>æ–¹æ³•ï¼Œä½¿ç”¨ Client è®¾ç½®è·¯å¾„çš„å€¼ã€‚</li></ul><h1 id="3-collector-cluster-zookeeper-provider"><a href="#3-collector-cluster-zookeeper-provider" class="headerlink" title="3. collector-cluster-zookeeper-provider"></a>3. collector-cluster-zookeeper-provider</h1><p><code>collector-cluster-zookeeper-provider</code> ï¼ŒåŸºäº Zookeeper çš„é›†ç¾¤ç®¡ç†å®ç°ã€‚é¡¹ç›®ç»“æ„å¦‚ä¸‹ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_20/07.png" alt=""></p><p>å®é™…ä½¿ç”¨æ—¶ï¼Œé€šè¿‡ <code>application.yml</code> é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight"><table><tr><td class="code"><pre><div class="line">cluster:</div><div class="line">  zookeeper:</div><div class="line">    hostPort: localhost:2181</div><div class="line">    sessionTimeout: 100000</div></pre></td></tr></table></figure><ul><li>ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæ¨è Zookeeper é…ç½®æˆé›†ç¾¤ã€‚</li></ul><h2 id="3-1-ClusterModuleZookeeperProvider"><a href="#3-1-ClusterModuleZookeeperProvider" class="headerlink" title="3.1 ClusterModuleZookeeperProvider"></a>3.1 ClusterModuleZookeeperProvider</h2><p><code>org.skywalking.apm.collector.cluster.zookeeper.ClusterModuleZookeeperProvider</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleProvider.java" rel="external nofollow noopener noreferrer" target="_blank">ModuleProvider</a> <strong>æŠ½è±¡ç±»</strong>ï¼ŒåŸºäº Zookeeper çš„é›†ç¾¤ç®¡ç†æœåŠ¡æä¾›è€…ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-zookeeper-provider/src/main/java/org/skywalking/apm/collector/cluster/zookeeper/ClusterModuleZookeeperProvider.java#L53" rel="external nofollow noopener noreferrer" target="_blank"><code>#name()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ç»„ä»¶æœåŠ¡æä¾›è€…åä¸º <code>&quot;zookeeper&quot;</code> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-zookeeper-provider/src/main/java/org/skywalking/apm/collector/cluster/zookeeper/ClusterModuleZookeeperProvider.java#L57" rel="external nofollow noopener noreferrer" target="_blank"><code>module()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ç»„ä»¶ç±»ä¸º ClusterModule ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-zookeeper-provider/src/main/java/org/skywalking/apm/collector/cluster/zookeeper/ClusterModuleZookeeperProvider.java#L94" rel="external nofollow noopener noreferrer" target="_blank"><code>#requiredModules()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè¿”å›ä¾èµ–ç»„ä»¶ä¸ºç©ºã€‚</p><hr><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-zookeeper-provider/src/main/java/org/skywalking/apm/collector/cluster/zookeeper/ClusterModuleZookeeperProvider.java#L61" rel="external nofollow noopener noreferrer" target="_blank"><code>#prepare(Properties)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå‡†å¤‡é˜¶æ®µé€»è¾‘ã€‚</p><ul><li>ç¬¬ 63 è¡Œ ï¼šåˆ›å»º ClusterZKDataMonitor å¯¹è±¡ã€‚</li><li>ç¬¬ 69 è¡Œ ï¼šåˆ›å»º ZookeeperClient å¯¹è±¡ã€‚<strong>æ³¨æ„ï¼Œæ­¤æ—¶å¹¶æœªè¿æ¥ Zookeeper</strong> ã€‚</li><li>ç¬¬ 71 è‡³ 73 è¡Œ ï¼šåˆ›å»º ZookeeperModuleListenerService / ZookeeperModuleRegisterService å¯¹è±¡ï¼Œå¹¶è°ƒç”¨ <code>#registerServiceImplementation()</code> <strong>çˆ¶ç±»</strong>æ–¹æ³•ï¼Œæ³¨å†Œåˆ° <code>services</code> ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-zookeeper-provider/src/main/java/org/skywalking/apm/collector/cluster/zookeeper/ClusterModuleZookeeperProvider.java#L76" rel="external nofollow noopener noreferrer" target="_blank"><code>#start()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå¯åŠ¨é˜¶æ®µé€»è¾‘ã€‚</p><ul><li>ç¬¬ 79 è¡Œ ï¼šè°ƒç”¨ <code>ZookeeperClient#initialize()</code> æ–¹æ³•ï¼Œåˆå§‹åŒ– ZookeeperClient ï¼Œ<strong>æ­¤æ—¶ä¼šè¿æ¥ Zookeeper</strong>ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-zookeeper-provider/src/main/java/org/skywalking/apm/collector/cluster/zookeeper/ClusterModuleZookeeperProvider.java#L85" rel="external nofollow noopener noreferrer" target="_blank"><code>#notifyAfterCompleted()</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ‰§è¡Œå¯åŠ¨å®Œæˆé€»è¾‘ã€‚</p><ul><li>ç¬¬ 88 è¡Œ ï¼šè°ƒç”¨ <code>ClusterZKDataMonitor#start()</code> æ–¹æ³•ï¼Œå¯åŠ¨ ClusterZKDataMonitor ã€‚åœ¨æœ¬æ–‡ <a href="#">ã€Œ3.4 ClusterZKDataMonitorã€</a> è¯¦ç»†è§£æã€‚</li></ul><h2 id="3-2-ZookeeperModuleRegisterService"><a href="#3-2-ZookeeperModuleRegisterService" class="headerlink" title="3.2 ZookeeperModuleRegisterService"></a>3.2 ZookeeperModuleRegisterService</h2><p><code>org.skywalking.apm.collector.cluster.zookeeper.service.ZookeeperModuleRegisterService</code> ï¼ŒåŸºäº Zookeeper çš„æ¨¡å—æ³¨å†ŒæœåŠ¡<strong>å®ç°ç±»</strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-zookeeper-provider/src/main/java/org/skywalking/apm/collector/cluster/zookeeper/service/ZookeeperModuleRegisterService.java#L38" rel="external nofollow noopener noreferrer" target="_blank"><code>#register(moduleName, providerName, registration)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè°ƒç”¨ <code>ClusterZKDataMonitor#register(path, registration)</code> æ–¹æ³•ï¼Œæ³¨å†Œæ¨¡å—æ³¨å†Œä¿¡æ¯ã€‚</p><h2 id="3-3-ZookeeperModuleListenerService"><a href="#3-3-ZookeeperModuleListenerService" class="headerlink" title="3.3 ZookeeperModuleListenerService"></a>3.3 ZookeeperModuleListenerService</h2><p><code>org.skywalking.apm.collector.cluster.zookeeper.service.ZookeeperModuleListenerService</code> ï¼ŒåŸºäº Zookeeper çš„æ³¨å†Œç›‘å¬å™¨æœåŠ¡<strong>å®ç°ç±»</strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-zookeeper-provider/src/main/java/org/skywalking/apm/collector/cluster/zookeeper/service/ZookeeperModuleListenerService.java#L38" rel="external nofollow noopener noreferrer" target="_blank"><code>#addListener(ClusterModuleListener)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œè°ƒç”¨ <code>ClusterZKDataMonitor#addListener(ClusterModuleListener)</code> æ–¹æ³•ï¼Œæ³¨å†Œæ¨¡å—æ³¨å†Œä¿¡æ¯ã€‚</p><h2 id="3-4-ClusterZKDataMonitor"><a href="#3-4-ClusterZKDataMonitor" class="headerlink" title="3.4 ClusterZKDataMonitor"></a>3.4 ClusterZKDataMonitor</h2><p><code>org.skywalking.apm.collector.cluster.zookeeper.ClusterZKDataMonitor</code> ï¼ŒåŸºäº Zookeeper çš„æ•°æ®ç›‘è§†å™¨<strong>å®ç°ç±»</strong>ã€‚</p><p>åœ¨çœ‹å…·ä½“ä»£ç å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ Zookeeper æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_20/08.png" alt=""></p><ul><li>ç´«è‰²éƒ¨åˆ†ï¼Œé€šè¿‡è°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-zookeeper-provider/src/main/java/org/skywalking/apm/collector/cluster/zookeeper/ClusterZKDataMonitor.java#L172" rel="external nofollow noopener noreferrer" target="_blank"><code>#createPath(path)</code></a> æ–¹æ³•ï¼Œé¡ºç€è·¯å¾„ï¼Œé€å±‚åˆ›å»º<strong>æŒä¹…</strong>èŠ‚ç‚¹ã€‚</li><li>é»„è‰²éƒ¨åˆ†ï¼Œé€šè¿‡è°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-zookeeper-provider/src/main/java/org/skywalking/apm/collector/cluster/zookeeper/ClusterZKDataMonitor.java#L184" rel="external nofollow noopener noreferrer" target="_blank"><code>#setData(path)</code></a> æ–¹æ³•ï¼Œåˆ›å»º<strong>ä¸´æ—¶</strong>èŠ‚ç‚¹ï¼Œè®¾ç½® Collector æ¨¡å—åœ°å€ã€‚è‹¥ Collector é›†ç¾¤æœ‰ N ä¸ªèŠ‚ç‚¹ï¼Œåˆ™æ­¤å¤„ä¼šæœ‰ N ä¸ª<strong>ä¸´æ—¶</strong>èŠ‚ç‚¹ã€‚</li><li><p>æ‰“å¼€ <code>zkClient.sh</code> ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ ï¼š</p>  <figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">[zk: localhost:2181(CONNECTED) 1] ls /skywalking</div><div class="line">[remote, ui, agent_jetty, agent_gRPC]</div><div class="line"></div><div class="line">[zk: localhost:2181(CONNECTED) 2] ls /skywalking/ui</div><div class="line">[jetty]</div><div class="line"></div><div class="line">[zk: localhost:2181(CONNECTED) 3] ls /skywalking/ui/jetty</div><div class="line">[localhost:12800]</div><div class="line"></div><div class="line">[zk: localhost:2181(CONNECTED) 4] get /skywalking/ui/jetty/localhost:12800</div><div class="line">/</div><div class="line">cZxid = 0x24</div><div class="line">ctime = Thu Dec 14 16:05:25 CST 2017</div><div class="line">mZxid = 0x24</div><div class="line">mtime = Thu Dec 14 16:05:25 CST 2017</div><div class="line">pZxid = 0x24</div><div class="line">cversion = 0</div><div class="line">dataVersion = 0</div><div class="line">aclVersion = 0</div><div class="line">ephemeralOwner = 0x16052d8b9f40006</div><div class="line">dataLength = 1</div><div class="line">numChildren = 0</div></pre></td></tr></table></figure></li></ul><hr><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-zookeeper-provider/src/main/java/org/skywalking/apm/collector/cluster/zookeeper/ClusterZKDataMonitor.java#L163" rel="external nofollow noopener noreferrer" target="_blank"><code>#register(path, registration)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ·»åŠ åˆ°ç»„ä»¶æ³¨å†Œä¿¡æ¯é›†åˆ( <code>registrations</code> )ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-zookeeper-provider/src/main/java/org/skywalking/apm/collector/cluster/zookeeper/ClusterZKDataMonitor.java#L123" rel="external nofollow noopener noreferrer" target="_blank"><code>#start()</code></a> æ–¹æ³•ï¼Œå¯åŠ¨ ClusterZKDataMonitor ï¼Œå°†ç»„ä»¶æ³¨å†Œä¿¡æ¯( <code>registrations</code> ) å†™åˆ° Zookeeper ä¸­ã€‚</p><hr><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-zookeeper-provider/src/main/java/org/skywalking/apm/collector/cluster/zookeeper/ClusterZKDataMonitor.java#L157" rel="external nofollow noopener noreferrer" target="_blank"><code>#addListener(listener)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œæ·»åŠ åˆ°ç›‘å¬å™¨é›†åˆ( <code>listeners</code> )ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-cluster/collector-cluster-zookeeper-provider/src/main/java/org/skywalking/apm/collector/cluster/zookeeper/ClusterZKDataMonitor.java#L123" rel="external nofollow noopener noreferrer" target="_blank"><code>#process(WatchedEvent)</code></a> <strong>å®ç°</strong>æ–¹æ³•ï¼Œå¤„ç†æœ‰ Collector èŠ‚ç‚¹çš„ç»„ä»¶åŠ å…¥æˆ–ä¸‹çº¿ã€‚æ€»ä½“é€»è¾‘æ˜¯ï¼Œä» Zookeeper è·å–å˜æ›´çš„è·¯å¾„ä¸‹çš„åœ°å€æ•°ç»„ï¼Œå’Œæœ¬åœ°çš„åœ°å€( <code>ClusterModuleListener.addresses</code> )æ¯”è¾ƒï¼Œå¤„ç†åŠ å…¥æˆ–ç§»é™¤é€»è¾‘çš„åœ°å€ã€‚</p><ul><li>ClusterZKDataMonitor å®ç° <code>org.apache.zookeeper.Watcher</code> <strong>æ¥å£</strong>ï¼Œæ‰€ä»¥å®ç°è¯¥æ–¹æ³•ã€‚</li><li>è¯¥æ–¹æ³•æ˜¯ <code>synchronized</code> æ–¹æ³•ï¼Œä»¥ä¿è¯ä¸ä¼šå‡ºç°å¹¶å‘é—®é¢˜ã€‚</li></ul><h2 id="3-5-ZookeeperClient"><a href="#3-5-ZookeeperClient" class="headerlink" title="3.5 ZookeeperClient"></a>3.5 ZookeeperClient</h2><p><a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-component/client-component/src/main/java/org/skywalking/apm/collector/client/zookeeper/ZookeeperClient.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.client.zookeeper.ZookeeperClient</code></a> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/20d38d7fcbbaac65e10eb8d256881fc9c0cedd87/apm-collector/apm-collector-component/client-component/src/main/java/org/skywalking/apm/collector/client/Client.java" rel="external nofollow noopener noreferrer" target="_blank">Client</a> <strong>æ¥å£</strong>ï¼ŒZookeeper å®¢æˆ·ç«¯ã€‚</p><p>ä»£ç æ¯”è¾ƒç®€å•ï¼Œèƒ–å‹è‡ªå·±é˜…è¯»ç†è§£ã€‚</p><h1 id="4-collector-cluster-standalone-provider"><a href="#4-collector-cluster-standalone-provider" class="headerlink" title="4. collector-cluster-standalone-provider"></a>4. collector-cluster-standalone-provider</h1><p><code>collector-cluster-standalone-provider.ClusterStandaloneDataMonitor</code> ï¼ŒåŸºäº H2 çš„ é›†ç¾¤ç®¡ç†å®ç°ã€‚<strong>è¯¥å®ç°æ˜¯å•æœºç‰ˆï¼Œå»ºè®®ä»…ç”¨äº SkyWalking å¿«é€Ÿä¸Šæ‰‹ï¼Œç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨</strong>ã€‚é¡¹ç›®ç»“æ„å¦‚ä¸‹ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_20/09.png" alt=""></p><p>å¤§ä½“å®ç°å’Œ <code>collector-cluster-zookeeper-provider</code> å·®ä¸å¤šï¼Œå·®å¼‚åœ¨å¯¹ DataMonitor çš„å®ç°ç±» ClusterStandaloneDataMonitor ä¸Šã€‚</p><p>åœ¨ ClusterStandaloneDataMonitor é‡Œï¼Œå®é™…å¹¶æœªä½¿ç”¨ H2Client ï¼Œè€Œæ˜¯åŸºäºå†…å­˜ï¼Œèƒ–å‹å¯ä»¥è‡ªå·±æŸ¥çœ‹ä¸‹ã€‚</p><h1 id="5-collector-cluster-redis-provider"><a href="#5-collector-cluster-redis-provider" class="headerlink" title="5. collector-cluster-redis-provider"></a>5. collector-cluster-redis-provider</h1><p><code>collector-cluster-redis-provider</code> ï¼šåŸºäº Redis çš„é›†ç¾¤ç®¡ç†å®ç°ã€‚<em>ç›®å‰æš‚æœªå®Œæˆ</em>ã€‚</p><p>ã€TODO 4003ã€‘ç­‰å®ç°åæ¥å†™å†™ï¼ŒåŸºäº Redis Pub Sub ä¿è¯å®æ—¶æ€§</p><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>æœ‰ä¸€ç§ç¡¬ç”Ÿç”ŸæŠŠå¾ˆç®€å•çš„ä¸œè¥¿ï¼Œå†™çš„å¾ˆå¤æ‚çš„æ„Ÿè§‰ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_20/10.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸ªæœ‹å‹åœˆå¯å¥½ï¼Ÿ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/collector-cluster-module/&quot;&gt;http://www.iocoder.cn/SkyWalking/collector-cluster-module/&lt;
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” Collector åˆå§‹åŒ–</title>
    <link href="http://www.iocoder.cn/SkyWalking/collector-init/"/>
    <id>http://www.iocoder.cn/SkyWalking/collector-init/</id>
    <published>2020-07-14T16:00:00.000Z</published>
    <updated>2017-12-25T05:23:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/collector-init/">http://www.iocoder.cn/SkyWalking/collector-init/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-init/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-init/">2. CollectorBootStartUp</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-init/">2. ApplicationConfigLoader</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-init/">3. ModuleManager</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-init/">3.1 Module</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-init/">3.2 ModuleProvider</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-init/">3.3 Service</a></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-init/">3.4 BootstrapFlow</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/collector-init/">4. Module å®ç°ç±»ç®€ä»‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>SkyWalking Collector å¯åŠ¨åˆå§‹åŒ–çš„è¿‡ç¨‹</strong>ã€‚åœ¨åˆ†äº«çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼š<strong>ç®€å•</strong>ä»‹ç» Collector æ¯ä¸ªæ¨¡å—åŠå…¶ç”¨é€”ã€‚</p><p>ps ï¼šCollector æ˜¯ SkyWalking çš„ Server ç«¯ã€‚æ•´ä½“å¦‚ä¸‹å›¾ ï¼š</p><blockquote><p>FROM <a href="https://github.com/apache/incubating-skywalking" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/apache/incubating-skywalking</a><br><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_15/01.png" alt=""></p></blockquote><h1 id="2-CollectorBootStartUp"><a href="#2-CollectorBootStartUp" class="headerlink" title="2. CollectorBootStartUp"></a>2. CollectorBootStartUp</h1><p><code>org.skywalking.apm.collector.boot.CollectorBootStartUp</code> ï¼Œåœ¨ <code>apm-sniffer/apm-agent</code> Maven æ¨¡å—é¡¹ç›®é‡Œï¼ŒSkyWalking Collector <strong>å¯åŠ¨å…¥å£</strong>ã€‚ </p><p><a href="https://github.com/YunaiV/skywalking/blob/c633c1f0e143d1df2457926ab239350a642f7be2/apm-collector/apm-collector-boot/src/main/java/org/skywalking/apm/collector/boot/CollectorBootStartUp.java#L38" rel="external nofollow noopener noreferrer" target="_blank"><code>#main(args)</code></a> æ–¹æ³•ï¼Œå¯åŠ¨ Collector ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><ul><li>ç¬¬ 45 è¡Œ ï¼šè°ƒç”¨ <code>ApplicationConfiguration#load()</code> æ–¹æ³•ï¼ŒåŠ è½½ Collector <strong>é…ç½®</strong>ã€‚</li><li>ç¬¬ 47 è¡Œ ï¼šè°ƒç”¨ <code>ModuleManager#init(...)</code> æ–¹æ³•ï¼Œåˆå§‹åŒ– Collector <strong>ç»„ä»¶</strong>ä»¬ã€‚</li><li>ç¬¬ 60 è¡Œ ï¼šè°ƒç”¨ <code>Thread#sleep(60000)</code> æ–¹æ³•ï¼Œç­‰å¾… Collector å†…åµŒçš„ Jetty Server å¯åŠ¨å®Œæˆã€‚</li></ul><h1 id="2-ApplicationConfigLoader"><a href="#2-ApplicationConfigLoader" class="headerlink" title="2. ApplicationConfigLoader"></a>2. ApplicationConfigLoader</h1><p><code>org.skywalking.apm.collector.boot.config.ApplicationConfigLoader</code> ï¼Œå®ç° <a href="https://github.com/YunaiV/skywalking/blob/c633c1f0e143d1df2457926ab239350a642f7be2/apm-collector/apm-collector-boot/src/main/java/org/skywalking/apm/collector/boot/config/ConfigLoader.java#L24" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.boot.config.ConfigLoader</code></a> æ¥å£ï¼ŒCollector é…ç½®( <a href="https://github.com/YunaiV/skywalking/blob/c633c1f0e143d1df2457926ab239350a642f7be2/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ApplicationConfiguration.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.core.module.ApplicationConfiguration</code></a> )åŠ è½½å™¨ã€‚</p><p>åœ¨çœ‹å…·ä½“ä»£ç å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸‹ ApplicationConfiguration æ•´ä½“ç±»ç»“æ„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_15/02.png" alt=""></p><ul><li>Collector ä½¿ç”¨ç»„ä»¶ç®¡ç†å™¨( ModuleManager )ï¼Œç®¡ç†<strong>å¤šä¸ª</strong>ç»„ä»¶( <a href="https://github.com/YunaiV/skywalking/blob/c633c1f0e143d1df2457926ab239350a642f7be2/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Module.java" rel="external nofollow noopener noreferrer" target="_blank">Module</a> )ã€‚<ul><li>ä¸€ä¸ªç»„ä»¶æœ‰å¤šç§ç»„ä»¶æœåŠ¡æä¾›è€…( <a href="https://github.com/YunaiV/skywalking/blob/c633c1f0e143d1df2457926ab239350a642f7be2/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleProvider.java" rel="external nofollow noopener noreferrer" target="_blank">ModuleProvider</a> )ï¼Œ<strong>åŒæ—¶</strong>ä¸€ä¸ªç»„ä»¶åªå…è®¸ä½¿ç”¨<strong>ä¸€ä¸ª</strong>ç»„ä»¶æœåŠ¡æä¾›è€…ã€‚è¿™å—ä¸‹é¢ä¼šæœ‰ä»£ç è§£æè¯´æ˜ã€‚</li></ul></li><li>Collector ä½¿ç”¨ä¸€ä¸ªåº”ç”¨é…ç½®ç±»( <a href="https://github.com/YunaiV/skywalking/blob/c633c1f0e143d1df2457926ab239350a642f7be2/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ApplicationConfiguration.java" rel="external nofollow noopener noreferrer" target="_blank">ApplicationConfiguration</a> )ã€‚<ul><li>ä¸€ä¸ªåº”ç”¨é…ç½®ç±»åŒ…å«å¤šä¸ªç»„ä»¶é…ç½®ç±»( <a href="https://github.com/YunaiV/skywalking/blob/c633c1f0e143d1df2457926ab239350a642f7be2/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ApplicationConfiguration.java#L62" rel="external nofollow noopener noreferrer" target="_blank">ModuleConfiguration</a> )ã€‚æ¯ä¸ªç»„ä»¶å¯¹åº”ä¸€ä¸ªç»„ä»¶é…ç½®ç±»ã€‚</li><li>ä¸€ä¸ªç»„ä»¶é…ç½®ç±»åŒ…å«å¤šä¸ªç»„ä»¶æœåŠ¡æä¾›è€…é…ç½®( <a href="https://github.com/YunaiV/skywalking/blob/c633c1f0e143d1df2457926ab239350a642f7be2/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ApplicationConfiguration.java#L93" rel="external nofollow noopener noreferrer" target="_blank">ProviderConfiguration</a> )ã€‚æ¯ä¸ªç»„ä»¶æœåŠ¡æä¾›è€…å¯¹åº”ä¸€ä¸ªç»„ä»¶é…ç½®ç±»ã€‚<strong>æ³¨æ„</strong>ï¼šå› ä¸ºä¸€ä¸ªç»„ä»¶åªå…è®¸<strong>åŒæ—¶</strong>ä½¿ç”¨<strong>ä¸€ä¸ª</strong>ç»„ä»¶æœåŠ¡æä¾›è€…ï¼Œæ‰€ä»¥ä¸€ä¸ªç»„ä»¶é…ç½®ç±»<strong>åªè®¾ç½®</strong>ä¸€ä¸ªç»„ä»¶æœåŠ¡æä¾›è€…é…ç½®ã€‚</li></ul></li><li>æ•´ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¯¹åº”åº”ç”¨é…ç½®ç±»ã€‚<strong>ç»¿æ¡†</strong>éƒ¨åˆ†ï¼Œå¯¹åº”ä¸€ä¸ªç»„ä»¶é…ç½®ç±»ã€‚<strong>çº¢æ¡†</strong>éƒ¨åˆ†ï¼Œå¯¹åº”ä¸€ä¸ªç»„ä»¶æœåŠ¡æä¾›è€…é…ç½®ç±»ã€‚</li></ul><p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ <a href="https://github.com/YunaiV/skywalking/blob/c633c1f0e143d1df2457926ab239350a642f7be2/apm-collector/apm-collector-boot/src/main/java/org/skywalking/apm/collector/boot/config/ApplicationConfigLoader.java#L43" rel="external nofollow noopener noreferrer" target="_blank"><code>ApplicationConfigLoader#load()</code></a> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><ul><li>ç¬¬ 47 è¡Œ ï¼šè°ƒç”¨ <code>#loadConfig()</code> æ–¹æ³•ï¼Œä» <code>apm-collector-core</code> çš„ <a href="https://github.com/YunaiV/skywalking/blob/c633c1f0e143d1df2457926ab239350a642f7be2/apm-collector/apm-collector-core/src/main/resources/application-default.yml" rel="external nofollow noopener noreferrer" target="_blank"><code>application.yml</code></a> åŠ è½½è‡ªå®šä¹‰é…ç½®ã€‚</li><li>ç¬¬ 49 è¡Œ ï¼šè°ƒç”¨ <code>#loadDefaultConfig()</code> æ–¹æ³•ï¼Œä» <code>apm-collector-core</code> çš„ <a href="https://github.com/YunaiV/skywalking/blob/c633c1f0e143d1df2457926ab239350a642f7be2/apm-collector/apm-collector-core/src/main/resources/application-default.yml" rel="external nofollow noopener noreferrer" target="_blank"><code>application-default.yml</code></a> åŠ è½½é»˜è®¤é…ç½®ã€‚</li><li>ä¸¤ä¸ªæ–¹æ³•é€»è¾‘åŸºæœ¬ä¸€è‡´ï¼Œå·²ç»æ·»åŠ ä»£ç æ³¨é‡Šï¼Œèƒ–å‹è‡ªå·±é˜…è¯»ç†è§£ã€‚</li></ul><h1 id="3-ModuleManager"><a href="#3-ModuleManager" class="headerlink" title="3. ModuleManager"></a>3. ModuleManager</h1><p><code>org.skywalking.apm.collector.core.module.ModuleManager</code> ï¼Œç»„ä»¶ç®¡ç†å™¨ï¼Œè´Ÿè´£ç»„ä»¶çš„ç®¡ç†ä¸åˆå§‹åŒ–ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ff055ee52da855ef6cc8bfdfae7c2758ae3c61cd/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleManager.java#L49" rel="external nofollow noopener noreferrer" target="_blank"><code>#init()</code></a> æ–¹æ³•ï¼Œåˆå§‹åŒ–ç»„ä»¶ä»¬ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><ul><li><p>ç¬¬ 51 è‡³ 53 è¡Œ ï¼šè°ƒç”¨ <code>java.util.ServiceLoader#load(Module.class)</code> æ–¹æ³•ï¼ŒåŠ è½½æ‰€æœ‰ Module å®ç°ç±»çš„å®ä¾‹æ•°ç»„ã€‚ServiceManager åŸºäº SPI (Service Provider Interface) æœºåˆ¶ï¼Œåœ¨æ¯ä¸ª <code>apm-collector-xxx-define</code> é¡¹ç›®çš„ <code>/resources/META-INF.services/org.skywalking.apm.collector.core.module.Module</code> æ–‡ä»¶é‡Œï¼Œå®šä¹‰äº†è¯¥é¡¹ç›® Module çš„å®ç°ç±»ã€‚å¦‚æœèƒ–å‹å¯¹ SPI æœºåˆ¶ä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥çœ‹ä¸‹å¦‚ä¸‹æ–‡ç«  ï¼š</p><ul><li><a href="http://www.jianshu.com/p/32d3e108f30a" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠSPI å’Œ ServiceLoaderã€‹</a> </li><li><a href="http://www.jianshu.com/p/46aa69643c97" rel="external nofollow noopener noreferrer" target="_blank">ã€Šè·Ÿæˆ‘å­¦Dubboç³»åˆ—ä¹‹Java SPIæœºåˆ¶ç®€ä»‹ã€‹</a> </li></ul></li><li><p>ç¬¬ 55 è‡³ 75 è¡Œ ï¼šéå†æ‰€æœ‰ Module å®ç°ç±»çš„å®ä¾‹æ•°ç»„ï¼Œåˆ›å»º<strong>åœ¨é…ç½®ä¸­</strong>çš„ Module å®ç°ç±»çš„å®ä¾‹ï¼Œå¹¶æ‰§è¡Œ Module å‡†å¤‡é˜¶æ®µçš„é€»è¾‘ï¼Œåæ·»åŠ åˆ°åŠ è½½çš„ç»„ä»¶å®ä¾‹çš„æ˜ å°„( <code>loadedModules</code> )ã€‚</p><ul><li>ç¬¬ 59 è‡³ 67 è¡Œ ï¼šåˆ›å»º Module å¯¹è±¡ã€‚</li><li>ç¬¬ 69 è¡Œ ï¼šè°ƒç”¨ <code>Module#prepare(...)</code> æ–¹æ³•ï¼Œæ‰§è¡Œ Module å‡†å¤‡é˜¶æ®µçš„é€»è¾‘ã€‚åœ¨æ”¹æ–¹æ³•å†…éƒ¨ï¼Œä¼šåˆ›å»º Module å¯¹åº”çš„ ModuleProvider ã€‚åœ¨ <a href="#">ã€Œ3.1 Moduleã€</a> è¯¦ç»†è§£æã€‚</li><li>ç¬¬ 71 è¡Œ ï¼šæ·»åŠ åˆ° <code>loadedModules</code> ã€‚</li></ul></li><li>ç¬¬ 77 è‡³ 80 è¡Œ ï¼šæ ¡éªŒ<strong>åœ¨é…ç½®ä¸­</strong>çš„ Module å®ç°ç±»çš„å®ä¾‹éƒ½åˆ›å»ºäº†ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li><li>ç¬¬ 84 è¡Œ ï¼šè°ƒç”¨ <code>BootstrapFlow#start(...)</code> æ–¹æ³•ï¼Œæ‰§è¡Œ Module å¯åŠ¨é€»è¾‘ã€‚<a href="#">ã€Œ3.4 BootstrapFlowã€</a> è¯¦ç»†è§£æã€‚</li><li>ç¬¬ 86 è¡Œ ï¼šè°ƒç”¨ <code>BootstrapFlow#notifyAfterCompleted()</code> æ–¹æ³•ï¼Œæ‰§è¡Œ Module å¯åŠ¨å®Œæˆï¼Œé€šçŸ¥ ModuleProvider ã€‚<a href="#">ã€Œ3.4 BootstrapFlowã€</a> è¯¦ç»†è§£æã€‚</li><li>æ€»çš„æ¥è¯´ï¼ŒModule åˆå§‹åŒ–çš„è¿‡ç¨‹ï¼Œå¯ä»¥ç†è§£æˆä¸‰ä¸ªé˜¶æ®µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_15/03.png" alt=""></li></ul><h2 id="3-1-Module"><a href="#3-1-Module" class="headerlink" title="3.1 Module"></a>3.1 Module</h2><p><code>org.skywalking.apm.collector.core.module.Module</code> ï¼Œç»„ä»¶<strong>æŠ½è±¡ç±»</strong>ã€‚é€šè¿‡å®ç° Module æŠ½è±¡ç±»ï¼Œå®ç°ä¸åŒåŠŸèƒ½çš„ç»„ä»¶ã€‚ç›®å‰ Collector çš„ Module å®ç°ç±»å¦‚ä¸‹å›¾ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_15/04.png" alt=""></p><p><a href="https://github.com/YunaiV/skywalking/blob/204a9e658dd95cc8ee5d4e65d7ca1ed58f3a71da/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Module.java#L50" rel="external nofollow noopener noreferrer" target="_blank"><code>#name()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œè·å¾—ç»„ä»¶åã€‚ç›®å‰ç»„ä»¶åæœ‰ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_15/05.png" alt=""></p><p><a href="https://github.com/YunaiV/skywalking/blob/204a9e658dd95cc8ee5d4e65d7ca1ed58f3a71da/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Module.java#L110" rel="external nofollow noopener noreferrer" target="_blank"><code>#providers()</code></a> æ–¹æ³•ï¼Œè·å¾— ModuleProvider æ•°ç»„ã€‚å®é™…ä¸Šï¼Œä¸€ä¸ª Module <strong>åŒæ—¶</strong>åªèƒ½æœ‰ä¸€ä¸ª ModuleProvider ï¼Œå‚è§ <a href="https://github.com/YunaiV/skywalking/blob/204a9e658dd95cc8ee5d4e65d7ca1ed58f3a71da/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Module.java#L114" rel="external nofollow noopener noreferrer" target="_blank"><code>#provider()</code></a> æ–¹æ³•ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/204a9e658dd95cc8ee5d4e65d7ca1ed58f3a71da/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Module.java#L55" rel="external nofollow noopener noreferrer" target="_blank"><code>#services()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œè·å¾— Service <strong>ç±»</strong>æ•°ç»„ã€‚å…·ä½“ Service <strong>å¯¹è±¡</strong>ï¼Œåœ¨ ModuleProvider å¯¹è±¡é‡Œè·å–ï¼Œå‚è§ <a href="https://github.com/YunaiV/skywalking/blob/204a9e658dd95cc8ee5d4e65d7ca1ed58f3a71da/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Module.java#L122" rel="external nofollow noopener noreferrer" target="_blank"><code>#getService(serviceType)</code></a> æ–¹æ³•ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/204a9e658dd95cc8ee5d4e65d7ca1ed58f3a71da/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/Module.java#L66" rel="external nofollow noopener noreferrer" target="_blank"><code>#prepare(...)</code></a> æ–¹æ³•ï¼Œæ‰§è¡Œ Module <strong>å‡†å¤‡é˜¶æ®µ</strong>çš„é€»è¾‘ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><ul><li>ç¬¬ 69 è¡Œ ï¼šè°ƒç”¨ <code>java.util.ServiceLoader#load(ModuleProvider.class)</code> æ–¹æ³•ï¼ŒåŠ è½½æ‰€æœ‰ ModuleProvider å®ç°ç±»çš„å®ä¾‹æ•°ç»„ã€‚ServiceManager åŸºäº SPI (Service Provider Interface) æœºåˆ¶ï¼Œåœ¨æ¯ä¸ª <code>apm-collector-xxx-yyy-provider</code> é¡¹ç›®çš„ <code>/resources/META-INF.services/org.skywalking.apm.collector.core.module.ModuleProvider</code> æ–‡ä»¶é‡Œï¼Œå®šä¹‰äº†è¯¥é¡¹ç›® ModuleProvider çš„å®ç°ç±»ã€‚</li><li>ç¬¬ 72 è‡³ 93 è¡Œ ï¼šéå†æ‰€æœ‰ ModuleProvider å®ç°ç±»çš„å®ä¾‹æ•°ç»„ï¼Œåˆ›å»º<strong>åœ¨é…ç½®ä¸­</strong>çš„ ModuleProvider å®ç°ç±»çš„å®ä¾‹ï¼Œåæ·»åŠ åˆ°åŠ è½½çš„ç»„ä»¶æœåŠ¡æä¾›è€…å®ä¾‹çš„æ˜ å°„( <code>loadedProviders</code> )ã€‚</li><li>ç¬¬ 95 è‡³ 98 è¡Œ ï¼šæ ¡éªŒæœ‰ ModuleProvider åˆå§‹åŒ–ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li><li>ç¬¬ 100 è‡³ 104 è¡Œ ï¼šè°ƒç”¨ <code>ModuleProvider#prepare(...)</code>  æ–¹æ³•ï¼Œæ‰§è¡Œ ModuleProvider å‡†å¤‡é˜¶æ®µçš„é€»è¾‘ã€‚åœ¨æ”¹æ–¹æ³•å†…éƒ¨ï¼Œä¼šåˆ›å»º ModuleProvider å¯¹åº”çš„ Service ã€‚åœ¨ <a href="#">ã€Œ3.2 ModuleProviderã€</a> è¯¦ç»†è§£æã€‚</li></ul><h2 id="3-2-ModuleProvider"><a href="#3-2-ModuleProvider" class="headerlink" title="3.2 ModuleProvider"></a>3.2 ModuleProvider</h2><p><code>org.skywalking.apm.collector.core.module.ModuleProvider</code> ï¼Œç»„ä»¶æœåŠ¡æä¾›è€…<strong>æŠ½è±¡ç±»</strong>ã€‚é€šè¿‡å®ç° ModuleProvider æŠ½è±¡ç±»ï¼Œå®ç°ä¸åŒåŠŸèƒ½çš„ç»„ä»¶æœåŠ¡æä¾›è€…ã€‚ç›®å‰ Collector çš„ ModuleProvider å®ç°ç±»å¦‚ä¸‹å›¾ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_15/06.png" alt=""></p><p><a href="https://github.com/YunaiV/skywalking/blob/3fb837104a111ff94abef9c871c814fb60c18340/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleProvider.java#L64" rel="external nofollow noopener noreferrer" target="_blank"><code>#name()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œè·å¾—ç»„ä»¶æœåŠ¡æä¾›è€…åã€‚ç›®å‰ç»„ä»¶æœåŠ¡æä¾›è€…åæœ‰ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_15/07.png" alt=""></p><p><a href="https://github.com/YunaiV/skywalking/blob/3fb837104a111ff94abef9c871c814fb60c18340/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleProvider.java#L69" rel="external nofollow noopener noreferrer" target="_blank"><code>#module()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œè·å¾— ModuleProvider å¯¹åº”çš„ Module <strong>ç±»</strong>ã€‚æ³¨æ„ï¼ŒModuleProvider çš„åå­—å¯ä»¥é‡å¤ï¼Œä¾‹å¦‚ä¸Šå›¾çš„ <code>jetty</code> ï¼Œé€šè¿‡å¯¹åº”çš„ Module <strong>ç±»</strong>æ¥åŒºåˆ†ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/3fb837104a111ff94abef9c871c814fb60c18340/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleProvider.java#L95" rel="external nofollow noopener noreferrer" target="_blank"><code>#requiredModules()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œè·å¾— ModuleProvider ä¾èµ–çš„ Module <strong>åå­—</strong>æ•°ç»„ã€‚</p><p>â€”â€”â€”- Service ç›¸å…³æ–¹æ³• Begin â€”â€”â€”-</p><p><a href="https://github.com/YunaiV/skywalking/blob/3fb837104a111ff94abef9c871c814fb60c18340/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleProvider.java#L103" rel="external nofollow noopener noreferrer" target="_blank"><code>#registerServiceImplementation(Class&lt;? extends Service&gt;, Service)</code></a> æ–¹æ³•ï¼Œæ³¨å†Œ Service å¯¹è±¡ã€‚ä¸€ä¸ª ModuleProvider å¯ä»¥æœ‰ 0 åˆ° N ä¸ª Service å¯¹è±¡ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/3fb837104a111ff94abef9c871c814fb60c18340/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleProvider.java#L133" rel="external nofollow noopener noreferrer" target="_blank"><code>#getService(Class&lt;T&gt;)</code></a> æ–¹æ³•ï¼Œè·å¾— Service å¯¹è±¡ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/3fb837104a111ff94abef9c871c814fb60c18340/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleProvider.java#L118" rel="external nofollow noopener noreferrer" target="_blank"><code>#requiredCheck(...)</code></a> æ–¹æ³•ï¼Œ<strong>æ ¡éªŒ</strong> ModuleProvider åŒ…å«çš„ Service ä»¬éƒ½åˆ›å»ºæˆåŠŸã€‚</p><ul><li><strong>æ–¹æ³•å‚æ•°</strong>ï¼Œä» <code>Module#services()</code> æ–¹æ³•è·å¾—ã€‚</li><li>è¯¥æ–¹æ³•ä¼šè¢« <code>BootstrapFlow#start()</code> æ–¹æ³•è°ƒç”¨ï¼Œåœ¨ <a href="#">ã€Œ3.4 BootstrapFlowã€</a> è¯¦ç»†è§£æã€‚</li></ul><p>â€”â€”â€”- Service ç›¸å…³æ–¹æ³• End â€”â€”â€”-</p><p><a href="https://github.com/YunaiV/skywalking/blob/3fb837104a111ff94abef9c871c814fb60c18340/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleProvider.java#L76" rel="external nofollow noopener noreferrer" target="_blank"><code>#prepare(Properties)</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œæ‰§è¡Œ ModuleProvider å‡†å¤‡é˜¶æ®µçš„é€»è¾‘ï¼šService çš„åˆ›å»ºï¼Œç§æœ‰å˜é‡çš„åˆ›å»ºç­‰ç­‰ã€‚ä¾‹å¦‚ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/3fb837104a111ff94abef9c871c814fb60c18340/apm-collector/apm-collector-storage/collector-storage-h2-provider/src/main/java/org/skywalking/apm/collector/storage/h2/StorageModuleH2Provider.java#L123" rel="external nofollow noopener noreferrer" target="_blank"><code>StorageModuleH2Provider#prepare(Properties)</code></a> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/3fb837104a111ff94abef9c871c814fb60c18340/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleProvider.java#L83" rel="external nofollow noopener noreferrer" target="_blank"><code>#start(Properties)</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œæ‰§è¡Œ ModuleProvider å¯åŠ¨é˜¶æ®µçš„é€»è¾‘ï¼šç§æœ‰å˜é‡çš„åˆå§‹åŒ–ç­‰ç­‰ã€‚ä¾‹å¦‚ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/3fb837104a111ff94abef9c871c814fb60c18340/apm-collector/apm-collector-storage/collector-storage-h2-provider/src/main/java/org/skywalking/apm/collector/storage/h2/StorageModuleH2Provider.java#L136" rel="external nofollow noopener noreferrer" target="_blank"><code>StorageModuleH2Provider#start(Properties)</code></a> ã€‚</p><ul><li>è¯¥æ–¹æ³•ä¼šè¢« <code>BootstrapFlow#start()</code> æ–¹æ³•è°ƒç”¨ï¼Œåœ¨ <a href="#">ã€Œ3.4 BootstrapFlowã€</a> è¯¦ç»†è§£æã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/3fb837104a111ff94abef9c871c814fb60c18340/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/ModuleProvider.java#L90" rel="external nofollow noopener noreferrer" target="_blank"><code>#notifyAfterCompleted()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œæ‰§è¡Œ ModuleProvider å¯åŠ¨å®Œæˆé˜¶æ®µçš„é€»è¾‘ï¼šç§æœ‰å˜é‡çš„åˆå§‹åŒ–ç­‰ç­‰ã€‚ä¾‹å¦‚ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/3fb837104a111ff94abef9c871c814fb60c18340/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/StorageModuleEsProvider.java#L170" rel="external nofollow noopener noreferrer" target="_blank"><code>StorageModuleEsProvider#notifyAfterCompleted(Properties)</code></a> ã€‚</p><ul><li>è¯¥æ–¹æ³•ä¼šè¢« <code>BootstrapFlow#notifyAfterCompleted()</code> æ–¹æ³•è°ƒç”¨ï¼Œåœ¨ <a href="#">ã€Œ3.4 BootstrapFlowã€</a> è¯¦ç»†è§£æã€‚</li></ul><h2 id="3-3-Service"><a href="#3-3-Service" class="headerlink" title="3.3 Service"></a>3.3 Service</h2><p><code>org.skywalking.apm.collector.core.module.Service</code> ï¼ŒæœåŠ¡<strong>æ¥å£</strong>ã€‚é€šè¿‡å®ç° Service æ¥å£ï¼Œå®ç°ä¸åŒåŠŸèƒ½çš„æœåŠ¡ã€‚ç›®å‰ Collector çš„ Service å®ç°ç±»å¦‚ä¸‹å›¾ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_15/08.png" alt=""></p><p>è¿™é‡Œæœ‰ä¸€ç‚¹è¦æ³¨æ„ä¸‹ï¼Œå®é™…ä¸Š Module æ˜¯ä¸ Service <strong>â€œç›´æ¥â€</strong> ä¸€å¯¹å¤šçš„å…³ç³»ã€‚ä¸­é—´ æœ‰ä¸€å±‚ ModuleProvider å­˜åœ¨çš„åŸå› æ˜¯ï¼Œç›¸åŒ Module å¯ä»¥æœ‰å¤šç§ ModuleProvider å®ç°ï¼Œè€Œ ModuleProvider æä¾›æä¾›ç›¸åŒåŠŸèƒ½çš„ Service ï¼Œä½†æ˜¯å®ç°ä¸åŒã€‚</p><p>ä»¥ <code>apm-collector-storage</code> ä¸¾ä¾‹å­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_15/09.png" alt=""></p><ul><li>StorageModuleEsProvider / StorageModuleH2Provider åˆ†åˆ«åŸºäº ES / H2 å®ç°ï¼Œå…¶æä¾›å­˜å‚¨ç›¸åŒæ•°æ®çš„ä¸åŒå®ç°ã€‚ä¾‹å¦‚ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_15/10.png" alt=""></li></ul><p>ä¸€èˆ¬ <code>collector-xxx-define</code> çš„ <code>service</code> åŒ…ä¸‹ï¼Œä¼šå®šä¹‰å½“å‰æ¨¡å—æä¾›çš„ Service æ¥å£ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_15/12.png" alt=""></p><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæœ‰ <code>Module#services()</code> å’Œ <code>#requiredCheck(Class&lt;? extends Service&gt;[])</code> è¿™æ ·çš„æ–¹æ³•æ¶‰åŠçš„åŸå› ã€‚</p><p>å¦å¤–ï¼Œå¦‚ä¸‹æ˜¯ Service æ¥å£çš„è§£é‡Šï¼š</p><blockquote><p>The <code>Service</code> implementation is a service provided by its own modules.  </p><p>And every {@link ModuleProvider} must provide all the given services of the {@link Module}.</p></blockquote><h2 id="3-4-BootstrapFlow"><a href="#3-4-BootstrapFlow" class="headerlink" title="3.4 BootstrapFlow"></a>3.4 BootstrapFlow</h2><p><a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/BootstrapFlow.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.core.module.BootstrapFlow</code></a>ï¼Œç»„ä»¶å¯åŠ¨æµç¨‹ã€‚</p><p>BootstrapFlow <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/BootstrapFlow.java#L42" rel="external nofollow noopener noreferrer" target="_blank"><strong>æ„é€ æ–¹æ³•</strong></a>ï¼Œè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/BootstrapFlow.java#L86" rel="external nofollow noopener noreferrer" target="_blank"><code>#makeSequence()</code></a> æ–¹æ³•ï¼Œè·å¾— ModuleProvider å¯åŠ¨é¡ºåºï¼Œè¿™ä¸ªæ˜¯è¯¥ç±»çš„<strong>é‡ç‚¹</strong>ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/BootstrapFlow.java#L51" rel="external nofollow noopener noreferrer" target="_blank"><code>#start()</code></a> æ–¹æ³•ï¼Œæ‰§è¡Œ Module å¯åŠ¨é€»è¾‘ã€‚</p><ul><li>ç¬¬ 54 è‡³ 63 è¡Œ ï¼šæ ¡éªŒ<strong>ä¾èµ–</strong> Module å·²ç»éƒ½å­˜åœ¨ã€‚</li><li>ç¬¬ 67 è¡Œ ï¼šæ ¡éªŒ ModuleProvider åŒ…å«çš„ Service ä»¬éƒ½<strong>åˆ›å»ºæˆåŠŸ</strong>ã€‚</li><li>ç¬¬ 70 è¡Œ ï¼šè°ƒç”¨ <code>ModuleProvider#start(...)</code> æ–¹æ³•ï¼Œæ‰§è¡Œ ModuleProvider å¯åŠ¨é˜¶æ®µé€»è¾‘ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/40823179d7228207b06b603b9a1c09dfc4f78593/apm-collector/apm-collector-core/src/main/java/org/skywalking/apm/collector/core/module/BootstrapFlow.java#L74" rel="external nofollow noopener noreferrer" target="_blank"><code>#notifyAfterCompleted()</code></a> æ–¹æ³•ï¼Œè°ƒç”¨ <code>ModuleProvider#notifyAfterCompleted()</code> æ–¹æ³•ï¼Œæ‰§è¡Œ ModuleProvider å¯åŠ¨å®Œæˆé˜¶æ®µçš„é€»è¾‘ã€‚</p><h1 id="4-Module-å®ç°ç±»ç®€ä»‹"><a href="#4-Module-å®ç°ç±»ç®€ä»‹" class="headerlink" title="4. Module å®ç°ç±»ç®€ä»‹"></a>4. Module å®ç°ç±»ç®€ä»‹</h1><p><img src="https://camo.githubusercontent.com/2a00cb347f6a7d7afb8faef8d8b0f2a0d3215d9d/68747470733a2f2f736b7977616c6b696e67746573742e6769746875622e696f2f706167652d7265736f75726365732f332e322e352532625f6172636869746563747572652e6a7067" alt=""></p><ul><li>Naming Module ï¼š<a href="http://www.iocoder.cn/SkyWalking/collector-naming-server/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Naming Server å‘½åæœåŠ¡ã€‹</a></li><li>UI Module ï¼š</li><li>Queue Module ï¼š<a href="http://www.iocoder.cn/SkyWalking/collector-queue-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Queue é˜Ÿåˆ—ç»„ä»¶ã€‹</a></li><li>Cache Module ï¼š<a href="http://www.iocoder.cn/SkyWalking/collector-cache-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Cache ç¼“å­˜ç»„ä»¶ã€‹</a></li><li>Cluster Module ï¼š<a href="http://www.iocoder.cn/SkyWalking/collector-cluster-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Cluster é›†ç¾¤ç®¡ç†ã€‹</a></li><li>Component Libraries ï¼š<a href="http://www.iocoder.cn/SkyWalking/collector-client-component/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Client Component å®¢æˆ·ç«¯ç»„ä»¶ã€‹</a> ã€<a href="http://www.iocoder.cn/SkyWalking/collector-server-component/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Server Component æœåŠ¡å™¨ç»„ä»¶ã€‹</a></li><li>Core ï¼š<ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Storage å­˜å‚¨ç»„ä»¶ã€‹ã€Œ2. apm-collector-coreã€</a> </li><li><a href="http://www.iocoder.cn/SkyWalking/collector-init/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector åˆå§‹åŒ–ã€‹ã€Œ3. ModuleManagerã€</a></li></ul></li><li>Storage Module ï¼š<a href="http://www.iocoder.cn/SkyWalking/collector-storage-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Storage å­˜å‚¨ç»„ä»¶ã€‹</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆä¸€ï¼‰ã€‹ã€Œ2. apm-collector-core/graphã€</a> </li><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆäºŒï¼‰ã€‹ã€Œ2. Dataã€</a> </li></ul></li><li>Agent Module ï¼šTODO</li><li>Jetty Manager Module ï¼š<a href="http://www.iocoder.cn/SkyWalking/collector-jetty-server-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Jetty Server Managerã€‹</a></li><li>gRPC Manager Module ï¼š<a href="http://www.iocoder.cn/SkyWalking/collector-grpc-server-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector gRPC Server Managerã€‹</a></li><li>Agent Streaming Computing ï¼š<ul><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-first/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆä¸€ï¼‰ã€‹ã€Œ2. apm-collector-core/graphã€</a> </li><li><a href="http://www.iocoder.cn/SkyWalking/collector-streaming-second/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Streaming Computing æµå¼å¤„ç†ï¼ˆäºŒï¼‰ã€‹ã€Œ2. Dataã€</a> </li><li><a href="http://www.iocoder.cn/SkyWalking/collector-remote-module/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Collector Remote è¿œç¨‹é€šä¿¡æœåŠ¡ã€‹</a></li></ul></li><li>Baseline Module ï¼štodo</li><li>Alerting Module ï¼štodo</li></ul><p>TODO ã€4001ã€‘Module å®ç°æ–‡ç« é“¾æ¥ </p><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>å¯èƒ½è¦è¿›å…¥ç‰¹åˆ«å¿™ç¢Œçš„ä¸€æ®µæ—¶é—´ï¼Œä¸ç¡®å®š SkyWalking æ–‡ç« åç»­çš„æ›´æ–°é¢‘ç‡ã€‚</p><p>ç»§ç»­åŠ æ²¹ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_15/11.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸ªæœ‹å‹åœˆå¯å¥½ï¼Ÿ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/collector-init/&quot;&gt;http://www.iocoder.cn/SkyWalking/collector-init/&lt;/a&gt; ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œ
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” Agent æ’ä»¶ä½“ç³»</title>
    <link href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/"/>
    <id>http://www.iocoder.cn/SkyWalking/agent-plugin-system/</id>
    <published>2020-07-09T16:00:00.000Z</published>
    <updated>2017-12-12T09:06:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">http://www.iocoder.cn/SkyWalking/agent-plugin-system/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">2. æ’ä»¶çš„åŠ è½½</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">2.1 AgentClassLoader</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">2.2 PluginResourcesResolver</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">2.3 PluginCfg</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">2.4 AbstractClassEnhancePluginDefine</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">2.5 å°ç»“</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">3. æ’ä»¶çš„åŒ¹é…</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">3.1 InstrumentDebuggingClass</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">3.2 ClassMatch</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">3.3 PluginFinder</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">4. æ’ä»¶çš„æ‹¦æˆª</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">4.1 ClassEnhancePluginDefine</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">4.2 InterceptPoint</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">4.3 Interceptor</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">4.4 Inter</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">4.5 å°ç»“</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>SkyWalking Agent æ’ä»¶ä½“ç³»</strong>ã€‚ä¸»è¦æ¶‰åŠä¸‰ä¸ªæµç¨‹ ï¼š</p><ul><li>æ’ä»¶çš„åŠ è½½</li><li>æ’ä»¶çš„åŒ¹é…</li><li>æ’ä»¶çš„æ‹¦æˆª</li></ul><p>å¯èƒ½çœ‹èµ·æ¥æœ‰ç‚¹æŠ½è±¡ï¼Œä¸å¤ªå®¹æ˜“ç†è§£ã€‚æ·¡å®šï¼Œæˆ‘ä»¬æ¯ä¸ªå°ç« èŠ‚è¿›è¡Œè§£æã€‚</p><p>æœ¬æ–‡æ¶‰åŠåˆ°çš„ç±»ä¸»è¦åœ¨ <a href="https://github.com/YunaiV/skywalking/tree/3de8a6c15d07aa3b2c3b4e732e6654fc87c4e70e/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin</code></a> åŒ…é‡Œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_10/01.png" alt=""></p><p>æ¯ä¸ªæµç¨‹ä¼šæ¶‰åŠåˆ°è¾ƒå¤šçš„ç±»ï¼Œæˆ‘ä»¬ä¼šè´¯ç©¿ç€è§£æä»£ç å®ç°ã€‚</p><h1 id="2-æ’ä»¶çš„åŠ è½½"><a href="#2-æ’ä»¶çš„åŠ è½½" class="headerlink" title="2. æ’ä»¶çš„åŠ è½½"></a>2. æ’ä»¶çš„åŠ è½½</h1><p>åœ¨ <a href="http://www.iocoder.cn/SkyWalking/agent-init/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Agent åˆå§‹åŒ–ã€‹</a> ä¸€æ–‡ä¸­ï¼ŒAgent åˆå§‹åŒ–æ—¶ï¼Œè°ƒç”¨ <code>PluginBootstrap#loadPlugins()</code> æ–¹æ³•ï¼ŒåŠ è½½æ‰€æœ‰çš„æ’ä»¶ã€‚æ•´ä½“æµç¨‹å¦‚ä¸‹å›¾ ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_10/03.png" alt=""></p><p><a href="https://github.com/YunaiV/skywalking/blob/130f0a5a3438663b393e53ba2cca02a8d13c258a/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/PluginBootstrap.java#L45" rel="external nofollow noopener noreferrer" target="_blank"><code>PluginBootstrap#loadPlugins()</code></a> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><ul><li>ç¬¬ 47 è¡Œ ï¼šè°ƒç”¨ <code>AgentClassLoader#initDefaultLoader()</code> æ–¹æ³•ï¼Œåˆå§‹åŒ– AgentClassLoader ã€‚åœ¨æœ¬æ–‡ <a href="#">ã€Œ2.1 AgentClassLoaderã€</a> è¯¦ç»†è§£æã€‚</li><li>ç¬¬ 50 è‡³ 56 è¡Œ ï¼šè·å¾—æ’ä»¶<strong>å®šä¹‰è·¯å¾„</strong>æ•°ç»„ã€‚åœ¨æœ¬æ–‡ <a href="#">ã€Œ2.2 PluginResourcesResolverã€</a> è¯¦ç»†è§£æã€‚</li><li>ç¬¬ 59 è‡³ 66 è¡Œ ï¼šè·å¾—æ’ä»¶<strong>å®šä¹‰</strong>( <a href="https://github.com/OpenSkywalking/skywalking/blob/b16d23c1484bec941367d6b36fa932b8ace40971/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/PluginDefine.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.PluginDefine</code></a> )æ•°ç»„ã€‚åœ¨æœ¬æ–‡ <a href="#">ã€Œ2.3 PluginCfgã€</a> è¯¦ç»†è§£æã€‚</li><li>ç¬¬ 69 è‡³ 82 è¡Œ ï¼šåˆ›å»º<strong>ç±»å¢å¼ºæ’ä»¶å®šä¹‰</strong>( <a href="https://github.com/OpenSkywalking/skywalking/blob/b16d23c1484bec941367d6b36fa932b8ace40971/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/AbstractClassEnhancePluginDefine.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.AbstractClassEnhancePluginDefine</code></a> )å¯¹è±¡æ•°ç»„ã€‚ä¸åŒæ’ä»¶é€šè¿‡å®ç° AbstractClassEnhancePluginDefine <strong>æŠ½è±¡ç±»</strong>ï¼Œå®šä¹‰ä¸åŒæ¡†æ¶çš„<strong>åˆ‡é¢</strong>ï¼Œ<strong>è®°å½•è°ƒç”¨é“¾è·¯</strong>ã€‚åœ¨æœ¬æ–‡ <a href="#">ã€Œ2.4 AbstractClassEnhancePluginDefineã€</a> ç®€å•è§£æã€‚</li></ul><h2 id="2-1-AgentClassLoader"><a href="#2-1-AgentClassLoader" class="headerlink" title="2.1 AgentClassLoader"></a>2.1 AgentClassLoader</h2><p><code>org.skywalking.apm.agent.core.plugin.loader.AgentClassLoader</code> ï¼Œç»§æ‰¿ <code>java.lang.ClassLoader</code> ï¼ŒAgent ç±»åŠ è½½å™¨ã€‚</p><p><strong>ä¸ºä»€ä¹ˆå®ç°è‡ªå®šä¹‰çš„ ClassLoader</strong> ï¼Ÿåº”ç”¨<strong>é€æ˜</strong>æ¥å…¥ SkyWalking ï¼Œä¸ä¼š<strong>æ˜¾ç¤º</strong>å¯¼å…¥ SkyWalking çš„æ’ä»¶ä¾èµ–ã€‚é€šè¿‡å®ç°è‡ªå®šä¹‰çš„ ClassLoader ï¼Œä»æ’ä»¶ Jar ä¸­æŸ¥æ‰¾ç›¸å…³ç±»ã€‚ä¾‹å¦‚è¯´ï¼Œä» <code>apm-dubbo-plugin-3.2.6-2017.jar</code> æŸ¥æ‰¾ <code>org.skywalking.apm.plugin.dubbo.DubboInstrumentation</code> ã€‚</p><hr><p>AgentClassLoader <strong>æ„é€ æ–¹æ³•</strong>ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AgentClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * The default class loader for the agent.</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AgentClassLoader DEFAULT_LOADER;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * classpath</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> List&lt;File&gt; classpath;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * Jar æ•°ç»„</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> List&lt;Jar&gt; allJars;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * Jar è¯»å–æ—¶çš„é”</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> ReentrantLock jarScanLock = <span class="keyword">new</span> ReentrantLock();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AgentClassLoader</span><span class="params">(ClassLoader parent)</span> <span class="keyword">throws</span> AgentPackageNotFoundException </span>&#123;</div><div class="line">        <span class="keyword">super</span>(parent);</div><div class="line">        File agentDictionary = AgentPackagePath.getPath();</div><div class="line">        classpath = <span class="keyword">new</span> LinkedList&lt;File&gt;();</div><div class="line">        classpath.add(<span class="keyword">new</span> File(agentDictionary, <span class="string">"plugins"</span>));</div><div class="line">        classpath.add(<span class="keyword">new</span> File(agentDictionary, <span class="string">"activations"</span>));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li><code>DEFAULT_LOADER</code> <strong>é™æ€</strong>å±æ€§ï¼Œé»˜è®¤å•ä¾‹ã€‚é€šè¿‡ <a href="https://github.com/YunaiV/skywalking/blob/3de8a6c15d07aa3b2c3b4e732e6654fc87c4e70e/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/loader/AgentClassLoader.java#L56" rel="external nofollow noopener noreferrer" target="_blank"><code>#getDefault()</code></a> æ–¹æ³•ï¼Œå¯ä»¥è·å–åˆ°å®ƒã€‚</li><li><code>classpath</code> å±æ€§ï¼ŒJava ç±»æ‰€åœ¨çš„ç›®å½•ã€‚åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>${AGENT_PACKAGE_PATH}/plugins</code> / <code>${AGENT_PACKAGE_PATH}/activations</code> æ·»åŠ åˆ° <code>classpath</code> ã€‚åœ¨ <a href="https://github.com/YunaiV/skywalking/blob/3de8a6c15d07aa3b2c3b4e732e6654fc87c4e70e/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/loader/AgentClassLoader.java#L163" rel="external nofollow noopener noreferrer" target="_blank"><code>#getAllJars()</code></a>  æ–¹æ³•ä¸­ï¼ŒåŠ è½½è¯¥ç›®å½•ä¸‹çš„ Jar ä¸­çš„ Class æ–‡ä»¶ã€‚</li><li><code>allJars</code> å±æ€§ï¼ŒJar æ•°ç»„ã€‚</li><li><code>jarScanLock</code> å±æ€§ï¼ŒJar è¯»å–æ—¶çš„<strong>é”</strong>ã€‚</li></ul><hr><p><code>#initDefaultLoader()</code> <strong>é™æ€</strong>æ–¹æ³•ï¼Œåˆå§‹åŒ–<strong>é»˜è®¤</strong>çš„ AgentClassLoader ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AgentClassLoader <span class="title">initDefaultLoader</span><span class="params">()</span> <span class="keyword">throws</span> AgentPackageNotFoundException </span>&#123;</div><div class="line">    DEFAULT_LOADER = <span class="keyword">new</span> AgentClassLoader(PluginBootstrap.class.getClassLoader());</div><div class="line">    <span class="keyword">return</span> getDefault();</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>org.skywalking.apm.agent.core.plugin.PluginBootstrap</code> çš„ç±»åŠ è½½å™¨ä½œä¸º AgentClassLoader çš„<strong>çˆ¶ç±»åŠ è½½å™¨</strong>ã€‚</li></ul><hr><p>å¦‚ä¸‹æ–¹æ³•å·²ç»æ·»åŠ ç›¸å…³ä¸­æ–‡æ³¨é‡Šï¼Œèƒ–å‹è¯·è‡ªè¡Œé˜…è¯»ç†è§£ ï¼š</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/778093d38a0a820b90092c2ed77a08e3393169eb/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/loader/AgentClassLoader.java#L132" rel="external nofollow noopener noreferrer" target="_blank"><code>#findResource(name)</code></a></li><li><a href="https://github.com/YunaiV/skywalking/blob/778093d38a0a820b90092c2ed77a08e3393169eb/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/loader/AgentClassLoader.java#L150" rel="external nofollow noopener noreferrer" target="_blank"><code>#findResources(String name)</code></a></li><li><a href="https://github.com/YunaiV/skywalking/blob/778093d38a0a820b90092c2ed77a08e3393169eb/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/loader/AgentClassLoader.java#L182" rel="external nofollow noopener noreferrer" target="_blank"><code>#getAllJars()</code></a></li></ul><p>åœ¨ ClassLoader åŠ è½½èµ„æº( ä¾‹å¦‚ï¼Œç±» )ï¼Œä¼šè°ƒç”¨ <code>#findResource(name)</code> / <code>#findResources(name)</code> æ–¹æ³•ã€‚</p><h2 id="2-2-PluginResourcesResolver"><a href="#2-2-PluginResourcesResolver" class="headerlink" title="2.2 PluginResourcesResolver"></a>2.2 PluginResourcesResolver</h2><p><code>org.skywalking.apm.agent.core.plugin.PluginResourcesResolver</code> ï¼Œæ’ä»¶èµ„æºè§£æå™¨ï¼Œè¯»å–æ‰€æœ‰æ’ä»¶çš„å®šä¹‰æ–‡ä»¶ã€‚æ’ä»¶å®šä¹‰æ–‡ä»¶å¿…é¡»ä»¥ <code>skywalking-plugin.def</code> <strong>å‘½å</strong>ï¼Œä¾‹å¦‚ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_10/02.png" alt=""></p><p><a href="https://github.com/YunaiV/skywalking/blob/d4a6ba291419ab90379a3d1c423b747f682f857f/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/PluginResourcesResolver.java#L45" rel="external nofollow noopener noreferrer" target="_blank"><code>#getResources()</code></a> æ–¹æ³•ï¼Œè·å¾—æ’ä»¶å®šä¹‰è·¯å¾„æ•°ç»„ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><ul><li>ç¬¬ 50 è¡Œ ï¼šä½¿ç”¨ AgentClassLoader è·å¾—æ‰€æœ‰ <code>skywalking-plugin.def</code> çš„è·¯å¾„ã€‚</li></ul><h2 id="2-3-PluginCfg"><a href="#2-3-PluginCfg" class="headerlink" title="2.3 PluginCfg"></a>2.3 PluginCfg</h2><p><code>org.skywalking.apm.agent.core.plugin.PluginCfg</code> ï¼Œæ’ä»¶å®šä¹‰é…ç½®ï¼Œè¯»å– <code>skywalking-plugin.def</code> æ–‡ä»¶ï¼Œç”Ÿæˆæ’ä»¶å®šä¹‰( <a href="https://github.com/YunaiV/skywalking/blob/43241fff19e17f19b918c96ffd588787f8f05519/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/PluginDefine.java#L27" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.PluginDefinie</code></a> )æ•°ç»„ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/43241fff19e17f19b918c96ffd588787f8f05519/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/PluginCfg.java#L55" rel="external nofollow noopener noreferrer" target="_blank"><code>#load(InputStream)</code></a> æ–¹æ³•ï¼Œè¯»å– <code>skywalking-plugin.def</code> æ–‡ä»¶ï¼Œæ·»åŠ åˆ° <code>pluginClassList</code> ã€‚å¦‚ä¸‹æ˜¯ <code>apm-springmvc-annotation-4.x-plugin-3.2.6-2017.jar</code> æ’ä»¶çš„å®šä¹‰æ–‡ä»¶ ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">spring-mvc-annotation-4.x=org.skywalking.apm.plugin.spring.mvc.v4.define.ControllerInstrumentation</div><div class="line">spring-mvc-annotation-4.x=org.skywalking.apm.plugin.spring.mvc.v4.define.RestControllerInstrumentation</div><div class="line">spring-mvc-annotation-4.x=org.skywalking.apm.plugin.spring.mvc.v4.define.HandlerMethodInstrumentation</div><div class="line">spring-mvc-annotation-4.x=org.skywalking.apm.plugin.spring.mvc.v4.define.InvocableHandlerInstrumentation</div></pre></td></tr></table></figure><h2 id="2-4-AbstractClassEnhancePluginDefine"><a href="#2-4-AbstractClassEnhancePluginDefine" class="headerlink" title="2.4 AbstractClassEnhancePluginDefine"></a>2.4 AbstractClassEnhancePluginDefine</h2><p><code>org.skywalking.apm.agent.core.plugin.AbstractClassEnhancePluginDefine</code> ï¼Œç±»å¢å¼ºæ’ä»¶å®šä¹‰<strong>æŠ½è±¡åŸºç±»</strong>ã€‚ä¸åŒæ’ä»¶é€šè¿‡å®ç° AbstractClassEnhancePluginDefine <strong>æŠ½è±¡ç±»</strong>ï¼Œå®šä¹‰ä¸åŒæ¡†æ¶çš„<strong>åˆ‡é¢</strong>ï¼Œ<strong>è®°å½•è°ƒç”¨é“¾è·¯</strong>ã€‚ä»¥ Spring æ’ä»¶ä¸ºä¾‹å­ï¼Œå¦‚ä¸‹æ˜¯ç›¸å…³ç±»å›¾ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_05/06.png" alt=""></p><p>PluginDefine å¯¹è±¡çš„ <code>defineClass</code> å±æ€§ï¼Œå³å¯¹åº”ä¸åŒæ’ä»¶å¯¹AbstractClassEnhancePluginDefine çš„<strong>å®ç°ç±»</strong>ã€‚æ‰€ä»¥åœ¨ <a href="https://github.com/YunaiV/skywalking/blob/130f0a5a3438663b393e53ba2cca02a8d13c258a/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/PluginBootstrap.java#L45" rel="external nofollow noopener noreferrer" target="_blank"><code>PluginBootstrap#loadPlugins()</code></a> æ–¹æ³•çš„ã€<strong>ç¬¬ 74 è¡Œ</strong>ã€‘ï¼Œæˆ‘ä»¬çœ‹åˆ°é€šè¿‡è¯¥å±æ€§ï¼Œåˆ›å»ºåˆ›å»º<strong>ç±»å¢å¼ºæ’ä»¶å®šä¹‰</strong>å¯¹è±¡ã€‚</p><h2 id="2-5-å°ç»“"><a href="#2-5-å°ç»“" class="headerlink" title="2.5 å°ç»“"></a>2.5 å°ç»“</h2><p>èƒ–å‹ï¼Œå›è¿‡å¤´ï¼Œåœ¨çœ‹ä¸€ä¸‹æµç¨‹å›¾ï¼Œç†è§£ç†è§£ã€‚</p><h1 id="3-æ’ä»¶çš„åŒ¹é…"><a href="#3-æ’ä»¶çš„åŒ¹é…" class="headerlink" title="3. æ’ä»¶çš„åŒ¹é…"></a>3. æ’ä»¶çš„åŒ¹é…</h1><p>åœ¨ <a href="http://www.iocoder.cn/SkyWalking/agent-init/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Agent åˆå§‹åŒ–ã€‹</a> ä¸€æ–‡ï¼Œæˆ‘ä»¬æåˆ°ï¼ŒSkyWalking Agent åŸºäº <strong>JavaAgent</strong> æœºåˆ¶ï¼Œå®ç°åº”ç”¨<strong>é€æ˜</strong>æ¥å…¥ SkyWalking ã€‚ä¸‹é¢ç¬”è€…é»˜è®¤èƒ–å‹å·²ç»å¯¹ JavaAgent æœºåˆ¶å·²ç»æœ‰ä¸€å®šçš„äº†è§£ã€‚å¦‚æœèƒ–å‹æš‚æ—¶ä¸äº†è§£ï¼Œå»ºè®®å…ˆé˜…è¯»å¦‚ä¸‹æ–‡ç«  ï¼š</p><ul><li><a href="https://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠInstrumentation æ–°åŠŸèƒ½ã€‹</a></li><li><a href="http://www.infoq.com/cn/articles/javaagent-illustrated" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠJVMæºç åˆ†æä¹‹javaagentåŸç†å®Œå…¨è§£è¯»ã€‹</a></li></ul><blockquote><p>å‹æƒ…æç¤º ï¼šå»ºè®®è‡ªå·±æ‰‹æ’¸ä¸€ä¸ªç®€å•çš„ JavaAgent ï¼Œæ›´å®¹æ˜“ç†è§£ SkyWalking Agent ã€‚ </p><p>ç¬”è€…ç»ƒæ‰‹çš„ JavaAgent é¡¹ç›®åœ°å€ ï¼š<a href="https://github.com/YunaiV/learning/tree/master/javaagent01" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/YunaiV/learning/tree/master/javaagent01</a></p></blockquote><p>é€šè¿‡ JavaAgent æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>#premain(String, Instrumentation)</code> æ–¹æ³•é‡Œï¼Œè°ƒç”¨ <code>Instrumentation#addTransformer(ClassFileTransformer)</code> æ–¹æ³•ï¼Œå‘ Instrumentation æ³¨å†Œ <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/instrument/ClassFileTransformer.html" rel="external nofollow noopener noreferrer" target="_blank"><code>java.lang.instrument.ClassFileTransformer</code></a> å¯¹è±¡ï¼Œå¯ä»¥ä¿®æ”¹ Java ç±»çš„äºŒè¿›åˆ¶ï¼Œä»è€Œ<strong>åŠ¨æ€</strong>ä¿®æ”¹ Java ç±»çš„ä»£ç å®ç°ã€‚</p><p>å¦‚æœèƒ–å‹ä½¿ç”¨è¿‡ AOP å®ç°åˆ‡é¢è®°å½•æ—¥å¿—ï¼Œé‚£ä¹ˆå°±å¾ˆå®¹æ˜“ç†è§£ï¼ŒSkyWalking é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œä½¿ç”¨ä¸åŒæ¡†æ¶å®šä¹‰<strong>æ–¹æ³•åˆ‡é¢</strong>ï¼Œä»è€Œåœ¨åœ¨åˆ‡é¢<strong>è®°å½•è°ƒç”¨é“¾è·¯</strong>ã€‚</p><hr><p>ç›´æ¥ä¿®æ”¹ Java ç±»çš„äºŒè¿›åˆ¶ï¼Œæ˜¯éå¸¸ç¹æ‚çš„ã€‚å› æ­¤ï¼ŒSkyWalking å¼•å…¥äº† <a href="https://github.com/raphw/byte-buddy" rel="external nofollow noopener noreferrer" target="_blank"><code>byte-buddy</code></a> ã€‚</p><blockquote><p><code>byte-buddy</code> æ˜¯ä¸€ä¸ªä»£ç ç”Ÿæˆå’Œæ“ä½œåº“ï¼Œç”¨äºåœ¨ Java åº”ç”¨ç¨‹åº<br>è¿è¡Œæ—¶åˆ›å»ºå’Œä¿®æ”¹ Java ç±»ï¼Œè€Œå¾æ— éœ€ç¼–è¯‘å™¨çš„å¸®åŠ©ã€‚</p><p>é™¤äº†å‚ä¸ Java ç±»åº“ä¸€èµ·æä¾›ä»£ç ç”Ÿæˆå·¥å…·å¤–ï¼Œ<code>byte-buddy</code> å…è®¸åˆ›å»ºä»»æ„ç±»ï¼Œå¹¶ä¸é™äºå®ç°ç”¨äºåˆ›å»ºè¿è¡Œæ—¶ä»£ç†çš„æ¥å£ã€‚  </p><p>æ­¤å¤–ï¼Œ<code>byte-buddy</code> æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„ API ï¼Œç”¨äº Java Agent æˆ–åœ¨æ„å»ºè¿‡ç¨‹ä¸­æ›´æ”¹ç±»ã€‚</p></blockquote><p>ä¸‹é¢ç¬”è€…é»˜è®¤èƒ–å‹å·²ç»å¯¹ <code>byte-buddy</code> æœ‰ä¸€å®šçš„äº†è§£ã€‚å¦‚æœèƒ–å‹æš‚ä¸äº†è§£ï¼Œå»ºè®®å…ˆé˜…è¯»å¦‚ä¸‹æ–‡ç«  ï¼š</p><ul><li><a href="http://www.jianshu.com/p/fe1448bf7d31" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠJavaå­—èŠ‚ç 3-ä½¿ç”¨ByteBuddyå®ç°ä¸€ä¸ªJava-Agentã€‹</a></li><li><a href="https://notes.diguage.com/byte-buddy-tutorial/" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠByte Buddy æ•™ç¨‹ã€‹</a></li><li><a href="https://www.infoq.com/articles/Easily-Create-Java-Agents-with-ByteBuddy" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠEasily Create Java Agents with Byte Buddyã€‹</a></li><li><a href="http://www.kailing.pub/article/index/arcid/178.html" rel="external nofollow noopener noreferrer" target="_blank">ã€Šskywalkingæºç åˆ†æä¹‹javaAgentå·¥å…·ByteBuddyçš„åº”ç”¨ã€‹</a> æœç´¢ â€œBYTE BUDDYåº”ç”¨â€ éƒ¨åˆ†</li></ul><blockquote><p>å‹æƒ…æç¤º ï¼šå»ºè®®è‡ªå·±ç®€å•ä½¿ç”¨ä¸‹ <code>byte-buddy</code> ï¼Œæ›´å®¹æ˜“ç†è§£ SkyWalking Agent ã€‚ </p><p>ç¬”è€…ç»ƒæ‰‹çš„ <code>byte-buddy</code> é¡¹ç›®åœ°å€ ï¼š<a href="https://github.com/YunaiV/learning/tree/master/bytebuddy" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/YunaiV/learning/tree/master/bytebuddy</a></p></blockquote><hr><p>ä¸‹é¢ï¼Œè®©æˆ‘ä»¬æ‰“å¼€ <a href="https://github.com/YunaiV/skywalking/blob/b68162306b4db7adfd4a2c2891a205b7085f38f0/apm-sniffer/apm-agent/src/main/java/org/skywalking/apm/agent/SkyWalkingAgent.java#L79" rel="external nofollow noopener noreferrer" target="_blank"><code>SkyWalkingAgent#premain(String, Instrumentation)</code></a> æ–¹æ³•ï¼Œä»ã€ç¬¬ 79 è¡Œã€‘ä»£ç å¼€å§‹çœ‹ ï¼š</p><ul><li>ç¬¬ 79 è‡³ 104 è¡Œ ï¼šåˆ›å»º <a href="https://github.com/raphw/byte-buddy/blob/188366ace6e16ec167a00b144c9048d78495165f/byte-buddy-dep/src/main/java/net/bytebuddy/agent/builder/AgentBuilder.java" rel="external nofollow noopener noreferrer" target="_blank"><code>net.bytebuddy.agent.builder.AgentBuilder</code></a> å¯¹è±¡ï¼Œå¹¶è®¾ç½®ç›¸å…³å±æ€§ã€‚<ul><li>AgentBuilder ï¼Œæä¾›ä¾¿åˆ©çš„ API ï¼Œåˆ›å»º Java Agent ã€‚</li><li>ç¬¬ 79 è¡Œ ï¼šè°ƒç”¨ <code>AgentBuilder#type(ElementMatcher)</code> æ–¹æ³•ï¼Œå®ç° <a href="https://github.com/raphw/byte-buddy/blob/188366ace6e16ec167a00b144c9048d78495165f/byte-buddy-dep/src/main/java/net/bytebuddy/matcher/ElementMatcher.java#L13" rel="external nofollow noopener noreferrer" target="_blank"><code>net.bytebuddy.matcher.ElementMatcher</code></a> æ¥å£ï¼Œè®¾ç½®éœ€è¦æ‹¦æˆªçš„ç±»ã€‚<code>PluginFinder#buildMatch()</code> æ–¹æ³•ï¼Œåœ¨æœ¬æ–‡ <a href="#">ã€Œ3.3 PluginFinderã€</a> è¯¦ç»†è§£æã€‚</li><li>ç¬¬ 79 è‡³ 104 è¡Œ ï¼šè°ƒç”¨ <code>AgentBuilder#transform(Transformer)</code> æ–¹æ³•ï¼Œè®¾ç½® Java ç±»çš„ä¿®æ”¹é€»è¾‘ã€‚<ul><li>ç¬¬ 84 è¡Œ ï¼šè°ƒç”¨ <code>PluginFinder#find(TypeDescription, ClassLoader)</code> æ–¹æ³•ï¼Œè·å¾—<strong>åŒ¹é…</strong>çš„ AbstractClassEnhancePluginDefine æ•°ç»„ã€‚å› ä¸ºåœ¨ã€<strong>ç¬¬ 79 è¡Œ</strong>ã€‘çš„ä»£ç ï¼Œè®¾ç½®äº†<strong>æ‰€æœ‰</strong>æ’ä»¶éœ€è¦æ‹¦æˆªçš„ç±»ï¼Œæ‰€ä»¥æ­¤å¤„éœ€è¦åŒ¹é…<strong>è¯¥ç±»å¯¹åº”</strong>çš„ AbstractClassEnhancePluginDefine æ•°ç»„ã€‚<code>PluginFinder#find(TypeDescription, ClassLoader)</code> æ–¹æ³•ï¼Œåœ¨æœ¬æ–‡ <a href="#">ã€Œ3.3 PluginFinderã€</a> è¯¦ç»†è§£æã€‚</li><li>ç¬¬ 85 è¡Œ ï¼šåˆ¤æ–­åŒ¹é…çš„ AbstractClassEnhancePluginDefine æ•°ç»„å¤§äºé›¶ã€‚ä»ç›®å‰çš„ä»£ç çœ‹ä¸‹æ¥ï¼Œæ­¤å¤„å±äº<strong>é˜²å¾¡æ€§ç¼–ç¨‹</strong>ï¼Œåœ¨ã€<strong>ç¬¬ 79 è¡Œ</strong>ã€‘çš„ä»£ç ä¿è¯ä¸€å®šèƒ½åŒ¹é…åˆ° AbstractClassEnhancePluginDefine ã€‚</li><li>ç¬¬ 86 è‡³ 100 è¡Œ ï¼šå¾ªç¯åŒ¹é…åˆ° AbstractClassEnhancePluginDefine æ•°ç»„ï¼Œè°ƒç”¨ <code>AbstractClassEnhancePluginDefine#define(...)</code> æ–¹æ³•ï¼Œè®¾ç½® <a href="https://github.com/raphw/byte-buddy/blob/188366ace6e16ec167a00b144c9048d78495165f/byte-buddy-dep/src/main/java/net/bytebuddy/dynamic/DynamicType.java" rel="external nofollow noopener noreferrer" target="_blank"><code>net.bytebuddy.dynamic.DynamicType.Builder</code></a> å¯¹è±¡ã€‚é€šè¿‡è¯¥å¯¹è±¡ï¼Œå®šä¹‰<strong>å¦‚ä½•æ‹¦æˆª</strong>éœ€è¦ä¿®æ”¹çš„ Java ç±»ã€‚åœ¨ <code>AbstractClassEnhancePluginDefine#define(...)</code> æ–¹æ³•çš„å†…éƒ¨ï¼Œä¼šè°ƒç”¨ <a href="https://github.com/raphw/byte-buddy/blob/188366ace6e16ec167a00b144c9048d78495165f/byte-buddy-dep/src/main/java/net/bytebuddy/dynamic/DynamicType.java#L1512" rel="external nofollow noopener noreferrer" target="_blank"><code>net.bytebuddy.dynamic.DynamicType.ImplementationDefinition#intercept(Implementation)</code></a> æ–¹æ³•ï¼Œæœ¬æ–‡ <a href="#">ã€Œ4. æ’ä»¶çš„æ‹¦æˆªã€</a> ä¹Ÿä¼šè¯¦ç»†è§£æã€‚</li><li>ç¬¬ 91 è¡Œ ï¼šä¸ºä»€ä¹ˆä¼šå‡ºç°è¿”å›ä¸º<strong>ç©º</strong>çš„æƒ…å†µå‘¢ï¼ŸåŒä¸€ä¸ªæ¡†æ¶åœ¨ä¸åŒçš„<strong>å¤§</strong>ç‰ˆæœ¬ï¼Œä½¿ç”¨çš„æ–¹å¼ç›¸åŒï¼Œä½†æ˜¯å®ç°çš„ä»£ç å´ä¸å°½ç›¸åŒã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒSpringMVC 3 å’Œ SpringMVC 4 ï¼Œ<strong>éƒ½</strong>æœ‰ <code>@RequestMapping</code> æ³¨è§£å®šä¹‰ URL ï¼Œæ‰€ä»¥ã€<strong>ç¬¬ 84 è¡Œ</strong>ã€‘ä¼šåŒ¹é…åˆ° <code>AbstractSpring3Instrumentation</code> / <code>AbstractSpring4Instrumentation</code> <strong>ä¸¤ä¸ª</strong>ã€‚å½“åº”ç”¨ä½¿ç”¨çš„æ˜¯ Spring MVC 4 æ—¶ï¼Œè°ƒç”¨ <code>AbstractSpring3Instrumentation#define(...)</code> æ–¹æ³•ä¼šè¿”å›ç©ºï¼Œè€Œè°ƒç”¨ <code>AbstractSpring4Instrumentation#define(...)</code> æ–¹æ³•ä¼šæœ‰è¿”å›å€¼ã€‚è¿™æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿæœ¬æ–‡ <a href="#">ã€Œ4. æ’ä»¶çš„æ‹¦æˆªã€</a> ä¹Ÿä¼šè¯¦ç»†è§£æã€‚</li></ul></li></ul></li><li>ç¬¬ 105 è‡³ 134 è¡Œ ï¼šè°ƒç”¨ <a href="https://github.com/raphw/byte-buddy/blob/188366ace6e16ec167a00b144c9048d78495165f/byte-buddy-dep/src/main/java/net/bytebuddy/agent/builder/AgentBuilder.java#L114" rel="external nofollow noopener noreferrer" target="_blank"><code>AgentBuilder#with(Listener)</code></a> æ–¹æ³•ï¼Œæ·»åŠ ç›‘å¬å™¨ã€‚<ul><li><code>#onTransformation(...)</code> æ–¹æ³•ï¼Œå½“ Java ç±»çš„ä¿®æ”¹<strong>æˆåŠŸ</strong>ï¼Œè¿›è¡Œè°ƒç”¨ã€‚</li><li><code>#onError(...)</code> æ–¹æ³•ï¼Œå½“ Java ç±»çš„ä¿®æ”¹<strong>å¤±è´¥</strong>ï¼Œè¿›è¡Œè°ƒç”¨ã€‚InstrumentDebuggingClass åœ¨æœ¬æ–‡ <a href="#">ã€Œ3.1 InstrumentDebuggingClassã€</a> è¯¦ç»†è§£æã€‚</li></ul></li><li>ç¬¬ 135 è¡Œ ï¼šè°ƒç”¨ <a href="https://github.com/raphw/byte-buddy/blob/master/byte-buddy-dep/src/main/java/net/bytebuddy/agent/builder/AgentBuilder.java#L620" rel="external nofollow noopener noreferrer" target="_blank"><code>AgentBuilder#installOn(Instrumentation)</code></a> æ–¹æ³•ï¼Œæ ¹æ®<strong>ä¸Šé¢</strong> AgentBuilder è®¾ç½®çš„å±æ€§ï¼Œåˆ›å»º <a href="https://github.com/raphw/byte-buddy/blob/188366ace6e16ec167a00b144c9048d78495165f/byte-buddy-dep/src/main/java/net/bytebuddy/agent/builder/ResettableClassFileTransformer.java" rel="external nofollow noopener noreferrer" target="_blank"><code>net.bytebuddy.agent.builder.ResettableClassFileTransformer</code></a> å¯¹è±¡ï¼Œé…ç½®åˆ° Instrumentation å¯¹è±¡ä¸Šã€‚åœ¨ <code>AgentBuilder#installOn(Instrumentation)</code> æ–¹æ³•çš„å†…éƒ¨ï¼Œä¼šè°ƒç”¨ <code>Instrumentation#addTransformer(ClassFileTransformer)</code> æ–¹æ³•ã€‚</li></ul><hr><p>ğŸ˜ˆ è¿™ä¸ªæ–¹æ³•ä¿¡æ¯é‡æ¯”è¾ƒå¤§ï¼Œç¬”è€…å¯¹ <code>byte-buddy</code> ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼ŒèŠ±è´¹äº†è¾ƒå¤šæ—¶é—´æ¢³ç†ä¸ç†è§£ã€‚å»ºè®®ï¼Œå¦‚æœèƒ–å‹æ­¤å¤„ä¸æ˜¯ç†è§£çš„å¾ˆæ¸…æ™°ï¼Œå¯ä»¥é˜…è¯»å®Œå…¨æ–‡ï¼Œåœ¨å›è¿‡å¤´å†æ‹ä¸€æ‹è¿™å—çš„ä»£ç å®ç°ã€‚</p><h2 id="3-1-InstrumentDebuggingClass"><a href="#3-1-InstrumentDebuggingClass" class="headerlink" title="3.1 InstrumentDebuggingClass"></a>3.1 InstrumentDebuggingClass</h2><p><code>org.skywalking.apm.agent.InstrumentDebuggingClass</code> ï¼ŒInstrument è°ƒè¯•ç±»ï¼Œç”¨äºå°†è¢« JavaAgent ä¿®æ”¹çš„<strong>æ‰€æœ‰</strong>ç±»å­˜å‚¨åˆ° <code>${JAVA_AGENT_PACKAGE}/debugger</code> ç›®å½•ä¸‹ã€‚éœ€è¦é…ç½® <code>agent.is_open_debugging_class = true</code> ï¼Œæ•ˆæœå¦‚ä¸‹å›¾ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_10/04.png" alt=""></p><p>ä»£ç æ¯”è¾ƒç®€å•ï¼Œèƒ–å‹ç‚¹å‡» <a href="https://github.com/YunaiV/skywalking/blob/b68162306b4db7adfd4a2c2891a205b7085f38f0/apm-sniffer/apm-agent/src/main/java/org/skywalking/apm/agent/InstrumentDebuggingClass.java" rel="external nofollow noopener noreferrer" target="_blank">InstrumentDebuggingClass</a> ç†è§£ã€‚</p><h2 id="3-2-ClassMatch"><a href="#3-2-ClassMatch" class="headerlink" title="3.2 ClassMatch"></a>3.2 ClassMatch</h2><p>åœ¨åˆ†äº«æœ¬èŠ‚ç›¸å…³å†…å®¹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ <code>bytebuddy</code> çš„ <a href="https://github.com/raphw/byte-buddy/tree/188366ace6e16ec167a00b144c9048d78495165f/byte-buddy-dep/src/main/java/net/bytebuddy/matcher" rel="external nofollow noopener noreferrer" target="_blank"><code>net.bytebuddy.matcher</code></a> æ¨¡å—ã€‚è¯¥æ¨¡å—æä¾›äº†å„ç§çµæ´»çš„åŒ¹é…æ–¹æ³•ã€‚é‚£ä¹ˆ SkyWalking ä¸ºä»€ä¹ˆå®ç°è‡ªå·±çš„ <a href="https://github.com/YunaiV/skywalking/tree/43241fff19e17f19b918c96ffd588787f8f05519/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/match" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.match</code></a> æ¨¡å—ï¼Ÿç¬”è€…è®¤ä¸ºï¼Œä»…å®šä½äº<strong>ç±»çº§åˆ«çš„åŒ¹é…</strong>ï¼Œæ›´å¸¸ç”¨è€Œåˆç²¾ç®€çš„ API ã€‚</p><hr><p><code>org.skywalking.apm.agent.core.plugin.match.ClassMatch</code> ï¼Œç±»åŒ¹é…<strong>æ¥å£</strong>ã€‚ç›®å‰å­ç±»å¦‚ä¸‹ ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_10/05.png" alt=""></p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/b68162306b4db7adfd4a2c2891a205b7085f38f0/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/match/NameMatch.java#L28" rel="external nofollow noopener noreferrer" target="_blank">NameMatch</a> ï¼šåŸºäº<strong>å®Œæ•´çš„ç±»å</strong>è¿›è¡ŒåŒ¹é…ï¼Œä¾‹å¦‚ï¼š<code>&quot;com.alibaba.dubbo.monitor.support.MonitorFilter&quot;</code> ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/b68162306b4db7adfd4a2c2891a205b7085f38f0/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/match/IndirectMatch.java" rel="external nofollow noopener noreferrer" target="_blank">IndirectMatch</a> ï¼š<strong>é—´æ¥</strong>åŒ¹é…<strong>æ¥å£</strong>ã€‚ç›¸æ¯” NameMatch æ¥è¯´ï¼Œç¡®å®æ¯”è¾ƒ â€œå§”å©‰â€ ğŸ™‚ ã€‚<ul><li><a href="https://github.com/YunaiV/skywalking/blob/b68162306b4db7adfd4a2c2891a205b7085f38f0/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/match/ClassAnnotationMatch.java" rel="external nofollow noopener noreferrer" target="_blank">ClassAnnotationMatch</a> ï¼šåŸºäº<strong>ç±»æ³¨è§£</strong>è¿›è¡ŒåŒ¹é…ï¼Œå¯è®¾ç½®<strong>åŒæ—¶</strong>åŒ¹é…å¤šä¸ªã€‚ä¾‹å¦‚ï¼š<code>&quot;@RequestMapping&quot;</code>ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/b68162306b4db7adfd4a2c2891a205b7085f38f0/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/match/HierarchyMatch.java" rel="external nofollow noopener noreferrer" target="_blank">HierarchyMatch</a> ï¼šåŸºäº<strong>çˆ¶ç±» / æ¥å£</strong>è¿›è¡ŒåŒ¹é…ï¼Œå¯è®¾ç½®<strong>åŒæ—¶</strong>åŒ¹é…å¤šä¸ªã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/b68162306b4db7adfd4a2c2891a205b7085f38f0/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/match/MethodAnnotationMatch.java" rel="external nofollow noopener noreferrer" target="_blank">MethodAnnotationMatch</a> ï¼šåŸºäº<strong>æ–¹æ³•æ³¨è§£</strong>è¿›è¡ŒåŒ¹é…ï¼Œå¯è®¾ç½®<strong>åŒæ—¶</strong>åŒ¹é…å¤šä¸ªã€‚ç›®å‰é¡¹ç›®é‡Œä¸»è¦ç”¨äºåŒ¹é…æ–¹æ³•ä¸Šçš„  <a href="https://github.com/OpenSkywalking/skywalking/blob/8d9820322bdfc956d9d4f0d04f55ce985926cfae/apm-application-toolkit/apm-toolkit-trace/src/main/java/org/apache/skywalking/apm/toolkit/trace/Trace.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.toolkit.trace.@Trace</code></a> æ³¨è§£ã€‚</li></ul></li></ul><p>æ¯ä¸ªç±»å·²ç»æ·»åŠ è¯¦ç»†çš„ä»£ç æ³¨é‡Šï¼Œèƒ–å‹å–œæ¬¢å“ªä¸ªç‚¹å“ªä¸ªå“Ÿã€‚</p><h2 id="3-3-PluginFinder"><a href="#3-3-PluginFinder" class="headerlink" title="3.3 PluginFinder"></a>3.3 PluginFinder</h2><p><code>org.skywalking.apm.agent.core.plugin.PluginFinder</code> ï¼Œæ’ä»¶å‘ç°è€…ã€‚å…¶æä¾› <a href="https://github.com/YunaiV/skywalking/blob/09c654af33081e56547cb8b3b9e0c8525ddce32f/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/PluginFinder.java#L80" rel="external nofollow noopener noreferrer" target="_blank"><code>#find(...)</code></a> æ–¹æ³•ï¼Œè·å¾—<strong>ç±»å¢å¼ºæ’ä»¶å®šä¹‰</strong>( <a href="https://github.com/OpenSkywalking/skywalking/blob/b16d23c1484bec941367d6b36fa932b8ace40971/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/AbstractClassEnhancePluginDefine.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.AbstractClassEnhancePluginDefine</code></a> )å¯¹è±¡ã€‚</p><p>PluginFinder <strong><a href="https://github.com/YunaiV/skywalking/blob/09c654af33081e56547cb8b3b9e0c8525ddce32f/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/PluginFinder.java#L56" rel="external nofollow noopener noreferrer" target="_blank">æ„é€ æ–¹æ³•</a></strong>ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><ul><li>ç¬¬ 57 è‡³ 77 è¡Œ ï¼šå¾ªç¯ AbstractClassEnhancePluginDefine å¯¹è±¡æ•°ç»„ï¼Œæ·»åŠ åˆ° <code>nameMatchDefine</code> / <code>signatureMatchDefine</code> å±æ€§ï¼Œæ–¹ä¾¿ <code>#find(...)</code> æ–¹æ³•æŸ¥æ‰¾ AbstractClassEnhancePluginDefine å¯¹è±¡ã€‚<ul><li>ç¬¬ 65 è‡³ 72 è¡Œ ï¼šå¤„ç† NameMatch ä¸ºåŒ¹é…çš„ AbstractClassEnhancePluginDefine å¯¹è±¡ï¼Œæ·»åŠ åˆ° <code>nameMatchDefine</code>  å±æ€§ã€‚</li><li>ç¬¬ 74 è‡³ 76 è¡Œ ï¼šå¤„ç†<strong>é</strong> NameMatch ä¸ºåŒ¹é…çš„ AbstractClassEnhancePluginDefine å¯¹è±¡ï¼Œæ·»åŠ åˆ° <code>signatureMatchDefine</code> å±æ€§ã€‚</li></ul></li></ul><hr><p><a href="https://github.com/YunaiV/skywalking/blob/b68162306b4db7adfd4a2c2891a205b7085f38f0/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/PluginFinder.java#L89" rel="external nofollow noopener noreferrer" target="_blank"><code>#find(...)</code></a> æ–¹æ³•ï¼Œè·å¾—<strong>ç±»å¢å¼ºæ’ä»¶å®šä¹‰</strong>( <a href="https://github.com/OpenSkywalking/skywalking/blob/b16d23c1484bec941367d6b36fa932b8ace40971/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/AbstractClassEnhancePluginDefine.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.AbstractClassEnhancePluginDefine</code></a> )å¯¹è±¡ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><ul><li>ç¬¬ 92 è‡³ 96 è¡Œ ï¼šä»¥ <code>nameMatchDefine</code> å±æ€§æ¥åŒ¹é… AbstractClassEnhancePluginDefine å¯¹è±¡ã€‚</li><li>ç¬¬ 98 è‡³ 104 è¡Œ ï¼šä»¥ <code>signatureMatchDefine</code> å±æ€§æ¥åŒ¹é… AbstractClassEnhancePluginDefine å¯¹è±¡ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼šè°ƒç”¨ <code>IndirectMatch#isMatch(TypeDescription)</code> æ–¹æ³•ï¼Œè¿›è¡ŒåŒ¹é…ã€‚</li></ul><hr><p><a href="https://github.com/YunaiV/skywalking/blob/b68162306b4db7adfd4a2c2891a205b7085f38f0/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/PluginFinder.java#L116" rel="external nofollow noopener noreferrer" target="_blank"><code>#buildMatch()</code></a> æ–¹æ³•ï¼Œè·å¾—å…¨éƒ¨æ’ä»¶çš„ç±»åŒ¹é…ï¼Œå¤šä¸ªæ’ä»¶çš„ç±»åŒ¹é…æ¡ä»¶ä»¥ <code>or</code> åˆ†éš”ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><ul><li>ç¬¬ 117 è‡³ 123 è¡Œ ï¼šä»¥ <code>nameMatchDefine</code> å±æ€§æ¥åŒ¹é…ã€‚</li><li>ç¬¬ 124 è‡³ 132 è¡Œ ï¼šä»¥ <code>signatureMatchDefine</code> å±æ€§æ¥åŒ¹é…ã€‚</li><li><strong>å®é™…ä¸Šï¼Œè¯¥æ–¹æ³•å’Œ <code>#find(...)</code> æ–¹æ³•é€»è¾‘æ˜¯ä¸€è‡´çš„</strong>ã€‚</li></ul><h1 id="4-æ’ä»¶çš„æ‹¦æˆª"><a href="#4-æ’ä»¶çš„æ‹¦æˆª" class="headerlink" title="4. æ’ä»¶çš„æ‹¦æˆª"></a>4. æ’ä»¶çš„æ‹¦æˆª</h1><p>åœ¨ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»æåˆ°ï¼ŒSkyWalking é€šè¿‡ JavaAgent æœºåˆ¶ï¼Œå¯¹éœ€è¦æ‹¦æˆªçš„ç±»çš„æ–¹æ³•ï¼Œä½¿ç”¨ <code>byte-buddy</code> <strong>åŠ¨æ€</strong>ä¿®æ”¹ Java ç±»çš„äºŒè¿›åˆ¶ï¼Œä»è€Œè¿›è¡Œæ–¹æ³•åˆ‡é¢æ‹¦æˆªï¼Œè®°å½•è°ƒç”¨é“¾è·¯ã€‚</p><p>çœ‹å…·ä½“çš„ä»£ç å®ç°ä¹‹å‰ï¼Œæƒ³ä¸€ä¸‹<strong>æ‹¦æˆª</strong>ä¼šæ¶‰åŠåˆ°å“ªäº›å…ƒç´  ï¼š</p><ul><li>æ‹¦æˆªåˆ‡é¢ InterceptPoint</li><li>æ‹¦æˆªå™¨ Interceptor</li><li>æ‹¦æˆªç±»çš„å®šä¹‰ Define ï¼šä¸€ä¸ªç±»æœ‰å“ªäº›æ‹¦æˆªåˆ‡é¢åŠå¯¹åº”çš„æ‹¦æˆªå™¨</li></ul><p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æœ¬å°èŠ‚ä¼šæ¶‰åŠåˆ°çš„ç±»ã€‚å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_10/06.png" alt=""></p><p>çœ‹èµ·æ¥ç±»æ¯”æƒ³è±¡çš„å¤šï¼Ÿæ¢³ç†ä¹‹ï¼Œç»“æœå¦‚å›¾ ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_10/07.png" alt=""></p><ul><li>æ ¹æ®æ–¹æ³•ç±»å‹çš„ä¸åŒï¼Œä½¿ç”¨ä¸åŒ ClassEnhancePluginDefine çš„å®ç°ç±»ã€‚å…¶ä¸­ï¼Œæ„é€ æ–¹æ³•å’Œé™æ€æ–¹æ³•ä½¿ç”¨ç›¸åŒçš„å®ç°ç±»ã€‚</li><li><p>ç›¸æ¯”ä¸Šé¢æåˆ°<strong>æ‹¦æˆª</strong>ä¼šæ¶‰åŠåˆ°çš„å…ƒç´ ï¼Œå¤šäº†ä¸€ä¸ª <strong>Inter</strong> ï¼Ÿå¦‚ä¸‹æ˜¯å®˜æ–¹çš„è¯´æ˜ ï¼š</p><blockquote><p>In this class, it provide a bridge between <code>byte-buddy</code> and <code>sky-walking</code> plugin.</p></blockquote></li></ul><h2 id="4-1-ClassEnhancePluginDefine"><a href="#4-1-ClassEnhancePluginDefine" class="headerlink" title="4.1 ClassEnhancePluginDefine"></a>4.1 ClassEnhancePluginDefine</h2><p>æ•´ä½“ç±»å›¾å¦‚ä¸‹ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_10/08.png" alt=""></p><ul><li>AbstractClassEnhancePluginDefine ï¼šSkyWalking ç±»å¢å¼ºæ’ä»¶å®šä¹‰<strong>æŠ½è±¡åŸºç±»</strong>ã€‚</li><li>ClassEnhancePluginDefine ï¼šSkyWalking ç±»å¢å¼ºæ’ä»¶å®šä¹‰<strong>æŠ½è±¡ç±»</strong>ã€‚</li><li>ä» UML å›¾ä¸­çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒAbstractClassEnhancePluginDefine æ³¨é‡åœ¨<strong>å®šä¹‰</strong>( Define )ï¼ŒClassEnhancePluginDefine æ³¨é‡åœ¨<strong>å¢å¼º</strong>( Enhance )ã€‚</li></ul><p>æ•´ä½“æµç¨‹å¦‚ä¸‹ ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_10/09.png" alt=""></p><p>OK ï¼Œä¸‹é¢æˆ‘ä»¬å¼€å§‹çœ‹çœ‹ä»£ç æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><h3 id="4-1-1-AbstractClassEnhancePluginDefine"><a href="#4-1-1-AbstractClassEnhancePluginDefine" class="headerlink" title="4.1.1 AbstractClassEnhancePluginDefine"></a>4.1.1 AbstractClassEnhancePluginDefine</h3><p><code>org.skywalking.apm.agent.core.plugin.AbstractClassEnhancePluginDefine</code> ï¼ŒSkyWalking ç±»å¢å¼ºæ’ä»¶å®šä¹‰<strong>æŠ½è±¡åŸºç±»</strong>ã€‚å®ƒæ³¨é‡åœ¨<strong>å®šä¹‰</strong>( Define )çš„æŠ½è±¡ä¸å®ç°ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/30683167c79c71ad088666c587a05c6d9f0daf3f/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/AbstractClassEnhancePluginDefine.java#L93" rel="external nofollow noopener noreferrer" target="_blank"><code>#enhanceClass()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œå®šä¹‰äº†ç±»åŒ¹é…( ClassMatch ) ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/30683167c79c71ad088666c587a05c6d9f0daf3f/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/AbstractClassEnhancePluginDefine.java#L105" rel="external nofollow noopener noreferrer" target="_blank"><code>#witnessClasses()</code></a> æ–¹æ³•ï¼Œè§è¯ç±»åˆ—è¡¨ã€‚å½“ä¸”ä»…å½“åº”ç”¨å­˜åœ¨è§è¯ç±»åˆ—è¡¨ï¼Œæ’ä»¶æ‰ç”Ÿæ•ˆã€‚<strong>ä»€ä¹ˆæ„æ€</strong>ï¼Ÿè®©æˆ‘ä»¬çœ‹çœ‹è¿™ç§æƒ…å†µï¼šä¸€ä¸ª<strong>ç±»åº“</strong>å­˜åœ¨ä¸¤ä¸ªå‘å¸ƒçš„ç‰ˆæœ¬( å¦‚ <code>1.0</code> å’Œ <code>2.0</code> )ï¼Œå…¶ä¸­åŒ…æ‹¬<strong>ç›¸åŒ</strong>çš„ç›®æ ‡ç±»ï¼Œä½†ä¸åŒçš„æ–¹æ³•æˆ–ä¸åŒçš„æ–¹æ³•å‚æ•°åˆ—è¡¨ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ ¹æ®åº“çš„ä¸åŒç‰ˆæœ¬ä½¿ç”¨æ’ä»¶çš„ä¸åŒç‰ˆæœ¬ã€‚ç„¶è€Œç‰ˆæœ¬æ˜¾ç„¶ä¸æ˜¯ä¸€ä¸ªé€‰é¡¹ï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨è§è¯ç±»åˆ—è¡¨ï¼Œåˆ¤æ–­å‡ºå½“å‰å¼•ç”¨ç±»åº“çš„å‘å¸ƒç‰ˆæœ¬ã€‚</p><ul><li>ä¸¾ä¸ªå®é™…çš„ä¾‹å­ï¼ŒSpringMVC 3 å’Œ SpringMVC 4 ï¼Œ<strong>éƒ½</strong>æœ‰ <code>@RequestMapping</code> æ³¨è§£å®šä¹‰ URL ã€‚<ul><li>é€šè¿‡åˆ¤æ–­å­˜åœ¨ <code>org.springframework.web.servlet.view.xslt.AbstractXsltView</code> ç±»ï¼Œåº”ç”¨ä½¿ç”¨ SpringMVC 3 ï¼Œä½¿ç”¨ <code>apm-springmvc-annotation-3.x-plugin.jar</code> ã€‚</li><li>é€šè¿‡åˆ¤æ–­å­˜åœ¨ <code>org.springframework.web.servlet.tags.ArgumentTag</code> ç±»ï¼Œåº”ç”¨ä½¿ç”¨ SpringMVC 4 ï¼Œä½¿ç”¨ <code>apm-springmvc-annotation-4.x-plugin.jar</code> ã€‚</li></ul></li><li><strong>å¦å¤–</strong>ï¼Œè¯¥æ–¹æ³•è¿”å›<strong>ç©ºæ•°ç»„</strong>ã€‚å³é»˜è®¤æƒ…å†µï¼Œæ’ä»¶ç”Ÿæ•ˆï¼Œæ— éœ€è§è¯ç±»åˆ—è¡¨ã€‚</li></ul><hr><p><a href="https://github.com/YunaiV/skywalking/blob/30683167c79c71ad088666c587a05c6d9f0daf3f/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/AbstractClassEnhancePluginDefine.java#L46" rel="external nofollow noopener noreferrer" target="_blank"><code>#define(...)</code></a> æ–¹æ³•ï¼Œè®¾ç½® <a href="https://github.com/raphw/byte-buddy/blob/188366ace6e16ec167a00b144c9048d78495165f/byte-buddy-dep/src/main/java/net/bytebuddy/dynamic/DynamicType.java" rel="external nofollow noopener noreferrer" target="_blank"><code>net.bytebuddy.dynamic.DynamicType.Builder</code></a> å¯¹è±¡ã€‚é€šè¿‡è¯¥å¯¹è±¡ï¼Œå®šä¹‰<strong>å¦‚ä½•æ‹¦æˆª</strong>éœ€è¦ä¿®æ”¹çš„ç›®æ ‡ Java ç±»(æ–¹æ³•çš„ <code>transformClassName</code> å‚æ•°)ã€‚ä»£ç å¦‚ä¸‹ ï¼š</p><ul><li>ç¬¬ 57 è‡³ 70 è¡Œ ï¼šåˆ¤æ–­è§è¯ç±»åˆ—è¡¨æ˜¯å¦éƒ½å­˜åœ¨ã€‚è‹¥ä¸å­˜åœ¨ï¼Œåˆ™æ’ä»¶ä¸ç”Ÿæ•ˆã€‚<ul><li><a href="https://github.com/YunaiV/skywalking/blob/30683167c79c71ad088666c587a05c6d9f0daf3f/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/WitnessClassFinder.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.WitnessClassFinder</code></a> ï¼Œå·²ç»æ·»åŠ å®Œæ•´æ³¨é‡Šï¼Œèƒ–å‹ç‚¹å‡»æŸ¥çœ‹ã€‚</li></ul></li><li>ç¬¬ 72 è‡³ 76 è¡Œ ï¼šè°ƒç”¨ <code>#enhance(...)</code> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œä½¿ç”¨æ‹¦æˆªå™¨å¢å¼ºç›®æ ‡ç±»ã€‚</li></ul><h3 id="4-1-2-ClassEnhancePluginDefine"><a href="#4-1-2-ClassEnhancePluginDefine" class="headerlink" title="4.1.2 ClassEnhancePluginDefine"></a>4.1.2 ClassEnhancePluginDefine</h3><p><code>org.skywalking.apm.agent.core.plugin.interceptor.enhance.ClassEnhancePluginDefine</code> ï¼ŒSkyWalking ç±»å¢å¼ºæ’ä»¶å®šä¹‰<strong>æŠ½è±¡ç±»</strong>ã€‚å®ƒæ³¨é‡åœ¨<strong>å¢å¼º</strong>( Enhance )çš„æŠ½è±¡ä¸å®ç°ã€‚åŒ…æ‹¬å¦‚ä¸‹ ï¼š</p><ul><li>é™æ€æ–¹æ³•ã€æ„é€ æ–¹æ³•ã€å®ä¾‹æ–¹æ³•çš„<strong>å¢å¼º</strong></li><li>é™æ€æ–¹æ³•ã€æ„é€ æ–¹æ³•ã€å®ä¾‹æ–¹æ³•çš„<strong>æ‹¦æˆªåˆ‡é¢</strong></li></ul><hr><p>æ‹¦æˆªåˆ‡é¢ï¼Œåœ¨ <a href="#">ã€Œ4.2 InterceptPointã€</a> æœ‰ç›¸å…³è§£æã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/ClassEnhancePluginDefine.java#L248" rel="external nofollow noopener noreferrer" target="_blank"><code>#getStaticMethodsInterceptPoints()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œè·å¾— StaticMethodsInterceptPoint <strong>æ•°ç»„</strong>ã€‚<br><a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/ClassEnhancePluginDefine.java#L185" rel="external nofollow noopener noreferrer" target="_blank"><code>#getConstructorsInterceptPoints()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œè·å¾— ConstructorInterceptPoint <strong>æ•°ç»„</strong>ã€‚<br><a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/ClassEnhancePluginDefine.java#L192" rel="external nofollow noopener noreferrer" target="_blank"><code>#getInstanceMethodsInterceptPoints()</code></a> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œè·å¾— InstanceMethodsInterceptPoint <strong>æ•°ç»„</strong>ã€‚</p><hr><p><a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/ClassEnhancePluginDefine.java#L67" rel="external nofollow noopener noreferrer" target="_blank"><code>#enhance(...)</code></a> æ–¹æ³•ï¼Œå¢å¼ºé™æ€æ–¹æ³•ã€æ„é€ æ–¹æ³•ã€å®ä¾‹æ–¹æ³•ã€‚</p><h4 id="4-1-2-1-å¢å¼ºé™æ€æ–¹æ³•"><a href="#4-1-2-1-å¢å¼ºé™æ€æ–¹æ³•" class="headerlink" title="4.1.2.1 å¢å¼ºé™æ€æ–¹æ³•"></a>4.1.2.1 å¢å¼ºé™æ€æ–¹æ³•</h4><p>è°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/ClassEnhancePluginDefine.java#L203" rel="external nofollow noopener noreferrer" target="_blank"><code>#enhanceClass(...)</code></a> æ–¹æ³•ï¼Œå¢å¼ºé™æ€æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><ul><li>ç¬¬ 206 è‡³ 210 è¡Œ ï¼šè°ƒç”¨ <code>#getStaticMethodsInterceptPoints()</code> æ–¹æ³•ï¼Œè·å¾— StaticMethodsInterceptPoint æ•°ç»„ã€‚è‹¥ä¸º<strong>ç©º</strong>ï¼Œä¸è¿›è¡Œå¢å¼ºã€‚</li><li>ç¬¬ 212 è‡³ 238 è¡Œ ï¼š<strong>éå†</strong> StaticMethodsInterceptPoint æ•°ç»„ï¼Œé€ä¸ªå¢å¼ºStaticMethodsInterceptPoint å¯¹åº”çš„é™æ€æ–¹æ³•ã€‚<ul><li>ç¬¬ 214 è‡³ 218 è¡Œ ï¼šè·å¾—æ‹¦æˆªå™¨çš„<strong>ç±»å</strong>ã€‚æ‹¦æˆªå™¨çš„å®ä¾‹ï¼Œåœ¨ <strong>Inter ç±»</strong>é‡Œè·å–ã€‚</li><li>ç¬¬ 221 è‡³ 229 è¡Œ ï¼šå½“ <code>StaticMethodsInterceptPoint#isOverrideArgs()</code> æ–¹æ³•è¿”å› <code>true</code> æ—¶ï¼Œä½¿ç”¨ StaticMethodsInterWithOverrideArgs å¤„ç†æ‹¦æˆªé€»è¾‘ã€‚åœ¨ <a href="#">ã€Œ4.4.3 é™æ€æ–¹æ³• Interã€</a> è¯¦ç»†è§£æã€‚</li><li>ç¬¬ 230 è‡³ 236 è¡Œ ï¼šå½“ <code>StaticMethodsInterceptPoint#isOverrideArgs()</code> æ–¹æ³•è¿”å› <code>false</code> æ—¶ï¼Œä½¿ç”¨ StaticMethodsInter å¤„ç†æ‹¦æˆªé€»è¾‘ï¼Œåœ¨ <a href="#">ã€Œ4.4.3 é™æ€æ–¹æ³• Interã€</a> è¯¦ç»†è§£æã€‚</li></ul></li></ul><h4 id="4-1-2-2-å¢å¼ºæ„é€ æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•"><a href="#4-1-2-2-å¢å¼ºæ„é€ æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•" class="headerlink" title="4.1.2.2 å¢å¼ºæ„é€ æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•"></a>4.1.2.2 å¢å¼ºæ„é€ æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•</h4><p>è°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/ClassEnhancePluginDefine.java#L89" rel="external nofollow noopener noreferrer" target="_blank"><code>#enhanceInstance()</code></a> æ–¹æ³•ï¼Œå¢å¼ºæ„é€ æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><ul><li>ç¬¬ 92 è‡³ 110 è¡Œ ï¼šè°ƒç”¨ <code>#getConstructorsInterceptPoints()</code> / <code>#getInstanceMethodsInterceptPoints()</code>  æ–¹æ³•ï¼Œè·å¾— ConstructorInterceptPoint / InstanceMethodsInterceptPoint æ•°ç»„ã€‚è‹¥<strong>éƒ½</strong>ä¸º<strong>ç©º</strong>ï¼Œä¸è¿›è¡Œå¢å¼ºã€‚</li><li>ç¬¬ 112 è‡³ 128 è¡Œ ï¼šä½¿ç”¨ <code>byte-buddy</code> ï¼Œä¸ºç›®æ ‡ Java ç±»<strong>â€œè‡ªåŠ¨â€</strong>å®ç° <a href="https://github.com/OpenSkywalking/skywalking/blob/15328202b8b7df89a609885d9110361ff29ce668/apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/plugin/interceptor/enhance/EnhancedInstance.java#L25" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.interceptor.enhance.EnhancedInstance</code></a> æ¥å£ã€‚è¿™æ ·ï¼Œç›®æ ‡ Java ç±»å°±æœ‰ä¸€ä¸ªç§æœ‰å˜é‡ï¼Œæ‹¦æˆªå™¨åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å­˜å‚¨çŠ¶æ€åˆ°è¯¥ç§æœ‰å˜é‡ã€‚è¿™é‡Œå¦‚æœæš‚æ—¶ä¸ç†è§£<strong>æ²¡å…³ç³»</strong>ï¼Œåé¢åˆ†äº«æ¯ä¸ªæ’ä»¶çš„å®ç°æ—¶ï¼Œä¼šæœ‰å®é™…çš„ä¾‹å­ï¼Œæ›´æ˜“æ‡‚ã€‚</li><li>â€”â€”â€”- æ„é€ æ–¹æ³• â€”â€”â€”-</li><li>ç¬¬ 130 è‡³ 143 è¡Œ ï¼š<strong>éå†</strong> ConstructorInterceptPoint æ•°ç»„ï¼Œé€ä¸ªå¢å¼º ConstructorInterceptPoint å¯¹åº”çš„æ„é€ æ–¹æ³•ã€‚ä½¿ç”¨ ConstructorInter å¤„ç†æ‹¦æˆªé€»è¾‘ï¼Œåœ¨ <a href="#">ã€Œ4.4.1 æ„é€ æ–¹æ³• Interã€</a> è¯¦ç»†è§£æã€‚</li><li>â€”â€”â€”- å®ä¾‹æ–¹æ³• â€”â€”â€”-</li><li>ç¬¬ 145 è‡³ 175 è¡Œ ï¼š<strong>éå†</strong> InstanceMethodsInterceptPoint æ•°ç»„ï¼Œé€ä¸ªå¢å¼º InstanceMethodsInterceptPoint å¯¹åº”çš„é™æ€æ–¹æ³•ã€‚<ul><li>ç¬¬ 151 è‡³ 154 è¡Œ ï¼šè·å¾—æ‹¦æˆªå™¨çš„<strong>ç±»å</strong>ã€‚æ‹¦æˆªå™¨çš„å®ä¾‹ï¼Œåœ¨ <strong>Inter ç±»</strong>é‡Œè·å–ã€‚</li><li>ç¬¬ 156 è‡³ 165 è¡Œ ï¼šå½“ <code>InstanceMethodsInterceptPoint#isOverrideArgs()</code> æ–¹æ³•è¿”å› <code>true</code> æ—¶ï¼Œä½¿ç”¨ InstMethodsInterWithOverrideArgs å¤„ç†æ‹¦æˆªé€»è¾‘ã€‚åœ¨ <a href="#">ã€Œ4.4.2 å®ä¾‹æ–¹æ³• Interã€</a> è¯¦ç»†è§£æã€‚</li><li>ç¬¬ 166 è‡³ 173 è¡Œ ï¼šå½“ <code>InstanceMethodsInterceptPoint#isOverrideArgs()</code> æ–¹æ³•è¿”å› <code>false</code> æ—¶ï¼Œä½¿ç”¨ InstMethodsInter å¤„ç†æ‹¦æˆªé€»è¾‘ï¼Œåœ¨ <a href="#">ã€Œ4.4.2 å®ä¾‹æ–¹æ³• Interã€</a> è¯¦ç»†è§£æã€‚</li></ul></li></ul><h3 id="4-1-3-ClassStaticMethodsEnhancePluginDefine"><a href="#4-1-3-ClassStaticMethodsEnhancePluginDefine" class="headerlink" title="4.1.3 ClassStaticMethodsEnhancePluginDefine"></a>4.1.3 ClassStaticMethodsEnhancePluginDefine</h3><p><a href="https://github.com/YunaiV/skywalking/blob/c7c800bba485dcb9d532d6cb5686df273ae53d6d/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/ClassStaticMethodsEnhancePluginDefine.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.interceptor.enhance.ClassStaticMethodsEnhancePluginDefine</code></a> ï¼Œç±»<strong>å¢å¼ºé™æ€æ–¹æ³•</strong>çš„æ’ä»¶å®šä¹‰<strong>æŠ½è±¡ç±»</strong>ï¼Œå’Œæœ¬æ–‡ <a href="#">ã€Œ4.1.2.1 å¢å¼ºé™æ€æ–¹æ³•ã€</a> å¯¹åº”ã€‚</p><p>å®ç° <code>#getConstructorsInterceptPoints()</code> / <code>#getInstanceMethodsInterceptPoints()</code> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œè¿”å›ç©ºï¼Œè¡¨ç¤ºä¸å¢å¼ºæ„é€ æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•ã€‚<strong>å³åªå¢å¼ºé™æ€æ–¹æ³•</strong>ã€‚</p><h3 id="4-1-4-ClassInstanceMethodsEnhancePluginDefine"><a href="#4-1-4-ClassInstanceMethodsEnhancePluginDefine" class="headerlink" title="4.1.4 ClassInstanceMethodsEnhancePluginDefine"></a>4.1.4 ClassInstanceMethodsEnhancePluginDefine</h3><p><a href="https://github.com/YunaiV/skywalking/blob/c7c800bba485dcb9d532d6cb5686df273ae53d6d/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/ClassInstanceMethodsEnhancePluginDefine.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.interceptor.enhance.ClassInstanceMethodsEnhancePluginDefine</code></a> ï¼Œç±»<strong>å¢å¼ºæ„é€ æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•</strong>çš„æ’ä»¶å®šä¹‰<strong>æŠ½è±¡ç±»</strong>ï¼Œå’Œæœ¬æ–‡ <a href="#">ã€Œ4.1.2.2 å¢å¼ºæ„é€ æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•ã€</a> å¯¹åº”ã€‚</p><p>å®ç° <code>#getStaticMethodsInterceptPoints()</code> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œè¿”å›ç©ºï¼Œè¡¨ç¤ºä¸å¢å¼ºé™æ€æ–¹æ³•ã€‚<strong>å³åªå¢å¼ºæ„é€ æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•</strong>ã€‚</p><h2 id="4-2-InterceptPoint"><a href="#4-2-InterceptPoint" class="headerlink" title="4.2 InterceptPoint"></a>4.2 InterceptPoint</h2><table><thead><tr><th>InterceptPoint</th><th>æ–¹æ³•ç±»å‹</th><th>æ–¹æ³•åŒ¹é…</th><th>æ‹¦æˆªå™¨</th><th><code>#isOverrideArgs()</code></th></tr></thead><tbody><tr><td>StaticMethodsInterceptPoint</td><td>é™æ€æ–¹æ³•</td><td><code>#getMethodsMatcher()</code></td><td><code>#getMethodsInterceptor()</code></td><td>æœ‰</td></tr><tr><td>ConstructorInterceptPoint</td><td>æ„é€ æ–¹æ³•</td><td><code>#getConstructorMatcher()</code></td><td><code>#getConstructorInterceptor()</code></td><td>æ— </td></tr><tr><td>InstanceMethodsInterceptPoint</td><td>å®ä¾‹æ–¹æ³•</td><td><code>#getMethodsMatcher()</code></td><td><code>#getMethodsInterceptor()</code></td><td>æœ‰</td></tr></tbody></table><p>XXXInterceptPoint <strong>æ¥å£</strong>ï¼Œå¯¹åº”ä¸€ä¸ª <code>net.bytebuddy.matcher.ElementMatcher</code>  å’Œä¸€ä¸ªæ‹¦æˆªå™¨ã€‚</p><p>ä»£ç æ¯”è¾ƒç®€å•ï¼Œèƒ–å‹è‡ªå·±æŸ¥çœ‹ã€‚</p><h2 id="4-3-Interceptor"><a href="#4-3-Interceptor" class="headerlink" title="4.3 Interceptor"></a>4.3 Interceptor</h2><p>åœ¨å¼€å§‹åˆ†äº« <strong>Inter</strong> ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ Interceptor ç›¸å…³æ¥å£ã€‚å¦‚ä¸‹å›¾æ‰€è§ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_10/10.png" alt=""></p><ul><li>InstanceConstructorInterceptor ï¼Œæ„é€ æ–¹æ³•æ‹¦æˆªå™¨<strong>æ¥å£</strong>ã€‚</li><li><em>AroundInterceptor</em><ul><li>StaticMethodsAroundInterceptor ï¼Œé™æ€æ–¹æ³•æ‹¦æˆªå™¨<strong>æ¥å£</strong>ã€‚</li><li>InstanceMethodsAroundInterceptor ï¼Œå®ä¾‹æ–¹æ³•æ‹¦æˆªå™¨<strong>æ¥å£</strong>ã€‚</li><li>æ¥å£æ–¹æ³•åŸºæœ¬ä¸€è‡´ï¼Œä¸‹é¢ Inter é€»è¾‘ä¹ŸåŸºæœ¬ä¸€è‡´ã€‚</li></ul></li></ul><p>åœ¨ <a href="#">ã€Œ4. 2 InterceptPointã€</a> é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ° <code>#getXXXInterceptor()</code> æ–¹æ³•è¿”å›çš„æ‹¦æˆªå™¨ç±»åï¼Œéœ€è¦é€šè¿‡ <a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/loader/InterceptorInstanceLoader.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.loader.InterceptorInstanceLoader</code></a> åŠ è½½ä¸åˆ›å»ºæ‹¦æˆªå™¨å®ä¾‹ã€‚</p><h2 id="4-4-Inter"><a href="#4-4-Inter" class="headerlink" title="4.4 Inter"></a>4.4 Inter</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹ Inter çš„å®šä¹‰ ï¼š</p><blockquote><p>In this class, it provide a bridge between byte-buddy and sky-walking plugin.</p></blockquote><p>æ ¹æ®æ–¹æ³•ç±»å‹ï¼Œå°† Inter æ•´ç†å¦‚ä¸‹ ï¼š</p><table><thead><tr><th>æ–¹æ³•ç±»å‹</th><th></th><th></th></tr></thead><tbody><tr><td>æ„é€ æ–¹æ³•</td><td>ConstructorInter</td><td></td></tr><tr><td>å®ä¾‹æ–¹æ³•</td><td>InstMethodsInter</td><td>InstMethodsInterWithOverrideArgs</td></tr><tr><td>é™æ€æ–¹æ³•</td><td>StaticMethodsInter</td><td>StaticMethodsInterWithOverrideArgs</td></tr></tbody></table><h3 id="4-4-1-æ„é€ æ–¹æ³•-Inter"><a href="#4-4-1-æ„é€ æ–¹æ³•-Inter" class="headerlink" title="4.4.1 æ„é€ æ–¹æ³• Inter"></a>4.4.1 æ„é€ æ–¹æ³• Inter</h3><p><a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/ConstructorInter.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.interceptor.enhance.ConstructorInter</code></a> ï¼Œæ„é€ æ–¹æ³• Inter ã€‚</p><p>ConstructorInter <a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/ConstructorInter.java#L52" rel="external nofollow noopener noreferrer" target="_blank"><strong>æ„é€ æ–¹æ³•</strong></a>ï¼Œè°ƒç”¨ <code>InterceptorInstanceLoader#load(String, classLoader)</code> æ–¹æ³•ï¼ŒåŠ è½½æ„é€ æ–¹æ³•æ‹¦æˆªå™¨ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/ConstructorInter.java#L68" rel="external nofollow noopener noreferrer" target="_blank"><code>#intercept(Object)</code></a> æ–¹æ³•ï¼Œ<strong>åœ¨æ„é€ æ–¹æ³•æ‰§è¡Œå®Œæˆåè¿›è¡Œæ‹¦æˆª</strong>ï¼Œè°ƒç”¨ <code>InstanceConstructorInterceptor#onConstruct(...)</code> æ–¹æ³•ã€‚</p><p><strong>ä¸ºä»€ä¹ˆæ²¡æœ‰ ConstructorInterWithOverrideArgs</strong>ï¼Ÿ<code>InstanceConstructorInterceptor#onConstruct(...)</code> æ–¹æ³•ï¼Œæ˜¯<strong>åœ¨æ„é€ æ–¹æ³•æ‰§è¡Œå®Œæˆåè¿›è¡Œè°ƒç”¨æ‹¦æˆª</strong>ï¼ŒOverrideArgs ç”¨äºåœ¨è°ƒç”¨æ–¹æ³•ä¹‹å‰ï¼Œ<strong>æ”¹å˜ä¼ å…¥æ–¹æ³•çš„å‚æ•°</strong>ã€‚æ‰€ä»¥ï¼Œåœ¨æ­¤å¤„æš‚æ—¶æ²¡è¿™å—éœ€è¦ï¼Œå› è€Œæ²¡æœ‰ ConstructorInterWithOverrideArgs ã€‚</p><h3 id="4-4-2-å®ä¾‹æ–¹æ³•-Inter"><a href="#4-4-2-å®ä¾‹æ–¹æ³•-Inter" class="headerlink" title="4.4.2 å®ä¾‹æ–¹æ³• Inter"></a>4.4.2 å®ä¾‹æ–¹æ³• Inter</h3><p><a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/InstMethodsInter.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.interceptor.enhance.InstMethodsInter</code></a> ï¼Œå®ä¾‹æ–¹æ³• Inter ã€‚</p><p>ConstructorInter <a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/InstMethodsInter.java#L51" rel="external nofollow noopener noreferrer" target="_blank"><strong>æ„é€ æ–¹æ³•</strong></a>ï¼Œè°ƒç”¨ <code>InterceptorInstanceLoader#load(String, classLoader)</code> æ–¹æ³•ï¼ŒåŠ è½½å®ä¾‹æ–¹æ³•æ‹¦æˆªå™¨ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/InstMethodsInter.java#L72" rel="external nofollow noopener noreferrer" target="_blank"><code>#intercept(...)</code></a> æ–¹æ³•ï¼Œ<strong>Before-After</strong> æ–¹å¼æ‹¦æˆªå®ä¾‹æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><ul><li>ç¬¬ 79 è‡³ 86 è¡Œ ï¼šè°ƒç”¨ <code>InstanceMethodsAroundInterceptor#beforeMethod(...)</code> æ–¹æ³•ï¼Œæ‰§è¡Œåœ¨å®ä¾‹æ–¹æ³•ä¹‹å‰çš„é€»è¾‘ã€‚<ul><li><a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/MethodInterceptResult.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.interceptor.enhance.MethodInterceptResult</code></a> ï¼Œæ–¹æ³•æ‹¦æˆªå™¨æ‰§è¡Œç»“æœã€‚å½“è°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/MethodInterceptResult.java#L51" rel="external nofollow noopener noreferrer" target="_blank"><code>MethodInterceptResult#defineReturnValue(Object)</code></a> æ–¹æ³•ï¼Œè®¾ç½®æ‰§è¡Œç»“æœï¼Œå¹¶æ ‡è®°ä¸å†ç»§ç»­æ‰§è¡Œã€‚</li></ul></li><li>ç¬¬ 90 è‡³ 92 è¡Œ ï¼šå½“ MethodInterceptResult å·²ç»æœ‰æ‰§è¡Œç»“æœï¼Œ<strong>ä¸å†æ‰§è¡ŒåŸæœ‰æ–¹æ³•ï¼Œç›´æ¥è¿”å›ç»“æœ</strong>ã€‚</li><li>ç¬¬ 94 è‡³ 96 è¡Œ ï¼šè°ƒç”¨ <code>Callable#call()</code> æ–¹æ³•ï¼Œæ‰§è¡ŒåŸæœ‰å®ä¾‹æ–¹æ³•ã€‚</li><li>ç¬¬ 97 è‡³ 105 è¡Œ ï¼šè°ƒç”¨ <code>InstanceMethodsAroundInterceptor#handleMethodException(...)</code> æ–¹æ³•ï¼Œå¤„ç†å¼‚å¸¸ã€‚</li><li>ç¬¬ 107 è‡³ 113 è¡Œ ï¼šè°ƒç”¨ <code>InstanceMethodsAroundInterceptor#afterMethod(...)</code> æ–¹æ³•ï¼Œæ‰§è¡Œåç½®é€»è¾‘ã€‚</li></ul><hr><p><a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/InstMethodsInterWithOverrideArgs.java#L37" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.interceptor.enhance.InstMethodsInterWithOverrideArgs</code></a> ï¼Œ<strong>è¦†å†™å‚æ•°</strong>çš„å®ä¾‹æ–¹æ³• Inter ã€‚</p><p>ä¸å¤ªç†è§£<strong>è¦†å†™å‚æ•°</strong>ï¼Ÿæœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œ<code>InstanceMethodsAroundInterceptor#beforeMethod(...)</code> æ–¹æ³•é‡Œï¼Œæˆ‘ä»¬ä¿®æ”¹äº†æ–¹æ³•å‚æ•°ï¼Œå¹¶ä¸”å¸Œæœ›åŸæœ‰å®ä¾‹æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œ<strong>ä½¿ç”¨çš„æ˜¯ä¿®æ”¹äº†çš„æ–¹æ³•å‚æ•°</strong>ï¼Œæ­¤æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨ InstMethodsInterWithOverrideArgs ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/InstMethodsInterWithOverrideArgs.java#L73" rel="external nofollow noopener noreferrer" target="_blank"><code>InstMethodsInterWithOverrideArgs#intercept(...)</code></a> æ–¹æ³•ï¼Œæ€»ä½“é€»è¾‘å’Œ InstMethodsInter æ˜¯ä¸€è‡´çš„ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å·®å¼‚ç‚¹ ï¼š</p><ul><li>ç¬¬ 76 è¡Œ ï¼šæ–¹æ³•å‚æ•°ç±»å‹æ˜¯ <a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/OverrideCallable.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.interceptor.enhance.OverrideCallable</code></a>ï¼Œå¹¶ä¸”å¸¦æœ‰ <a href="https://github.com/raphw/byte-buddy/blob/188366ace6e16ec167a00b144c9048d78495165f/byte-buddy-dep/src/main/java/net/bytebuddy/implementation/bind/annotation/Morph.java" rel="external nofollow noopener noreferrer" target="_blank"><code>net.bytebuddy.implementation.bind.annotation.@Morph</code></a> æ³¨è§£ã€‚</li><li>ç¬¬ 96 è¡Œ ï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/OverrideCallable.java#L37" rel="external nofollow noopener noreferrer" target="_blank"><code>OverrideCallable#call(args)</code></a> æ–¹æ³•ï¼Œä½¿ç”¨è¢«å‰ç½®æ–¹æ³•ä¿®æ”¹è¿‡çš„å‚æ•°ï¼Œæ‰§è¡ŒåŸæœ‰å®ä¾‹æ–¹æ³•ã€‚</li></ul><p>å…ˆæ¥ç…ç… <code>@Morph</code> æ³¨è§£çš„å®šä¹‰ ï¼š</p><blockquote><p>This annotation instructs Byte Buddy to inject a proxy class that calls a methodâ€™s super method with explicit arguments.  </p><p>For this, the {@link Morph.Binder} needs to be installed for an interface type that takes an argument of the array type {@link java.lang.Object} and returns a non-array type of {@link java.lang.Object}. </p><p>This is an alternative to using the {@link net.bytebuddy.implementation.bind.annotation.SuperCall} or {@link net.bytebuddy.implementation.bind.annotation.DefaultCall} annotations which call a super method using the same arguments as the intercepted method was invoked with.</p></blockquote><p>ç®€å•çš„æ¥è¯´ ï¼š</p><ul><li><code>@Morph</code> æ³¨è§£ï¼Œæ³¨å…¥ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¼šä½¿ç”¨ä¼ å…¥çš„å‚æ•°ï¼Œè°ƒç”¨è¢«ä»£ç†çš„æ–¹æ³•ã€‚ä¾‹å¦‚åœ¨ InstMethodsInterWithOverrideArgs é‡Œï¼Œè°ƒç”¨ <code>OverrideCallable#call(args)</code> æ–¹æ³•ï¼Œä¼šè°ƒç”¨åŸæœ‰å®ä¾‹æ–¹æ³•ã€‚</li><li><p>éœ€è¦ä½¿ç”¨ <code>Morph.Binder</code> è®¾ç½®ä¸€ä¸ªæ¥å£ï¼Œå¹¶ä¸”è¯¥æ¥å£çš„æ–¹æ³•å®šä¹‰ä¸º <code>Object methodName(Object[])</code> ã€‚åœ¨ InstMethodsInterWithOverrideArgs ä½¿ç”¨çš„æ˜¯  <a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/OverrideCallable.java#L29" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.interceptor.enhance.OverrideCallable</code></a> æ¥å£ã€‚å¦å¤–ï¼Œè°ƒç”¨ <code>Morph.Binder#install(Class&lt;?&gt;)</code> æ–¹æ³•çš„ä»£ç å¦‚ä¸‹ ï¼š</p>  <figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// ClassEnhancePluginDefine.java </span></div><div class="line"><span class="comment">// `#enhanceInstance(...)` æ–¹æ³•</span></div><div class="line">newClassBuilder =</div><div class="line">    newClassBuilder.method(not(isStatic()).and(instanceMethodsInterceptPoint.getMethodsMatcher())) <span class="comment">// åŒ¹é…</span></div><div class="line">        .intercept( <span class="comment">// æ‹¦æˆª</span></div><div class="line">            MethodDelegation.withDefaultConfiguration()</div><div class="line">                .withBinders(</div><div class="line">                    Morph.Binder.install(OverrideCallable.class) <span class="comment">// è¦†å†™å‚æ•°</span></div><div class="line">                )</div><div class="line">                .to(<span class="keyword">new</span> InstMethodsInterWithOverrideArgs(interceptor, classLoader))</div><div class="line">        );</div></pre></td></tr></table></figure></li></ul><h3 id="4-4-3-é™æ€æ–¹æ³•-Inter"><a href="#4-4-3-é™æ€æ–¹æ³•-Inter" class="headerlink" title="4.4.3 é™æ€æ–¹æ³• Inter"></a>4.4.3 é™æ€æ–¹æ³• Inter</h3><p><a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/StaticMethodsInter.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.interceptor.enhance.StaticMethodsInter</code></a> å’Œ <a href="https://github.com/YunaiV/skywalking/blob/ea8b4e879092b39070215b1a2d194e6df12f0ef8/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/interceptor/enhance/StaticMethodsInterWithOverrideArgs.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.interceptor.enhance.StaticMethodsInterWithOverrideArgs</code></a> å’Œ<strong>å®ä¾‹æ–¹æ³• Inter</strong>åŸºæœ¬ä¸€è‡´ï¼Œèƒ–å‹å¯ä»¥è‡ªå·±æ‹ä¸€æ‹ï¼Œç¬”è€…å°±ä¸çæ¯”æ¯”äº†ã€‚</p><h2 id="4-5-å°ç»“"><a href="#4-5-å°ç»“" class="headerlink" title="4.5 å°ç»“"></a>4.5 å°ç»“</h2><p>æ€»çš„æ¥è¯´ï¼Œæ¶‰åŠåˆ°çš„ç»„ä»¶ï¼Œå¦‚ä¸‹å›¾ ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_10/11.png" alt=""></p><p>èƒ–å‹å†æ¢³ç†æ¢³ç†ã€‚</p><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>å†™å®Œï¼Œè›®å—¨çš®ğŸ˜œã€‚</p><p>è¿‘æœŸæœ€è®¤çœŸçš„ä¸€ç¯‡æ–‡ç« ï¼Œæ²¡æœ‰ä¹‹ä¸€ï¼Œæ»¡è¶³ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_10/12.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸ªæœ‹å‹åœˆå¯å¥½ï¼Ÿ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/agent-plugin-system/&quot;&gt;http://www.iocoder.cn/SkyWalking/agent-plugin-system/&lt;/a&gt; ã€ŒèŠ‹é“æºç ã€
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” Agent åˆå§‹åŒ–</title>
    <link href="http://www.iocoder.cn/SkyWalking/agent-init/"/>
    <id>http://www.iocoder.cn/SkyWalking/agent-init/</id>
    <published>2020-07-04T16:00:00.000Z</published>
    <updated>2017-12-13T18:28:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/agent-init/">http://www.iocoder.cn/SkyWalking/agent-init/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/agent-init/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-init/">2. SkyWalkingAgent</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-init/">3. SnifferConfigInitializer</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/agent-init/">3.1 Config</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-init/">3.2 RemoteDownstreamConfig</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-init/">4. Plugin</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/agent-init/">4.1 PluginBootstrap</a></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-init/">4.2 PluginFinder</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-init/">5. ServiceManager</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/agent-init/">5.1 BootService</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/agent-init/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>SkyWalking Agent å¯åŠ¨åˆå§‹åŒ–çš„è¿‡ç¨‹</strong>ã€‚</p><p>SkyWalking Agent åŸºäº <strong>JavaAgent</strong> æœºåˆ¶ï¼Œå®ç°åº”ç”¨<strong>é€æ˜</strong>æ¥å…¥ SkyWalking ã€‚å…³äº JavaAgent æœºåˆ¶ï¼Œç¬”è€…æ¨èå¦‚ä¸‹ä¸¤ç¯‡æ–‡ç«  ï¼š</p><ul><li><a href="https://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠInstrumentation æ–°åŠŸèƒ½ã€‹</a></li><li><a href="http://www.infoq.com/cn/articles/javaagent-illustrated" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠJVMæºç åˆ†æä¹‹javaagentåŸç†å®Œå…¨è§£è¯»ã€‹</a></li></ul><blockquote><p>å‹æƒ…æç¤º ï¼šå»ºè®®è‡ªå·±æ‰‹æ’¸ä¸€ä¸ªç®€å•çš„ JavaAgent ï¼Œæ›´å®¹æ˜“ç†è§£ SkyWalking Agent ã€‚ </p><p>ç¬”è€…ç»ƒæ‰‹çš„ JavaAgent é¡¹ç›®åœ°å€ ï¼š<a href="https://github.com/YunaiV/learning/tree/master/javaagent01" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/YunaiV/learning/tree/master/javaagent01</a></p></blockquote><h1 id="2-SkyWalkingAgent"><a href="#2-SkyWalkingAgent" class="headerlink" title="2. SkyWalkingAgent"></a>2. SkyWalkingAgent</h1><p><code>org.skywalking.apm.agent.SkyWalkingAgent</code> ï¼Œåœ¨ <code>apm-sniffer/apm-agent</code> Maven æ¨¡å—é¡¹ç›®é‡Œï¼ŒSkyWalking Agent <strong>å¯åŠ¨å…¥å£</strong>ã€‚ä¸ºä»€ä¹ˆè¯´å®ƒæ˜¯å¯åŠ¨å…¥å£å‘¢ï¼Ÿåœ¨ <code>apm-sniffer/apm-agent</code> çš„ <a href="https://github.com/OpenSkywalking/skywalking/blob/23133f7d97d17b471f69e7214a01885ebcd2e882/apm-sniffer/apm-agent/pom.xml#L53" rel="external nofollow noopener noreferrer" target="_blank"><code>pom.xml</code></a> æ–‡ä»¶çš„ã€ç¬¬ 73 è¡Œã€‘ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° SkyWalkingAgent è¢«é…ç½®æˆ JavaAgent çš„ <strong>PremainClass</strong> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/c51dbc997348111674dbeedb71d22b0414936cdb/apm-sniffer/apm-agent/src/main/java/org/skywalking/apm/agent/SkyWalkingAgent.java#L54" rel="external nofollow noopener noreferrer" target="_blank"><code>#premain(...)</code></a> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><ul><li>ç¬¬ 58 è¡Œ ï¼šè°ƒç”¨ <code>SnifferConfigInitializer#initialize()</code> æ–¹æ³•ï¼Œåˆå§‹åŒ– Agent é…ç½®ã€‚</li><li>ç¬¬ 61 è¡Œ ï¼šè°ƒç”¨ <code>PluginBootstrap#loadPlugins()</code> æ–¹æ³•ï¼ŒåŠ è½½ Agent æ’ä»¶ä»¬ã€‚è€Œåï¼Œåˆ›å»º PluginFinder ã€‚ </li><li>ç¬¬ 64 è¡Œ ï¼šè°ƒç”¨ <code>ServiceManager#boot()</code> æ–¹æ³•ï¼Œåˆå§‹åŒ– Agent æœåŠ¡ç®¡ç†ã€‚åœ¨è¿™è¿‡ç¨‹ä¸­ï¼ŒAgent æœåŠ¡ä»¬ä¼šè¢«åˆå§‹åŒ–ã€‚</li><li>ç¬¬ 79 è‡³ 133 è¡Œ ï¼šåŸºäº <a href="https://github.com/raphw/byte-buddy" rel="external nofollow noopener noreferrer" target="_blank">byte-buddy</a> ï¼Œåˆå§‹åŒ– Instrumentation çš„ <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/instrument/ClassFileTransformer.html" rel="external nofollow noopener noreferrer" target="_blank"><code>java.lang.instrument.ClassFileTransformer</code></a> ã€‚</li></ul><h1 id="3-SnifferConfigInitializer"><a href="#3-SnifferConfigInitializer" class="headerlink" title="3. SnifferConfigInitializer"></a>3. SnifferConfigInitializer</h1><p><code>org.skywalking.apm.agent.core.conf.SnifferConfigInitializer</code> ï¼ŒAgent é…ç½®åˆå§‹åŒ–å™¨ã€‚</p><p>åœ¨çœ‹å…·ä½“ä»£ç å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹ <code>org.skywalking.apm.agent.core.conf</code> åŒ…çš„å¤§ä½“ç»“æ„ ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_05/02.png" alt=""></p><p>é…ç½®ç±»æœ‰ Config å’Œ RemoteDownstreamConfig ä¸¤ç§ã€‚ä»å‘½åä¸Šå¯ä»¥çœ‹å‡º ï¼š</p><ul><li>Config ä¸º Agent <strong>æœ¬åœ°</strong>é…ç½®ç±»ï¼Œä½¿ç”¨ SnifferConfigInitializer è¿›è¡Œåˆå§‹åŒ–ã€‚</li><li>RemoteDownstreamConfig ä¸º Agent <strong>è¿œç¨‹</strong>é…ç½®ç±»ï¼Œä» <a href="https://github.com/OpenSkywalking/skywalking/wiki/3.2.3-%E9%83%A8%E7%BD%B2Collector" rel="external nofollow noopener noreferrer" target="_blank">Collector Server</a> è¯»å–ã€‚ </li></ul><hr><p><a href="https://github.com/YunaiV/skywalking/blob/cea46a7e93437bbb16db2bfe0fae5c6fcf733fc2/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/conf/SnifferConfigInitializer.java#L56" rel="external nofollow noopener noreferrer" target="_blank"><code>#initialize()</code></a> æ–¹æ³•ï¼Œåˆå§‹åŒ– Agent æœ¬åœ°é…ç½®ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><ul><li>ç¬¬ 59 è‡³ 67 è¡Œ ï¼šä»é…ç½®æ–‡ä»¶( <code>agent.config</code> ) åŠ è½½é…ç½®ã€‚é…ç½®æ–‡ä»¶æ‰€åœ¨<strong>å›ºå®š</strong>è·¯å¾„ä¸º <code>${AGENT_PACKAGE_PATH}/config/agent.config</code> ï¼Œå…¶ä¸­ <code>${AGENT_PACKAGE_PATH}</code> é€šè¿‡ <a href="https://github.com/YunaiV/skywalking/blob/c51dbc997348111674dbeedb71d22b0414936cdb/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/boot/AgentPackagePath.java#L31" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.boot.AgentPackagePath</code></a> åˆå§‹åŒ–ã€‚Agent æ•´ç†ç›®å½•å¦‚ä¸‹å›¾ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_05/01.png" alt=""></li><li>ç¬¬ 70 è‡³ 74 è¡Œ ï¼šä»ç¯å¢ƒå˜é‡<strong>è¦†ç›–</strong>é…ç½®ã€‚ç¯å¢ƒå˜é‡ <strong>Key</strong> éœ€ä»¥ <code>&quot;skywalking.&quot;</code> å¼€å¤´ã€‚ä¾‹å¦‚ï¼Œ<code>Config.Agent.APPLICATION_CODE</code> åœ¨ <code>agent.config</code> ä¸º <code>agent.application_code</code> ï¼Œç¯å¢ƒå˜é‡ä¸º <code>skywalking.agent.application_code</code> ã€‚å¦å¤–ï¼Œç¯å¢ƒå˜é‡åŒ…æ‹¬ JVM è¿›ç¨‹çš„å’Œç³»ç»Ÿçš„ã€‚</li><li>ç¬¬ 77 è‡³ 82 è¡Œ ï¼šæ ¡éªŒé…ç½®æ˜¯å¦æ­£ç¡®åŠ è½½ã€‚</li></ul><h2 id="3-1-Config"><a href="#3-1-Config" class="headerlink" title="3.1 Config"></a>3.1 Config</h2><p><code>org.skywalking.apm.agent.core.conf.Config</code> ï¼ŒAgent æœ¬åœ°é…ç½®ç±»ã€‚</p><p>æ‰“å¼€ <a href="https://github.com/YunaiV/skywalking/blob/cea46a7e93437bbb16db2bfe0fae5c6fcf733fc2/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/conf/Config.java#L32" rel="external nofollow noopener noreferrer" target="_blank">Config</a> ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°æ‹†åˆ†äº† Agent / Collector / Jvm / Buffer / Dictionary / Logging / Plugin ä¸ƒä¸ªå°ç±»ã€‚å¦‚ä¸‹å›¾ ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_05/03.png" alt=""></p><p>æœ¬æ–‡æš‚ä¸å¯¹é…ç½®é¡¹è¯¦ç»†è§£æï¼Œèƒ–å‹å¯ä»¥çœ‹ä¸‹æ¯ä¸ªå±æ€§çš„è‹±æ–‡æ³¨é‡Šã€‚</p><h2 id="3-2-RemoteDownstreamConfig"><a href="#3-2-RemoteDownstreamConfig" class="headerlink" title="3.2 RemoteDownstreamConfig"></a>3.2 RemoteDownstreamConfig</h2><p><code>org.skywalking.apm.agent.core.conf.RemoteDownstreamConfig</code> ï¼ŒAgent è¿œç¨‹é…ç½®ç±»ã€‚</p><p>æ‰“å¼€ <a href="https://github.com/YunaiV/skywalking/blob/cea46a7e93437bbb16db2bfe0fae5c6fcf733fc2/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/conf/RemoteDownstreamConfig.java" rel="external nofollow noopener noreferrer" target="_blank">RemoteDownstreamConfig</a> ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°æ‹†åˆ†äº† Agent / Collector ä¸¤å°ç±»ã€‚å¦‚ä¸‹å›¾ ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_05/04.png" alt=""></p><p>æœ¬æ–‡æš‚ä¸å¯¹é…ç½®é¡¹è¯¦ç»†è§£æï¼Œèƒ–å‹å¯ä»¥çœ‹ä¸‹æ¯ä¸ªå±æ€§çš„è‹±æ–‡æ³¨é‡Šã€‚</p><h1 id="4-Plugin"><a href="#4-Plugin" class="headerlink" title="4. Plugin"></a>4. Plugin</h1><p>SkyWalking Agent æä¾›äº†å¤šç§æ’ä»¶ï¼Œå®ç°ä¸åŒæ¡†æ¶çš„<strong>é€æ˜</strong>æ¥å…¥ SkyWalking ã€‚åœ¨ <a href="https://github.com/OpenSkywalking/skywalking/wiki/3.2.3-supported-list" rel="external nofollow noopener noreferrer" target="_blank">ã€Šå®˜æ–¹æ–‡æ¡£ â€”â€” supported listã€‹</a> é‡Œï¼Œæœ‰ç›®å‰çš„æ’ä»¶åˆ—è¡¨ã€‚</p><p>å¦å¤–ï¼Œåœ¨ <code>apm-sniffer/apm-sdk-plugin</code> ç›®å½•ä¸‹ï¼Œæœ‰æ’ä»¶çš„å®ç°ä»£ç  ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_05/05.png" alt=""></p><p>æœ¬å°èŠ‚ä¼šåˆ†äº«çš„è¾ƒä¸ºç®€å•ï¼Œåœ¨ <a href="http://www.iocoder.cn/SkyWalking/agent-plugin-system/?self">ã€ŠSkyWalking æºç åˆ†æ â€”â€” Agent æ’ä»¶ä½“ç³»ã€‹</a> è¯¦ç»†è§£æã€‚</p><h2 id="4-1-PluginBootstrap"><a href="#4-1-PluginBootstrap" class="headerlink" title="4.1 PluginBootstrap"></a>4.1 PluginBootstrap</h2><p><code>org.skywalking.apm.agent.core.plugin.PluginBootstrap</code> ï¼Œæ’ä»¶å¼•å¯¼ç¨‹åºç±»ï¼Œåˆ›å»ºéœ€è¦åŠ è½½çš„æ’ä»¶å¯¹è±¡æ•°ç»„ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/130f0a5a3438663b393e53ba2cca02a8d13c258a/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/PluginBootstrap.java#L45" rel="external nofollow noopener noreferrer" target="_blank"><code>#loadPlugins()</code></a> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><ul><li>ç¬¬ 47 è¡Œ ï¼šåˆå§‹åŒ– AgentClassLoader ã€‚</li><li>ç¬¬ 50 è‡³ 56 è¡Œ ï¼šè·å¾—æ’ä»¶<strong>å®šä¹‰è·¯å¾„</strong>æ•°ç»„ã€‚</li><li>ç¬¬ 59 è‡³ 66 è¡Œ ï¼šè·å¾—æ’ä»¶<strong>å®šä¹‰</strong>( <a href="https://github.com/OpenSkywalking/skywalking/blob/b16d23c1484bec941367d6b36fa932b8ace40971/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/PluginDefine.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.PluginDefine</code></a> )æ•°ç»„ã€‚</li><li>ç¬¬ 69 è‡³ 82 è¡Œ ï¼šåˆ›å»º<strong>ç±»å¢å¼ºæ’ä»¶å®šä¹‰</strong>( <a href="https://github.com/OpenSkywalking/skywalking/blob/b16d23c1484bec941367d6b36fa932b8ace40971/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/AbstractClassEnhancePluginDefine.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.AbstractClassEnhancePluginDefine</code></a> )å¯¹è±¡æ•°ç»„ã€‚ä¸åŒæ’ä»¶é€šè¿‡å®ç° AbstractClassEnhancePluginDefine <strong>æŠ½è±¡ç±»</strong>ï¼Œå®šä¹‰ä¸åŒæ¡†æ¶çš„<strong>åˆ‡é¢</strong>ï¼Œ<strong>è®°å½•è°ƒç”¨é“¾è·¯</strong>ã€‚ä»¥ Spring æ’ä»¶ä¸ºä¾‹å­ï¼Œå¦‚ä¸‹æ˜¯ç›¸å…³ç±»å›¾ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_05/06.png" alt=""></li></ul><h2 id="4-2-PluginFinder"><a href="#4-2-PluginFinder" class="headerlink" title="4.2 PluginFinder"></a>4.2 PluginFinder</h2><p><code>org.skywalking.apm.agent.core.plugin.PluginFinder</code> ï¼Œæ’ä»¶å‘ç°è€…ã€‚å…¶æä¾› <a href="https://github.com/YunaiV/skywalking/blob/09c654af33081e56547cb8b3b9e0c8525ddce32f/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/PluginFinder.java#L80" rel="external nofollow noopener noreferrer" target="_blank"><code>#find(...)</code></a> æ–¹æ³•ï¼Œè·å¾—<strong>ç±»å¢å¼ºæ’ä»¶å®šä¹‰</strong>( <a href="https://github.com/OpenSkywalking/skywalking/blob/b16d23c1484bec941367d6b36fa932b8ace40971/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/AbstractClassEnhancePluginDefine.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.plugin.AbstractClassEnhancePluginDefine</code></a> )å¯¹è±¡ã€‚</p><p>PluginFinder <strong><a href="https://github.com/YunaiV/skywalking/blob/09c654af33081e56547cb8b3b9e0c8525ddce32f/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/plugin/PluginFinder.java#L56" rel="external nofollow noopener noreferrer" target="_blank">æ„é€ æ–¹æ³•</a></strong>ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><ul><li>ç¬¬ 57 è‡³ 77 è¡Œ ï¼šå¾ªç¯ AbstractClassEnhancePluginDefine å¯¹è±¡æ•°ç»„ï¼Œæ·»åŠ åˆ° <code>nameMatchDefine</code> / <code>signatureMatchDefine</code> å±æ€§ï¼Œæ–¹ä¾¿ <code>#find(...)</code> æ–¹æ³•æŸ¥æ‰¾ AbstractClassEnhancePluginDefine å¯¹è±¡ã€‚<ul><li>ç¬¬ 65 è‡³ 72 è¡Œ ï¼šå¤„ç† NameMatch ä¸ºåŒ¹é…çš„ AbstractClassEnhancePluginDefine å¯¹è±¡ï¼Œæ·»åŠ åˆ° <code>nameMatchDefine</code>  å±æ€§ã€‚</li><li>ç¬¬ 74 è‡³ 76 è¡Œ ï¼šå¤„ç†<strong>é</strong> NameMatch ä¸ºåŒ¹é…çš„ AbstractClassEnhancePluginDefine å¯¹è±¡ï¼Œæ·»åŠ åˆ° <code>signatureMatchDefine</code> å±æ€§ã€‚</li></ul></li></ul><h1 id="5-ServiceManager"><a href="#5-ServiceManager" class="headerlink" title="5. ServiceManager"></a>5. ServiceManager</h1><p><code>org.skywalking.apm.agent.core.boot.ServiceManager</code> ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/09c654af33081e56547cb8b3b9e0c8525ddce32f/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/boot/BootService.java" rel="external nofollow noopener noreferrer" target="_blank">BootService</a> ç®¡ç†å™¨ã€‚è´Ÿè´£ç®¡ç†ã€åˆå§‹åŒ– BootService å®ä¾‹ä»¬ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/3de8a6c15d07aa3b2c3b4e732e6654fc87c4e70e/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/boot/ServiceManager.java#L45" rel="external nofollow noopener noreferrer" target="_blank"><code>#boot()</code></a> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><ul><li><p>ç¬¬ 47 è¡Œ ï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/3de8a6c15d07aa3b2c3b4e732e6654fc87c4e70e/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/boot/ServiceManager.java#L72" rel="external nofollow noopener noreferrer" target="_blank"><code>#loadAllServices()</code></a> æ–¹æ³•ï¼ŒåŠ è½½æ‰€æœ‰ BootService å®ç°ç±»çš„å®ä¾‹æ•°ç»„ã€‚ServiceManager åŸºäº SPI (Service Provider Interface) æœºåˆ¶ï¼Œåœ¨ <a href="https://github.com/OpenSkywalking/skywalking/blob/b16d23c1484bec941367d6b36fa932b8ace40971/apm-sniffer/apm-agent-core/src/main/resources/META-INF/services/org.skywalking.apm.agent.core.boot.BootService" rel="external nofollow noopener noreferrer" target="_blank">/resources/META-INF.services/org.skywalking.apm.agent.core.boot.BootService</a> æ–‡ä»¶é‡Œï¼Œå®šä¹‰äº†æ‰€æœ‰ BootService çš„å®ç°ç±»ã€‚å¦‚æœèƒ–å‹å¯¹ SPI æœºåˆ¶ä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥çœ‹ä¸‹å¦‚ä¸‹æ–‡ç«  ï¼š</p><ul><li><a href="http://www.jianshu.com/p/32d3e108f30a" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠSPI å’Œ ServiceLoaderã€‹</a> </li><li><a href="http://www.jianshu.com/p/46aa69643c97" rel="external nofollow noopener noreferrer" target="_blank">ã€Šè·Ÿæˆ‘å­¦Dubboç³»åˆ—ä¹‹Java SPIæœºåˆ¶ç®€ä»‹ã€‹</a> </li></ul></li><li><p>ç¬¬ 50 è¡Œ ï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/3de8a6c15d07aa3b2c3b4e732e6654fc87c4e70e/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/boot/ServiceManager.java#L82" rel="external nofollow noopener noreferrer" target="_blank"><code>#beforeBoot()</code></a> æ–¹æ³•ï¼Œè°ƒç”¨æ¯ä¸ª <code>BootService#beforeBoot()</code> æ–¹æ³•ã€‚</p></li><li>ç¬¬ 52 è¡Œ ï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/3de8a6c15d07aa3b2c3b4e732e6654fc87c4e70e/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/boot/ServiceManager.java#L92" rel="external nofollow noopener noreferrer" target="_blank"><code>#startup()</code></a> æ–¹æ³•ï¼Œè°ƒç”¨æ¯ä¸ª <code>BootService#boot()</code> æ–¹æ³•ã€‚</li><li>ç¬¬ 54 è¡Œ ï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/3de8a6c15d07aa3b2c3b4e732e6654fc87c4e70e/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/boot/ServiceManager.java#L102" rel="external nofollow noopener noreferrer" target="_blank"><code>#afterBoot()</code></a> æ–¹æ³•ï¼Œè°ƒç”¨æ¯ä¸ª <code>BootService#afterBoot()</code> æ–¹æ³•ã€‚</li></ul><h2 id="5-1-BootService"><a href="#5-1-BootService" class="headerlink" title="5.1 BootService"></a>5.1 BootService</h2><p><code>org.skywalking.apm.agent.core.boot.BootService</code> ï¼ŒAgent å¯åŠ¨æœåŠ¡<strong>æ¥å£</strong>ï¼Œå®šä¹‰äº† <code>#beforeBoot()</code> / <code>#boot()</code> / <code>#afterBoot()</code> / <code>#shutdown()</code> æ¥å£æ–¹æ³•ã€‚</p><p>BootService ç›®å‰æœ‰<strong>ä¸ƒä¸ª</strong>å®ç°ç±»ï¼Œåœ¨åç»­çš„æ–‡ç« ï¼Œæˆ‘ä»¬ä¼šè§£æç›¸å…³å®ç°ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_05/07.png" alt=""></p><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>æ¯æ¬¡å†™åˆå§‹åŒ–ç›¸å…³çš„æ–‡ç« ï¼Œå†™å°‘äº†ï¼Œæ€•å¤ªæ°´ï¼›å†™å¤šäº†ï¼Œåˆæ€•å¤ªå¤æ‚ã€‚</p><p>å—¯ï¼Œé€ä¸€å‘å¦¹å­ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_05/08.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸ªæœ‹å‹åœˆå¯å¥½ï¼Ÿ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/agent-init/&quot;&gt;http://www.iocoder.cn/SkyWalking/agent-init/&lt;/a&gt; ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼&lt;/p&gt;

      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
  <entry>
    <title>SkyWalking æºç åˆ†æ â€”â€” è°ƒè¯•ç¯å¢ƒæ­å»º</title>
    <link href="http://www.iocoder.cn/SkyWalking/build-debugging-environment/"/>
    <id>http://www.iocoder.cn/SkyWalking/build-debugging-environment/</id>
    <published>2020-06-30T16:00:00.000Z</published>
    <updated>2017-12-10T02:02:06.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/SkyWalking/build-debugging-environment/">http://www.iocoder.cn/SkyWalking/build-debugging-environment/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><ul><li><a href="http://www.iocoder.cn/SkyWalking/build-debugging-environment/">1. ä¾èµ–å·¥å…·</a></li><li><a href="http://www.iocoder.cn/SkyWalking/build-debugging-environment/">2. æºç æ‹‰å–</a></li><li><a href="http://www.iocoder.cn/SkyWalking/build-debugging-environment/">3. å¯åŠ¨ SkyWalking Collector</a></li><li><a href="http://www.iocoder.cn/SkyWalking/build-debugging-environment/">4. å¯åŠ¨ SkyWalking Agent</a></li><li><a href="http://www.iocoder.cn/SkyWalking/build-debugging-environment/">5. å¯åŠ¨ SkyWalking Web UI</a></li><li><a href="http://www.iocoder.cn/SkyWalking/build-debugging-environment/">6. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š  </p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨  </li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong>  </li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚  </li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚  </li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-ä¾èµ–å·¥å…·"><a href="#1-ä¾èµ–å·¥å…·" class="headerlink" title="1. ä¾èµ–å·¥å…·"></a>1. ä¾èµ–å·¥å…·</h1><ul><li>Maven</li><li>Git</li><li>JDK</li><li>IntelliJ IDEA</li></ul><h1 id="2-æºç æ‹‰å–"><a href="#2-æºç æ‹‰å–" class="headerlink" title="2. æºç æ‹‰å–"></a>2. æºç æ‹‰å–</h1><p>ä»å®˜æ–¹ä»“åº“ <a href="https://github.com/OpenSkywalking/skywalking" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/OpenSkywalking/skywalking</a> <code>Fork</code> å‡ºå±äºè‡ªå·±çš„ä»“åº“ã€‚ä¸ºä»€ä¹ˆè¦ <code>Fork</code> ï¼Ÿæ—¢ç„¶å¼€å§‹é˜…è¯»ã€è°ƒè¯•æºç ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå†™ä¸€äº›æ³¨é‡Šï¼Œæœ‰äº†è‡ªå·±çš„ä»“åº“ï¼Œå¯ä»¥è¿›è¡Œè‡ªç”±çš„æäº¤ã€‚ğŸ˜ˆ</p><p>ä½¿ç”¨ <code>IntelliJ IDEA</code> ä» <code>Fork</code> å‡ºæ¥çš„ä»“åº“æ‹‰å–ä»£ç ã€‚æ‹‰å–å®Œæˆåï¼Œ<code>Maven</code> ä¼šä¸‹è½½ä¾èµ–åŒ…ï¼Œå¯èƒ½ä¼šèŠ±è´¹ä¸€äº›æ—¶é—´ï¼Œè€å¿ƒç­‰å¾…ä¸‹ã€‚</p><p>æœ¬æ–‡åŸºäº <code>master</code> åˆ†æ”¯ã€‚</p><h1 id="3-å¯åŠ¨-SkyWalking-Collector"><a href="#3-å¯åŠ¨-SkyWalking-Collector" class="headerlink" title="3. å¯åŠ¨ SkyWalking Collector"></a>3. å¯åŠ¨ SkyWalking Collector</h1><p>å‚è€ƒ <a href="https://github.com/OpenSkywalking/skywalking/wiki/How-to-build" rel="external nofollow noopener noreferrer" target="_blank">ã€Šå®˜æ–¹æ–‡æ¡£ â€”â€” How to buildã€‹</a></p><ol><li>åœ¨ IntelliJ IDEA Terminal ä¸­ï¼Œæ‰§è¡Œ <code>mvn compile -Dmaven.test.skip=true</code> è¿›è¡Œç¼–è¯‘ã€‚</li><li><p>è®¾ç½® gRPC çš„<strong>è‡ªåŠ¨ç”Ÿæˆ</strong>çš„ä»£ç ç›®å½•ï¼Œä¸º<strong>æºç </strong>ç›®å½• ï¼š</p><ul><li>/apm-network/target/generated-sources/protobuf/ ä¸‹çš„ <code>grpc-java</code> å’Œ <code>java</code> ç›®å½•</li><li>/apm-collector-remote/collector-remote-grpc-provider/target/generated-sources/protobuf/ ä¸‹çš„ <code>grpc-java</code> å’Œ <code>java</code> ç›®å½•</li><li><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_01/01.png" alt=""></p><blockquote><p>ä» 3.2 å¼€å§‹ï¼Œç½‘ç»œé€šè®¯åè®®å¼•å…¥ GRPC ï¼Œæ‰€ä»¥å¢åŠ ä¸Šè¿°çš„æ­¥éª¤</p></blockquote></li></ul></li><li><p>è¿è¡Œ <code>org.skywalking.apm.collector.bootCollectorBootStartUp</code> çš„ <code>#main(args)</code> æ–¹æ³•ï¼Œå¯åŠ¨ Collector ã€‚</p></li><li>è®¿é—® <code>http://127.0.0.1:10800/agent/jetty</code> åœ°å€ï¼Œè¿”å› <code>[&quot;localhost:12800/&quot;]</code> ï¼Œè¯´æ˜å¯åŠ¨<strong>æˆåŠŸ</strong>ã€‚</li></ol><h1 id="4-å¯åŠ¨-SkyWalking-Agent"><a href="#4-å¯åŠ¨-SkyWalking-Agent" class="headerlink" title="4. å¯åŠ¨ SkyWalking Agent"></a>4. å¯åŠ¨ SkyWalking Agent</h1><p>æ„Ÿè°¢ <a href="https://github.com/wu-sheng" rel="external nofollow noopener noreferrer" target="_blank">å´æ™Ÿ</a> æŒ‡å¯¼å¦‚ä½•æ­å»º Agent è°ƒè¯•ç¯å¢ƒã€‚</p><ol><li>åœ¨ IntelliJ IDEA Terminal ä¸­ï¼Œæ‰§è¡Œ <code>mvn compile -Dmaven.test.skip=true</code> è¿›è¡Œç¼–è¯‘ã€‚åœ¨ /packages/skywalking-agent ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¼–è¯‘å‡ºæ¥çš„ Agent ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_01/02.png" alt=""></li><li><p>ä½¿ç”¨ Spring Boot åˆ›å»ºä¸€ä¸ªç®€å•çš„ Web é¡¹ç›®ã€‚ç±»ä¼¼å¦‚ä¸‹ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_01/03.png" alt=""></p><blockquote><p>å‹æƒ…æç¤º ï¼š<strong>è¿™é‡Œä¸€å®šè¦æ³¨æ„ä¸‹</strong>ã€‚åˆ›å»ºçš„ Web é¡¹ç›®ï¼Œä½¿ç”¨  IntelliJ IDEA çš„<strong>èœå•</strong> File / New / Module æˆ– File / New / Module from Existing Sources ï¼Œ<strong>ä¿è¯ Web é¡¹ç›®å’Œ skywalking é¡¹ç›®å¹³çº§</strong>ã€‚è¿™æ ·ï¼Œæ‰å¯ä»¥ä½¿ç”¨ IntelliJ IDEA è°ƒè¯•  Agent ã€‚</p></blockquote><ul><li><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_01/04.png" alt=""></li><li><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_01/05.png" alt=""></li></ul></li><li><p>åœ¨ <code>org.skywalking.apm.agent.SkyWalkingAgent</code> çš„ <code>#premain(...)</code> æ–¹æ³•ï¼Œæ‰“ä¸Šè°ƒè¯•æ–­ç‚¹ã€‚</p></li><li>è¿è¡Œ Web é¡¹ç›®çš„ Application çš„ <code>#main(args)</code> æ–¹æ³•ï¼Œå¹¶å¢åŠ  JVM å¯åŠ¨å‚æ•°ï¼Œ<code>-javaagent:/path/to/skywalking-agent/skywalking-agent.jar</code>ã€‚<code>/path/to</code> <strong>å‚æ•°å€¼</strong>ä¸ºä¸Šé¢æˆ‘ä»¬ç¼–è¯‘å‡ºæ¥çš„ /packages/skywalking-agent ç›®å½•çš„ç»å¯¹è·¯å¾„ã€‚å¦‚ä¸‹å›¾ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_01/06.png" alt=""></li><li>å¦‚æœåœ¨ã€<strong>ç¬¬ä¸‰æ­¥</strong>ã€‘çš„è°ƒè¯•æ–­ç‚¹åœä½ï¼Œè¯´æ˜ Agent å¯åŠ¨<strong>æˆåŠŸ</strong>ã€‚</li></ol><hr><p>è€ƒè™‘åˆ°å¯èƒ½æˆ‘ä»¬ä¼šåœ¨ Agent ä¸Šå¢åŠ ä»£ç æ³¨é‡Šï¼Œè¿™æ ·æ¯æ¬¡ä¸å¾—ä¸é‡æ–°ç¼–è¯‘ Agent ã€‚å¯ä»¥é…ç½®å¦‚ä¸‹å›¾ï¼Œè‡ªåŠ¨ç¼–è¯‘ Agent ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_01/07.png" alt=""></p><ul><li><code>-T 1C clean  package -Dmaven.test.skip=true -Dmaven.compile.fork=true</code> ã€‚</li></ul><hr><p>å¦å¤–ï¼Œä½¿ç”¨ IntelliJ IDEA Remote è¿œç¨‹è°ƒè¯•ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚å¦‚ä¸‹å›¾ ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_07_01/10.png" alt=""></p><h1 id="5-å¯åŠ¨-SkyWalking-Web-UI"><a href="#5-å¯åŠ¨-SkyWalking-Web-UI" class="headerlink" title="5. å¯åŠ¨ SkyWalking Web UI"></a>5. å¯åŠ¨ SkyWalking Web UI</h1><p>è€ƒè™‘åˆ°è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¦çœ‹ä¸‹æ˜¯å¦æ”¶é›†åˆ°è¿½è¸ªæ—¥å¿—ï¼Œå¯ä»¥å®‰è£… SkyWalking Web UI è¿›è¡ŒæŸ¥çœ‹ã€‚</p><p>å‚è€ƒ <a href="https://github.com/OpenSkywalking/skywalking-ui#quickstart-zh" rel="external nofollow noopener noreferrer" target="_blank">ã€Šå®˜æ–¹æ–‡æ¡£ â€”â€” Sky Walking Web UIã€‹</a> å®‰è£…ã€‚</p><h1 id="6-å½©è›‹"><a href="#6-å½©è›‹" class="headerlink" title="6. å½©è›‹"></a>6. å½©è›‹</h1><p>SkyWalking ç¯å¢ƒæ­å»ºå®Œæˆï¼Œèƒ–å‹ä»¬å¯ä»¥èµ·é£ï¼Œæºç è¯»èµ·æ¥ã€‚</p><p>è¿™ä¼šæ˜¯ä¸ªç³»åˆ—æ–‡ç« ï¼Œç¬”è€…ä¼šæ…¢æ…¢æ›´æ–°ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_01/08.png" alt=""></p><p>å¦‚ä¸‹æ˜¯ç¬”è€…å¯¹ä»£ç é‡å’Œç”¨é€”çš„ç®€å•æ•´ç†ï¼Œå®Œå–„åº¦æ¯”è¾ƒä½ï¼Œå¯èƒ½æœ‰ä¸€ä¸¢ä¸¢çš„å¸®åŠ© ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_07_01/09.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‘˜è¦: åŸåˆ›å‡ºå¤„ &lt;a href=&quot;http://www.iocoder.cn/SkyWalking/build-debugging-environment/&quot;&gt;http://www.iocoder.cn/SkyWalking/build-debugging-environ
      
    
    </summary>
    
      <category term="SkyWalking" scheme="http://www.iocoder.cn/categories/SkyWalking/"/>
    
    
  </entry>
  
</feed>
