<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="google-site-verification" content="GkJ68PCnxM9Ih7Zm9v8p91FOCV7ymNCO2KdGbflLh3E"><meta name="360-site-verification" content="dd6547587641bfede036f7c79561e8a0"><meta name="shenma-site-verification" content="fd96cf3751972c9b05f8471d2ccadddc_1496951214"><meta name="msvalidate.01" content="1D38B05050A977F6FDEDA481198343F1"><meta name="sogou_site_verification" content="MpPsku240L"><title>SkyWalking æºç åˆ†æ â€”â€” JVM æŒ‡æ ‡çš„æ”¶é›†ä¸å­˜å‚¨ | èŠ‹é“æºç  â€”â€” çº¯æºç è§£æåšå®¢</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3,minimum-scale=1"><meta name="author" content="èŠ‹é“æºç "><meta name="description" content="æ‘˜è¦: åŸåˆ›å‡ºå¤„ http://www.iocoder.cn/SkyWalking/jvm-collect/ ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼
æœ¬æ–‡ä¸»è¦åŸºäº SkyWalking 3.2.6 æ­£å¼ç‰ˆ

1. æ¦‚è¿°
2. Agent æ”¶é›† JVM æŒ‡æ ‡

2.1 JVMService
2.2 C"><meta name="keywords" content="Java,æ¶æ„,åç«¯,æœåŠ¡ç«¯,RocketMQ,MyCAT,åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—,åˆ†å¸ƒå¼å­˜å‚¨,æŠ€æœ¯åšå®¢,Sharding-JDBC,åˆ†åº“åˆ†è¡¨"><link rel="alternate" href="atom.xml" title="èŠ‹é“æºç  â€”â€” çº¯æºç è§£æåšå®¢" type="application/atom+xml"><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/style.css"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?9e70e3362807c1bd185a79655b307027";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>!function(){var t="http:"==document.location.protocol?"http://js.passport.qihucdn.com/11.0.1.js?f05b61dd54bbc38386611a5238672938":"https://jspassport.ssl.qhimg.com/11.0.1.js?f05b61dd54bbc38386611a5238672938";document.write('<script src="'+t+'" id="sozz"><\/script>')}()</script><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></head></html><body><header><div><div id="textlogo"><h1 class="site-name"><a href="/" title="èŠ‹é“æºç  â€”â€” çº¯æºç è§£æåšå®¢">èŠ‹é“æºç  â€”â€” çº¯æºç è§£æåšå®¢</a></h1><a class="blog-motto">æ„¿åŠç”Ÿç¼–ç ï¼Œå¦‚ä¸€ç”Ÿè€å‹ï¼</a></div><div class="navbar"><a class="navbutton navmobile" href="#" title="èœå•"></a></div><nav class="animated"><ul><ul><li><a href="/">æ–‡ç« </a></li><li><a href="/2018-meet-you">çŸ¥è¯†æ˜Ÿçƒ</a></li><li><a href="https://github.com/YunaiV" rel="external nofollow noopener noreferrer" target="_blank">Github</a></li><li><a href="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31_bak.jpg">å¾®ä¿¡å…¬ä¼—å·</a></li><li><a href="/categories/%E5%B7%A5%E4%BD%9C%E5%86%85%E6%8E%A8/">å·¥ä½œå†…æ¨</a></li><li><a href="/link_url">å‹é“¾</a></li></ul></ul></nav></div></header><div id="container"><div id="main" class="post" itemscope="" itemprop="blogPost"><article itemprop="articleBody"><header class="article-info clearfix"><h1 itemprop="name"><a href="/SkyWalking/jvm-collect/" title="SkyWalking æºç åˆ†æ â€”â€” JVM æŒ‡æ ‡çš„æ”¶é›†ä¸å­˜å‚¨" itemprop="url">SkyWalking æºç åˆ†æ â€”â€” JVM æŒ‡æ ‡çš„æ”¶é›†ä¸å­˜å‚¨</a></h1><p class="article-author"></p><p class="article-time">æ€»é˜…è¯»é‡:<span id="busuanzi_value_page_pv"></span>æ¬¡</p></header><div class="article-content"><p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ http://www.iocoder.cn/SkyWalking/jvm-collect/ ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><p><strong>æœ¬æ–‡ä¸»è¦åŸºäº SkyWalking 3.2.6 æ­£å¼ç‰ˆ</strong></p><ul><li><a href="http://www.iocoder.cn/SkyWalking/jvm-collect/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/SkyWalking/jvm-collect/">2. Agent æ”¶é›† JVM æŒ‡æ ‡</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/jvm-collect/">2.1 JVMService</a></li><li><a href="http://www.iocoder.cn/SkyWalking/jvm-collect/">2.2 CPU</a></li><li><a href="http://www.iocoder.cn/SkyWalking/jvm-collect/">2.3 Memory</a></li><li><a href="http://www.iocoder.cn/SkyWalking/jvm-collect/">2.4 MemoryPool</a></li><li><a href="http://www.iocoder.cn/SkyWalking/jvm-collect/">2.5 GC</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/jvm-collect/">3. Collector å­˜å‚¨ JVM æŒ‡æ ‡</a><ul><li><a href="http://www.iocoder.cn/SkyWalking/jvm-collect/">3.1 JVMMetricsServiceHandler</a></li><li><a href="http://www.iocoder.cn/SkyWalking/jvm-collect/">3.2 CPU</a></li><li><a href="http://www.iocoder.cn/SkyWalking/jvm-collect/">3.3 Memory</a></li><li><a href="http://www.iocoder.cn/SkyWalking/jvm-collect/">3.4 MemoryPool</a></li><li><a href="http://www.iocoder.cn/SkyWalking/jvm-collect/">3.5 GC</a></li></ul></li><li><a href="http://www.iocoder.cn/SkyWalking/jvm-collect/">4. å¿ƒè·³</a></li><li><a href="http://www.iocoder.cn/SkyWalking/jvm-collect/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š</p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨</li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong></li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚</li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚</li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>SkyWalking JVM æŒ‡æ ‡çš„æ”¶é›†ä¸å­˜å‚¨</strong>ã€‚å¤§ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>Agent æ¯ç§’å®šæ—¶æ”¶é›† JVM æŒ‡æ ‡åˆ°ç¼“å†²é˜Ÿåˆ—ã€‚</li><li>Agent æ¯ç§’å®šæ—¶å°†ç¼“å†²é˜Ÿåˆ—çš„ JVM æŒ‡æ ‡å‘é€åˆ° Collector ã€‚</li><li>Collector æ¥æ”¶åˆ° JVM æŒ‡æ ‡ï¼Œå¼‚æ­¥æ‰¹é‡å­˜å‚¨åˆ°å­˜å‚¨å™¨( ä¾‹å¦‚ï¼ŒES )ã€‚</li></ul><p>ç›®å‰ JVM æŒ‡æ ‡åŒ…æ‹¬<strong>å››ä¸ªç»´åº¦</strong>ï¼š</p><ul><li>CPU</li><li>Memory</li><li>MemoryPool</li><li>GC</li></ul><p>SkyWalking UI ç•Œé¢å¦‚ä¸‹ï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_10_20/02.png" alt=""></p><h1>2. Agent æ”¶é›† JVM æŒ‡æ ‡</h1><h2>2.1 JVMService</h2><p><a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/JVMService.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.jvm.JVMService</code></a> ï¼Œå®ç° BootService ã€Runnable æ¥å£ï¼ŒJVM æŒ‡æ ‡æœåŠ¡ï¼Œè´Ÿè´£å°† JVM æŒ‡æ ‡æ”¶é›†å¹¶å‘é€ç»™ Collector ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul><li><code>queue</code> å±æ€§ï¼Œæ”¶é›†æŒ‡æ ‡é˜Ÿåˆ—ã€‚</li><li><code>collectMetricFuture</code> å±æ€§ï¼Œæ”¶é›†æŒ‡æ ‡å®šæ—¶ä»»åŠ¡ã€‚</li><li><code>sendMetricFuture</code> å±æ€§ï¼Œå‘é€æŒ‡æ ‡å®šæ—¶ä»»åŠ¡ã€‚</li><li><code>sender</code> å±æ€§ï¼Œå‘é€å™¨ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/JVMService.java#L79" rel="external nofollow noopener noreferrer" target="_blank"><code>#beforeBoot()</code></a> æ–¹æ³•ï¼Œåˆå§‹åŒ– <code>queue</code> ï¼Œ<code>sender</code> å±æ€§ï¼Œå¹¶å°†è‡ªå·±æ·»åŠ åˆ° GRPCChannelManager ï¼Œä»è€Œç›‘å¬ä¸ Collector çš„è¿æ¥çŠ¶æ€ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/JVMService.java#L86" rel="external nofollow noopener noreferrer" target="_blank"><code>boot</code></a> æ–¹æ³•ï¼Œåˆ›å»ºä¸¤ä¸ªå®šæ—¶ä»»åŠ¡ï¼š</p><ul><li>ç¬¬ 88 è‡³ 90 è¡Œï¼šåˆ›å»ºæ”¶é›†æŒ‡æ ‡å®šæ—¶ä»»åŠ¡ï¼Œ0 ç§’å»¶è¿Ÿï¼Œ1 ç§’é—´éš”ï¼Œè°ƒç”¨ <code>JVMService#run()</code> æ–¹æ³•ã€‚</li><li>ç¬¬ 92 è‡³ 94 è¡Œï¼šåˆ›å»ºå‘é€æŒ‡æ ‡å®šæ—¶ä»»åŠ¡ï¼Œ0 ç§’å»¶è¿Ÿï¼Œ1 ç§’é—´éš”ï¼Œè°ƒç”¨ <code>Sender#run()</code> æ–¹æ³•ã€‚</li></ul><h3>2.1.1 å®šæ—¶æ”¶é›†</h3><p><a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/JVMService.java#L109" rel="external nofollow noopener noreferrer" target="_blank"><code>JVMService#run()</code></a> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 110 è‡³ 111 è¡Œï¼šåº”ç”¨å®ä¾‹æ³¨å†Œåï¼Œæ‰æ”¶é›† JVM æŒ‡æ ‡ã€‚</li><li>ç¬¬ 116 è‡³ 122 è¡Œï¼šåˆ›å»º JVMMetric å¯¹è±¡ã€‚<ul><li>ç¬¬ 118 è¡Œï¼šè°ƒç”¨ <code>CPUProvider#getCpuMetric()</code> æ–¹æ³•ï¼Œè·å¾— GC æŒ‡æ ‡ã€‚</li><li>ç¬¬ 119 è¡Œï¼šè°ƒç”¨ <code>MemoryProvider#getMemoryMetricList()</code> æ–¹æ³•ï¼Œè·å¾— Memory æŒ‡æ ‡ã€‚</li><li>ç¬¬ 120 è¡Œï¼šè°ƒç”¨ <code>MemoryPoolProvider#getMemoryPoolMetricList()</code> æ–¹æ³•ï¼Œè·å¾— MemoryPool æŒ‡æ ‡ã€‚</li><li>ç¬¬ 121 è¡Œï¼šè°ƒç”¨ <code>GCProvider#getGCList()</code> æ–¹æ³•ï¼Œè·å¾— GC æŒ‡æ ‡ã€‚</li></ul></li><li>ç¬¬ 125 è‡³ 128 è¡Œï¼šæäº¤ JVMMetric å¯¹è±¡åˆ°æ”¶é›†æŒ‡æ ‡é˜Ÿåˆ—ã€‚</li></ul><h3>2.1.2 å®šæ—¶å‘é€</h3><p><a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/JVMService.java#L135" rel="external nofollow noopener noreferrer" target="_blank"><code>JVMService.Sender</code></a> ï¼Œå®ç° Runnable ã€GRPCChannelListener æ¥å£ï¼ŒJVM æŒ‡æ ‡å‘é€å™¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul><li><code>status</code> å±æ€§ï¼Œè¿æ¥çŠ¶æ€ã€‚</li><li><code>stub</code> å±æ€§ï¼Œ<strong>é˜»å¡</strong> Stub ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/JVMService.java#L171" rel="external nofollow noopener noreferrer" target="_blank"><code>#statusChanged(GRPCChannelStatus)</code></a> æ–¹æ³•ï¼Œå½“è¿æ¥æˆåŠŸæ—¶ï¼Œåˆ›å»º<strong>é˜»å¡</strong> Stub ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/JVMService.java#L147" rel="external nofollow noopener noreferrer" target="_blank"><code>#run()</code></a> æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š<ul><li>ç¬¬ 148 è‡³ 151 è¡Œï¼šåº”ç”¨å®ä¾‹æ³¨å†Œåï¼Œå¹¶ä¸”è¿æ¥ä¸­ï¼Œæ‰å‘é€ JVM æŒ‡æ ‡ã€‚</li><li>ç¬¬ 153 è‡³ 155 è¡Œï¼šè°ƒç”¨ <code>#drainTo(Collection)</code> æ–¹æ³•ï¼Œä»é˜Ÿåˆ—ç§»é™¤æ‰€æœ‰ JVMMetric åˆ° <code>buffer</code> æ•°ç»„ã€‚</li><li>ç¬¬ 157 è‡³ 162 è¡Œï¼šä½¿ç”¨ Stub ï¼Œ<strong>æ‰¹é‡</strong>å‘é€åˆ° Collector ã€‚</li></ul></li></ul><h2>2.2 CPU</h2><p><a href="https://github.com/YunaiV/skywalking/blob/d10357a372d8178ff205a2272d2cb7d57bc8f605/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/cpu/CPUProvider.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.jvm.cpu.CPUProvider</code></a> ï¼ŒCPU æä¾›è€…ï¼Œæä¾› <a href="https://github.com/YunaiV/skywalking/blob/d10357a372d8178ff205a2272d2cb7d57bc8f605/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/cpu/CPUProvider.java#L50" rel="external nofollow noopener noreferrer" target="_blank"><code>#getCpuMetric()</code></a> æ–¹æ³•ï¼Œé‡‡é›† CPU æŒ‡æ ‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_10_20/05.png" alt=""></p><ul><li><code>usagePercent</code> ï¼šJVM è¿›ç¨‹å ç”¨ CPU ç™¾åˆ†æ¯”ã€‚</li><li>ç¬¬ 51 è¡Œï¼šè°ƒç”¨ <code>CPUMetricAccessor#getCPUMetric()</code> æ–¹æ³•ï¼Œè·å¾— CPU æŒ‡æ ‡ã€‚</li></ul><p>åœ¨ <a href="https://github.com/YunaiV/skywalking/blob/d10357a372d8178ff205a2272d2cb7d57bc8f605/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/cpu/CPUProvider.java#L35" rel="external nofollow noopener noreferrer" target="_blank">CPUProvider æ„é€ æ–¹æ³•</a> ä¸­ï¼Œåˆå§‹åŒ– <code>cpuMetricAccessor</code> æ•°é‡ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 37 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/os/ProcessorUtil.java#L27" rel="external nofollow noopener noreferrer" target="_blank"><code>ProcessorUtil#getNumberOfProcessors()</code></a> æ–¹æ³•ï¼Œè·å¾— CPU æ•°é‡ã€‚</li><li>ç¬¬ 40 è‡³ 42 è¡Œï¼šåˆ›å»º SunCpuAccessor å¯¹è±¡ã€‚</li><li>ç¬¬ 44 è‡³ 46 è¡Œï¼šå‘ç”Ÿå¼‚å¸¸ï¼Œè¯´æ˜ä¸æ”¯æŒï¼Œåˆ›å»º NoSupportedCPUAccessor å¯¹è±¡ã€‚</li><li><strong>ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨ <code>ClassLoader#loadClass(className)</code> æ–¹æ³•å‘¢</strong>ï¼Ÿå› ä¸º SkyWalking Agent æ˜¯é€šè¿‡ JavaAgent æœºåˆ¶ï¼Œå®é™…æœªå¼•å…¥ï¼Œæ‰€ä»¥é€šè¿‡è¯¥æ–¹å¼åŠ è½½ç±»ã€‚</li></ul><h3>2.2.1 CPUMetricAccessor</h3><p><a href="https://github.com/YunaiV/skywalking/blob/d10357a372d8178ff205a2272d2cb7d57bc8f605/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/cpu/CPUMetricAccessor.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.jvm.cpu.CPUMetricAccessor</code></a> ï¼ŒCPU æŒ‡æ ‡è®¿é—®å™¨<strong>æŠ½è±¡ç±»</strong>ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul><li><code>lastCPUTimeNs</code> å±æ€§ï¼Œè·å¾—è¿›ç¨‹å ç”¨ CPU æ—¶é•¿ï¼Œå•ä½ï¼šçº³ç§’ã€‚</li><li><code>lastSampleTimeNs</code> å±æ€§ï¼Œæœ€åé‡‡æ ·æ—¶é—´ï¼Œå•ä½ï¼šçº³ç§’ã€‚</li><li><code>cpuCoreNum</code> å±æ€§ï¼ŒCPU æ•°é‡ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/d10357a372d8178ff205a2272d2cb7d57bc8f605/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/cpu/CPUMetricAccessor.java#L47" rel="external nofollow noopener noreferrer" target="_blank"><code>#init()</code></a> æ–¹æ³•ï¼Œåˆå§‹åŒ– <code>lastCPUTimeNs</code> ã€<code>lastSampleTimeNs</code> ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/d10357a372d8178ff205a2272d2cb7d57bc8f605/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/cpu/CPUMetricAccessor.java#L55" rel="external nofollow noopener noreferrer" target="_blank"><code>#getCpuTime()</code></a> æŠ½è±¡æ–¹æ³•ï¼Œè·å¾— CPU å ç”¨æ—¶é—´ï¼Œç”±å­ç±»å®Œæˆã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/d10357a372d8178ff205a2272d2cb7d57bc8f605/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/cpu/CPUMetricAccessor.java#L57" rel="external nofollow noopener noreferrer" target="_blank"><code>#getCPUMetric()</code></a> æ–¹æ³•ï¼Œè·å¾— CPU æŒ‡æ ‡ã€‚æ”¾åœ¨å’Œ SunCpuAccessor ä¸€èµ·åˆ†äº«ã€‚è¿™é‡Œæˆ‘å…ˆè®°å¾—ï¼ŒJVM è¿›ç¨‹å ç”¨ CPU ç‡çš„è®¡ç®—å…¬å¼ï¼š<code>è¿›ç¨‹ CPU å ç”¨æ€»æ—¶é—´ / ( è¿›ç¨‹å¯åŠ¨æ€»æ—¶é—´ * CPU æ•°é‡)</code> ã€‚</li></ul><hr><p>CPUMetricAccessor æœ‰ä¸¤ä¸ªå­ç±»ï¼Œå®é™…ä¸Šæ–‡æˆ‘ä»¬å·²ç»çœ‹åˆ°å®ƒçš„åˆ›å»ºï¼š</p><ul><li>SunCpuAccessor ï¼ŒåŸºäº SUN æä¾›çš„æ–¹æ³•ï¼Œè·å– CPU æŒ‡æ ‡è®¿é—®å™¨ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/d10357a372d8178ff205a2272d2cb7d57bc8f605/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/cpu/NoSupportedCPUAccessor.java" rel="external nofollow noopener noreferrer" target="_blank">NoSupportedCPUAccessor</a> ï¼Œä¸æ”¯æŒçš„ CPU æŒ‡æ ‡è®¿é—®å™¨ã€‚å› æ­¤ï¼Œä½¿ç”¨è¯¥ç±»çš„æƒ…å†µä¸‹ï¼Œè·å–ä¸åˆ°å…·ä½“çš„è¿›ç¨‹ CPU å ç”¨ç‡ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/d10357a372d8178ff205a2272d2cb7d57bc8f605/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/cpu/SunCpuAccessor.java#L31" rel="external nofollow noopener noreferrer" target="_blank">SunCpuAccessor æ„é€ æ–¹æ³•</a> ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li><p>ç¬¬ 32 è¡Œï¼šè®¾ç½® CPU æ•°é‡ã€‚</p></li><li><p>ç¬¬ 33 è¡Œï¼šè·å¾— OperatingSystemMXBean å¯¹è±¡ã€‚é€šè¿‡è¯¥å¯¹è±¡ï¼Œåœ¨ <a href="https://github.com/YunaiV/skywalking/blob/d10357a372d8178ff205a2272d2cb7d57bc8f605/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/cpu/SunCpuAccessor.java#L38" rel="external nofollow noopener noreferrer" target="_blank"><code>#getCpuTime()</code></a> å®ç°æ–¹æ³•ï¼Œè°ƒç”¨ <a href="https://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/OperatingSystemMXBean.html#getProcessCpuTime()" rel="external nofollow noopener noreferrer" target="_blank"><code>OperatingSystemMXBean#getProcessCpuTime()</code></a> æ–¹æ³•ï¼Œè·å¾— JVM è¿›ç¨‹å ç”¨ CPU æ€»æ—¶é•¿ã€‚</p><blockquote><p>long getProcessCpuTime()</p><p>Returns the CPU time used by the process on which the Java virtual machine is running in nanoseconds. The returned value is of nanoseconds precision but not necessarily nanoseconds accuracy. This method returns -1 if the the platform does not support this operation.</p><p><strong>Returns</strong>:<br>the CPU time used by the process in nanoseconds, or -1 if this operation is not supported.</p></blockquote></li><li><p>ç¬¬ 34 è¡Œï¼šè°ƒç”¨ <code>#init()</code> æ–¹æ³•ï¼Œåˆå§‹åŒ– <code>lastCPUTimeNs</code> ã€<code>lastSampleTimeNs</code> ã€‚</p></li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/d10357a372d8178ff205a2272d2cb7d57bc8f605/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/cpu/CPUMetricAccessor.java#L57" rel="external nofollow noopener noreferrer" target="_blank"><code>#getCPUMetric()</code></a> æ–¹æ³•ï¼Œè·å¾— CPU æŒ‡æ ‡ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 58 è‡³ 59 è¡Œï¼šè·å¾— JVM è¿›ç¨‹å ç”¨ CPU æ€»æ—¶é•¿ã€‚</li><li>ç¬¬ 64 è¡Œï¼š<code>now - lastSampleTimeNs</code> ï¼Œè·å¾— JVM è¿›ç¨‹å¯åŠ¨æ€»æ—¶é•¿ã€‚</li><li><strong>è¿™é‡Œä¸ºä»€ä¹ˆç›¸å‡å‘¢</strong>ï¼Ÿå› ä¸º CPUMetricAccessor ä¸æ˜¯åœ¨ JVM å¯åŠ¨æ—¶å°±è¿›è¡Œè®¡ç®—ï¼Œé€šè¿‡ç›¸å‡ï¼Œè§£å†³åå·®ã€‚</li><li>ç¬¬ 63 è‡³ 64 è¡Œï¼šè®¡ç®— JVM è¿›ç¨‹å ç”¨ CPU ç‡ã€‚</li></ul><h2>2.3 Memory</h2><p><a href="https://github.com/YunaiV/skywalking/blob/ac31b37208b33a06616e580dfc71e2079531a2a6/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memory/MemoryProvider.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.jvm.memory.MemoryProvider</code></a> ï¼ŒMemory æä¾›è€…ï¼Œæä¾› <a href="https://github.com/YunaiV/skywalking/blob/ac31b37208b33a06616e580dfc71e2079531a2a6/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memory/MemoryProvider.java#L40" rel="external nofollow noopener noreferrer" target="_blank"><code>#getMemoryMetricList()</code></a> æ–¹æ³•ï¼Œé‡‡é›† Memory æŒ‡æ ‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_10_20/07.png" alt=""></p><ul><li>æ¨èé˜…è¯»æ–‡ç« ï¼š<ul><li><a href="https://docs.oracle.com/javase/7/docs/api/java/lang/management/MemoryUsage.html" rel="external nofollow noopener noreferrer" target="_blank">MemoryUsage</a></li><li><a href="http://blog.sina.com.cn/s/blog_ad7c19000102vjcw.html" rel="external nofollow noopener noreferrer" target="_blank">Javaä¸­ç›‘æ§ç¨‹åºå†…å­˜çš„å‡½æ•°</a></li><li><a href="http://zhanjindong.com/2016/03/02/jvm-memory-tunning-notes" rel="external nofollow noopener noreferrer" target="_blank">JVMå†…å­˜è°ƒä¼˜ç›¸å…³çš„ä¸€äº›ç¬”è®°ï¼ˆæ‚ï¼‰</a></li></ul></li><li><code>isHeap</code> ï¼šæ˜¯å¦å †å†…å†…å­˜ã€‚</li><li><code>init</code> ï¼šåˆå§‹åŒ–çš„å†…å­˜æ•°é‡ã€‚</li><li><code>max</code> ï¼šæœ€å¤§çš„å†…å­˜æ•°é‡ã€‚</li><li><code>used</code> ï¼šå·²ä½¿ç”¨çš„å†…å­˜æ•°é‡ã€‚</li><li><code>committed</code> ï¼šå¯ä»¥ä½¿ç”¨çš„å†…å­˜æ•°é‡ã€‚</li><li>ç¬¬ 44 è‡³ 51 è¡Œï¼šä½¿ç”¨ MemoryMXBean å¯¹è±¡ï¼Œè·å¾—å †å†…( Heap )å†…å­˜ã€‚</li><li>ç¬¬ 54 è‡³ 61 è¡Œï¼šä½¿ç”¨ MemoryMXBean å¯¹è±¡ï¼Œè·å¾—éå †å†…( None-Heap )å†…å­˜ã€‚</li></ul><h2>2.4 MemoryPool</h2><p><a href="https://github.com/YunaiV/skywalking/blob/868b01dbabccb8dd81031914d1536cb2393e9ab5/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/MemoryPoolProvider.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.jvm.memorypool.MemoryPoolProvider</code></a> ï¼ŒMemoryPool æä¾›è€…ï¼Œæä¾› <a href="https://github.com/YunaiV/skywalking/blob/868b01dbabccb8dd81031914d1536cb2393e9ab5/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/MemoryPoolProvider.java#L52" rel="external nofollow noopener noreferrer" target="_blank"><code>#getMemoryPoolMetricList()</code></a> æ–¹æ³•ï¼Œé‡‡é›† MemoryPool æŒ‡æ ‡<strong>æ•°ç»„</strong>ï¼Œå¦‚ä¸‹å›¾ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_10_20/09.png" alt=""></p><ul><li>æ¨èé˜…è¯»æ–‡ç« ï¼š<ul><li><a href="JVM%E5%A0%86%E5%86%85%E5%AD%98%E5%92%8C%E9%9D%9E%E5%A0%86%E5%86%85%E5%AD%98">MemoryUsage</a></li></ul></li><li><code>type</code> ï¼šå†…å­˜åŒºåŸŸç±»å‹ã€‚MemoryPool å’Œ Memory çš„å·®åˆ«åœ¨äºæ‹†åˆ†çš„ç»´åº¦ä¸åŒï¼Œå¦‚ä¸‹å›¾ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_10_20/11.png" alt=""></li><li><code>init</code> ï¼šåˆå§‹åŒ–çš„å†…å­˜æ•°é‡ã€‚</li><li><code>max</code> ï¼šæœ€å¤§çš„å†…å­˜æ•°é‡ã€‚</li><li><code>used</code> ï¼šå·²ä½¿ç”¨çš„å†…å­˜æ•°é‡ã€‚</li><li><code>committed</code> ï¼šå¯ä»¥ä½¿ç”¨çš„å†…å­˜æ•°é‡ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/868b01dbabccb8dd81031914d1536cb2393e9ab5/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/MemoryPoolProvider.java#L36" rel="external nofollow noopener noreferrer" target="_blank">MemoryPoolProvider æ„é€ æ–¹æ³•</a>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 38 è¡Œï¼šè·å¾— MemoryPoolMXBean æ•°ç»„ã€‚æ¯ä¸ª MemoryPoolMXBean å¯¹è±¡ï¼Œä»£è¡¨ä¸Šé¢çš„ä¸€ä¸ªåŒºåŸŸç±»å‹ã€‚</li><li>ç¬¬ 39 è‡³ 46 è¡Œï¼šå¾ªç¯ MemoryPoolMXBean æ•°ç»„ï¼Œè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/868b01dbabccb8dd81031914d1536cb2393e9ab5/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/MemoryPoolProvider.java#L56" rel="external nofollow noopener noreferrer" target="_blank"><code>#findByBeanName(name)</code></a> æ–¹æ³•ï¼Œæ‰¾åˆ°å¯¹åº”çš„ GC ç®—æ³•ï¼Œåˆ›å»ºå¯¹åº”çš„ MemoryPoolMetricAccessor å¯¹è±¡ã€‚</li><li>ç¬¬ 47 è‡³ 49 è¡Œï¼šæœªæ‰¾åˆ°åŒ¹é…çš„ GC ç®—æ³•ï¼Œåˆ›å»º UnknownMemoryPool å¯¹è±¡ã€‚</li></ul><h3>2.4.1 MemoryPoolMetricAccessor</h3><p><a href="https://github.com/YunaiV/skywalking/blob/868b01dbabccb8dd81031914d1536cb2393e9ab5/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/MemoryPoolMetricAccessor.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.jvm.memorypool.MemoryPoolMetricAccessor</code></a> ï¼ŒMemoryPool æŒ‡æ ‡è®¿é—®å™¨<strong>æ¥å£</strong>ã€‚</p><ul><li>å®šä¹‰äº† <a href="https://github.com/YunaiV/skywalking/blob/868b01dbabccb8dd81031914d1536cb2393e9ab5/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/MemoryPoolMetricAccessor.java#L30" rel="external nofollow noopener noreferrer" target="_blank"><code>#getMemoryPoolMetricList()</code></a> æ¥å£ï¼Œè·å¾— MemoryPool æŒ‡æ ‡<strong>æ•°ç»„</strong>ã€‚</li></ul><p>MemoryPoolMetricAccessor å­ç±»å¦‚ä¸‹å›¾ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_10_20/12.png" alt=""></p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/868b01dbabccb8dd81031914d1536cb2393e9ab5/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/UnknownMemoryPool.java" rel="external nofollow noopener noreferrer" target="_blank">UnknownMemoryPool</a> ï¼ŒæœªçŸ¥çš„ MemoryPool æŒ‡æ ‡è®¿é—®å™¨å®ç°ç±»ã€‚æ¯æ¬¡ <a href="https://github.com/YunaiV/skywalking/blob/868b01dbabccb8dd81031914d1536cb2393e9ab5/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/UnknownMemoryPool.java#L31" rel="external nofollow noopener noreferrer" target="_blank"><code>#getMemoryPoolMetricList()</code></a> æ–¹æ³•ï¼Œè¿”å› MemoryPool æŒ‡æ ‡<strong>æ•°ç»„</strong>ï¼Œä½†æ˜¯æ¯ä¸ªæŒ‡æ ‡å…ƒç´ æ˜¯æ— å…·ä½“æ•°æ®çš„ã€‚</li></ul><h3>2.4.2 MemoryPoolModule</h3><p><a href="https://github.com/YunaiV/skywalking/blob/c94fca439b748760bb7561e4fa79f2673df171a3/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/MemoryPoolModule.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.jvm.memorypool.MemoryPoolModule</code></a> ï¼Œå®ç° MemoryPoolMetricAccessor æ¥å£ï¼ŒMemoryPool æŒ‡æ ‡è®¿é—®å™¨<strong>æŠ½è±¡ç±»</strong>ã€‚ä¸åŒ GC ç®—æ³•ä¹‹é—´ï¼Œå†…å­˜åŒºåŸŸå‘½åä¸åŒï¼Œé€šè¿‡å¦‚ä¸‹<strong>å…­ä¸ª</strong>æ–¹æ³•æŠ½è±¡ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒå†…å­˜åŒºåŸŸï¼Œå½¢æˆæ˜ å°„å…³ç³»ï¼Œå±è”½å·®å¼‚ï¼š</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/c94fca439b748760bb7561e4fa79f2673df171a3/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/MemoryPoolModule.java#L85" rel="external nofollow noopener noreferrer" target="_blank"><code>#getPermNames()</code></a></li><li><a href="https://github.com/YunaiV/skywalking/blob/c94fca439b748760bb7561e4fa79f2673df171a3/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/MemoryPoolModule.java#L87" rel="external nofollow noopener noreferrer" target="_blank"><code>#getCodeCacheNames()</code></a></li><li><a href="https://github.com/YunaiV/skywalking/blob/c94fca439b748760bb7561e4fa79f2673df171a3/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/MemoryPoolModule.java#L89" rel="external nofollow noopener noreferrer" target="_blank"><code>#getEdenNames()</code></a></li><li><a href="https://github.com/YunaiV/skywalking/blob/c94fca439b748760bb7561e4fa79f2673df171a3/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/MemoryPoolModule.java#L91" rel="external nofollow noopener noreferrer" target="_blank"><code>#getOldNames()</code></a></li><li><a href="https://github.com/YunaiV/skywalking/blob/c94fca439b748760bb7561e4fa79f2673df171a3/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/MemoryPoolModule.java#L93" rel="external nofollow noopener noreferrer" target="_blank"><code>#getSurvivorNames()</code></a></li><li><a href="https://github.com/YunaiV/skywalking/blob/c94fca439b748760bb7561e4fa79f2673df171a3/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/MemoryPoolModule.java#L95" rel="external nofollow noopener noreferrer" target="_blank"><code>#getMetaspaceNames()</code></a></li><li>èƒ–å‹å¯ä»¥çœ‹çœ‹ MemoryPoolModule å­ç±»çš„å®ç°ï¼š<ul><li><a href="https://github.com/YunaiV/skywalking/blob/c94fca439b748760bb7561e4fa79f2673df171a3/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/CMSCollectorModule.java" rel="external nofollow noopener noreferrer" target="_blank">CMSCollectorModule</a></li><li><a href="https://github.com/YunaiV/skywalking/blob/c94fca439b748760bb7561e4fa79f2673df171a3/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/G1CollectorModule.java" rel="external nofollow noopener noreferrer" target="_blank">G1CollectorModule</a></li><li><a href="https://github.com/YunaiV/skywalking/blob/c94fca439b748760bb7561e4fa79f2673df171a3/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/ParallelCollectorModule.java" rel="external nofollow noopener noreferrer" target="_blank">ParallelCollectorModule</a></li><li><a href="https://github.com/YunaiV/skywalking/blob/c94fca439b748760bb7561e4fa79f2673df171a3/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/SerialCollectorModule.java" rel="external nofollow noopener noreferrer" target="_blank">SerialCollectorModule</a></li></ul></li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/c94fca439b748760bb7561e4fa79f2673df171a3/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/MemoryPoolModule.java#L41" rel="external nofollow noopener noreferrer" target="_blank"><code>#getMemoryPoolMetricList()</code></a> <strong>å®ç°æ–¹æ³•</strong>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 44 è¡Œï¼šå¾ªç¯æ¯ä¸ªå†…å­˜åŒºåŸŸï¼Œæ”¶é›†æ¯ä¸ª MemoryPool æŒ‡æ ‡ã€‚</li><li>ç¬¬ 47 è‡³ 62 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/c94fca439b748760bb7561e4fa79f2673df171a3/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/memorypool/MemoryPoolModule.java#L76" rel="external nofollow noopener noreferrer" target="_blank"><code>#contains(possibleNames, name)</code></a> æ–¹æ³•ï¼Œé€ä¸ªå†…å­˜åŒºåŸŸåå­—åˆ¤æ–­ï¼Œè·å¾—å¯¹åº”çš„å†…å­˜åŒºåŸŸç±»å‹ã€‚</li><li>ç¬¬ 65 è‡³ 71 è¡Œï¼šåˆ›å»º MemoryUsage å¯¹è±¡ï¼Œå¹¶æ·»åŠ åˆ°ç»“æœæ•°ç»„ã€‚</li></ul><h2>2.5 GC</h2><p>æ•´ä½“å®ç°ç±»ä¼¼ <a href="#">ã€Œ2.4 MemoryPoolã€</a> ã€‚</p><p><a href="https://github.com/YunaiV/skywalking/blob/73f4c2fb5fb7cf6eb533d61ba59afec66af2c9b6/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/gc/GCProvider.java#L30" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.jvm.memorypool.GCProvider</code></a> ï¼ŒGC æä¾›è€…ï¼Œæä¾› <a href="https://github.com/YunaiV/skywalking/blob/73f4c2fb5fb7cf6eb533d61ba59afec66af2c9b6/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/gc/GCProvider.java#L55" rel="external nofollow noopener noreferrer" target="_blank"><code>#getGCList()</code></a> æ–¹æ³•ï¼Œé‡‡é›† GC æŒ‡æ ‡<strong>æ•°ç»„</strong>ï¼Œå¦‚ä¸‹å›¾ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_10_20/13.png" alt=""></p><ul><li><code>phrase</code> ï¼šç”Ÿä»£ç±»å‹ï¼ŒåŒ…æ‹¬æ–°ç”Ÿä»£ã€è€ç”Ÿä»£ã€‚</li><li><code>count</code> ï¼šæ€»å›æ”¶æ¬¡æ•°ã€‚</li><li><code>time</code> ï¼šæ€»å›æ”¶å ç”¨æ—¶é—´ã€‚</li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/73f4c2fb5fb7cf6eb533d61ba59afec66af2c9b6/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/gc/GCProvider.java#L37" rel="external nofollow noopener noreferrer" target="_blank">GCProvider æ„é€ æ–¹æ³•</a>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 38 è¡Œï¼šè·å¾— GarbageCollectorMXBean æ•°ç»„ã€‚</li><li>ç¬¬ 39 è‡³ 46 è¡Œï¼šå¾ªç¯ MemoryPoolMXBean æ•°ç»„ï¼Œè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/73f4c2fb5fb7cf6eb533d61ba59afec66af2c9b6/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/gc/GCProvider.java#L59" rel="external nofollow noopener noreferrer" target="_blank"><code>#findByBeanName(name)</code></a> æ–¹æ³•ï¼Œæ‰¾åˆ°å¯¹åº”çš„ GC ç®—æ³•ï¼Œåˆ›å»ºå¯¹åº”çš„ GCMetricAccessor å¯¹è±¡ã€‚</li><li>ç¬¬ 47 è‡³ 49 è¡Œï¼šæœªæ‰¾åˆ°åŒ¹é…çš„ GC ç®—æ³•ï¼Œåˆ›å»º UnknowGC å¯¹è±¡ã€‚</li></ul><h3>2.5.1 GCMetricAccessor</h3><p><a href="https://github.com/YunaiV/skywalking/blob/73f4c2fb5fb7cf6eb533d61ba59afec66af2c9b6/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/gc/GCMetricAccessor.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.jvm.gc.GCMetricAccessor</code></a> ï¼ŒGC æŒ‡æ ‡è®¿é—®å™¨<strong>æ¥å£</strong>ã€‚</p><ul><li>å®šä¹‰äº† <a href="https://github.com/YunaiV/skywalking/blob/73f4c2fb5fb7cf6eb533d61ba59afec66af2c9b6/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/gc/GCMetricAccessor.java#L28" rel="external nofollow noopener noreferrer" target="_blank"><code>#getGCList()</code></a> æ¥å£ï¼Œè·å¾— GC æŒ‡æ ‡<strong>æ•°ç»„</strong>ã€‚</li></ul><p>GCMetricAccessor å­ç±»å¦‚ä¸‹å›¾ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_10_20/15.png" alt=""></p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/73f4c2fb5fb7cf6eb533d61ba59afec66af2c9b6/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/gc/UnknowGC.java" rel="external nofollow noopener noreferrer" target="_blank">UnknowGC</a> ï¼ŒæœªçŸ¥çš„ GC æŒ‡æ ‡è®¿é—®å™¨å®ç°ç±»ã€‚æ¯æ¬¡ <a href="https://github.com/YunaiV/skywalking/blob/73f4c2fb5fb7cf6eb533d61ba59afec66af2c9b6/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/gc/UnknowGC.java#L31" rel="external nofollow noopener noreferrer" target="_blank"><code>#getGCList()</code></a> æ–¹æ³•ï¼Œè¿”å› GC æŒ‡æ ‡<strong>æ•°ç»„</strong>ï¼Œä½†æ˜¯æ¯ä¸ªæŒ‡æ ‡å…ƒç´ æ˜¯æ— å…·ä½“æ•°æ®çš„ã€‚</li></ul><h3>2.5.2 GCModule</h3><p><a href="https://github.com/YunaiV/skywalking/blob/73f4c2fb5fb7cf6eb533d61ba59afec66af2c9b6/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/gc/GCModule.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.agent.core.jvm.gc.GCModule</code></a> ï¼Œå®ç° GCMetricAccessor æ¥å£ï¼ŒGC æŒ‡æ ‡è®¿é—®å™¨<strong>æŠ½è±¡ç±»</strong>ã€‚ä¸åŒ GC ç®—æ³•ä¹‹é—´ï¼Œç”Ÿä»£å‘½åä¸åŒï¼Œé€šè¿‡å¦‚ä¸‹<strong>ä¸¤ä¸ª</strong>æ–¹æ³•æŠ½è±¡ï¼Œåˆ†åˆ«å¯¹åº”ä¸¤ä¸ªç”Ÿä»£ï¼Œå½¢æˆæ˜ å°„å…³ç³»ï¼Œå±è”½å·®å¼‚ï¼š</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/73f4c2fb5fb7cf6eb533d61ba59afec66af2c9b6/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/gc/GCModule.java#L66" rel="external nofollow noopener noreferrer" target="_blank"><code>#getOldGCName()</code></a></li><li><a href="https://github.com/YunaiV/skywalking/blob/73f4c2fb5fb7cf6eb533d61ba59afec66af2c9b6/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/gc/GCModule.java#L68" rel="external nofollow noopener noreferrer" target="_blank"><code>#getNewGCName()</code></a></li><li>èƒ–å‹å¯ä»¥çœ‹çœ‹ GCModule å­ç±»çš„å®ç°ï¼š<ul><li><a href="https://github.com/YunaiV/skywalking/blob/73f4c2fb5fb7cf6eb533d61ba59afec66af2c9b6/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/gc/CMSGCModule.java" rel="external nofollow noopener noreferrer" target="_blank">CMSGCModule</a></li><li><a href="https://github.com/YunaiV/skywalking/blob/73f4c2fb5fb7cf6eb533d61ba59afec66af2c9b6/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/gc/G1GCModule.java" rel="external nofollow noopener noreferrer" target="_blank">G1GCModule</a></li><li><a href="https://github.com/YunaiV/skywalking/blob/73f4c2fb5fb7cf6eb533d61ba59afec66af2c9b6/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/gc/ParallelGCModule.java" rel="external nofollow noopener noreferrer" target="_blank">ParallelGCModule</a></li><li><a href="https://github.com/YunaiV/skywalking/blob/73f4c2fb5fb7cf6eb533d61ba59afec66af2c9b6/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/gc/SerialGCModule.java" rel="external nofollow noopener noreferrer" target="_blank">SerialGCModule</a></li></ul></li></ul><p><a href="https://github.com/YunaiV/skywalking/blob/73f4c2fb5fb7cf6eb533d61ba59afec66af2c9b6/apm-sniffer/apm-agent-core/src/main/java/org/skywalking/apm/agent/core/jvm/gc/GCModule.java#L39" rel="external nofollow noopener noreferrer" target="_blank"><code>#getGCList()</code></a> <strong>å®ç°æ–¹æ³•</strong>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 44 è¡Œï¼šå¾ªç¯ GarbageCollectorMXBean æ•°ç»„ï¼Œæ”¶é›†æ¯ä¸ª GC æŒ‡æ ‡ã€‚</li><li>ç¬¬ 47 è‡³ 62 è¡Œï¼šè·å¾—ç”Ÿä»£ç±»å‹ã€‚</li><li>ç¬¬ 65 è‡³ 71 è¡Œï¼šåˆ›å»º GC å¯¹è±¡ï¼Œå¹¶æ·»åŠ åˆ°ç»“æœæ•°ç»„ã€‚</li></ul><h1>3. Collector å­˜å‚¨ JVM æŒ‡æ ‡</h1><h2>3.1 JVMMetricsServiceHandler</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ API çš„å®šä¹‰ï¼Œ<a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-network/src/main/proto/JVMMetricsService.proto#L8" rel="external nofollow noopener noreferrer" target="_blank"><code>JVMMetricsService.proto</code></a> ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_10_20/01.png" alt=""></p><p><a href="https://github.com/YunaiV/skywalking/blob/c15cf5e1356c7b44a23f2146b8209ab78c2009ac/apm-collector/apm-collector-agent-grpc/collector-agent-grpc-provider/src/main/java/org/skywalking/apm/collector/agent/grpc/handler/TraceSegmentServiceHandler.java#L47" rel="external nofollow noopener noreferrer" target="_blank"><code>JVMMetricsServiceHandler#collect(JVMMetrics, StreamObserver&lt;Downstream&gt;)</code></a>, ä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 60 è¡Œï¼š<strong>å¾ªç¯</strong>æ¥æ”¶åˆ°çš„ JVMMetric <strong>æ•°ç»„</strong>ã€‚</li><li>ç¬¬ 62 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-grpc/collector-agent-grpc-provider/src/main/java/org/skywalking/apm/collector/agent/grpc/handler/JVMMetricsServiceHandler.java#L77" rel="external nofollow noopener noreferrer" target="_blank"><code>#sendToInstanceHeartBeatService(...)</code></a> æ–¹æ³•ï¼Œå‘é€å¿ƒè·³ï¼Œè®°å½•åº”ç”¨å®ä¾‹çš„æœ€åå¿ƒè·³æ—¶é—´ã€‚å› ä¸ºç›®å‰ SkyWaling ä¸»è¦ç”¨äº JVM å¹³å°ï¼Œé€šè¿‡æ¯ç§’çš„ JVM æŒ‡æ ‡æ”¶é›†çš„åŒæ—¶ï¼Œè®°å½•åº”ç”¨å®ä¾‹çš„æœ€åå¿ƒè·³æ—¶é—´ã€‚</li><li>ç¬¬ 62 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-grpc/collector-agent-grpc-provider/src/main/java/org/skywalking/apm/collector/agent/grpc/handler/JVMMetricsServiceHandler.java#L91" rel="external nofollow noopener noreferrer" target="_blank"><code>#sendToCpuMetricService(...)</code></a> æ–¹æ³•ï¼Œå¤„ç† CPU æ•°æ®ã€‚</li><li>ç¬¬ 64 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-grpc/collector-agent-grpc-provider/src/main/java/org/skywalking/apm/collector/agent/grpc/handler/JVMMetricsServiceHandler.java#L81" rel="external nofollow noopener noreferrer" target="_blank"><code>#sendToMemoryMetricService(...)</code></a> æ–¹æ³•ï¼Œå¤„ç† Memory æ•°æ®ã€‚</li><li>ç¬¬ 66 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-grpc/collector-agent-grpc-provider/src/main/java/org/skywalking/apm/collector/agent/grpc/handler/JVMMetricsServiceHandler.java#L85" rel="external nofollow noopener noreferrer" target="_blank"><code>#sendToMemoryPoolMetricService(...)</code></a> æ–¹æ³•ï¼Œå¤„ç† Memory Pool æ•°æ®ã€‚</li><li>ç¬¬ 68 è¡Œï¼šè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-grpc/collector-agent-grpc-provider/src/main/java/org/skywalking/apm/collector/agent/grpc/handler/JVMMetricsServiceHandler.java#L95" rel="external nofollow noopener noreferrer" target="_blank"><code>#sendToGCMetricService(...)</code></a> æ–¹æ³•ï¼Œå¤„ç† GC æ•°æ®ã€‚</li><li>ç¬¬ 73 è‡³ 74 è¡Œï¼šå…¨éƒ¨å¤„ç†å®Œæˆï¼Œè¿”å›æˆåŠŸã€‚</li></ul><p>ä¸Šè¿°çš„ <code>#sendToXXX()</code> æ–¹æ³•ï¼Œå†…éƒ¨æ¯ä¸ªå¯¹åº”è°ƒç”¨ä¸€ä¸ªå¦‚ä¸‹å›¾ Service æä¾›çš„æ–¹æ³•ï¼š<img src="http://www.iocoder.cn/images/SkyWalking/2020_10_20/04.png" alt=""></p><ul><li>æ¯ä¸ª Service çš„å®ç°ï¼Œå¯¹åº”ä¸€ä¸ªæ•°æ®å®ä½“å’Œä¸€ä¸ª Graph å¯¹è±¡ï¼Œé€šè¿‡æµå¼å¤„ç†ï¼Œæœ€ç»ˆå­˜å‚¨åˆ°å­˜å‚¨å™¨( ä¾‹å¦‚ ES ) ï¼Œæµç¨‹å¦‚ä¸‹å›¾ï¼š</li><li>å…·ä½“çš„å®ç°ä»£ç ï¼Œæˆ‘ä»¬æ”¾åœ¨ä¸‹é¢çš„æ•°æ®å®ä½“ä¸€èµ·åˆ†äº«ã€‚</li></ul><h2>3.2 CPU</h2><p><a href="https://github.com/YunaiV/skywalking/blob/aadff78dcde7c2e05dc8d29f3381032c1650137e/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/jvm/CpuMetric.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.table.jvm.CpuMetric</code></a> ï¼ŒCPU æŒ‡æ ‡ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/aadff78dcde7c2e05dc8d29f3381032c1650137e/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/jvm/CpuMetricTable.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.table.jvm.CpuMetricTable</code></a> ï¼Œ CpuMetric è¡¨( <code>cpu_metric</code> )ã€‚å­—æ®µå¦‚ä¸‹ï¼š<ul><li><code>instance_id</code> ï¼šåº”ç”¨å®ä¾‹ç¼–å·ã€‚</li><li><code>usage_percent</code> ï¼šCPU å ç”¨ç‡ã€‚</li><li><code>time_bucket</code> ï¼šæ—¶é—´ã€‚</li></ul></li><li><a href="https://github.com/YunaiV/skywalking/blob/3d1d1f5219205d38f58f1b59f0e81d81c038d2f1/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/CpuMetricEsPersistenceDAO.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.es.dao.CpuMetricEsPersistenceDAO</code></a> ï¼ŒCpuMetric çš„ EsDAO ã€‚</li><li>åœ¨ ES å­˜å‚¨ä¾‹å­å¦‚ä¸‹å›¾ï¼š <img src="http://www.iocoder.cn/images/SkyWalking/2020_10_20/06.png" alt=""></li><li><a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/jvm/CpuMetricService.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.agent.stream.worker.jvm.CpuMetricService</code></a> ï¼ŒCPU æŒ‡æ ‡æœåŠ¡ï¼Œè°ƒç”¨ CPUMetric å¯¹åº”çš„ <a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/graph/JvmMetricStreamGraph.java#L66" rel="external nofollow noopener noreferrer" target="_blank"><code>Graph&lt;CPUMetric&gt;</code></a> å¯¹è±¡ï¼Œæµå¼å¤„ç†ï¼Œæœ€ç»ˆ CPUMetric ä¿å­˜åˆ°å­˜å‚¨å™¨ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/jvm/CpuMetricPersistenceWorker.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.agent.stream.worker.jvm.CpuMetricPersistenceWorker</code></a> , CPU æŒ‡æ ‡æ‰¹é‡å­˜å‚¨ Worker ã€‚</li></ul><h2>3.3 Memory</h2><p><a href="https://github.com/YunaiV/skywalking/blob/0051d648dc8e5435dd63666a34da81274f0a0e61/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/jvm/MemoryMetric.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.table.jvm.MemoryMetric</code></a> ï¼ŒMemory æŒ‡æ ‡ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/0051d648dc8e5435dd63666a34da81274f0a0e61/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/jvm/MemoryMetricTable.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.table.jvm.MemoryMetricTable</code></a> ï¼Œ MemoryMetric è¡¨( <code>memory_metric</code> )ã€‚å­—æ®µå¦‚ä¸‹ï¼š<ul><li><code>instance_id</code> ï¼šåº”ç”¨å®ä¾‹ç¼–å·ã€‚</li><li><code>isHeap</code> ï¼šæ˜¯å¦å †å†…å†…å­˜ã€‚</li><li><code>init</code> ï¼šåˆå§‹åŒ–çš„å†…å­˜æ•°é‡ã€‚</li><li><code>max</code> ï¼šæœ€å¤§çš„å†…å­˜æ•°é‡ã€‚</li><li><code>used</code> ï¼šå·²ä½¿ç”¨çš„å†…å­˜æ•°é‡ã€‚</li><li><code>committed</code> ï¼šå¯ä»¥ä½¿ç”¨çš„å†…å­˜æ•°é‡ã€‚</li><li><code>time_bucket</code> ï¼šæ—¶é—´ã€‚</li></ul></li><li><a href="https://github.com/YunaiV/skywalking/blob/3d1d1f5219205d38f58f1b59f0e81d81c038d2f1/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/MemoryMetricEsPersistenceDAO.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.es.dao.MemoryMetricEsPersistenceDAO</code></a> ï¼ŒMemoryMetric çš„ EsDAO ã€‚</li><li>åœ¨ ES å­˜å‚¨ä¾‹å­å¦‚ä¸‹å›¾ï¼š <img src="http://www.iocoder.cn/images/SkyWalking/2020_10_20/08.png" alt=""></li><li><a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/jvm/MemoryMetricService.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.agent.stream.worker.jvm.MemoryMetricService</code></a> ï¼ŒMemory æŒ‡æ ‡æœåŠ¡ï¼Œè°ƒç”¨ MemoryMetric å¯¹åº”çš„ <a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/graph/JvmMetricStreamGraph.java#L74" rel="external nofollow noopener noreferrer" target="_blank"><code>Graph&lt;MemoryMetric&gt;</code></a> å¯¹è±¡ï¼Œæµå¼å¤„ç†ï¼Œæœ€ç»ˆ MemoryMetric ä¿å­˜åˆ°å­˜å‚¨å™¨ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/jvm/MemoryMetricPersistenceWorker.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.agent.stream.worker.jvm.MemoryMetricPersistenceWorker</code></a> , Memory æŒ‡æ ‡æ‰¹é‡å­˜å‚¨ Worker ã€‚</li></ul><h2>3.4 MemoryPool</h2><p><a href="https://github.com/YunaiV/skywalking/blob/0051d648dc8e5435dd63666a34da81274f0a0e61/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/jvm/MemoryPoolMetric.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.table.jvm.MemoryPoolMetric</code></a> ï¼ŒMemoryPool æŒ‡æ ‡ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/c94fca439b748760bb7561e4fa79f2673df171a3/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/jvm/MemoryPoolMetricTable.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.table.jvm.MemoryPoolMetricTable</code></a> ï¼Œ MemoryPool è¡¨( <code>memory_pool_metric</code> )ã€‚å­—æ®µå¦‚ä¸‹ï¼š<ul><li><code>instance_id</code> ï¼šåº”ç”¨å®ä¾‹ç¼–å·ã€‚</li><li><code>pool_type</code> ï¼šå†…å­˜åŒºåŸŸç±»å‹ã€‚</li><li><code>init</code> ï¼šåˆå§‹åŒ–çš„å†…å­˜æ•°é‡ã€‚</li><li><code>max</code> ï¼šæœ€å¤§çš„å†…å­˜æ•°é‡ã€‚</li><li><code>used</code> ï¼šå·²ä½¿ç”¨çš„å†…å­˜æ•°é‡ã€‚</li><li><code>committed</code> ï¼šå¯ä»¥ä½¿ç”¨çš„å†…å­˜æ•°é‡ã€‚</li><li><code>time_bucket</code> ï¼šæ—¶é—´ã€‚</li></ul></li><li><a href="https://github.com/YunaiV/skywalking/blob/3d1d1f5219205d38f58f1b59f0e81d81c038d2f1/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/MemoryPoolMetricEsPersistenceDAO.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.es.dao.MemoryPoolMetricEsPersistenceDAO</code></a> ï¼ŒMemoryPoolMetric çš„ EsDAO ã€‚</li><li>åœ¨ ES å­˜å‚¨ä¾‹å­å¦‚ä¸‹å›¾ï¼š <img src="http://www.iocoder.cn/images/SkyWalking/2020_10_20/10.png" alt=""></li><li><a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/jvm/MemoryPoolMetricService.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.agent.stream.worker.jvm.MemoryMetricService</code></a> ï¼ŒMemoryPoolMetric æŒ‡æ ‡æœåŠ¡ï¼Œè°ƒç”¨ MemoryPoolMetric å¯¹åº”çš„ <a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/graph/JvmMetricStreamGraph.java#L82" rel="external nofollow noopener noreferrer" target="_blank"><code>Graph&lt;MemoryPoolMetric&gt;</code></a> å¯¹è±¡ï¼Œæµå¼å¤„ç†ï¼Œæœ€ç»ˆ MemoryPoolMetric ä¿å­˜åˆ°å­˜å‚¨å™¨ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/jvm/MemoryMetricPersistenceWorker.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.agent.stream.worker.jvm.MemoryMetricPersistenceWorker</code></a> , MemoryPool æŒ‡æ ‡æ‰¹é‡å­˜å‚¨ Worker ã€‚</li></ul><h2>3.5 GC</h2><p><a href="https://github.com/YunaiV/skywalking/blob/0051d648dc8e5435dd63666a34da81274f0a0e61/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/jvm/GCMetric.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.table.jvm.GCMetric</code></a> ï¼ŒGC æŒ‡æ ‡ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/73f4c2fb5fb7cf6eb533d61ba59afec66af2c9b6/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/jvm/GCMetricTable.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.table.jvm.GCMetricTable</code></a> ï¼Œ GCMetric è¡¨( <code>gc_metric</code> )ã€‚å­—æ®µå¦‚ä¸‹ï¼š<ul><li><code>instance_id</code> ï¼šåº”ç”¨å®ä¾‹ç¼–å·ã€‚</li><li><code>phrase</code> ï¼šç”Ÿä»£ç±»å‹ï¼ŒåŒ…æ‹¬æ–°ç”Ÿä»£ã€è€ç”Ÿä»£ã€‚</li><li><code>count</code> ï¼šæ€»æ¬¡æ•°ã€‚</li><li><code>time</code> ï¼šæ€»æ—¶é—´ã€‚</li><li><code>time_bucket</code> ï¼šæ—¶é—´ã€‚</li></ul></li><li><a href="https://github.com/YunaiV/skywalking/blob/3d1d1f5219205d38f58f1b59f0e81d81c038d2f1/apm-collector/apm-collector-storage/collector-storage-es-provider/src/main/java/org/skywalking/apm/collector/storage/es/dao/GCMetricEsPersistenceDAO.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.storage.es.dao.GCMetricEsPersistenceDAO</code></a> ï¼ŒGCMetric çš„ EsDAO ã€‚</li><li>åœ¨ ES å­˜å‚¨ä¾‹å­å¦‚ä¸‹å›¾ï¼š <img src="http://www.iocoder.cn/images/SkyWalking/2020_10_20/14.png" alt=""></li><li><a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/jvm/GCMetricService.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.agent.stream.worker.jvm.GCMetricService</code></a> ï¼ŒGCMetric æŒ‡æ ‡æœåŠ¡ï¼Œè°ƒç”¨ GCMetric å¯¹åº”çš„ <a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/graph/JvmMetricStreamGraph.java#L58" rel="external nofollow noopener noreferrer" target="_blank"><code>Graph&lt;GCMetric&gt;</code></a> å¯¹è±¡ï¼Œæµå¼å¤„ç†ï¼Œæœ€ç»ˆ GCMetric ä¿å­˜åˆ°å­˜å‚¨å™¨ã€‚</li><li><a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/jvm/MemoryMetricPersistenceWorker.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.agent.stream.worker.jvm.MemoryMetricPersistenceWorker</code></a> , MemoryPool æŒ‡æ ‡æ‰¹é‡å­˜å‚¨ Worker ã€‚</li></ul><h1>4. å¿ƒè·³</h1><p>Collector åœ¨æ¥æ”¶åˆ° GC æŒ‡æ ‡ä¸Šä¼ åï¼Œè°ƒç”¨ <a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-grpc/collector-agent-grpc-provider/src/main/java/org/skywalking/apm/collector/agent/grpc/handler/JVMMetricsServiceHandler.java#L77" rel="external nofollow noopener noreferrer" target="_blank"><code>JVMMetricsServiceHandler#sendToInstanceHeartBeatService(...)</code></a> æ–¹æ³•ï¼Œå‘é€å¿ƒè·³ï¼Œè®°å½•åº”ç”¨å®ä¾‹çš„æœ€åå¿ƒè·³æ—¶é—´ã€‚å› ä¸ºç›®å‰ SkyWaling ä¸»è¦ç”¨äº JVM å¹³å°ï¼Œé€šè¿‡æ¯ç§’çš„ JVM æŒ‡æ ‡æ”¶é›†çš„åŒæ—¶ï¼Œè®°å½•åº”ç”¨å®ä¾‹çš„æœ€åå¿ƒè·³æ—¶é—´ã€‚</p><ul><li><a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/worker/jvm/InstanceHeartBeatService.java" rel="external nofollow noopener noreferrer" target="_blank"><code>org.skywalking.apm.collector.agent.stream.worker.jvm.InstanceHeartBeatService</code></a> ï¼Œåº”ç”¨å®ä¾‹å¿ƒè·³æœåŠ¡ï¼Œè°ƒç”¨ Instance å¯¹åº”çš„ <a href="https://github.com/YunaiV/skywalking/blob/4b7d7083ca9cd89437bcca6d0c5f67f3832d60dd/apm-collector/apm-collector-agent-stream/collector-agent-stream-provider/src/main/java/org/skywalking/apm/collector/agent/stream/graph/JvmMetricStreamGraph.java#L90" rel="external nofollow noopener noreferrer" target="_blank"><code>Graph&lt;Instance&gt;</code></a> å¯¹è±¡ï¼Œæµå¼å¤„ç†ï¼Œæœ€ç»ˆæ›´æ–° Instance çš„æœ€å<strong>å¿ƒè·³æ—¶é—´</strong>( <a href="https://github.com/YunaiV/skywalking/blob/73f4c2fb5fb7cf6eb533d61ba59afec66af2c9b6/apm-collector/apm-collector-storage/collector-storage-define/src/main/java/org/skywalking/apm/collector/storage/table/register/InstanceTable.java#L42" rel="external nofollow noopener noreferrer" target="_blank"><code>heartbeat_time</code></a> )åˆ°å­˜å‚¨å™¨ã€‚</li></ul><h1>666. å½©è›‹</h1><p>æ¯”æƒ³è±¡ä¸­å†—é•¿çš„æ–‡ç« ï¼Œæœ‰äº›è€ƒéªŒè€å¿ƒï¼Œå¿ƒç–¼ SkyWalking å¼€å‘è€… 30 ç§’ã€‚</p><p><img src="http://www.iocoder.cn/images/SkyWalking/2020_10_20/16.png" alt=""></p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸ªæœ‹å‹åœˆå¯å¥½ï¼Ÿ</p></div><footer class="article-footer clearfix"><div class="article-categories"><span></span> <a class="article-category-link" href="/categories/SkyWalking/">SkyWalking</a></div><div class="article-share" id="share"><div data-url="http://www.iocoder.cn/SkyWalking/jvm-collect/" data-title="SkyWalking æºç åˆ†æ â€”â€” JVM æŒ‡æ ‡çš„æ”¶é›†ä¸å­˜å‚¨ | èŠ‹é“æºç  â€”â€” çº¯æºç è§£æåšå®¢" data-tsina="null" class="share clearfix"></div></div></footer></article><nav class="article-nav clearfix"><div class="prev"><a href="/SkyWalking/ui-1-application/" title="SkyWalking æºç åˆ†æ â€”â€” è¿ç»´ç•Œé¢ï¼ˆä¸€ï¼‰ä¹‹åº”ç”¨è§†è§’"><strong>PREVIOUS:</strong><br><span>SkyWalking æºç åˆ†æ â€”â€” è¿ç»´ç•Œé¢ï¼ˆä¸€ï¼‰ä¹‹åº”ç”¨è§†è§’</span></a></div><div class="next"><a href="/SkyWalking/collector-store-trace/" title="SkyWalking æºç åˆ†æ â€”â€” Collector å­˜å‚¨ Trace æ•°æ®"><strong>NEXT:</strong><br><span>SkyWalking æºç åˆ†æ â€”â€” Collector å­˜å‚¨ Trace æ•°æ®</span></a></div></nav></div><div class="openaside"><a class="navbutton" href="#" title="æ˜¾ç¤ºä¾§è¾¹æ "></a></div><div id="toc" class="toc-aside"><strong class="toc-title">æ–‡ç« ç›®å½•</strong><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">1. æ¦‚è¿°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">2.</span> <span class="toc-text">2. Agent æ”¶é›† JVM æŒ‡æ ‡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 JVMService</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1.1 å®šæ—¶æ”¶é›†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.1.2 å®šæ—¶å‘é€</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 CPU</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 CPUMetricAccessor</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 Memory</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 MemoryPool</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">2.4.1.</span> <span class="toc-text">2.4.1 MemoryPoolMetricAccessor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">2.4.2.</span> <span class="toc-text">2.4.2 MemoryPoolModule</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 GC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">2.5.1.</span> <span class="toc-text">2.5.1 GCMetricAccessor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#undefined"><span class="toc-number">2.5.2.</span> <span class="toc-text">2.5.2 GCModule</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">3.</span> <span class="toc-text">3. Collector å­˜å‚¨ JVM æŒ‡æ ‡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 JVMMetricsServiceHandler</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 CPU</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 Memory</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 MemoryPool</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 GC</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">4.</span> <span class="toc-text">4. å¿ƒè·³</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">5.</span> <span class="toc-text">666. å½©è›‹</span></a></li></ol></div><div id="asidepart"><aside class="clearfix"><div id="authorInfo"><div><img width="100%" src="/images/common/wechat_mp_2017_07_31_bak.jpg"></div><div class="social-list"></div></div><div class="categorieslist"><p class="asidetitle">å¾®ä¿¡å…¬ä¼—å·ç¦åˆ©ï¼šèŠ‹é“æºç </p><ul><li><a href="/images/common/wechat_mp_2017_07_31_bak.jpg">0. é˜…è¯»æºç è‘µèŠ±å®å…¸</a></li><li><a href="/images/common/wechat_mp_2017_07_31_bak.jpg">1. RocketMQ / MyCAT / Sharding-JDBC è¯¦ç»†ä¸­æ–‡æ³¨é‡Šæºç </a></li><li><a href="/images/common/wechat_mp_2017_07_31_bak.jpg">2. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€éƒ½å°†å¾—åˆ°è®¤çœŸå›å¤</a></li><li><a href="/images/common/wechat_mp_2017_07_31_bak.jpg">3. æ–°çš„æºç è§£ææ–‡ç« å®æ—¶æ”¶åˆ°é€šçŸ¥ï¼Œæ¯å‘¨å…­åç‚¹æ›´æ–°</a></li><li><a href="/images/common/wechat_mp_2017_07_31_bak.jpg">4. è®¤çœŸçš„æºç äº¤æµå¾®ä¿¡ç¾¤</a></li></ul></div><div class="categorieslist"><p class="asidetitle">åˆ†ç±»</p><ul><li><a href="/categories/Docker/" title="Docker">Docker<sup>2</sup></a></li><li><a href="/categories/Dubbo/" title="Dubbo">Dubbo<sup>1</sup></a></li><li><a href="/categories/Elastic-Job-Cloud/" title="Elastic-Job-Cloud">Elastic-Job-Cloud<sup>6</sup></a></li><li><a href="/categories/Elastic-Job-Lite/" title="Elastic-Job-Lite">Elastic-Job-Lite<sup>16</sup></a></li><li><a href="/categories/Eureka/" title="Eureka">Eureka<sup>23</sup></a></li><li><a href="/categories/Happylifeplat-TCC/" title="Happylifeplat-TCC">Happylifeplat-TCC<sup>1</sup></a></li><li><a href="/categories/Hystrix/" title="Hystrix">Hystrix<sup>9</sup></a></li><li><a href="/categories/JUC/" title="JUC">JUC<sup>1</sup></a></li><li><a href="/categories/MyCAT/" title="MyCAT">MyCAT<sup>9</sup></a></li><li><a href="/categories/Nginx/" title="Nginx">Nginx<sup>1</sup></a></li><li><a href="/categories/RocketMQ/" title="RocketMQ">RocketMQ<sup>14</sup></a></li><li><a href="/categories/RxJava/" title="RxJava">RxJava<sup>5</sup></a></li><li><a href="/categories/Sharding-JDBC/" title="Sharding-JDBC">Sharding-JDBC<sup>18</sup></a></li><li><a href="/categories/SkyWalking/" title="SkyWalking">SkyWalking<sup>34</sup></a></li><li><a href="/categories/Spring/" title="Spring">Spring<sup>1</sup></a></li><li><a href="/categories/Spring-Cloud-Gateway/" title="Spring-Cloud-Gateway">Spring-Cloud-Gateway<sup>24</sup></a></li><li><a href="/categories/Spring-MVC/" title="Spring-MVC">Spring-MVC<sup>1</sup></a></li><li><a href="/categories/Spring-Security/" title="Spring-Security">Spring-Security<sup>1</sup></a></li><li><a href="/categories/TCC-Transaction/" title="TCC-Transaction">TCC-Transaction<sup>7</sup></a></li><li><a href="/categories/TiKV/" title="TiKV">TiKV<sup>2</sup></a></li><li><a href="/categories/å·¥ä½œå†…æ¨/" title="å·¥ä½œå†…æ¨">å·¥ä½œå†…æ¨<sup>4</sup></a></li><li><a href="/categories/æŠ€æœ¯æ‚æ–‡/" title="æŠ€æœ¯æ‚æ–‡">æŠ€æœ¯æ‚æ–‡<sup>5</sup></a></li><li><a href="/categories/èŠ‹é“æºç çš„å‘¨å¤©/" title="èŠ‹é“æºç çš„å‘¨å¤©">èŠ‹é“æºç çš„å‘¨å¤©<sup>1</sup></a></li></ul></div></aside></div></div><footer><div id="footer"><img src="http://www.iocoder.cn/images/common/wechat_mp_simple.png" style="display:none"><p class="copyright">Â© 2018 <a href="http://www.iocoder.cn" target="_blank" title="èŠ‹é“æºç ">èŠ‹é“æºç </a> && <span style="display:inline" id="busuanzi_container_site_uv">æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv" font="å¾®è½¯é›…é»‘"></span> æ¬¡</span> && <span style="display:inline" id="busuanzi_container_site_pv">æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv" font="å¾®è½¯é›…é»‘"></span> æ¬¡</span></p></div><div class="copyright">æ²ªICPå¤‡17037075å·-1</div></footer><script src="/js/jquery-2.1.0.min.js"></script><script type="text/javascript">$(document).ready(function(){function e(){"number"==typeof window.innerWidth?n=window.innerWidth:document.documentElement&&document.documentElement.clientWidth&&(n=document.documentElement.clientWidth)}$(".navbar").click(function(){$("header nav").toggleClass("shownav")});var n=0,s=$("#main"),a=$("#asidepart"),o=$(".closeaside"),d=$(".openaside");$(window).resize(function(){e(),n>=1024?$("header nav").removeClass("shownav"):(s.removeClass("moveMain"),a.css("display","block").removeClass("fadeOut"),d.css("display","none"),$("#toc.toc-aside").css("display","none"))}),o.click(function(){a.addClass("fadeOut").css("display","none"),d.css("display","block").addClass("fadeIn"),s.addClass("moveMain")}),d.click(function(){d.css("display","none").removeClass("beforeFadeIn"),a.css("display","block").removeClass("fadeOut").addClass("fadeIn"),s.removeClass("moveMain")}),$(window).scroll(function(){d.css("top",Math.max(80,260-$(this).scrollTop()))})})</script><script type="text/javascript">$(document).ready(function(){var a=$(".article-content>iframe"),t=$(".article-content>embed"),n=$("#toc");$("article h2");ah=$("article h2"),ta=$("#toc.toc-aside"),o=$(".openaside"),c=$(".closeaside"),a.length>0&&a.wrap('<div class="video-container" />'),t.length>0&&t.wrap('<div class="video-container" />'),0==ah.length?n.css("display","none"):(c.click(function(){ta.css("display","block").addClass("fadeIn")}),o.click(function(){ta.css("display","none")}),$(window).scroll(function(){ta.css("top",Math.max(140,320-$(this).scrollTop()))}))})</script><script type="text/javascript">$(document).ready(function(){var t=$(".share"),a=t.attr("data-url"),e=encodeURIComponent(a),r=['<a href="#" class="overlay" id="qrcode"></a>','<div class="qrcode clearfix"><span>æ‰«æäºŒç»´ç åˆ†äº«åˆ°å¾®ä¿¡æœ‹å‹åœˆ</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url='+e+'"/></div>','<a href="#textlogo" class="article-back-to-top" title="Top"></a>','<a href="https://www.facebook.com/sharer.php?u='+e+'" class="article-share-facebook" target="_blank" title="Facebook"></a>','<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>','<a href="https://twitter.com/intent/tweet?url='+e+'" class="article-share-twitter" target="_blank" title="Twitter"></a>','<a href="http://service.weibo.com/share/share.php?title='+t.attr("data-title")+"&url="+e+"&ralateUid="+t.attr("data-tsina")+'&searchPic=true&style=number" class="article-share-weibo" target="_blank" title="Weibo"></a>','<span title="Share to"></span>'].join("");t.append(r),$(".article-share-qrcode").click(function(){var t=$("#qrcode-pic").attr("data-src");$("#qrcode-pic").attr("src",t),$("#qrcode-pic").load(function(){$(".qrcode strong").text(" ")})})})</script><link rel="stylesheet" href="/alert/css/alert.css"><script src="/alert/js/alert.js"></script><script src="/js/jquery.cookie.js"></script><script src="/js/util.js"></script><script type="text/javascript">!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",s.parentNode.insertBefore(o,s)}(window,document,"script",0,"ga"),ga("create","UA-107572620-1","auto"),ga("send","pageview")</script></body>