# 1. 概述

本文主要分享**交易模块的[订单信息](#)的数据库实体设计**。

基于如下信息，逆向猜测数据库实体：

* [有赞云提供的商家管理订单API](https://www.youzanyun.com/apilist/list/group_trade/trade)
* [有赞云提供的买家下单API](https://www.youzanyun.com/apilist/list/group_buyer/buyer_bill)
* [有赞**微商城**的订单管理](https://www.youzan.com/v2/trade/order/index)

> 【护脸旁白】  
> 笔者非电商行业出身 && **非有赞工程师**，所以有错误或不合理的地方，烦请斧正和探讨。  
> 有赞是个各方面都很 NICE 的公司，[推荐](http://www.iocoder.cn/NeiTui/hangzhou/?self) 。

# 2. 背景了解

参见 [《订单中心设计》](https://github.com/tangxuehua/ecommerce/wiki/%E8%AE%A2%E5%8D%95%E4%B8%AD%E5%BF%83%E8%AE%BE%E8%AE%A1) ，写的非常非常非常棒。

## 2.1 界面

1. 运营后台-订单管理-所有订单  [](../../../images/Entity/2018_03_01/01.png)
2. 运营后台-订单管理-订单详情  [](../../../images/Entity/2018_03_01/02.png)

# 3. 数据库实体

TODO 此处有一类图

**注意**，不同于我们常用的[京东](http://www.jd.com)电商平台，不存在拆单的情况：

* 基于商家的拆单 [](../../../images/Entity/2018_03_01/03.png)
    * 因为有赞是一个 Saas 化的去中心化的电商系统，而不是一个中心化的电商平台，没有跨商家下单的需求
* 基于仓库的**自动**拆单 [](../../../images/Entity/2018_03_01/04.png)
    * 因为有赞买家购买的每**种**( 相同商品购买多个，也是一种 )商品都会生成一条**交易明细**，卖家可以组合排列发货。例如，买家购买了 A、B、C 商品，卖家可以按照 [A,B,C] ，也可以 [A,B]+[C]，也可以 [A]+[B]+[C] 以及等等**手动**发货。后面，我们会另外单独分享[物流](https://www.youzanyun.com/apilist/list/group_trade/logistics)这块。

关于**订单拆单**的逻辑，胖友可以阅读 [《订单拆单：把产品逻辑拆给你看》](http://www.ebrun.com/20171128/256998.shtml) 文章：

> 订单拆单在电商订单中很常见，也比较复杂。拆单也有两次：
> 
> * 一次是在用户提交订单之后、支付之前拆单，这次是拆分的订单；
> * 另一次是在用户下单之后，商家发货之前，去拆分发货单（SKU层面）。
> 
> 两次拆单的原则不同：
> 
> * 第一次拆单是为了区分平台商家、方便财务结算；
> * 第二次拆单是为了按照最后的发货包裹进行拆单，如不同仓库、不同运输要求的SKU、包裹重量体积限制等因素（第二次拆单的有些步骤也可以放在第一步）。

## 3.1 Trade

[Trade](TODO) ，交易。  
字段较多，我们进行简单的切块。

### 3.1.1 基础字段

### 3.1.x 商品信息

### 3.1.x 买家信息

### 3.1.x 收货人信息

### 3.1.x 卖家信息

### 3.1.x 支付信息

### 3.1.x 退款维权信息

### 3.1.x 优惠信息

### 3.1.x 价格信息

## 3.2 TradeOrder

# 4. API

# 666. 彩蛋

