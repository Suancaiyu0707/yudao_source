title: 数据库实体设计 —— 商品（1.2）之商品详情
date: 2018-01-23
tags:
categories: 数据库实体设计
permalink: Entity/item-module-content

-------

# 1. 概述

本文主要分享**商品模块的商品详情的数据库实体设计**。

基于 [有赞云提供的商品API](https://www.youzanyun.com/apilist/list/group_item/item) 和 [有赞**微商城**的商品管理](https://www.youzan.com/v2/showcase/goods/index#/) 逆向猜测数据库实体。

> 【护脸旁白】  
> 笔者非电商行业出身 && **非有赞工程师**，所以有错误或不合理的地方，烦请斧正和探讨。  
> 有赞是个各方面都很 NICE 的公司，[推荐](http://www.iocoder.cn/NeiTui/hangzhou/?self) 。

# 2. 背景了解

参考 [《如何使用商品页模版》](https://help.youzan.com/qa#/menu/2111/detail/859?_k=8o68j6) 。

当我们打开某个商品时，商品详情页示意图如下：

[](../../../images/Entity/2018_01_23/01.png) 

* 基本信息区：显示**商品**主页、价格等信息
* 顶部**模板**内容
* 商品详情区，每个**商品**独立编辑
* 底部**模板**内容

所以商品详情页涉及商品的详情和商品引用的模板。

## 2.1 界面

1. 商城端-商品详情页 [](../../../images/Entity/2018_01_23/02.png) 
2. 商城端-商品页模板编辑页 [](../../../images/Entity/2018_01_23/03.png) 
3. 商城端-商品详情编辑页 [](../../../images/Entity/2018_01_23/04.png) 

我们可以看出，有赞在常用的**富文本**的组件上，增加了大量易用的组件，提升商家运营的能力和空间。这点笔者觉得，非常值得借鉴与学习。

-------

良心如笔者，如下是其他电商平台的商品详情编辑页：

* 微店 [](../../../images/Entity/2018_01_23/05.png)
* 淘宝 [](../../../images/Entity/2018_01_23/06.png)

# 3. 数据库实体

整体实体类关系如下图：

[](../../../images/Entity/2018_01_23/07.png)

全部实体在 [Github 商品实体目录](todo) 下可见。

## 3.1 ItemTemplate

[ItemTemplate](todo)，商品页面模板。

```Java
/**
 * 编号 —— 普通版（内置）
 */
private static final Integer ID_STYLE_1 = - 1;
/**
 * 编号 —— 普通简洁版（内置）
 */
private static final Integer ID_SYTLE_2 = -2;

/**
 * 模板编号
 */
private Integer id;
/**
 * 别名
 *
 * 系统生成，作为唯一标识。例如，2fpa62tbmsl9h
 */
private String alias;
/**
 * 店铺编号
 */
private Integer shopId;
/**
 * 标题
 */
private String title;
/**
 * 是否展示
 */
private Boolean isDisplay;
/**
 * 状态
 *
 * 1-正常
 * 2-删除
 */
private Integer status;
/**
 * 模板元素数组
 *
 * JSON 格式，数组，每个元素为 {@link cn.iocoder.doraemon.itemgroup.item.entity.vo.AbstractItemTemplateElementVO} 的实现类字符串
 */
private String data;
/**
 * 添加时间
 */
private Date addTime;
/**
 * 最后更新时间
 */
private Date updateTime;
/**
 * 删除时间
 */
private Date deleteTime;
```

* `id` ，模板编号。系统内置了两套基础的模板：
    * `ID_STYLE_1` ，普通版 [](../../../images/Entity/2018_01_23/08.png)
    * `ID_SYTLE_2` ，普通简洁版 [](../../../images/Entity/2018_01_23/09.png)
* `shopId` ，店铺编号。每个店铺可配置属于自己的模板。
* `isDisplay` ，是否展示。目前猜测( 目前在接口上看到有该字段，管理页面里面实际不存在相关操作 )，可能内置的模板不展示。
* `status` ，状态，包含正常和删除。**笔者的习惯**，对于未来可能出现新的状态的情况，笔者使用 Integer 而不 Boolean ，例如此处可能出现**关闭**状态( `status = 3` )。
* `data` ，模板元素数组，**JSON 格式化成字符串**( 实际无根据元素进行检索，所以可以这么做 )。其中，每个元素为 [AbstractItemTemplateElementVO](TODO) 的**子类**。[](../../../images/Entity/2018_01_23/10.png)

### 3.1.1 AbstractItemTemplateElementVO

[AbstractItemTemplateElementVO](todo) ，商品页面模板元素 VO 抽象类。

```Java
/**
 * 类型
 */
private String type;
```

* `type` ，类型。每种模板元素对应一个 `type` 枚举。笔者在实际抓取接口中发现，`type = config` 的情况，实际会对应多种模板元素，并且实际无共同性，所以笔者将它们分成两类：
    * 通用组件：例如 [](../../../images/Entity/2018_01_23/11.png)
    * 模块独有组件：例如 [](../../../images/Entity/2018_01_23/12.png)

> 友情提示
> 通用组件，在 [「3.3 AbstractItemTemplateElementVO」](#) 分享
> 模块独有组件，在各自模块的文章小节里分享。

### 3.1.2 ConfigElementVO

[ConfigElementVO](todo) ，配置元素 VO 。

```Java
private static final String TYPE = "config";

/**
 * 标题
 */
private String title;
/**
 * 模板样式
 *
 * 0-普通版
 * 1-普通简洁版
 */
private Integer templateStyle;
```

* `type = config` 。
* `title` ，标题。和 ItemTemplate 的 `title` 字段一致。
* `templateStyle` ，模板样式。[](../../../images/Entity/2018_01_23/13.png)

### 3.1.3 GoodsTemplateSplitElementVO

[GoodsTemplateSplitElementVO](todo) ，商品详情区元素 VO 。

```Java
private static final String TYPE = "goods_template_split";
```

* `type = goods_template_split` 。
* 作为**商品详情区**的占位元素。[](../../../images/Entity/2018_01_23/14.png)

## 3.2 ItemContent 

[ItemContent](todo) ，商品详情。

```Java
/**
 * Item 编号
 *
 * {@link Item#id}
 */
private Integer id;
/**
 * 商品描述。
 *
 * 字数要大于5个字符，小于25000个字符 ，受违禁词控制
 */
private String desc;
/**
 * 商品页模板编号
 */
private Integer templateId;
/**
 * 模板元素数组
 *
 * JSON 格式，数组，每个元素为 {@link cn.iocoder.doraemon.itemgroup.item.entity.vo.AbstractItemTemplateElementVO} 的实现类字符串
 */
private String data;
```

* `id` ，Item 编号，1：1 指向对应的 Item 。
* `desc` ，商品描述，HTML 富文本。**考虑到数据库性能，单独成 ItemContent 表**。
* `templateId` ，ItemTemplate 编号。
* `data` ，模板元素数组，**JSON 格式化成字符串**( 实际无根据元素进行检索，所以可以这么做 )。其中，每个元素为 [AbstractItemTemplateElementVO](TODO) 的**子类**。 [](../../../images/Entity/2018_01_23/15.png)

### 3.2.1 ConfigElementVO

[ConfigElementVO](todo) ，配置元素 VO 。

```Java
private static final String TYPE = "config";

/**
 * 商品描述
 */
private String content;
```

* `type = config` 。
* `content` ，标题。和 ItemContent 的 `desc` 字段一致。
* 富文本编辑器基于 [ueditor](https://github.com/fex-team/ueditor) 定制。 [](../../../images/Entity/2018_01_23/16.png)

## 3.3 AbstractItemTemplateElementVO

### 3.3.1 ItemTemplateRichTextElementVO

[ItemTemplateRichTextElementVO](todo) ，富文本元素 VO 。

```Java
private static final String TYPE = "rich_text";

/**
 * 是否全屏
 */
private Boolean fullscreen;
/**
 * 富文本
 */
private String content;
/**
 * 背景色
 */
private String color;
```

* `type = rich_text` 。
* [](../../../images/Entity/2018_01_23/17.png)

### 3.3.2 

# 666. 彩蛋


