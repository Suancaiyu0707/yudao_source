title: ç²¾å°½ Dubbo æºç åˆ†æ â€”â€” è°ƒç”¨ç‰¹æ€§ï¼ˆä¸€ï¼‰ä¹‹å›å£°æµ‹è¯•
date: 2018-11-05
tags:
categories: Dubbo
permalink: Dubbo/rpc-feature-echo-service

-------

æ‘˜è¦: åŸåˆ›å‡ºå¤„ http://www.iocoder.cn/Dubbo/rpc-feature-echo-service/ ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

- [1. æ¦‚è¿°](http://www.iocoder.cn/Dubbo/rpc-feature-echo-service/)
- [2. æœåŠ¡æ¶ˆè´¹è€…](http://www.iocoder.cn/Dubbo/rpc-feature-echo-service/)
  - [2.1 EchoService](http://www.iocoder.cn/Dubbo/rpc-feature-echo-service/)
  - [2.2  ä½¿ç”¨ç¤ºä¾‹](http://www.iocoder.cn/Dubbo/rpc-feature-echo-service/)
- [3. æœåŠ¡æä¾›è€…](http://www.iocoder.cn/Dubbo/rpc-feature-echo-service/)
  - [3.1 EchoFilter](http://www.iocoder.cn/Dubbo/rpc-feature-echo-service/)
- [666. å½©è›‹](http://www.iocoder.cn/Dubbo/rpc-feature-echo-service/)

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š  
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨  
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**  
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚  
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚  
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

# 1. æ¦‚è¿°

æœ¬æ–‡åˆ†äº«**å›å£°æµ‹è¯•**ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹ [ã€Šç”¨æˆ·æŒ‡å— â€”â€” å›å£°æµ‹è¯•ã€‹](https://dubbo.gitbooks.io/dubbo-user-book/demos/echo-service.html) çš„å®šä¹‰ï¼š

> å›å£°æµ‹è¯•ç”¨äºæ£€æµ‹æœåŠ¡æ˜¯å¦å¯ç”¨ï¼Œå›å£°æµ‹è¯•æŒ‰ç…§æ­£å¸¸è¯·æ±‚æµç¨‹æ‰§è¡Œï¼Œèƒ½å¤Ÿæµ‹è¯•æ•´ä¸ªè°ƒç”¨æ˜¯å¦é€šç•…ï¼Œå¯ç”¨äºç›‘æ§ã€‚

# 2. æœåŠ¡æ¶ˆè´¹è€…

## 2.1 EchoService

[`com.alibaba.dubbo.rpc.service.EchoService`](https://github.com/YunaiV/dubbo/blob/master/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/service/EchoService.java) ï¼ŒEcho æœåŠ¡æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š

```Java
public interface EchoService {

    /**
     * echo test.
     *
     * @param message message.
     * @return message.
     */
    Object $echo(Object message);

}
```

> æ‰€æœ‰æœåŠ¡è‡ªåŠ¨å®ç° EchoService æ¥å£ï¼Œåªéœ€å°†ä»»æ„æœåŠ¡å¼•ç”¨å¼ºåˆ¶è½¬å‹ä¸º EchoServiceï¼Œå³å¯ä½¿ç”¨ã€‚

åœ¨ AbstractProxyFactory ä¸­ï¼Œ`#getProxy(invoker)` æ–¹æ³•ï¼Œåˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…çš„ Proxy å¯¹è±¡æ—¶ï¼Œè‡ªåŠ¨å®ç° EchoService æ¥å£ï¼Œä»£ç å¦‚ä¸‹ï¼š

![AbstractProxyFactory](http://www.iocoder.cn/images/Dubbo/2018_11_05/01.png)

## 2.2  ä½¿ç”¨ç¤ºä¾‹

> æ—ç™½å›ï¼šå¦‚ä¸‹éƒ¨åˆ†ï¼Œä»å®˜æ–¹æ–‡æ¡£ï¼Œç›´æ¥å¤åˆ¶ç²˜è´´çš„ã€‚

Spring é…ç½®ï¼š

```XML
<dubbo:reference id="memberService" interface="com.xxx.MemberService" />
```

ä»£ç ï¼š

```Java
// è¿œç¨‹æœåŠ¡å¼•ç”¨
MemberService memberService = ctx.getBean("memberService"); 

EchoService echoService = (EchoService) memberService; // å¼ºåˆ¶è½¬å‹ä¸ºEchoService

// å›å£°æµ‹è¯•å¯ç”¨æ€§
String status = echoService.$echo("OK"); 

assert(status.equals("OK"));
```

# 3. æœåŠ¡æä¾›è€…

æœåŠ¡æä¾›è€…ï¼Œæ˜¯**ä¸å®ç°** EchoService æ¥å£ï¼Œè€Œæ˜¯é€šè¿‡ EchoFilter å®ç°ã€‚

## 3.1 EchoFilter

[`com.alibaba.dubbo.rpc.filter.EchoFilter`](https://github.com/YunaiV/dubbo/blob/master/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/filter/EchoFilter.java) ï¼Œå®ç° Filter æ¥å£ï¼Œå›å£°è¿‡æ»¤å™¨ã€‚ä»£ç å¦‚ä¸‹ï¼š

```Java
@Activate(group = Constants.PROVIDER, order = -110000)
public class EchoFilter implements Filter {

    @Override
    public Result invoke(Invoker<?> invoker, Invocation inv) throws RpcException {
        // æ–¹æ³•åä¸º `$echo` ï¼Œå‚æ•°åªæœ‰ä¸€ä¸ª
        if (inv.getMethodName().equals(Constants.$ECHO) && inv.getArguments() != null && inv.getArguments().length == 1) {
            return new RpcResult(inv.getArguments()[0]);
        }
        return invoker.invoke(inv);
    }

}
```

* ä½¿ç”¨ Dubbo SPI Adaptive æœºåˆ¶ï¼Œ**è‡ªåŠ¨åŠ è½½**ï¼Œä»…é™**æœåŠ¡æä¾›è€…**ã€‚
* å¦‚æœè°ƒç”¨æ–¹æ³•æ˜¯**å›å£°**è°ƒç”¨æ—¶ï¼Œé€šè¿‡æ–¹æ³•å( `$echo` ) å’Œæ–¹æ³•å‚æ•°æ•°é‡ä¸º **1** ï¼Œç›´æ¥è¿”å›æ–¹æ³•å‚æ•°ã€‚
* è‹¥æœè°ƒç”¨æ–¹æ³•é**å›å£°**è°ƒç”¨æ—¶ï¼Œè°ƒç”¨ `Invoker#invoke(invocation)` æ–¹æ³•ï¼Œç»§ç»­èµ°åé¢çš„è¿‡æ»¤é“¾ã€‚

# 666. å½©è›‹

![çŸ¥è¯†æ˜Ÿçƒ](http://www.iocoder.cn/images/Architecture/2017_12_29/01.png)

ç¾æ»‹æ»‹ã€‚


