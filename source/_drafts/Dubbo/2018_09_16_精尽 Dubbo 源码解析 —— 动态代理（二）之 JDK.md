title: ç²¾å°½ Dubbo æºç åˆ†æ â€”â€” åŠ¨æ€ä»£ç†ï¼ˆäºŒï¼‰ä¹‹ JDK
date: 2018-09-16
tags:
categories: Dubbo
permalink: Dubbo/proxy-jdk

-------

æ‘˜è¦: åŸåˆ›å‡ºå¤„ http://www.iocoder.cn/Dubbo/proxy-jdk/ ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼

- [1. æ¦‚è¿°](http://www.iocoder.cn/Dubbo/proxy-jdk/)
- [2. JdkProxyFactory](http://www.iocoder.cn/Dubbo/proxy-jdk/)
- [666. å½©è›‹](http://www.iocoder.cn/Dubbo/proxy-jdk/)

-------

![](http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg)

> ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨**å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘**æœ‰ç¦åˆ©ï¼š  
> 1. RocketMQ / MyCAT / Sharding-JDBC **æ‰€æœ‰**æºç åˆ†ææ–‡ç« åˆ—è¡¨  
> 2. RocketMQ / MyCAT / Sharding-JDBC **ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€**  
> 3. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€**éƒ½**å°†å¾—åˆ°**è®¤çœŸ**å›å¤ã€‚**ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢**ã€‚  
> 4. **æ–°çš„**æºç è§£ææ–‡ç« **å®æ—¶**æ”¶åˆ°é€šçŸ¥ã€‚**æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³**ã€‚  
> 5. **è®¤çœŸçš„**æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚

-------

# 1. æ¦‚è¿°

æœ¬æ–‡æ¥ [ã€Šç²¾å°½ Dubbo æºç åˆ†æ â€”â€” åŠ¨æ€ä»£ç†ï¼ˆä¸€ï¼‰ä¹‹ Javassistã€‹](http://www.iocoder.cn/Dubbo/proxy-javassist/?self) ä¸€æ–‡ï¼Œåˆ†äº«ä½¿ç”¨ **JDK** ç”ŸæˆåŠ¨æ€ä»£ç†çš„ä»£ç å®ç°ã€‚

å¦‚æœ JDK Proxy ä¸ç†Ÿæ‚‰çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹ä¸‹ [ã€Š Java JDK åŠ¨æ€ä»£ç†ï¼ˆAOPï¼‰ä½¿ç”¨åŠå®ç°åŸç†åˆ†æã€‹](http://blog.csdn.net/jiankunking/article/details/52143504#) å­¦ä¹ ä¸‹ã€‚ğŸ™‚ å­¦æ— æ­¢å¢ƒå‘€ã€‚

å¦å¤–ï¼Œå¦‚æœä½¿ç”¨ JDK ç”Ÿæˆä»£ç†ï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š

```xml
// æœåŠ¡å¼•ç”¨
<dubbo:reference proxy="jdk" />

// æœåŠ¡æš´éœ²
<dubbo:service proxy="jdk" />
```

# 2. JdkProxyFactory 

`com.alibaba.dubbo.rpc.proxy.jdk.JdkProxyFactory` ï¼Œå®ç° AbstractProxyInvoker æŠ½è±¡ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š

```Java
  1: public class JdkProxyFactory extends AbstractProxyFactory {
  2: 
  3:     @SuppressWarnings("unchecked")
  4:     public <T> T getProxy(Invoker<T> invoker, Class<?>[] interfaces) {
  5:         return (T) Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(), interfaces, new InvokerInvocationHandler(invoker));
  6:     }
  7: 
  8:     public <T> Invoker<T> getInvoker(T proxy, Class<T> type, URL url) {
  9:         return new AbstractProxyInvoker<T>(proxy, type, url) {
 10:             @Override
 11:             protected Object doInvoke(T proxy, String methodName,
 12:                                       Class<?>[] parameterTypes,
 13:                                       Object[] arguments) throws Throwable {
 14:                 // è·å¾—æ–¹æ³•
 15:                 Method method = proxy.getClass().getMethod(methodName, parameterTypes);
 16:                 // è°ƒç”¨æ–¹æ³•
 17:                 return method.invoke(proxy, arguments);
 18:             }
 19:         };
 20:     }
 21: 
 22: }
```

* `#getProxy(invoker, interfaces)` æ–¹æ³•
    * ç¬¬ 5 è¡Œï¼šåˆ›å»º  InvokerInvocationHandler å¯¹è±¡ï¼Œä¼ å…¥ `invoker` å¯¹è±¡ã€‚
    * ç¬¬ 5 è¡Œï¼šè°ƒç”¨ `java.lang.reflect.Proxy#getProxy(ClassLoader loader, Class<?>[] interfaces, InvocationHandler h)` æ–¹æ³•ï¼Œåˆ›å»º Proxy å¯¹è±¡ã€‚
    * ğŸ™‚ ç›¸æ¯” Javassist ç²¾ç®€å¾ˆå¤šï¼ŒæœŸå¾… JDK Proxy çš„ä¸æ–­æ€§èƒ½ä¼˜åŒ–ã€‚
* `#getInvoker(proxy, type, url)` æ–¹æ³•
    * ç¬¬ 9 è‡³ 19 è¡Œï¼šåˆ›å»º AbstractProxyInvoker å¯¹è±¡ï¼Œå®ç° `#doInvoker(...)` æ–¹æ³•ã€‚
        * ç¬¬ 15 è¡Œï¼šè°ƒç”¨ `Class#getMethod(String name, Class<?>... parameterTypes)`  æ–¹æ³•ï¼Œåå°„è·å¾—æ–¹æ³•ã€‚
        * ç¬¬ 17 è¡Œï¼šè°ƒç”¨ `Method#invoke(proxy, arguments)` æ–¹æ³•ï¼Œæ‰§è¡Œæ–¹æ³•ã€‚
        * æ¨èé˜…è¯»ï¼š[ã€ŠJavaåå°„åŸç†ç®€æã€‹](http://www.fanyilun.me/2015/10/29/Java%E5%8F%8D%E5%B0%84%E5%8E%9F%E7%90%86/)

# 666. å½©è›‹

![çŸ¥è¯†æ˜Ÿçƒ](http://www.iocoder.cn/images/Architecture/2017_12_29/01.png)

æ¨èå¯¹åŠ¨æ€ä»£ç†çš„æ€§èƒ½æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯é˜…è¯» [ã€ŠåŠ¨æ€ä»£ç†æ–¹æ¡ˆæ€§èƒ½å¯¹æ¯”ã€‹](http://javatar.iteye.com/blog/814426) ã€‚

