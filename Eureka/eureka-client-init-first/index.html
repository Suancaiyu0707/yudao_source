<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="google-site-verification" content="GkJ68PCnxM9Ih7Zm9v8p91FOCV7ymNCO2KdGbflLh3E"><meta name="360-site-verification" content="dd6547587641bfede036f7c79561e8a0"><meta name="shenma-site-verification" content="fd96cf3751972c9b05f8471d2ccadddc_1496951214"><meta name="msvalidate.01" content="1D38B05050A977F6FDEDA481198343F1"><meta name="sogou_site_verification" content="MpPsku240L"><title>Eureka æºç è§£æ â€”â€” Eureka-Client åˆå§‹åŒ–ï¼ˆä¸€ï¼‰ä¹‹ EurekaInstanceConfig | èŠ‹é“æºç  â€”â€” çº¯æºç è§£æåšå®¢</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3,minimum-scale=1"><meta name="author" content="èŠ‹é“æºç "><meta name="description" content="æ‘˜è¦: åŸåˆ›å‡ºå¤„ http://www.iocoder.cn/Eureka/eureka-client-init-first/ ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼
æœ¬æ–‡ä¸»è¦åŸºäº Eureka 1.8.X ç‰ˆæœ¬ 

1. æ¦‚è¿°
2. EurekaInstanceConfig
2.1 ç±»å…³ç³»å›¾
2."><meta name="keywords" content="Java,æ¶æ„,åç«¯,æœåŠ¡ç«¯,RocketMQ,MyCAT,åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—,åˆ†å¸ƒå¼å­˜å‚¨,æŠ€æœ¯åšå®¢,Sharding-JDBC,åˆ†åº“åˆ†è¡¨"><link rel="alternate" href="atom.xml" title="èŠ‹é“æºç  â€”â€” çº¯æºç è§£æåšå®¢" type="application/atom+xml"><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/style.css"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?9e70e3362807c1bd185a79655b307027";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>!function(){var t="http:"==document.location.protocol?"http://js.passport.qihucdn.com/11.0.1.js?f05b61dd54bbc38386611a5238672938":"https://jspassport.ssl.qhimg.com/11.0.1.js?f05b61dd54bbc38386611a5238672938";document.write('<script src="'+t+'" id="sozz"><\/script>')}()</script><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></head></html><body><header><div><div id="textlogo"><h1 class="site-name"><a href="/" title="èŠ‹é“æºç  â€”â€” çº¯æºç è§£æåšå®¢">èŠ‹é“æºç  â€”â€” çº¯æºç è§£æåšå®¢</a></h1><a class="blog-motto">æ„¿åŠç”Ÿç¼–ç ï¼Œå¦‚ä¸€ç”Ÿè€å‹ï¼</a></div><div class="navbar"><a class="navbutton navmobile" href="#" title="èœå•"></a></div><nav class="animated"><ul><ul><li><a href="/">æ–‡ç« </a></li><li><a href="/2018-meet-you">çŸ¥è¯†æ˜Ÿçƒ</a></li><li><a href="https://github.com/YunaiV" rel="external nofollow noopener noreferrer" target="_blank">Github</a></li><li><a href="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31_bak.jpg">å¾®ä¿¡å…¬ä¼—å·</a></li><li><a href="/categories/%E5%B7%A5%E4%BD%9C%E5%86%85%E6%8E%A8/">å·¥ä½œå†…æ¨</a></li><li><a href="/link_url">å‹é“¾</a></li></ul></ul></nav></div></header><div id="container"><div id="main" class="post" itemscope="" itemprop="blogPost"><article itemprop="articleBody"><header class="article-info clearfix"><h1 itemprop="name"><a href="/Eureka/eureka-client-init-first/" title="Eureka æºç è§£æ â€”â€” Eureka-Client åˆå§‹åŒ–ï¼ˆä¸€ï¼‰ä¹‹ EurekaInstanceConfig" itemprop="url">Eureka æºç è§£æ â€”â€” Eureka-Client åˆå§‹åŒ–ï¼ˆä¸€ï¼‰ä¹‹ EurekaInstanceConfig</a></h1><p class="article-author"></p><p class="article-time">æ€»é˜…è¯»é‡:<span id="busuanzi_value_page_pv"></span>æ¬¡</p></header><div class="article-content"><p>æ‘˜è¦: åŸåˆ›å‡ºå¤„ <a href="http://www.iocoder.cn/Eureka/eureka-client-init-first/">http://www.iocoder.cn/Eureka/eureka-client-init-first/</a> ã€ŒèŠ‹é“æºç ã€æ¬¢è¿è½¬è½½ï¼Œä¿ç•™æ‘˜è¦ï¼Œè°¢è°¢ï¼</p><p><strong>æœ¬æ–‡ä¸»è¦åŸºäº Eureka 1.8.X ç‰ˆæœ¬</strong></p><ul><li><a href="http://www.iocoder.cn/Eureka/eureka-client-init-first/">1. æ¦‚è¿°</a></li><li><a href="http://www.iocoder.cn/Eureka/eureka-client-init-first/">2. EurekaInstanceConfig</a><ul><li><a href="http://www.iocoder.cn/Eureka/eureka-client-init-first/">2.1 ç±»å…³ç³»å›¾</a></li><li><a href="http://www.iocoder.cn/Eureka/eureka-client-init-first/">2.2 é…ç½®å±æ€§</a></li><li><a href="http://www.iocoder.cn/Eureka/eureka-client-init-first/">2.3 AbstractInstanceConfig</a></li><li><a href="http://www.iocoder.cn/Eureka/eureka-client-init-first/">2.4 PropertiesInstanceConfig</a></li><li><a href="http://www.iocoder.cn/Eureka/eureka-client-init-first/">2.5 MyDataCenterInstanceConfig</a></li><li><a href="http://www.iocoder.cn/Eureka/eureka-client-init-first/">2.6 å°ç»“</a></li></ul></li><li><a href="http://www.iocoder.cn/Eureka/eureka-client-init-first/">3. InstanceInfo</a></li><li><a href="http://www.iocoder.cn/Eureka/eureka-client-init-first/">4. ApplicationInfoManager</a></li><li><a href="http://www.iocoder.cn/Eureka/eureka-client-init-first/">666. å½©è›‹</a></li></ul><hr><p><img src="http://www.iocoder.cn/images/common/wechat_mp_2017_07_31.jpg" alt=""></p><blockquote><p>ğŸ™‚ğŸ™‚ğŸ™‚å…³æ³¨<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šã€èŠ‹é“æºç ã€‘</strong>æœ‰ç¦åˆ©ï¼š</p><ol><li>RocketMQ / MyCAT / Sharding-JDBC <strong>æ‰€æœ‰</strong>æºç åˆ†ææ–‡ç« åˆ—è¡¨</li><li>RocketMQ / MyCAT / Sharding-JDBC <strong>ä¸­æ–‡æ³¨é‡Šæºç  GitHub åœ°å€</strong></li><li>æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€<strong>éƒ½</strong>å°†å¾—åˆ°<strong>è®¤çœŸ</strong>å›å¤ã€‚<strong>ç”šè‡³ä¸çŸ¥é“å¦‚ä½•è¯»æºç ä¹Ÿå¯ä»¥è¯·æ•™å™¢</strong>ã€‚</li><li><strong>æ–°çš„</strong>æºç è§£ææ–‡ç« <strong>å®æ—¶</strong>æ”¶åˆ°é€šçŸ¥ã€‚<strong>æ¯å‘¨æ›´æ–°ä¸€ç¯‡å·¦å³</strong>ã€‚</li><li><strong>è®¤çœŸçš„</strong>æºç äº¤æµå¾®ä¿¡ç¾¤ã€‚</li></ol></blockquote><hr><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡ä¸»è¦åˆ†äº« <strong>Eureka-Client è‡ªèº«åˆå§‹åŒ–çš„è¿‡ç¨‹</strong>ï¼Œä¸åŒ…å« Eureka-Client å‘ Eureka-Server çš„æ³¨å†Œè¿‡ç¨‹( ğŸ™‚åé¢ä¼šå¦å¤–æ–‡ç« åˆ†äº« )ã€‚</p><p>Eureka-Client è‡ªèº«åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œæ¶‰åŠåˆ°ä¸»è¦å¯¹è±¡å¦‚ä¸‹å›¾ï¼š</p><p><img src="http://www.iocoder.cn/images/Eureka/2018_04_15/01.png" alt=""></p><ol><li><strong>åˆ›å»º</strong> EurekaInstanceConfigå¯¹è±¡</li><li>ä½¿ç”¨ EurekaInstanceConfigå¯¹è±¡ <strong>åˆ›å»º</strong> InstanceInfoå¯¹è±¡</li><li>ä½¿ç”¨ EurekaInstanceConfigå¯¹è±¡ + InstanceInfoå¯¹è±¡ <strong>åˆ›å»º</strong> ApplicationInfoManagerå¯¹è±¡</li><li><strong>åˆ›å»º</strong> EurekaClientConfigå¯¹è±¡</li><li>ä½¿ç”¨ ApplicationInfoManagerå¯¹è±¡ + EurekaClientConfigå¯¹è±¡ <strong>åˆ›å»º</strong> EurekaClientå¯¹è±¡</li></ol><p>è€ƒè™‘åˆ°æ•´ä¸ªåˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­æ¶‰åŠçš„é…ç½®ç‰¹åˆ«å¤šï¼Œæ‹†åˆ†æˆä¸‰ç¯‡æ–‡ç« ï¼š</p><ol><li><strong>ã€æœ¬æ–‡ã€‘</strong>ï¼ˆä¸€ï¼‰EurekaInstanceConfig</li><li>ï¼ˆäºŒï¼‰<a href="http://www.iocoder.cn/Eureka/eureka-client-init-second/">EurekaClientConfig</a></li><li>ï¼ˆä¸‰ï¼‰<a href="http://www.iocoder.cn/Eureka/eureka-client-init-third/">EurekaClient</a></li></ol><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ¯ä¸ª<strong>ç±»</strong>çš„å®ç°ã€‚</p><p><strong>æ¨è Spring Cloud ä¹¦ç±</strong>ï¼š</p><ul><li>è¯·æ”¯æŒæ­£ç‰ˆã€‚ä¸‹è½½ç›—ç‰ˆï¼Œ<strong>ç­‰äºä¸»åŠ¨ç¼–å†™ä½çº§ BUG</strong> ã€‚</li><li>ç¨‹åºçŒ¿DD â€”â€” <a href="https://union-click.jd.com/jdc?d=505Twi" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠSpring Cloudå¾®æœåŠ¡å®æˆ˜ã€‹</a></li><li>å‘¨ç«‹ â€”â€” <a href="https://union-click.jd.com/jdc?d=k3sAaK" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠSpring Cloudä¸Dockerå¾®æœåŠ¡æ¶æ„å®æˆ˜ã€‹</a></li><li>ä¸¤ä¹¦é½ä¹°ï¼Œäº¬ä¸œåŒ…é‚®ã€‚</li></ul><h1 id="2-EurekaInstanceConfig"><a href="#2-EurekaInstanceConfig" class="headerlink" title="2. EurekaInstanceConfig"></a>2. EurekaInstanceConfig</h1><p><code>com.netflix.appinfo.EurekaInstanceConfig</code>ï¼ŒEureka <strong>åº”ç”¨å®ä¾‹</strong>é…ç½®<strong>æ¥å£</strong>ã€‚åœ¨ä¸‹æ–‡ä½ ä¼šçœ‹åˆ° EurekaClientConfig <strong>æ¥å£</strong>ï¼Œä¸¤è€…çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li>EurekaInstanceConfigï¼Œé‡åœ¨<strong>åº”ç”¨å®ä¾‹</strong>ï¼Œä¾‹å¦‚ï¼Œåº”ç”¨åã€åº”ç”¨çš„ç«¯å£ç­‰ç­‰ã€‚æ­¤å¤„åº”ç”¨æŒ‡çš„æ˜¯ï¼ŒApplication Consumer å’Œ Application Providerã€‚</li><li>EurekaClientConfigï¼Œé‡åœ¨ <strong>Eureka-Client</strong>ï¼Œä¾‹å¦‚ï¼Œ è¿æ¥çš„ Eureka-Server çš„åœ°å€ã€è·å–æœåŠ¡æä¾›è€…åˆ—è¡¨çš„é¢‘ç‡ã€æ³¨å†Œè‡ªèº«ä¸ºæœåŠ¡æä¾›è€…çš„é¢‘ç‡ç­‰ç­‰ã€‚</li></ul><p><img src="http://www.iocoder.cn/images/Eureka/2018_04_15/02.jpeg" alt=""></p><h2 id="2-1-ç±»å…³ç³»å›¾"><a href="#2-1-ç±»å…³ç³»å›¾" class="headerlink" title="2.1 ç±»å…³ç³»å›¾"></a>2.1 ç±»å…³ç³»å›¾</h2><p>EurekaInstanceConfig æ•´ä½“ç±»å…³ç³»å¦‚ä¸‹å›¾ï¼š</p><p><img src="http://www.iocoder.cn/images/Eureka/2018_04_15/03.png" alt=""></p><ul><li>æœ¬æ–‡åªè§£æ<strong>çº¢åœˆ</strong>éƒ¨åˆ†ç±»ã€‚</li><li>EurekaArchaius2ClientConfig åŸºäº <a href="https://github.com/Netflix/archaius" rel="external nofollow noopener noreferrer" target="_blank">Netflix Archaius 2.x</a> å®ç°ï¼Œç›®å‰è¿˜åœ¨å¼€å‘ä¸­ï¼Œå› æ­¤æš‚ä¸è§£æã€‚</li><li>CloudInstanceConfigã€Ec2EurekaArchaius2InstanceConfig åŸºäºäºšé©¬é€Š AWSï¼Œå¤§å¤šæ•°è¯»è€…å’Œæˆ‘å¯¹ AWS éƒ½ä¸äº†è§£ï¼Œå› æ­¤æš‚ä¸è§£æã€‚</li></ul><h2 id="2-2-é…ç½®å±æ€§"><a href="#2-2-é…ç½®å±æ€§" class="headerlink" title="2.2 é…ç½®å±æ€§"></a>2.2 é…ç½®å±æ€§</h2><p>ç‚¹å‡» <a href="https://github.com/YunaiV/eureka/blob/8b0f67ac33116ee05faad1ff5125034cfcf573bf/eureka-client/src/main/java/com/netflix/appinfo/EurekaInstanceConfig.java" rel="external nofollow noopener noreferrer" target="_blank">EurekaInstanceConfig</a> æŸ¥çœ‹é…ç½®å±æ€§ç®€ä»‹ï¼Œå·²ç»æ·»åŠ ä¸­æ–‡æ³¨é‡Šï¼Œå¯ä»¥å¯¹ç…§ç€è‹±æ–‡æ³¨é‡Šä¸€èµ·ç†è§£ã€‚è¿™é‡Œç¬”è€…æ‘˜å‡ºéƒ¨åˆ†è¾ƒä¸ºé‡è¦çš„å±æ€§ï¼š</p><ul><li><code>#getLeaseRenewalIntervalInSeconds()</code> ï¼šç§Ÿçº¦ç»­çº¦é¢‘ç‡ï¼Œå•ä½ï¼šç§’ã€‚åº”ç”¨ä¸æ–­é€šè¿‡æŒ‰ç…§è¯¥é¢‘ç‡å‘é€å¿ƒè·³ç»™ Eureka-Server ä»¥è¾¾åˆ°ç»­çº¦çš„ä½œç”¨ã€‚å½“ Eureka-Server è¶…è¿‡æœ€å¤§é¢‘ç‡æœªæ”¶åˆ°ç»­çº¦ï¼ˆå¿ƒè·³ï¼‰ï¼Œå¥‘çº¦å¤±æ•ˆï¼Œè¿›è¡Œåº”ç”¨ç§»é™¤ã€‚åº”ç”¨ç§»é™¤åï¼Œå…¶ä»–åº”ç”¨æ— æ³•ä» Eureka-Server è·å–è¯¥åº”ç”¨ã€‚</li><li><code>#getLeaseExpirationDurationInSeconds()</code> ï¼šå¥‘çº¦è¿‡æœŸæ—¶é—´ï¼Œå•ä½ï¼šç§’ã€‚</li><li><p><code>#getDataCenterInfo()</code> ï¼šæ•°æ®ä¸­å¿ƒä¿¡æ¯ã€‚<code>com.netflix.appinfo.DataCenterInfo</code>ï¼Œæ•°æ®ä¸­å¿ƒä¿¡æ¯<strong>æ¥å£</strong>ï¼Œç›®å‰è¾ƒä¸ºç®€å•ï¼Œæ ‡è®°æ‰€å±æ•°æ®ä¸­å¿ƒåã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>Name.MyOwn</code>ã€‚æ¥å£å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DataCenterInfo</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * æ•°æ®ä¸­å¿ƒåæšä¸¾</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">enum</span> Name &#123;</div><div class="line">        Netflix,</div><div class="line">        Amazon,</div><div class="line">        MyOwn</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> å½’å±çš„æ•°æ®ä¸­å¿ƒå</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function">Name <span class="title">getName</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li><li><p><code>#getNamespace()</code> ï¼šé…ç½®å‘½åç©ºé—´ï¼Œé»˜è®¤ä½¿ç”¨ <code>eureka</code>ã€‚ä»¥ <code>eureka-client.properties</code> ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">eureka.name=eureka</div><div class="line">eureka.port=<span class="number">8080</span></div><div class="line">eureka.vipAddress=eureka.mydomain.net</div></pre></td></tr></table></figure><ul><li>æ¯ä¸ªå±æ€§<strong>æœ€å‰é¢</strong>çš„ <code>eureka</code> å³æ˜¯é…ç½®å‘½åç©ºé—´ï¼Œä¸€èˆ¬æƒ…å†µæ— éœ€ä¿®æ”¹ã€‚</li></ul></li><li><p>TODO[0004]ï¼šå¥åº·æ£€æŸ¥</p></li><li><code>#isInstanceEnabledOnit()</code> ï¼šåº”ç”¨åˆå§‹åŒ–åæ˜¯å¦å¼€å¯ã€‚åœ¨<a href="#">ã€Œ3. InstanceInfoã€</a>è¯¦ç»†è§£æã€‚</li></ul><h2 id="2-3-AbstractInstanceConfig"><a href="#2-3-AbstractInstanceConfig" class="headerlink" title="2.3 AbstractInstanceConfig"></a>2.3 AbstractInstanceConfig</h2><p><code>com.netflix.appinfo.AbstractInstanceConfig</code>ï¼ŒEureka <strong>åº”ç”¨å®ä¾‹</strong>é…ç½®<strong>æŠ½è±¡åŸºç±»</strong>ï¼Œä¸»è¦å®ç°ä¸€äº›ç›¸å¯¹<strong>é€šç”¨</strong>çš„é…ç½®ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractInstanceConfig</span> <span class="keyword">implements</span> <span class="title">EurekaInstanceConfig</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * å¥‘çº¦è¿‡æœŸæ—¶é—´ï¼Œå•ä½ï¼šç§’</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LEASE_EXPIRATION_DURATION_SECONDS = <span class="number">90</span>;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * ç§Ÿçº¦ç»­çº¦é¢‘ç‡ï¼Œå•ä½ï¼šç§’ã€‚</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LEASE_RENEWAL_INTERVAL_SECONDS = <span class="number">30</span>;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * åº”ç”¨ https ç«¯å£å…³é—­</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> SECURE_PORT_ENABLED = <span class="keyword">false</span>;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * åº”ç”¨ http ç«¯å£å¼€å¯</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> NON_SECURE_PORT_ENABLED = <span class="keyword">true</span>;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * åº”ç”¨ http ç«¯å£</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NON_SECURE_PORT = <span class="number">80</span>;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * åº”ç”¨ https ç«¯å£</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SECURE_PORT = <span class="number">443</span>;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * åº”ç”¨åˆå§‹åŒ–åå¼€å¯</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> INSTANCE_ENABLED_ON_INIT = <span class="keyword">false</span>;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * ä¸»æœºä¿¡æ¯</span></div><div class="line"><span class="comment">     * keyï¼šä¸»æœº IP åœ°å€</span></div><div class="line"><span class="comment">     * valueï¼šä¸»æœºå</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Pair&lt;String, String&gt; hostInfo = getHostInfo();</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * æ•°æ®ä¸­å¿ƒä¿¡æ¯</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> DataCenterInfo info = <span class="keyword">new</span> DataCenterInfo() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Name <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> Name.MyOwn;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Pair&lt;String, String&gt; <span class="title">getHostInfo</span><span class="params">()</span> </span>&#123;</div><div class="line">        Pair&lt;String, String&gt; pair;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            InetAddress localHost = InetAddress.getLocalHost();</div><div class="line">            pair = <span class="keyword">new</span> Pair&lt;String, String&gt;(localHost.getHostAddress(), localHost.getHostName());</div><div class="line">        &#125; <span class="keyword">catch</span> (UnknownHostException e) &#123;</div><div class="line">            logger.error(<span class="string">"Cannot get host info"</span>, e);</div><div class="line">            pair = <span class="keyword">new</span> Pair&lt;String, String&gt;(<span class="string">""</span>, <span class="string">""</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> pair;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// .... çœç•¥ setting / getting æ–¹æ³•</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li><code>#getHostInfo()</code> æ–¹æ³•ï¼Œè·å–æœ¬åœ°æœåŠ¡å™¨çš„ä¸»æœºåå’Œä¸»æœº IP åœ°å€ã€‚<strong>å¦‚æœä¸»æœºæœ‰å¤šç½‘å¡æˆ–è€…è™šæ‹Ÿæœºç½‘å¡</strong>ï¼Œè¿™å—è¦å°å¿ƒï¼Œè§£å†³æ–¹å¼å¦‚ä¸‹ï¼š<ul><li>æ‰‹åŠ¨é…ç½®æœ¬æœºçš„ <code>hostname</code> + <code>etc/hosts</code> æ–‡ä»¶ï¼Œä»è€Œæ˜ å°„ä¸»æœºåå’Œ IP åœ°å€ã€‚</li><li>ä½¿ç”¨ Spring-Cloud-Eureka-Client çš„è¯ï¼Œå‚è€ƒ<a href="http://www.itmuch.com/spring-cloud-code-read/spring-cloud-code-read-eureka-registry-ip/?from=www.iocoder.cn" rel="external nofollow noopener noreferrer" target="_blank">å‘¨ç«‹ â€”â€” ã€ŠEurekaæœåŠ¡æ³¨å†Œè¿‡ç¨‹è¯¦è§£ä¹‹IpAddressã€‹</a>è§£å†³ã€‚</li></ul></li></ul><h2 id="2-4-PropertiesInstanceConfig"><a href="#2-4-PropertiesInstanceConfig" class="headerlink" title="2.4 PropertiesInstanceConfig"></a>2.4 PropertiesInstanceConfig</h2><p><code>com.netflix.appinfo.PropertiesInstanceConfig</code>ï¼ŒåŸºäº<strong>é…ç½®æ–‡ä»¶</strong>çš„ Eureka <strong>åº”ç”¨å®ä¾‹</strong>é…ç½®<strong>æŠ½è±¡åŸºç±»</strong>ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertiesInstanceConfig</span> <span class="keyword">extends</span> <span class="title">AbstractInstanceConfig</span> <span class="keyword">implements</span> <span class="title">EurekaInstanceConfig</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * å‘½åç©ºé—´</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> String namespace;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * é…ç½®æ–‡ä»¶å¯¹è±¡</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> DynamicPropertyFactory configInstance;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * åº”ç”¨åˆ†ç»„</span></div><div class="line"><span class="comment">     * ä» ç¯å¢ƒå˜é‡ è·å–</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> String appGrpNameFromEnv;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PropertiesInstanceConfig</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(CommonConstants.DEFAULT_CONFIG_NAMESPACE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PropertiesInstanceConfig</span><span class="params">(String namespace)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(namespace, <span class="keyword">new</span> DataCenterInfo() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> Name <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">return</span> Name.MyOwn;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PropertiesInstanceConfig</span><span class="params">(String namespace, DataCenterInfo info)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(info);</div><div class="line">        <span class="comment">// è®¾ç½® namespaceï¼Œä¸º "." ç»“å°¾</span></div><div class="line">        <span class="keyword">this</span>.namespace = namespace.endsWith(<span class="string">"."</span>)</div><div class="line">                ? namespace</div><div class="line">                : namespace + <span class="string">"."</span>;</div><div class="line">        <span class="comment">// ä» ç¯å¢ƒå˜é‡ è·å– åº”ç”¨åˆ†ç»„</span></div><div class="line">        appGrpNameFromEnv = ConfigurationManager.getConfigInstance()</div><div class="line">                .getString(FALLBACK_APP_GROUP_KEY, Values.UNKNOWN_APPLICATION);</div><div class="line">        <span class="comment">// åˆå§‹åŒ– é…ç½®æ–‡ä»¶å¯¹è±¡</span></div><div class="line">        <span class="keyword">this</span>.configInstance = Archaius1Utils.initConfig(CommonConstants.CONFIG_FILE_NAME);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAppGroupName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> configInstance.getStringProperty(namespace + APP_GROUP_KEY, appGrpNameFromEnv).get().trim();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li><code>configInstance</code> å±æ€§ï¼Œé…ç½®æ–‡ä»¶å¯¹è±¡ï¼ŒåŸºäº <a href="https://github.com/Netflix/archaius" rel="external nofollow noopener noreferrer" target="_blank">Netflix Archaius 1.x</a> å®ç°é…ç½®æ–‡ä»¶çš„è¯»å–ã€‚åœ¨ <a href="https://github.com/YunaiV/eureka/blob/671d7fc20bd6353040431d6e298eac5f82293497/eureka-client/src/main/java/com/netflix/appinfo/PropertyBasedInstanceConfigConstants.java" rel="external nofollow noopener noreferrer" target="_blank"><code>com.netflix.appinfo.PropertyBasedInstanceConfigConstants</code></a> å¯ä»¥çœ‹åˆ°é…ç½®æ–‡ä»¶çš„æ¯ä¸ªå±æ€§ KEY ã€‚</li><li><p><code>appGrpNameFromEnv</code> å±æ€§ï¼Œåº”ç”¨åˆ†ç»„ï¼Œä»<strong>ç¯å¢ƒå˜é‡</strong>ä¸­è·å–ã€‚ä» <code>#getAppGroupName()</code> æ–¹æ³•ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ä¼˜å…ˆè¿˜æ˜¯ä»é…ç½®æ–‡ä»¶è¯»å–ã€‚è®¾ç½®æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">System.setProperty(FALLBACK_APP_GROUP_KEY, <span class="string">"app_gropu_name"</span>);</div></pre></td></tr></table></figure><ul><li><code>FALLBACK_APP_GROUP_KEY</code>ï¼Œç§æœ‰é™æ€å˜é‡ï¼Œå®é™…å¾—ä½¿ç”¨ <code>NETFLIX_APP_GROUP</code>ã€‚</li><li><code>com.netflix.config.ConfigurationManager</code> å¯ä»¥ä»<strong>ç¯å¢ƒå˜é‡</strong>è·å–åˆ°å€¼ã€‚</li></ul></li><li><p>è°ƒç”¨ <code>Archaius1Utils#initConfig(...)</code> æ–¹æ³•ï¼Œåˆå§‹åŒ–è¯»å–çš„é…ç½®æ–‡ä»¶å¯¹è±¡ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Archaius1Utils</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(Archaius1Utils.class);</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ARCHAIUS_DEPLOYMENT_ENVIRONMENT = <span class="string">"archaius.deployment.environment"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String EUREKA_ENVIRONMENT = <span class="string">"eureka.environment"</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DynamicPropertyFactory <span class="title">initConfig</span><span class="params">(String configName)</span> </span>&#123;</div><div class="line">        <span class="comment">// é…ç½®æ–‡ä»¶å¯¹è±¡</span></div><div class="line">        DynamicPropertyFactory configInstance = DynamicPropertyFactory.getInstance();</div><div class="line">        <span class="comment">// é…ç½®æ–‡ä»¶å</span></div><div class="line">        DynamicStringProperty EUREKA_PROPS_FILE = configInstance.getStringProperty(<span class="string">"eureka.client.props"</span>, configName);</div><div class="line">        <span class="comment">// é…ç½®æ–‡ä»¶ç¯å¢ƒ</span></div><div class="line">        String env = ConfigurationManager.getConfigInstance().getString(EUREKA_ENVIRONMENT, <span class="string">"test"</span>);</div><div class="line">        ConfigurationManager.getConfigInstance().setProperty(ARCHAIUS_DEPLOYMENT_ENVIRONMENT, env);</div><div class="line">        <span class="comment">// å°†é…ç½®æ–‡ä»¶åŠ è½½åˆ°ç¯å¢ƒå˜é‡</span></div><div class="line">        String eurekaPropsFile = EUREKA_PROPS_FILE.get();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            ConfigurationManager.loadCascadedPropertiesFromResources(eurekaPropsFile);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            logger.warn(</div><div class="line">                    <span class="string">"Cannot find the properties specified : &#123;&#125;. This may be okay if there are other environment "</span></div><div class="line">                            + <span class="string">"specific properties or the configuration is installed with a different mechanism."</span>,</div><div class="line">                    eurekaPropsFile);</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> configInstance;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>ä»ç¯å¢ƒå˜é‡ <code>eureka.client.props</code>ï¼Œè·å–é…ç½®æ–‡ä»¶åã€‚å¦‚æœæœªé…ç½®ï¼Œä½¿ç”¨å‚æ•° <code>configName</code>ï¼Œå³ <code>CommonConstants.CONFIG_FILE_NAME</code> ( <code>&quot;eureka-client&quot;</code> )ã€‚</li><li>ä»ç¯å¢ƒå˜é‡ <code>eureka.environment</code> ( EUREKA_ENVIRONMENT )ï¼Œè·å–é…ç½®æ–‡ä»¶ç¯å¢ƒã€‚</li><li>è°ƒç”¨ <code>ConfigurationManager#loadCascadedPropertiesFromResources(...)</code> æ–¹æ³•ï¼Œè¯»å–é…ç½®æ–‡ä»¶åˆ°ç¯å¢ƒå˜é‡ï¼Œé¦–å…ˆè¯»å– <code>${eureka.client.props}</code> å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼›ç„¶åè¯»å– <code>${eureka.client.props}-${eureka.environment}</code> å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚è‹¥æœ‰ç›¸åŒå±æ€§ï¼Œè¿›è¡Œè¦†ç›–ã€‚</li></ul></li></ul><h2 id="2-5-MyDataCenterInstanceConfig"><a href="#2-5-MyDataCenterInstanceConfig" class="headerlink" title="2.5 MyDataCenterInstanceConfig"></a>2.5 MyDataCenterInstanceConfig</h2><p><code>com.netflix.appinfo.MyDataCenterInstanceConfig</code>ï¼Œé AWS æ•°æ®ä¸­å¿ƒçš„ Eureka <strong>åº”ç”¨å®ä¾‹</strong>é…ç½®<strong>å®ç°ç±»</strong>ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDataCenterInstanceConfig</span> <span class="keyword">extends</span> <span class="title">PropertiesInstanceConfig</span> <span class="keyword">implements</span> <span class="title">EurekaInstanceConfig</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDataCenterInstanceConfig</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDataCenterInstanceConfig</span><span class="params">(String namespace)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(namespace);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDataCenterInstanceConfig</span><span class="params">(String namespace, DataCenterInfo dataCenterInfo)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(namespace, dataCenterInfo);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="2-6-å°ç»“"><a href="#2-6-å°ç»“" class="headerlink" title="2.6 å°ç»“"></a>2.6 å°ç»“</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨ MyDataCenterInstanceConfig é…ç½® Eureka åº”ç”¨å®ä¾‹ã€‚</p><p>åœ¨ Spring-Cloud-Eureka é‡Œï¼Œ<strong>ç›´æ¥</strong>åŸºäº EurekaInstanceConfig æ¥å£é‡æ–°å®ç°äº†é…ç½®ç±»ï¼Œå®é™…é€»è¾‘å·®åˆ«ä¸å¤§ï¼Œåœ¨<a href="#">TODO[0007] ï¼šã€ŠSpring-Cloud-Eureka-Clientã€‹</a>è¯¦ç»†è§£æã€‚</p><h1 id="3-InstanceInfo"><a href="#3-InstanceInfo" class="headerlink" title="3. InstanceInfo"></a>3. InstanceInfo</h1><p><code>com.netflix.appinfo.InstanceInfo</code>ï¼Œ<strong>åº”ç”¨å®ä¾‹</strong>ä¿¡æ¯ã€‚Eureka-Client å‘ Eureka-Server <strong>æ³¨å†Œ</strong>è¯¥å¯¹è±¡ä¿¡æ¯ã€‚æ³¨å†ŒæˆåŠŸåï¼Œå¯ä»¥è¢«å…¶ä»– Eureka-Client <strong>å‘ç°</strong>ã€‚</p><p><strong>æœ¬æ–‡ä»…åˆ†äº« InstanceInfo çš„åˆå§‹åŒ–</strong>ã€‚InstanceInfo é‡Œå’Œæ³¨å†Œå‘ç°ç›¸å…³çš„å±æ€§å’Œæ–¹æ³•ï¼Œæš‚æ—¶è·³è¿‡ã€‚</p><p><code>com.netflix.appinfo.providers.EurekaConfigBasedInstanceInfoProvider</code>ï¼ŒåŸºäº EurekaInstanceConfig åˆ›å»º InstanceInfo çš„å·¥å‚ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">  <span class="number">1</span>: <span class="meta">@Singleton</span></div><div class="line">  <span class="number">2</span>: <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EurekaConfigBasedInstanceInfoProvider</span> <span class="keyword">implements</span> <span class="title">Provider</span>&lt;<span class="title">InstanceInfo</span>&gt; </span>&#123;</div><div class="line">  <span class="number">3</span>:     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOG = LoggerFactory.getLogger(EurekaConfigBasedInstanceInfoProvider.class);</div><div class="line">  <span class="number">4</span>: </div><div class="line">  <span class="number">5</span>:     <span class="keyword">private</span> <span class="keyword">final</span> EurekaInstanceConfig config;</div><div class="line">  <span class="number">6</span>: </div><div class="line">  <span class="number">7</span>:     <span class="keyword">private</span> InstanceInfo instanceInfo;</div><div class="line">  <span class="number">8</span>: </div><div class="line">  <span class="number">9</span>:     <span class="meta">@Inject</span>(optional = <span class="keyword">true</span>)</div><div class="line"> <span class="number">10</span>:     <span class="keyword">private</span> VipAddressResolver vipAddressResolver = <span class="keyword">null</span>;</div><div class="line"> <span class="number">11</span>: </div><div class="line"> <span class="number">12</span>:     <span class="meta">@Inject</span></div><div class="line"> <span class="number">13</span>:     <span class="function"><span class="keyword">public</span> <span class="title">EurekaConfigBasedInstanceInfoProvider</span><span class="params">(EurekaInstanceConfig config)</span> </span>&#123;</div><div class="line"> <span class="number">14</span>:         <span class="keyword">this</span>.config = config;</div><div class="line"> <span class="number">15</span>:     &#125;</div><div class="line"> <span class="number">16</span>: </div><div class="line"> <span class="number">17</span>:     <span class="meta">@Override</span></div><div class="line"> <span class="number">18</span>:     <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> InstanceInfo <span class="title">get</span><span class="params">()</span> </span>&#123;</div><div class="line"> <span class="number">19</span>:         <span class="keyword">if</span> (instanceInfo == <span class="keyword">null</span>) &#123;</div><div class="line"> <span class="number">20</span>:             <span class="comment">// Build the lease information to be passed to the server based on config</span></div><div class="line"> <span class="number">21</span>:             <span class="comment">// åˆ›å»º ç§Ÿçº¦ä¿¡æ¯æ„å»ºå™¨ï¼Œå¹¶è®¾ç½®å±æ€§</span></div><div class="line"> <span class="number">22</span>:             LeaseInfo.Builder leaseInfoBuilder = LeaseInfo.Builder.newBuilder()</div><div class="line"> <span class="number">23</span>:                     .setRenewalIntervalInSecs(config.getLeaseRenewalIntervalInSeconds())</div><div class="line"> <span class="number">24</span>:                     .setDurationInSecs(config.getLeaseExpirationDurationInSeconds());</div><div class="line"> <span class="number">25</span>: </div><div class="line"> <span class="number">26</span>:             <span class="comment">// åˆ›å»º VIPåœ°å€è§£æå™¨</span></div><div class="line"> <span class="number">27</span>:             <span class="keyword">if</span> (vipAddressResolver == <span class="keyword">null</span>) &#123;</div><div class="line"> <span class="number">28</span>:                 vipAddressResolver = <span class="keyword">new</span> Archaius1VipAddressResolver();</div><div class="line"> <span class="number">29</span>:             &#125;</div><div class="line"> <span class="number">30</span>: </div><div class="line"> <span class="number">31</span>:             <span class="comment">// Builder the instance information to be registered with eureka server</span></div><div class="line"> <span class="number">32</span>:             <span class="comment">// åˆ›å»º åº”ç”¨å®ä¾‹ä¿¡æ¯æ„å»ºå™¨</span></div><div class="line"> <span class="number">33</span>:             InstanceInfo.Builder builder = InstanceInfo.Builder.newBuilder(vipAddressResolver);</div><div class="line"> <span class="number">34</span>: </div><div class="line"> <span class="number">35</span>:             <span class="comment">// åº”ç”¨å®ä¾‹ç¼–å·</span></div><div class="line"> <span class="number">36</span>:             <span class="comment">// set the appropriate id for the InstanceInfo, falling back to datacenter Id if applicable, else hostname</span></div><div class="line"> <span class="number">37</span>:             String instanceId = config.getInstanceId();</div><div class="line"> <span class="number">38</span>:             DataCenterInfo dataCenterInfo = config.getDataCenterInfo();</div><div class="line"> <span class="number">39</span>:             <span class="keyword">if</span> (instanceId == <span class="keyword">null</span> || instanceId.isEmpty()) &#123;</div><div class="line"> <span class="number">40</span>:                 <span class="keyword">if</span> (dataCenterInfo <span class="keyword">instanceof</span> UniqueIdentifier) &#123;</div><div class="line"> <span class="number">41</span>:                     instanceId = ((UniqueIdentifier) dataCenterInfo).getId();</div><div class="line"> <span class="number">42</span>:                 &#125; <span class="keyword">else</span> &#123;</div><div class="line"> <span class="number">43</span>:                     instanceId = config.getHostName(<span class="keyword">false</span>);</div><div class="line"> <span class="number">44</span>:                 &#125;</div><div class="line"> <span class="number">45</span>:             &#125;</div><div class="line"> <span class="number">46</span>: </div><div class="line"> <span class="number">47</span>:             <span class="comment">// è·å¾— ä¸»æœºå</span></div><div class="line"> <span class="number">48</span>:             String defaultAddress;</div><div class="line"> <span class="number">49</span>:             <span class="keyword">if</span> (config <span class="keyword">instanceof</span> RefreshableInstanceConfig) &#123;</div><div class="line"> <span class="number">50</span>:                 <span class="comment">// Refresh AWS data center info, and return up to date address</span></div><div class="line"> <span class="number">51</span>:                 defaultAddress = ((RefreshableInstanceConfig) config).resolveDefaultAddress(<span class="keyword">false</span>);</div><div class="line"> <span class="number">52</span>:             &#125; <span class="keyword">else</span> &#123;</div><div class="line"> <span class="number">53</span>:                 defaultAddress = config.getHostName(<span class="keyword">false</span>);</div><div class="line"> <span class="number">54</span>:             &#125;</div><div class="line"> <span class="number">55</span>:             <span class="comment">// fail safe</span></div><div class="line"> <span class="number">56</span>:             <span class="keyword">if</span> (defaultAddress == <span class="keyword">null</span> || defaultAddress.isEmpty()) &#123;</div><div class="line"> <span class="number">57</span>:                 defaultAddress = config.getIpAddress();</div><div class="line"> <span class="number">58</span>:             &#125;</div><div class="line"> <span class="number">59</span>: </div><div class="line"> <span class="number">60</span>:             <span class="comment">// è®¾ç½® åº”ç”¨å®ä¾‹ä¿¡æ¯æ„å»ºå™¨ çš„ å±æ€§</span></div><div class="line"> <span class="number">61</span>:             builder.setNamespace(config.getNamespace())</div><div class="line"> <span class="number">62</span>:                     .setInstanceId(instanceId)</div><div class="line"> <span class="number">63</span>:                     .setAppName(config.getAppname())</div><div class="line"> <span class="number">64</span>:                     .setAppGroupName(config.getAppGroupName())</div><div class="line"> <span class="number">65</span>:                     .setDataCenterInfo(config.getDataCenterInfo())</div><div class="line"> <span class="number">66</span>:                     .setIPAddr(config.getIpAddress())</div><div class="line"> <span class="number">67</span>:                     .setHostName(defaultAddress) <span class="comment">// ä¸»æœºå</span></div><div class="line"> <span class="number">68</span>:                     .setPort(config.getNonSecurePort())</div><div class="line"> <span class="number">69</span>:                     .enablePort(PortType.UNSECURE, config.isNonSecurePortEnabled())</div><div class="line"> <span class="number">70</span>:                     .setSecurePort(config.getSecurePort())</div><div class="line"> <span class="number">71</span>:                     .enablePort(PortType.SECURE, config.getSecurePortEnabled())</div><div class="line"> <span class="number">72</span>:                     .setVIPAddress(config.getVirtualHostName()) <span class="comment">// VIP åœ°å€</span></div><div class="line"> <span class="number">73</span>:                     .setSecureVIPAddress(config.getSecureVirtualHostName())</div><div class="line"> <span class="number">74</span>:                     .setHomePageUrl(config.getHomePageUrlPath(), config.getHomePageUrl())</div><div class="line"> <span class="number">75</span>:                     .setStatusPageUrl(config.getStatusPageUrlPath(), config.getStatusPageUrl())</div><div class="line"> <span class="number">76</span>:                     .setASGName(config.getASGName())</div><div class="line"> <span class="number">77</span>:                     .setHealthCheckUrls(config.getHealthCheckUrlPath(),</div><div class="line"> <span class="number">78</span>:                             config.getHealthCheckUrl(), config.getSecureHealthCheckUrl());</div><div class="line"> <span class="number">79</span>: </div><div class="line"> <span class="number">80</span>:             <span class="comment">// åº”ç”¨åˆå§‹åŒ–åæ˜¯å¦å¼€å¯</span></div><div class="line"> <span class="number">81</span>:             <span class="comment">// Start off with the STARTING state to avoid traffic</span></div><div class="line"> <span class="number">82</span>:             <span class="keyword">if</span> (!config.isInstanceEnabledOnit()) &#123;</div><div class="line"> <span class="number">83</span>:                 InstanceStatus initialStatus = InstanceStatus.STARTING;</div><div class="line"> <span class="number">84</span>:                 LOG.info(<span class="string">"Setting initial instance status as: "</span> + initialStatus);</div><div class="line"> <span class="number">85</span>:                 builder.setStatus(initialStatus);</div><div class="line"> <span class="number">86</span>:             &#125; <span class="keyword">else</span> &#123;</div><div class="line"> <span class="number">87</span>:                 LOG.info(<span class="string">"Setting initial instance status as: &#123;&#125;. This may be too early for the instance to advertise "</span></div><div class="line"> <span class="number">88</span>:                          + <span class="string">"itself as available. You would instead want to control this via a healthcheck handler."</span>,</div><div class="line"> <span class="number">89</span>:                          InstanceStatus.UP);</div><div class="line"> <span class="number">90</span>:             &#125;</div><div class="line"> <span class="number">91</span>: </div><div class="line"> <span class="number">92</span>:             <span class="comment">// è®¾ç½® åº”ç”¨å®ä¾‹ä¿¡æ¯æ„å»ºå™¨ çš„ å…ƒæ•°æ®( Metadata )é›†åˆ</span></div><div class="line"> <span class="number">93</span>:             <span class="comment">// Add any user-specific metadata information</span></div><div class="line"> <span class="number">94</span>:             <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; mapEntry : config.getMetadataMap().entrySet()) &#123;</div><div class="line"> <span class="number">95</span>:                 String key = mapEntry.getKey();</div><div class="line"> <span class="number">96</span>:                 String value = mapEntry.getValue();</div><div class="line"> <span class="number">97</span>:                 builder.add(key, value);</div><div class="line"> <span class="number">98</span>:             &#125;</div><div class="line"> <span class="number">99</span>: </div><div class="line"><span class="number">100</span>:             <span class="comment">// åˆ›å»º åº”ç”¨å®ä¾‹ä¿¡æ¯</span></div><div class="line"><span class="number">101</span>:             instanceInfo = builder.build();</div><div class="line"><span class="number">102</span>: </div><div class="line"><span class="number">103</span>:             <span class="comment">// è®¾ç½® åº”ç”¨å®ä¾‹ä¿¡æ¯ çš„ ç§Ÿçº¦ä¿¡æ¯</span></div><div class="line"><span class="number">104</span>:             instanceInfo.setLeaseInfo(leaseInfoBuilder.build());</div><div class="line"><span class="number">105</span>:         &#125;</div><div class="line"><span class="number">106</span>:         <span class="keyword">return</span> instanceInfo;</div><div class="line"><span class="number">107</span>:     &#125;</div><div class="line"><span class="number">108</span>: </div><div class="line"><span class="number">109</span>: &#125;</div></pre></td></tr></table></figure><ul><li>è¯¥ç±»å®ç° <code>javax.inject.Provider</code> æ¥å£ï¼Œè®¾ç½® InstanceInfo çš„ç”Ÿæˆå·¥å‚ã€‚æ„Ÿå…´è¶£çš„åŒå­¦ï¼Œå¯ä»¥ç‚¹å‡»<a href="http://blog.csdn.net/derekjiang/article/details/7231490" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠGoogle-Guiceå…¥é—¨ä»‹ç»ã€‹</a>æœç´¢ <strong>Provider</strong> å…³é”®å­—ã€‚ç›®å‰å¤„äº<strong>è¯•éªŒ</strong>é˜¶æ®µï¼Œæœªå®Œæˆã€‚</li><li><code>EurekaConfigBasedInstanceInfoProvider(config)</code> æ„é€ æ–¹æ³•ï¼Œè®¾ç½®ç”Ÿæˆ InstanceInfo çš„ EurekaInstanceConfig é…ç½®ã€‚</li><li><p>è°ƒç”¨ <code>#get()</code> æ–¹æ³•ï¼Œæ ¹æ® EurekaInstanceConfig åˆ›å»º InstanceInfoã€‚InstanceInfo çš„ç»å¤§æ•°å±æ€§å’Œ EurekaInstanceConfig æ˜¯ä¸€è‡´çš„ ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ 21 è‡³ 24 è¡Œ ï¼šåˆ›å»ºç§Ÿçº¦ä¿¡æ¯æ„å»ºå™¨( <a href="https://github.com/YunaiV/eureka/blob/671d7fc20bd6353040431d6e298eac5f82293497/eureka-client/src/main/java/com/netflix/appinfo/LeaseInfo.java" rel="external nofollow noopener noreferrer" target="_blank"><code>com.netflix.appinfo.LeaseInfo.Builder</code></a> )ï¼Œå¹¶è®¾ç½® <code>renewalIntervalInSecs</code> / <code>durationInSecs</code> å±æ€§ã€‚</li><li><p>ç¬¬ 26 è‡³ 29 è¡Œ ï¼šåˆ›å»º VIPåœ°å€è§£æå™¨( <code>com.netflix.appinfo.providers.VipAddressResolver</code> )ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// VipAddressResolver.java</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">VipAddressResolver</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function">String <span class="title">resolveDeploymentContextBasedVipAddresses</span><span class="params">(String vipAddressMacro)</span></span>;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Archaius1VipAddressResolver</span> <span class="keyword">implements</span> <span class="title">VipAddressResolver</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Pattern VIP_ATTRIBUTES_PATTERN = Pattern.compile(<span class="string">"\\$\\&#123;(.*?)\\&#125;"</span>);</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">resolveDeploymentContextBasedVipAddresses</span><span class="params">(String vipAddressMacro)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (vipAddressMacro == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">        String result = vipAddressMacro;</div><div class="line">        <span class="comment">// æ›¿æ¢è¡¨è¾¾å¼</span></div><div class="line">        Matcher matcher = VIP_ATTRIBUTES_PATTERN.matcher(result);</div><div class="line">        <span class="keyword">while</span> (matcher.find()) &#123;</div><div class="line">            String key = matcher.group(<span class="number">1</span>);</div><div class="line">            String value = DynamicPropertyFactory.getInstance().getStringProperty(key, <span class="string">""</span>).get();</div><div class="line"></div><div class="line">            logger.debug(<span class="string">"att:"</span> + matcher.group());</div><div class="line">            logger.debug(<span class="string">", att key:"</span> + key);</div><div class="line">            logger.debug(<span class="string">", att value:"</span> + value);</div><div class="line">            logger.debug(<span class="string">""</span>);</div><div class="line"></div><div class="line">            result = result.replaceAll(<span class="string">"\\$\\&#123;"</span> + key + <span class="string">"\\&#125;"</span>, value);</div><div class="line">            matcher = VIP_ATTRIBUTES_PATTERN.matcher(result);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>#resolveDeploymentContextBasedVipAddresses()</code> æ–¹æ³•ï¼Œå°† <strong>VIPåœ°å€</strong> é‡Œçš„ <code>${(.*?)}</code> æŸ¥æ‰¾é…ç½®æ–‡ä»¶é‡Œçš„é”®å€¼è¿›è¡Œæ›¿æ¢ã€‚ä¾‹å¦‚ï¼Œ<code>${eureka.env}.domain.com</code>ï¼ŒæŸ¥æ‰¾é…ç½®æ–‡ä»¶é‡Œçš„é”® <code>${eureka.env}</code> å¯¹åº”å€¼è¿›è¡Œæ›¿æ¢ã€‚TODO[0005]ï¼šè°ƒè¯•ä¸‹æ¥ï¼Œå‘ç° Archaius å·²ç»æ›¿æ¢ï¼Œç­‰åˆ°æ‰¾åˆ°ç­”æ¡ˆä¿®æ”¹æ­¤å¤„ã€‚</li></ul></li><li><p>ç¬¬ 32 è‡³ 33 è¡Œ ï¼šåˆ›å»ºåº”ç”¨å®ä¾‹ä¿¡æ¯æ„å»ºå™¨( <a href="https://github.com/YunaiV/eureka/blob/671d7fc20bd6353040431d6e298eac5f82293497/eureka-client/src/main/java/com/netflix/appinfo/InstanceInfo.java" rel="external nofollow noopener noreferrer" target="_blank"><code>com.netflix.appinfo.InstanceInfo.Builder</code></a> )ã€‚</p></li><li>ç¬¬ 35 è‡³ 45 è¡Œ ï¼šè·å¾—åº”ç”¨å®ä¾‹ç¼–å·( <code>instanceId</code> )ã€‚</li><li>ç¬¬ 47 è‡³ 58 è¡Œ ï¼šè·å¾—ä¸»æœºåã€‚</li><li>ç¬¬ 60 è‡³ 78 è¡Œ ï¼šè®¾ç½®åº”ç”¨å®ä¾‹ä¿¡æ¯æ„å»ºå™¨çš„å±æ€§ã€‚</li><li>ç¬¬ 80 è‡³ 90 è¡Œ ï¼šåº”ç”¨åˆå§‹åŒ–åæ˜¯å¦å¼€å¯ã€‚<ul><li>ç¬¬ 82 è‡³ 85 è¡Œ ï¼šåº”ç”¨<strong>ä¸å¼€å¯</strong>ï¼Œåº”ç”¨å®ä¾‹å¤„äº STARTING çŠ¶æ€ã€‚</li><li>ç¬¬ 86 è‡³ 90 è¡Œ ï¼šåº”ç”¨<strong>å¼€å¯</strong>ï¼Œåº”ç”¨å®ä¾‹å¤„äº UP çŠ¶æ€ã€‚</li><li><strong>ä½¿ç”¨åº”ç”¨åˆå§‹åŒ–åä¸å¼€å¯</strong>ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ <code>ApplicationInfoManager#setInstanceStatus(...)</code> æ–¹æ³•æ”¹å˜åº”ç”¨å®ä¾‹çŠ¶æ€ï¼Œåœ¨<a href="http://www.iocoder.cn/Eureka/instance-registry-register/?self">ã€ŠEureka æºç è§£æ â€”â€” åº”ç”¨å®ä¾‹æ³¨å†Œå‘ç° ï¼ˆä¸€ï¼‰ä¹‹æ³¨å†Œã€‹ã€Œ2.1 åº”ç”¨å®ä¾‹ä¿¡æ¯å¤åˆ¶å™¨ã€</a>æœ‰è¯¦ç»†è§£æã€‚</li></ul></li><li>ç¬¬ 92 è‡³ 98 è¡Œ ï¼šè®¾ç½®åº”ç”¨å®ä¾‹ä¿¡æ¯æ„å»ºå™¨çš„å…ƒæ•°æ®( Metadata )é›†åˆã€‚</li><li>ç¬¬ 100 è‡³ 101 è¡Œ ï¼šåˆ›å»ºåº”ç”¨å®ä¾‹ä¿¡æ¯( <a href="https://github.com/YunaiV/eureka/blob/671d7fc20bd6353040431d6e298eac5f82293497/eureka-client/src/main/java/com/netflix/appinfo/InstanceInfo.java" rel="external nofollow noopener noreferrer" target="_blank"><code>com.netflix.appinfo.InstanceInfo</code></a> )ã€‚</li><li>ç¬¬ 103 è‡³ 104 è¡Œ ï¼šè®¾ç½®åº”ç”¨å®ä¾‹ä¿¡æ¯çš„ç§Ÿçº¦ä¿¡æ¯( <a href="https://github.com/YunaiV/eureka/blob/671d7fc20bd6353040431d6e298eac5f82293497/eureka-client/src/main/java/com/netflix/appinfo/InstanceInfo.java" rel="external nofollow noopener noreferrer" target="_blank"><code>com.netflix.appinfo.InstanceInfo</code></a> )ã€‚</li></ul></li></ul><h1 id="4-ApplicationInfoManager"><a href="#4-ApplicationInfoManager" class="headerlink" title="4. ApplicationInfoManager"></a>4. ApplicationInfoManager</h1><p><code>com.netflix.appinfo.ApplicationInfoManager</code>ï¼Œåº”ç”¨ä¿¡æ¯ç®¡ç†å™¨ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationInfoManager</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * å•ä¾‹</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ApplicationInfoManager instance = <span class="keyword">new</span> ApplicationInfoManager(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * çŠ¶æ€å˜æ›´ç›‘å¬å™¨</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> Map&lt;String, StatusChangeListener&gt; listeners;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * åº”ç”¨å®ä¾‹çŠ¶æ€åŒ¹é…</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InstanceStatusMapper instanceStatusMapper;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * åº”ç”¨å®ä¾‹ä¿¡æ¯</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> InstanceInfo instanceInfo;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * åº”ç”¨å®ä¾‹é…ç½®</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">private</span> EurekaInstanceConfig config;</div><div class="line">    </div><div class="line">    <span class="comment">// ... çœç•¥å…¶å®ƒæ„é€ æ–¹æ³•</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ApplicationInfoManager</span><span class="params">(EurekaInstanceConfig config, InstanceInfo instanceInfo, OptionalArgs optionalArgs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.config = config;</div><div class="line">        <span class="keyword">this</span>.instanceInfo = instanceInfo;</div><div class="line">        <span class="keyword">this</span>.listeners = <span class="keyword">new</span> ConcurrentHashMap&lt;String, StatusChangeListener&gt;();</div><div class="line">        <span class="keyword">if</span> (optionalArgs != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">this</span>.instanceStatusMapper = optionalArgs.getInstanceStatusMapper();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">this</span>.instanceStatusMapper = NO_OP_MAPPER;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// Hack to allow for getInstance() to use the DI'd ApplicationInfoManager</span></div><div class="line">        instance = <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// ... çœç•¥å…¶å®ƒæ–¹æ³•</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li><code>listeners</code> å±æ€§ï¼ŒçŠ¶æ€å˜æ›´ç›‘å¬å™¨é›†åˆã€‚åœ¨<a href="http://www.iocoder.cn/Eureka/instance-registry-register/?self">ã€ŠEureka æºç è§£æ â€”â€” åº”ç”¨å®ä¾‹æ³¨å†Œå‘ç° ï¼ˆä¸€ï¼‰ä¹‹æ³¨å†Œã€‹ã€Œ2.1 åº”ç”¨å®ä¾‹ä¿¡æ¯å¤åˆ¶å™¨ã€</a>æœ‰è¯¦ç»†è§£æã€‚</li><li><p><code>instanceStatusMapper</code> å±æ€§ï¼Œåº”ç”¨å®ä¾‹çŠ¶æ€åŒ¹é…ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">// ApplicationInfoManager.java</span></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">interface</span> <span class="title">InstanceStatusMapper</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> InstanceStatusMapper NO_OP_MAPPER = <span class="keyword">new</span> InstanceStatusMapper() &#123;</div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> InstanceStatus <span class="title">map</span><span class="params">(InstanceStatus prev)</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> prev;</div><div class="line">   &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure><ul><li><code>#map</code> æ–¹æ³•ï¼Œæ ¹æ®ä¼ å…¥ <code>pre</code> å‚æ•°ï¼Œè½¬æ¢æˆå¯¹åº”çš„åº”ç”¨å®ä¾‹çŠ¶æ€ã€‚</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨ NO_OP_MAPPER ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸éœ€è¦å…³æ³¨è¯¥ç±»ã€‚</li></ul></li></ul><h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>æ¶‰åŠåˆ°é…ç½®ï¼Œå†…å®¹åˆçœ‹èµ·æ¥ä¼šæ¯”è¾ƒå¤šï¼Œæ…¢æ…¢ç†è§£åï¼Œå°±ä¼šå˜å¾—å¾ˆâ€œå•°å—¦â€ï¼Œè¯·ä¿æŒè€å¿ƒã€‚</p><p>èƒ–å‹ï¼Œåˆ†äº«ä¸€ä¸ªæœ‹å‹åœˆå¯å¥½ã€‚</p></div><footer class="article-footer clearfix"><div class="article-categories"><span></span> <a class="article-category-link" href="/categories/Eureka/">Eureka</a></div><div class="article-share" id="share"><div data-url="http://www.iocoder.cn/Eureka/eureka-client-init-first/" data-title="Eureka æºç è§£æ â€”â€” Eureka-Client åˆå§‹åŒ–ï¼ˆä¸€ï¼‰ä¹‹ EurekaInstanceConfig | èŠ‹é“æºç  â€”â€” çº¯æºç è§£æåšå®¢" data-tsina="null" class="share clearfix"></div></div></footer></article><nav class="article-nav clearfix"><div class="prev"><a href="/Eureka/eureka-client-init-second/" title="Eureka æºç è§£æ â€”â€” Eureka-Client åˆå§‹åŒ–ï¼ˆäºŒï¼‰ä¹‹ EurekaClientConfig"><strong>PREVIOUS:</strong><br><span>Eureka æºç è§£æ â€”â€” Eureka-Client åˆå§‹åŒ–ï¼ˆäºŒï¼‰ä¹‹ EurekaClientConfig</span></a></div><div class="next"><a href="/Eureka/build-debugging-environment/" title="Eureka æºç è§£æ â€”â€” è°ƒè¯•ç¯å¢ƒæ­å»º"><strong>NEXT:</strong><br><span>Eureka æºç è§£æ â€”â€” è°ƒè¯•ç¯å¢ƒæ­å»º</span></a></div></nav></div><div class="openaside"><a class="navbutton" href="#" title="æ˜¾ç¤ºä¾§è¾¹æ "></a></div><div id="toc" class="toc-aside"><strong class="toc-title">æ–‡ç« ç›®å½•</strong><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-æ¦‚è¿°"><span class="toc-number">1.</span> <span class="toc-text">1. æ¦‚è¿°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-EurekaInstanceConfig"><span class="toc-number">2.</span> <span class="toc-text">2. EurekaInstanceConfig</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-ç±»å…³ç³»å›¾"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 ç±»å…³ç³»å›¾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-é…ç½®å±æ€§"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 é…ç½®å±æ€§</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-AbstractInstanceConfig"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 AbstractInstanceConfig</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-PropertiesInstanceConfig"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 PropertiesInstanceConfig</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-MyDataCenterInstanceConfig"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 MyDataCenterInstanceConfig</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-å°ç»“"><span class="toc-number">2.6.</span> <span class="toc-text">2.6 å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-InstanceInfo"><span class="toc-number">3.</span> <span class="toc-text">3. InstanceInfo</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-ApplicationInfoManager"><span class="toc-number">4.</span> <span class="toc-text">4. ApplicationInfoManager</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#666-å½©è›‹"><span class="toc-number">5.</span> <span class="toc-text">666. å½©è›‹</span></a></li></ol></div><div id="asidepart"><aside class="clearfix"><div id="authorInfo"><div><img width="100%" src="/images/common/wechat_mp_2017_07_31_bak.jpg"></div><div class="social-list"></div></div><div class="categorieslist"><p class="asidetitle">å¾®ä¿¡å…¬ä¼—å·ç¦åˆ©ï¼šèŠ‹é“æºç </p><ul><li><a href="/images/common/wechat_mp_2017_07_31_bak.jpg">0. é˜…è¯»æºç è‘µèŠ±å®å…¸</a></li><li><a href="/images/common/wechat_mp_2017_07_31_bak.jpg">1. RocketMQ / MyCAT / Sharding-JDBC è¯¦ç»†ä¸­æ–‡æ³¨é‡Šæºç </a></li><li><a href="/images/common/wechat_mp_2017_07_31_bak.jpg">2. æ‚¨å¯¹äºæºç çš„ç–‘é—®æ¯æ¡ç•™è¨€éƒ½å°†å¾—åˆ°è®¤çœŸå›å¤</a></li><li><a href="/images/common/wechat_mp_2017_07_31_bak.jpg">3. æ–°çš„æºç è§£ææ–‡ç« å®æ—¶æ”¶åˆ°é€šçŸ¥ï¼Œæ¯å‘¨å…­åç‚¹æ›´æ–°</a></li><li><a href="/images/common/wechat_mp_2017_07_31_bak.jpg">4. è®¤çœŸçš„æºç äº¤æµå¾®ä¿¡ç¾¤</a></li></ul></div><div class="categorieslist"><p class="asidetitle">åˆ†ç±»</p><ul><li><a href="/categories/Docker/" title="Docker">Docker<sup>2</sup></a></li><li><a href="/categories/Dubbo/" title="Dubbo">Dubbo<sup>1</sup></a></li><li><a href="/categories/Elastic-Job-Cloud/" title="Elastic-Job-Cloud">Elastic-Job-Cloud<sup>6</sup></a></li><li><a href="/categories/Elastic-Job-Lite/" title="Elastic-Job-Lite">Elastic-Job-Lite<sup>16</sup></a></li><li><a href="/categories/Eureka/" title="Eureka">Eureka<sup>23</sup></a></li><li><a href="/categories/Happylifeplat-TCC/" title="Happylifeplat-TCC">Happylifeplat-TCC<sup>1</sup></a></li><li><a href="/categories/Hystrix/" title="Hystrix">Hystrix<sup>9</sup></a></li><li><a href="/categories/JUC/" title="JUC">JUC<sup>1</sup></a></li><li><a href="/categories/MyCAT/" title="MyCAT">MyCAT<sup>9</sup></a></li><li><a href="/categories/Myth/" title="Myth">Myth<sup>1</sup></a></li><li><a href="/categories/Nginx/" title="Nginx">Nginx<sup>1</sup></a></li><li><a href="/categories/RocketMQ/" title="RocketMQ">RocketMQ<sup>14</sup></a></li><li><a href="/categories/RxJava/" title="RxJava">RxJava<sup>5</sup></a></li><li><a href="/categories/Sharding-JDBC/" title="Sharding-JDBC">Sharding-JDBC<sup>18</sup></a></li><li><a href="/categories/SkyWalking/" title="SkyWalking">SkyWalking<sup>35</sup></a></li><li><a href="/categories/Spring/" title="Spring">Spring<sup>1</sup></a></li><li><a href="/categories/Spring-Cloud-Gateway/" title="Spring-Cloud-Gateway">Spring-Cloud-Gateway<sup>24</sup></a></li><li><a href="/categories/Spring-MVC/" title="Spring-MVC">Spring-MVC<sup>1</sup></a></li><li><a href="/categories/Spring-Security/" title="Spring-Security">Spring-Security<sup>1</sup></a></li><li><a href="/categories/TCC-Transaction/" title="TCC-Transaction">TCC-Transaction<sup>7</sup></a></li><li><a href="/categories/TiKV/" title="TiKV">TiKV<sup>2</sup></a></li><li><a href="/categories/å·¥ä½œå†…æ¨/" title="å·¥ä½œå†…æ¨">å·¥ä½œå†…æ¨<sup>4</sup></a></li><li><a href="/categories/æŠ€æœ¯æ‚æ–‡/" title="æŠ€æœ¯æ‚æ–‡">æŠ€æœ¯æ‚æ–‡<sup>5</sup></a></li><li><a href="/categories/æ•°æ®åº“å®ä½“è®¾è®¡/" title="æ•°æ®åº“å®ä½“è®¾è®¡">æ•°æ®åº“å®ä½“è®¾è®¡<sup>1</sup></a></li><li><a href="/categories/èŠ‹é“æºç çš„å‘¨å…«/" title="èŠ‹é“æºç çš„å‘¨å…«">èŠ‹é“æºç çš„å‘¨å…«<sup>3</sup></a></li></ul></div></aside></div></div><footer><div id="footer"><img src="http://www.iocoder.cn/images/common/wechat_mp_simple.png" style="display:none"><p class="copyright">Â© 2018 <a href="http://www.iocoder.cn" target="_blank" title="èŠ‹é“æºç ">èŠ‹é“æºç </a> && <span style="display:inline" id="busuanzi_container_site_uv">æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv" font="å¾®è½¯é›…é»‘"></span> æ¬¡</span> && <span style="display:inline" id="busuanzi_container_site_pv">æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv" font="å¾®è½¯é›…é»‘"></span> æ¬¡</span></p></div><div class="copyright">æ²ªICPå¤‡17037075å·-1</div></footer><script src="/js/jquery-2.1.0.min.js"></script><script type="text/javascript">$(document).ready(function(){function e(){"number"==typeof window.innerWidth?n=window.innerWidth:document.documentElement&&document.documentElement.clientWidth&&(n=document.documentElement.clientWidth)}$(".navbar").click(function(){$("header nav").toggleClass("shownav")});var n=0,s=$("#main"),a=$("#asidepart"),o=$(".closeaside"),d=$(".openaside");$(window).resize(function(){e(),n>=1024?$("header nav").removeClass("shownav"):(s.removeClass("moveMain"),a.css("display","block").removeClass("fadeOut"),d.css("display","none"),$("#toc.toc-aside").css("display","none"))}),o.click(function(){a.addClass("fadeOut").css("display","none"),d.css("display","block").addClass("fadeIn"),s.addClass("moveMain")}),d.click(function(){d.css("display","none").removeClass("beforeFadeIn"),a.css("display","block").removeClass("fadeOut").addClass("fadeIn"),s.removeClass("moveMain")}),$(window).scroll(function(){d.css("top",Math.max(80,260-$(this).scrollTop()))})})</script><script type="text/javascript">$(document).ready(function(){var a=$(".article-content>iframe"),t=$(".article-content>embed"),n=$("#toc");$("article h2");ah=$("article h2"),ta=$("#toc.toc-aside"),o=$(".openaside"),c=$(".closeaside"),a.length>0&&a.wrap('<div class="video-container" />'),t.length>0&&t.wrap('<div class="video-container" />'),0==ah.length?n.css("display","none"):(c.click(function(){ta.css("display","block").addClass("fadeIn")}),o.click(function(){ta.css("display","none")}),$(window).scroll(function(){ta.css("top",Math.max(140,320-$(this).scrollTop()))}))})</script><script type="text/javascript">$(document).ready(function(){var t=$(".share"),a=t.attr("data-url"),e=encodeURIComponent(a),r=['<a href="#" class="overlay" id="qrcode"></a>','<div class="qrcode clearfix"><span>æ‰«æäºŒç»´ç åˆ†äº«åˆ°å¾®ä¿¡æœ‹å‹åœˆ</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url='+e+'"/></div>','<a href="#textlogo" class="article-back-to-top" title="Top"></a>','<a href="https://www.facebook.com/sharer.php?u='+e+'" class="article-share-facebook" target="_blank" title="Facebook"></a>','<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>','<a href="https://twitter.com/intent/tweet?url='+e+'" class="article-share-twitter" target="_blank" title="Twitter"></a>','<a href="http://service.weibo.com/share/share.php?title='+t.attr("data-title")+"&url="+e+"&ralateUid="+t.attr("data-tsina")+'&searchPic=true&style=number" class="article-share-weibo" target="_blank" title="Weibo"></a>','<span title="Share to"></span>'].join("");t.append(r),$(".article-share-qrcode").click(function(){var t=$("#qrcode-pic").attr("data-src");$("#qrcode-pic").attr("src",t),$("#qrcode-pic").load(function(){$(".qrcode strong").text(" ")})})})</script><link rel="stylesheet" href="/alert/css/alert.css"><script src="/alert/js/alert.js"></script><script src="/js/jquery.cookie.js"></script><script src="/js/util.js"></script><script type="text/javascript">!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",s.parentNode.insertBefore(o,s)}(window,document,"script",0,"ga"),ga("create","UA-107572620-1","auto"),ga("send","pageview")</script></body>